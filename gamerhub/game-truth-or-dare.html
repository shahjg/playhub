<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Truth or Dare - PlayHub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* CSS STYLES (Omitted for brevity, using final approved version) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #fafbff; color: #1a1a1a; overflow-x: hidden; position: relative; min-height: 100vh; }
        h1, h2, h3 { font-family: 'Bebas Neue', sans-serif; letter-spacing: 1px; }

        /* Animated background blobs */
        .bg-shape { position: fixed; pointer-events: none; z-index: 0; opacity: 0.6; }
        .shape-1 { top: -80px; right: -80px; width: 350px; height: 350px; background: linear-gradient(135deg, #ff6b9d30 0%, #c4456930 100%); border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; animation: morph 10s ease-in-out infinite; }
        .shape-2 { top: 50%; left: -120px; width: 300px; height: 300px; background: linear-gradient(135deg, #ff6b9d30 0%, #c4456930 100%); border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; animation: morph 12s ease-in-out infinite reverse; }
        .shape-3 { bottom: -80px; right: 15%; width: 280px; height: 280px; background: linear-gradient(135deg, #ff6b9d30 0%, #c4456930 100%); border-radius: 50% 50% 30% 70% / 50% 50% 70% 30%; animation: morph 14s ease-in-out infinite; }
        @keyframes morph { 0%, 100% { border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; transform: rotate(0deg); } 50% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; transform: rotate(5deg); } }

        .container { max-width: 900px; margin: 0 auto; padding: 0 40px; position: relative; z-index: 1; min-height: 100vh; display: flex; flex-direction: column; }
        
        /* Navigation */
        nav { padding: 30px 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #1a1a1a; margin-bottom: 40px; position: relative; z-index: 10; }
        .logo-nav { font-family: 'Bebas Neue', sans-serif; font-size: 2.1rem; letter-spacing: 2px; color: #1a1a1a; text-decoration: none; }
        .back-btn { display: inline-flex; align-items: center; gap: 8px; color: #666; text-decoration: none; font-weight: 700; font-size: 0.95rem; transition: color 0.3s ease; }
        .back-btn:hover { color: #1a1a1a; }

        /* General Content */
        .game-content { flex: 1; display: flex; flex-direction: column; padding-bottom: 60px; }
        .hidden { display: none !important; }

        /* --- SCREEN STYLES (Category, Pack Selection) --- */
        .selection-screen { max-width: 800px; margin: 40px auto; }
        .selection-header { text-align: center; margin-bottom: 50px; }
        .selection-header h2 { font-size: 4.5rem; line-height: 1; margin-bottom: 15px; text-shadow: 2px 2px 0 rgba(255, 107, 157, 0.2); }
        .selection-header p { font-size: 1.2rem; color: #666; font-weight: 500; }
        
        /* 3x2 Grid for 6 categories */
        .selection-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; } 
        
        .selection-card { background: white; border: 3px solid #1a1a1a; padding: 40px 30px; cursor: pointer; transition: all 0.3s ease; box-shadow: 5px 5px 0 #e0e0e0; text-align: center; }
        .selection-card:hover { transform: translate(2px, -2px); box-shadow: 3px 3px 0 #e0e0e0; }
        .selection-icon { font-size: 3rem; margin-bottom: 15px; }
        .selection-card h3 { font-size: 2rem; margin-bottom: 10px; line-height: 1; }
        .selection-description { font-size: 0.95rem; color: #666; margin-bottom: 12px; font-weight: 500; line-height: 1.5; }

        /* Pack Specific Styles */
        .packs-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; } 
        .pack-card { background: white; border: 3px solid #1a1a1a; padding: 35px 25px; cursor: pointer; transition: all 0.3s ease; box-shadow: 5px 5px 0 #e0e0e0; text-align: center; }
        .pack-number { font-family: 'Bebas Neue', sans-serif; font-size: 3rem; color: #ff6b9d; margin-bottom: 10px; line-height: 1; }
        .pack-questions { font-family: 'Bebas Neue', sans-serif; font-size: 0.9rem; color: #666; letter-spacing: 1px; }

        .back-link { display: inline-flex; align-items: center; gap: 8px; color: #666; text-decoration: none; font-weight: 700; font-size: 0.95rem; cursor: pointer; margin-bottom: 30px; }
        .back-link:hover { color: #1a1a1a; }

        /* --- GAME SCREEN STYLES --- */
        .game-screen { display: none; }
        .progress-bar-container { background: white; border: 3px solid #1a1a1a; padding: 8px; margin-bottom: 40px; box-shadow: 4px 4px 0 #e0e0e0; }
        .progress-bar { height: 12px; background: #f0f0f0; position: relative; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%); transition: width 0.3s ease; }
        .game-header { text-align: center; margin-bottom: 40px; position: relative; }
        .quit-btn { position: absolute; right: 0; top: 0; background: white; border: 2px solid #1a1a1a; padding: 8px 20px; font-family: 'Bebas Neue', sans-serif; font-size: 1rem; letter-spacing: 1px; cursor: pointer; transition: all 0.3s ease; color: #666; }
        .quit-btn:hover { background: #f0f0f0; color: #1a1a1a; }
        
        .mode-label { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; color: #ff6b9d; letter-spacing: 2px; margin-bottom: 8px; }
        .prompt-counter { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; color: #666; letter-spacing: 1px; }

        /* FIXED: Player Choice Screen (White background) */
        .choice-screen {
            display: none; 
            text-align: center;
            padding: 60px 50px; 
            margin-bottom: 40px; 
            min-height: 280px; 
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            background: white; 
            color: #1a1a1a; 
            border: 4px solid #1a1a1a; 
            box-shadow: 8px 8px 0 #e0e0e0; 
        }
        .choice-screen h2 {
            font-size: 3.5rem;
            color: #1a1a1a; 
            text-shadow: 3px 3px 0 rgba(255, 107, 157, 0.2); 
            margin-bottom: 20px;
        }
        .choice-instruction {
            font-size: 1.4rem;
            font-weight: 500;
            margin-bottom: 40px;
            color: #666;
        }
        .choice-buttons {
            display: flex;
            gap: 20px;
        }
        .choice-buttons .primary {
            padding: 18px 40px;
            font-size: 1.5rem;
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 1px;
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
            border-color: #8b2e47;
            box-shadow: 5px 5px 0 #8b2e47;
            cursor: pointer;
            color: white;
        }

        /* Prompt Card (Visible ONLY after choice) */
        .prompt-card { 
            display: none;
            background: white; 
            color: #1a1a1a; 
            border: 4px solid #1a1a1a; 
            padding: 60px 50px; 
            margin-bottom: 40px; 
            box-shadow: 8px 8px 0 #e0e0e0; 
            min-height: 280px; 
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            text-align: center;
        }
        
        .prompt-label {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            color: #ff6b9d;
            margin-bottom: 15px;
            line-height: 1;
        }

        .prompt-text { font-size: 1.8rem; line-height: 1.5; font-weight: 600; color: #1a1a1a; }
        .answer-prompt { font-size: 1rem; color: #666; font-weight: 700; margin-top: 20px; }
        
        .navigation { display: flex; gap: 15px; justify-content: center; }
        .nav-btn { flex: 1; padding: 18px 30px; font-size: 1.2rem; font-family: 'Bebas Neue', sans-serif; letter-spacing: 1px; border: 3px solid #1a1a1a; cursor: pointer; transition: all 0.3s ease; }
        .nav-btn.prev { background: white; color: #1a1a1a; box-shadow: 5px 5px 0 #e0e0e0; flex-grow: 0.5; }
        .nav-btn.next { background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%); color: white; border-color: #8b2e47; box-shadow: 5px 5px 0 #8b2e47; flex-grow: 1; }
        .nav-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        /* End Screen - FIXED: Button Sizing */
        .end-screen { display: none; text-align: center; max-width: 700px; margin: 80px auto; }
        .end-screen h2 { font-size: 5.5rem; line-height: 1; margin-bottom: 30px; text-shadow: 3px 3px 0 rgba(255, 107, 157, 0.2); }
        .end-message { font-size: 1.3rem; line-height: 1.8; color: #666; margin-bottom: 50px; font-weight: 500; }
        
        .end-actions { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            width: 100%; 
        }

        .action-btn { 
            padding: 20px 50px; 
            font-size: 1.3rem; 
            font-family: 'Bebas Neue', sans-serif; 
            letter-spacing: 1px; 
            border: 3px solid #1a1a1a; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            width: 100%; 
        }
        .action-btn.primary { background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%); color: white; border-color: #8b2e47; box-shadow: 5px 5px 0 #8b2e47; }
        .action-btn.secondary { background: white; color: #1a1a1a; box-shadow: 5px 5px 0 #e0e0e0; }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container { padding: 0 20px; }
            .selection-header h2, .end-screen h2, .choice-screen h2 { font-size: 3.5rem; }
            .selection-grid { grid-template-columns: 1fr; } 
            .packs-grid { grid-template-columns: 1fr; }
            .choice-buttons { flex-direction: column; gap: 10px; }
            .prompt-text { font-size: 1.4rem; }
            .prompt-card, .choice-screen { padding: 40px 30px; min-height: 240px; }
            .nav-btn { font-size: 1.1rem; padding: 15px 20px; }
        }
    </style>
</head>
<body>
    <div class="bg-shape shape-1"></div>
    <div class="bg-shape shape-2"></div>
    <div class="bg-shape shape-3"></div>

    <div class="container">
        <nav>
            <a href="index.html" class="logo-nav">PLAYHUB</a>
            <a href="date-night.html" class="back-btn">
                ‚Üê Back to Games
            </a>
        </nav>

        <div class="game-content">
            
            <div class="selection-screen" id="categorySelection">
                <div class="selection-header">
                    <h2>TRUTH OR DARE</h2>
                    <p>Choose your level‚Äîanswer the truth or face the dare!</p>
                </div>

                <div class="selection-grid">
                    <div class="selection-card" onclick="showPacks('flirty')"> <div class="selection-icon">üíã</div> <h3>FLIRTY & FUN</h3> <p class="selection-description">Light secrets and playful, romantic physical dares.</p> </div>
                    <div class="selection-card" onclick="showPacks('deep')"> <div class="selection-icon">üí≠</div> <h3>DEEP CONVERSATION</h3> <p class="selection-description">Serious questions on regrets, goals, and emotional connection.</p> </div>
                    <div class="selection-card" onclick="showPacks('spicy')"> <div class="selection-icon">üî•</div> <h3>SPICY & DARING</h3> <p class="selection-description">Intimate questions and sexy physical challenges.</p> </div>
                    <div class="selection-card" onclick="showPacks('past')"> <div class="selection-icon">üï∞Ô∏è</div> <h3>NOSTALGIA & SECRETS</h3> <p class="selection-description">Exposing embarrassing past moments, childhood secrets, and silly history.</p> </div>
                    <div class="selection-card" onclick="showPacks('future')"> <div class="selection-icon">‚ú®</div> <h3>FUTURE & FANTASY</h3> <p class="selection-description">Hypothetical choices about dreams, goals, and unbelievable futures.</p> </div>
                    <div class="selection-card" onclick="showPacks('silly')"> <div class="selection-icon">ü§™</div> <h3>SILLY & PHYSICAL</h3> <p class="selection-description">Focus on funny truths and silly physical dares to make your partner laugh.</p> </div>
                </div>
            </div>

            <div class="selection-screen hidden" id="packSelection">
                <span class="back-link" onclick="backToCategories()">‚Üê Back to Categories</span>
                
                <div class="selection-header">
                    <h2 id="packCategoryTitle"></h2>
                    <p>Choose a pack of 18 challenges</p>
                </div>

                <div class="packs-grid" id="packsGrid">
                    </div>
            </div>

            <div class="game-screen" id="gameScreen">
                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <div class="game-header">
                    <button class="quit-btn" onclick="quitToPacks()">QUIT</button>
                    <div class="mode-label">TRUTH OR DARE</div>
                    <div class="prompt-counter" id="promptCounter">CHALLENGE 1 OF 18</div>
                </div>

                <div class="choice-screen" id="choiceScreen">
                    <h2 id="currentPlayerTurn">PLAYER 1'S TURN</h2>
                    <p class="choice-instruction">Choose your fate: Truth or Dare?</p>
                    <div class="choice-buttons">
                        <button class="action-btn primary" onclick="revealPrompt('TRUTH')">TRUTH</button>
                        <button class="action-btn primary" onclick="revealPrompt('DARE')">DARE</button>
                    </div>
                </div>

                <div class="prompt-card" id="promptCard">
                    <p class="prompt-label" id="typeLabel">TRUTH</p>
                    <p class="prompt-text" id="promptText">What is the most ridiculous fight you've ever started?</p>
                    <p class="answer-prompt">Answer or Complete the Challenge, then click next!</p>
                </div>

                <div class="navigation">
                    <button class="nav-btn prev" id="prevBtn" onclick="previousPrompt()">‚Üê PREVIOUS</button>
                    <button class="nav-btn next" id="nextBtn" onclick="nextPrompt()">NEXT ‚Üí</button>
                </div>
            </div>

            <div class="end-screen" id="endScreen">
                <h2>YOU DID IT! üéâ</h2>
                <p class="end-message">Hope you chose wisely! You survived the challenges.</p>
                <div class="end-actions">
                    <button class="action-btn primary" onclick="backToPackSelection()">TRY ANOTHER PACK</button>
                    <button class="action-btn secondary" onclick="backToGames()">BACK TO DATE NIGHT</button>
                </div>
            </div>
        </div>

        <footer></footer>
    </div>

    <script>
        // --- GAME STATE & DATA ---
        let currentPromptIndex = 0;
        let currentCategory = '';
        let currentPack = '';
        let currentPlayer = 1; 
        let history = []; 
        const PROMPT_PER_PACK = 18; 
        
        // Decks containing the remaining prompts for the current game session
        let availableTruths = [];
        let availableDares = [];

        const categoryTitles = {
            'flirty': 'FLIRTY & FUN', 'deep': 'DEEP CONVERSATION', 'spicy': 'SPICY & DARING',
            'past': 'NOSTALGIA & SECRETS', 'future': 'FUTURE & FANTASY', 'silly': 'SILLY & PHYSICAL',
        };
        
        // Utility function to get a random item from a list (now used for shuffling)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // --- TRUTH OR DARE PROMPT DATA (Truths and Dares separated for choice) ---
        const tdPrompts = {
            flirty: {
                pack1: {
                    truths: [ "What‚Äôs your current biggest physical turn-on?", "What's the riskiest text message you've ever sent?", "What's the craziest thing you've done to impress a crush?", "What‚Äôs the most romantic thing I've done for you?", "What fictional character do you wish I looked like?", "What's the longest you've gone without a shower?", "What's your go-to sexy dance move?", "What's the most money you've spent on an impulse buy?", "What's the most embarrassing clothing item you still own?" ],
                    dares: [ "Give me a passionate kiss for 20 seconds.", "Let me give you a 30-second body massage.", "Send a flirty text to someone randomly in your contacts.", "Do your best catwalk strut across the room.", "Let me put makeup (or condiments) on your face.", "Take off your shirt and dance for 15 seconds.", "Write a love poem about my left ear.", "Blindfold me and feed me something.", "Talk in a foreign accent for the next 5 minutes." ],
                },
                pack2: {
                    truths: [ "What‚Äôs one thing you find sexy about me that isn't physical?", "If you could only keep one memory of us, what would it be?", "What's your honest opinion about my friends?", "What movie star would you secretly cheat on me with?", "What‚Äôs the most immature thing you do regularly?", "What outfit do you think I look best in?", "What‚Äôs the craziest food craving you've ever had?", "What's the strangest thing you find attractive?", "What do you think is my worst habit?" ],
                    dares: [ "Let me tickle you for 30 seconds without laughing.", "Act out the first kiss we had.", "Put ice cubes down your pants for 10 seconds.", "Give me three compliments without using the letter 'E'.", "Sing a romantic song using only animal sounds.", "Let me draw a permanent marker mustache on your face.", "Propose to me dramatically using only song lyrics.", "Wear your shirt backwards for the rest of the game.", "Try to lick your elbow." ]
                },
                pack3: {
                    truths: [ "What‚Äôs one thing you regret telling me?", "What's the most childish thing you still believe?", "Who is your celebrity free pass?", "What is your guilty pleasure TV show?", "What's the most romantic thing you've done that I don't know about?", "What's the worst meal I‚Äôve ever cooked?", "What‚Äôs one habit I have that you secretly love?", "What song describes our relationship best?", "What‚Äôs the last thing you cried about?" ],
                    dares: [ "Write the alphabet on my back using only your finger.", "Let me dress you for the next 10 minutes.", "Try to fit your fist in your mouth.", "Do the worm across the room.", "Take three large bites of a lemon.", "Attempt to juggle three random items.", "Give me a one-minute stand-up comedy routine.", "Make me laugh without using words.", "Pretend to be a traffic cop for two minutes." ]
                }
            },
            deep: {
                pack1: {
                    truths: [ "What‚Äôs the one goal I don‚Äôt know about?", "What‚Äôs your biggest insecurity right now?", "What's a secret dream you gave up on?", "What‚Äôs the one thing you always hide from everyone?", "What's a major regret you wish you could undo?", "Who is the last person you cried in front of?", "What‚Äôs one thing you need from me right now?", "What‚Äôs the biggest lie you've ever told your parents?", "What did you learn from your last mistake?" ],
                    dares: [ "Call a family member and tell them you love them.", "Write down the three things you like most about me.", "Post a cringe-worthy status/story on social media right now.", "Go outside and sing 'Twinkle Twinkle Little Star' loudly.", "Do 25 push-ups (or sit-ups).", "Show me the last 5 photos in your camera roll and explain them.", "Act like a monkey until you make me laugh.", "Tell me a secret you've kept for over a year.", "Tell me about the worst mistake you ever made." ]
                },
                pack2: {
                    truths: [ "What's the deepest emotional pain you're still working through?", "What is your biggest fear about our relationship?", "What's one thing you're deeply proud of me for?", "What does 'home' truly mean to you?", "If you could change one thing about your personality, what would it be?", "What makes you feel truly seen and understood?", "What is a sacrifice you made for our relationship?", "What‚Äôs your opinion on our sex life right now (1-10)?", "What is a financial worry you have for our future?" ],
                    dares: [ "Stare into my eyes for one minute without blinking.", "Write down a quality you wish you possessed.", "Tell me one thing you've never told anyone.", "Spend 5 minutes talking about a topic you passionately hate.", "Write a letter to your past self and read it out loud.", "Explain a moment where you felt profound gratitude.", "Confess one time you thought about breaking up with me.", "Call your best friend and tell them how much you appreciate them.", "Name one thing you wish I'd stop doing." ]
                },
                pack3: {
                    truths: [ "What is a secret shame you carry?", "What's the one thing you refuse to compromise on?", "What makes you feel unworthy of love?", "What do you value more: loyalty or honesty?", "What's a life goal you haven't told anyone about?", "What's the biggest insecurity you have when arguing with me?", "What is the most irresponsible thing you've done with money?", "Who had the biggest impact on the person you are today?", "What's your biggest personal weakness?" ],
                    dares: [ "Plan our dream trip right now (1 minute).", "Act out the last time you were truly angry.", "Read the most embarrassing text message you've ever received.", "Recite the Pledge of Allegiance while holding your breath.", "Write a one-sentence summary of your life philosophy.", "Show me a talent that you rarely share with anyone.", "Dance passionately to a piece of classical music.", "Give me the longest compliment you can think of.", "Show me your best impression of me." ]
                }
            },
            spicy: {
                pack1: {
                    truths: [ "What's the craziest place you've ever hooked up?", "What's your biggest sexual fantasy?", "Who is the last person you fantasized about (outside of me)?", "What's your honest opinion on exhibitionism?", "What's the most scandalous thing you've ever worn?", "What's the longest you've gone without intimacy?", "What's the hottest thing you've ever seen me wear?", "What's a secret habit you have in bed?", "What's the dirtiest phrase you know in a foreign language?" ],
                    dares: [ "Take a piece of clothing off.", "Show me the underwear you're currently wearing.", "Whisper a naughty fantasy directly in my ear.", "Give me a slow, sensual body rub for one minute.", "Act out a movie scene using only seductive sounds.", "Bite your lip and maintain eye contact for 10 seconds.", "Show me your best seductive walk.", "Write a very dirty word on your forehead.", "Act out your favorite position." ]
                },
                pack2: {
                    truths: [ "What's the sexiest scenario you‚Äôve daydreamed about us?", "What's the biggest physical turn-off for you?", "What's one thing you want to try in the bedroom soon?", "What's your biggest deal-breaker in intimacy?", "What‚Äôs the fastest you've ever fallen out of love?", "What is your ultimate 'free pass' celebrity?", "What's one thing I do that makes you instantly wet/hard?", "Have you ever made out with someone in this room (besides me)?", "What‚Äôs the most fun you've had with a partner besides sex?" ],
                    dares: [ "Take a selfie doing your best 'bedroom eyes'.", "Take a shot of something spicy (hot sauce, pepper).", "Give me a lap dance for 30 seconds.", "Blindfold me and use only my hands to kiss my neck.", "Whisper a compliment about my body I haven't heard before.", "Make out with your arm as if it were me.", "Do the slow motion run from Baywatch.", "Let me remove one piece of your clothing using only my teeth.", "Lick a line of salt off my hand." ]
                },
                pack3: {
                    truths: [ "What's the most awkward sexual moment you‚Äôve had with anyone?", "Have you ever faked an orgasm (with me or someone else)?", "What‚Äôs one thing you always hide from me about your sexual past?", "Have you ever had a one-night stand that you regretted?", "What's the dirtiest thing you've done in a movie theater?", "What‚Äôs a secret fantasy you have that you think is too weird to share?", "What is one thing I do during sex that you want more of?", "What‚Äôs the biggest physical risk you‚Äôve taken?", "What is your favorite body part on me?" ],
                    dares: [ "Kiss me from my ankle up to my knee.", "Write 'I love sex' on your chest/stomach with a washable marker.", "Act out three non-verbal signals you use to indicate you want sex.", "Give me a two-minute foot massage.", "Wear your pants backwards for the rest of the game.", "Act out your partner's 'O' face.", "Take off your bra or socks without using your hands.", "Dance seductively to a nursery rhyme.", "Lick whipped cream off my cheek." ]
                }
            },
            past: {
                pack1: {
                    truths: [ "What‚Äôs the most embarrassing pet name you've had?", "What‚Äôs the biggest lie you told your best friend?", "What's the most irresponsible thing you've done?", "What's the worst fashion trend you followed?", "What‚Äôs the dumbest thing you did to impress an ex?", "What's one thing about your family I don't know?", "What‚Äôs the most immature way you‚Äôve handled a breakup?", "What's a secret language you used as a kid?", "What‚Äôs the most ridiculous rumor you started?" ],
                    dares: [ "Show me the worst haircut you've ever had a photo of.", "Tell me about a time you almost got arrested.", "Call your mother and sing her a lullaby.", "Write a poem about your current job.", "Act out your most embarrassing moment.", "Do 5 push-ups and yell your own name each time.", "Speak in a high-pitched voice until the next round.", "Show me the weirdest text thread you have.", "Stare at the ceiling and clap every time I say 'The'." ]
                },
                pack2: {
                    truths: [ "What's the most expensive thing you stole?", "What was your most regrettable teenage mistake?", "What's one physical feature you used to hate but now love?", "What‚Äôs the biggest lie on your resume?", "What's the most disgusting thing you've ever eaten?", "What's the most embarrassing item you've bought recently?", "What's a secret skill or talent you have?", "What's the weirdest dream you've ever had?", "What's one thing you wish your parents knew about your past?" ],
                    dares: [ "Describe your partner in a haiku (5-7-5 syllables).", "Pour a cup of water over your head.", "Do an interpretive dance about your breakfast.", "Let me pop any visible pimples on your face.", "Try to touch your nose with your tongue.", "Show me your saddest face.", "Pretend to be a dinosaur for one minute.", "Draw a funny picture of your partner on a sticky note.", "Do the chicken dance loudly." ]
                },
                pack3: {
                    truths: [ "What‚Äôs the biggest secret your family is hiding?", "What's the worst fight you've ever seen?", "What's your most expensive impulse purchase?", "What's the most embarrassing thing you've done while drunk/high?", "What's one thing you regret saying to a friend?", "What's the meanest thing you've ever done to a sibling?", "What's one thing you wish I'd change about my appearance?", "What's the most embarrassing text in your phone right now?", "What‚Äôs a bad habit I have that you've given up trying to fix?" ],
                    dares: [ "Give me an honest, unedited impression of my singing voice.", "Pretend the floor is lava and navigate the room.", "Try to put your foot behind your head.", "Sing the first line of every song you can think of until I say stop.", "Make a ridiculous face and hold it for one minute.", "Eat a spoonful of a condiment you hate (e.g., mustard/mayo).", "Do a handstand against the wall for 10 seconds.", "Let me paint your nails the ugliest color I can find.", "Put on three layers of mismatched clothing." ]
                }
            },
            future: {
                pack1: {
                    truths: [ "What‚Äôs your secret dream job if money weren‚Äôt an issue?", "What‚Äôs the one country you MUST visit before you die?", "What's the biggest risk you want us to take together?", "What's one major thing you want to accomplish in the next 5 years?", "What would you do if you won the lottery tomorrow?", "What's one thing you hope never changes about our relationship?", "What would you do if you suddenly became famous?", "What's the most significant thing you want to teach our future kids?", "What's one quality you secretly judge other couples for lacking?" ],
                    dares: [ "Plan our dream future home (where, style, 3 details) in 1 minute.", "Close your eyes and point to a random spot on a map. We have to go there someday.", "Write down a ridiculous business idea and try to sell it to me in 30 seconds.", "Act out a future argument we might have.", "Draw a mascot for our future relationship.", "Try to break dance to a piece of classical music.", "Act out a sci-fi character getting their powers.", "Give a 30-second motivational speech about achieving greatness.", "Pretend you are a superhero and give yourself a ridiculous name." ]
                },
                pack2: {
                    truths: [ "What's one thing you'd change about our current living situation?", "What would you do if you could fly for a day?", "What's the biggest sacrifice you'd make for my dream?", "What's the one celebrity interaction you would risk everything for?", "What's one skill you want to master together?", "What's one tradition you want us to start?", "What's one thing you hope I never tell anyone about you?", "What's your biggest pet peeve about society?", "What's the biggest difference in our long-term vision?" ],
                    dares: [ "Create a secret handshake for us right now.", "Act out a dramatic scene from a silent film.", "Call a random business and ask a ridiculous question.", "Try to lick your eyebrow.", "Blindly trust me to put a mystery item in your mouth.", "Tell me a secret you‚Äôve never told anyone.", "Give me an honest, detailed critique of my last outfit.", "Try to fit as many crackers/biscuits in your mouth as possible.", "Recite the alphabet backward." ]
                },
                pack3: {
                    truths: [ "What's the most unbelievable story about your life that is actually true?", "If you could change one thing about your physical appearance, what would it be?", "What's the most impulsive decision you've ever made?", "What's the biggest secret fear you have for our future together?", "What‚Äôs one thing you‚Äôve learned from our relationship that surprised you?", "If you could become invisible for a day, what would you do?", "What's the biggest life lesson you‚Äôve learned from me?", "What's the one thing you hope I never discover about your past?", "What‚Äôs the most difficult truth about yourself to admit?" ],
                    dares: [ "Act out a dramatic fight scene in slow motion.", "Serenade me with an improvised song about my shoes.", "Try to put on pants without using your hands.", "Make the sound of a chicken laying an egg.", "Give me a piggyback ride around the room.", "Pretend to be a puppet while I control your arms.", "Let me try to balance a spoon on your nose.", "Eat a spoonful of plain sugar.", "Blindly give me a handshake and tell me your best pickup line." ]
                }
            },
            silly: {
                pack1: {
                    truths: [ "What's the last childish thing you did alone?", "What's the silliest word you know?", "What's the most ridiculous gift you've ever received?", "What's the silliest reason you've ever cried?", "What's the weirdest noise you can make?", "What's the strangest food combination you secretly enjoy?", "What's the one thing you refuse to share?", "What's the most embarrassing item you have in your car/bag right now?", "What's the one piece of slang you secretly hate?" ],
                    dares: [ "Do the Macarena for 30 seconds.", "Try to imitate a famous cartoon character.", "Walk like a crab until the next round.", "Serenade me with a song about cheese.", "Try to peel a banana using only your feet.", "Tell me a secret while singing it.", "Pretend to be a superhero whose power is eating vegetables.", "Do your best zombie impression.", "Try to scare me by only whispering." ]
                },
                pack2: {
                    truths: [ "What's the most ridiculous thing you bought this week?", "What's one thing you do when you think you're alone?", "What‚Äôs the most embarrassing song you secretly love?", "What's the most childish punishment you've received as an adult?", "What's the one bad movie you genuinely love?", "What's the weirdest thing you've worn in the past week?", "What's a strange habit you picked up during lockdown?", "What's the dumbest thing you've argued about recently?", "What's the most pointless piece of trivia you know?" ],
                    dares: [ "Do a dramatic movie death scene.", "Put socks on your hands and touch your face.", "Eat a cracker without making any noise.", "Pretend you are a mime stuck in a glass box.", "Try to balance a feather on your head for 10 seconds.", "Only speak in riddles until the next turn.", "Walk around backward for the next two minutes.", "Act like a chicken crossing the road.", "Let me draw a funny animal on your leg." ]
                },
                pack3: {
                    truths: [ "What's the silliest dance you can do?", "What's the weirdest thing you've found in my bag/car?", "What's the strangest thing you've ever put in the microwave?", "What's the most embarrassing injury you've sustained?", "What's the most awkward thing you‚Äôve confessed to a child?", "What‚Äôs one thing you do that you hide from me?", "What‚Äôs the strangest rumor you've heard about me?", "What's your most embarrassing physical feature?", "What's the weirdest thing you've seen me do?" ],
                    dares: [ "Try to sing opera.", "Hide a random object and make me guess where it is using only 'hot' and 'cold'.", "Try to say three complicated tongue twisters correctly.", "Pretend to be stuck in slow motion.", "Give me a tour of the room as if you were a historian.", "Balance a book on your head and dance for 20 seconds.", "Try to mimic the sound of a crying baby.", "Pretend to be a washing machine on the spin cycle.", "Speak only in movie quotes until the next turn." ]
                }
            }
        };

        // Utility function to get a random item from a list
        function getRandomItem(list) {
            return list[Math.floor(Math.random() * list.length)];
        }

        // --- CORE GAME FUNCTIONS ---
        function init() {
            document.getElementById('categorySelection').style.display = 'block';
        }

        function showPacks(categoryId) {
            currentCategory = categoryId;
            document.getElementById('categorySelection').classList.add('hidden');
            document.getElementById('packSelection').classList.remove('hidden');
            
            document.getElementById('packCategoryTitle').textContent = categoryTitles[categoryId];
            
            const packsGrid = document.getElementById('packsGrid');
            packsGrid.innerHTML = '';
            
            const categoryPrompts = tdPrompts[categoryId];
            let packIndex = 1;

            for (const packId in categoryPrompts) {
                if (categoryPrompts.hasOwnProperty(packId) && categoryPrompts[packId].truths.length > 0) {
                    const promptsCount = categoryPrompts[packId].truths.length + categoryPrompts[packId].dares.length;
                    
                    const packCard = `
                        <div class="pack-card" onclick="selectPack('${packId}')">
                            <div class="pack-number">${packIndex}</div>
                            <h3>PACK ${packIndex}</h3>
                            <p class="pack-questions">${promptsCount} CHALLENGES</p>
                        </div>
                    `;
                    packsGrid.innerHTML += packCard;
                    packIndex++;
                }
            }
        }

        function selectPack(packId) {
            currentPack = packId;
            
            // --- LOAD AND SHUFFLE DECKS ---
            const data = tdPrompts[currentCategory][packId];
            availableTruths = [...data.truths]; // Make copies
            availableDares = [...data.dares]; // Make copies
            
            shuffleArray(availableTruths);
            shuffleArray(availableDares);
            // ----------------------------
            
            // Reset game state
            history = [];
            currentPromptIndex = 0;
            currentPlayer = 1; 
            
            document.getElementById('packSelection').classList.add('hidden');
            document.getElementById('gameScreen').style.display = 'block';
            
            // Start the game loop
            startTurn();
        }

        function startTurn() {
            // Show the choice screen, hide the prompt card
            document.getElementById('choiceScreen').style.display = 'flex';
            document.getElementById('promptCard').style.display = 'none';

            // Update player turn text
            document.getElementById('currentPlayerTurn').textContent = `PLAYER ${currentPlayer}'S TURN`;

            // Update progress bar and counter
            updateDisplay();
        }

        function revealPrompt(choiceType) {
            let chosenPrompt;

            if (choiceType === 'TRUTH') {
                if (availableTruths.length === 0) {
                    alert("No more unique TRUTH questions left in this pack!");
                    return;
                }
                chosenPrompt = availableTruths.pop(); // DRAW from the deck
            } else {
                if (availableDares.length === 0) {
                    alert("No more unique DARE challenges left in this pack!");
                    return;
                }
                chosenPrompt = availableDares.pop(); // DRAW from the deck
            }

            // Store the selected prompt in history
            const historyItem = {
                index: history.length,
                type: choiceType,
                prompt: chosenPrompt,
                player: currentPlayer
            };
            history.push(historyItem);
            
            // Update the game screen with the chosen prompt
            document.getElementById('typeLabel').textContent = choiceType;
            document.getElementById('promptText').textContent = chosenPrompt;

            // Show the prompt card, hide the choice screen
            document.getElementById('choiceScreen').style.display = 'none';
            document.getElementById('promptCard').style.display = 'flex';
        }

        function nextPrompt() {
            const totalPrompts = PROMPT_PER_PACK; 
            
            // Only proceed if a prompt has been revealed for the current turn
            if (document.getElementById('promptCard').style.display === 'flex') {
                
                // If we are at the last prompt slot, finish the game
                if (currentPromptIndex >= totalPrompts - 1) { 
                    showEndScreen();
                    return;
                }
                
                // Increment the index for the next player's choice
                currentPromptIndex++; 
                
                // Swap player turn
                currentPlayer = currentPlayer === 1 ? 2 : 1; 
                
                // Start the new turn by showing the choice screen
                startTurn();
            } else {
                 alert("Please choose Truth or Dare to continue!");
            }
        }

        function previousPrompt() {
            if (currentPromptIndex > 0) {
                // Decrement the virtual index
                currentPromptIndex--;
                
                // Find the prompt that was just revealed (to put it back)
                const itemToRestore = history[history.length - 1]; 
                
                // Return the prompt to the deck it came from
                if (itemToRestore.type === 'TRUTH') {
                    availableTruths.unshift(itemToRestore.prompt); // Put back on top
                } else {
                    availableDares.unshift(itemToRestore.prompt);
                }
                
                // Remove the last item from history (the challenge they just backed away from)
                history.pop();
                
                // Restore the player whose turn it was previously
                currentPlayer = currentPlayer === 1 ? 2 : 1; 
                
                // If history is not empty, reload the content of the *previous* turn
                if (history.length > 0) {
                     const lastItem = history[history.length - 1];
                     
                     // Display the choice screen for the player who originally chose this prompt
                     document.getElementById('currentPlayerTurn').textContent = `PLAYER ${lastItem.player}'S TURN`;
                     document.getElementById('typeLabel').textContent = lastItem.type;
                     document.getElementById('promptText').textContent = lastItem.prompt;
                     
                     // Show the result of the choice
                     document.getElementById('choiceScreen').style.display = 'none';
                     document.getElementById('promptCard').style.display = 'flex';

                } else {
                    // If history is empty, reset to P1 choice screen
                    currentPlayer = 1;
                    startTurn();
                }
                updateDisplay();
            }
        }

        function updateDisplay() {
            const totalPrompts = PROMPT_PER_PACK;
            const promptsPlayed = currentPromptIndex;
            const progress = (promptsPlayed / totalPrompts) * 100;
            
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('promptCounter').textContent = `CHALLENGE ${promptsPlayed + 1} OF ${totalPrompts}`;

            document.getElementById('prevBtn').disabled = currentPromptIndex === 0;
            
            const isFinalTurn = (currentPromptIndex === totalPrompts - 1);
            if (isFinalTurn) {
                document.getElementById('nextBtn').textContent = 'FINISH';
            } else {
                document.getElementById('nextBtn').textContent = 'NEXT ‚Üí';
            }
        }


        // --- BACK/QUIT FUNCTIONS ---
        function backToCategories() {
            document.getElementById('packSelection').classList.add('hidden');
            document.getElementById('categorySelection').classList.remove('hidden');
            history = [];
            currentPromptIndex = 0;
            currentPlayer = 1;
        }

        function quitToPacks() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('packSelection').classList.remove('hidden');
            history = [];
            currentPromptIndex = 0;
            currentPlayer = 1;
        }

        function showEndScreen() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('endScreen').style.display = 'block';
        }

        function backToPackSelection() {
            document.getElementById('endScreen').style.display = 'none';
            document.getElementById('packSelection').classList.remove('hidden');
            history = [];
            currentPromptIndex = 0;
            currentPlayer = 1;
        }

        function backToGames() {
            window.location.href = 'date-night.html';
        }

        window.onload = init;
    </script>
</body>
</html>
