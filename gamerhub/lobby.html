<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Game - TheGaming.co</title>
    <meta name="description" content="Create or join a game room.">
    <link rel="stylesheet" href="/header.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --accent: #14b8a6; --accent-glow: rgba(20,184,166,0.4); --accent-soft: rgba(20,184,166,0.12); --bg: #0a0a0f; --border: rgba(255,255,255,0.08); --text: #fff; --muted: rgba(255,255,255,0.5); }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; }

        .bg-container { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
        .bg-base { position: absolute; inset: 0; }
        .bg-scene { position: absolute; inset: 0; }
        .bg-scene::before, .bg-scene::after { content: ''; position: absolute; }

        /* SPYFALL */
        .theme-spyfall { --accent: #14b8a6; --accent-glow: rgba(20,184,166,0.4); --accent-soft: rgba(20,184,166,0.12); }
        .theme-spyfall .bg-base { background: linear-gradient(180deg, #061515, #0a0a0f); }
        .theme-spyfall .bg-scene::before { inset: 0; background: repeating-linear-gradient(90deg, transparent 0 80px, rgba(20,184,166,0.03) 80px 81px), repeating-linear-gradient(0deg, transparent 0 80px, rgba(20,184,166,0.03) 80px 81px); }
        .theme-spyfall .bg-scene::after { top: 5%; left: 50%; transform: translateX(-50%); width: 300px; height: 300px; background: radial-gradient(circle, rgba(20,184,166,0.3), transparent 70%); border-radius: 50%; filter: blur(60px); animation: pulse 4s ease-in-out infinite; }

        /* AVALON */
        .theme-avalon { --accent: #fbbf24; --accent-glow: rgba(251,191,36,0.4); --accent-soft: rgba(251,191,36,0.12); }
        .theme-avalon .bg-base { background: linear-gradient(180deg, #15120a, #0a0a0f); }
        .theme-avalon .bg-scene::before { bottom: 0; left: 0; right: 0; height: 50%; background: linear-gradient(0deg, rgba(251,191,36,0.1), transparent); }
        .theme-avalon .bg-scene::after { top: 8%; left: 50%; transform: translateX(-50%); width: 100px; height: 100px; font-size: 80px; content: 'üëë'; opacity: 0.15; animation: float 4s ease-in-out infinite; }

        /* WEREWOLF */
        .theme-werewolf { --accent: #a855f7; --accent-glow: rgba(168,85,247,0.4); --accent-soft: rgba(168,85,247,0.12); }
        .theme-werewolf .bg-base { background: linear-gradient(180deg, #0f0818, #0a0a0f); }
        .theme-werewolf .bg-scene::before { top: 8%; right: 12%; width: 100px; height: 100px; background: radial-gradient(circle, rgba(255,255,220,0.9), rgba(255,255,220,0.2) 40%, transparent 70%); border-radius: 50%; box-shadow: 0 0 80px rgba(168,85,247,0.5); animation: float 8s ease-in-out infinite; }

        /* IMPOSTER */
        .theme-imposter { --accent: #ef4444; --accent-glow: rgba(239,68,68,0.4); --accent-soft: rgba(239,68,68,0.12); }
        .theme-imposter .bg-base { background: linear-gradient(180deg, #150808, #0a0a0f); }
        .theme-imposter .bg-scene::before { inset: 0; background: repeating-linear-gradient(45deg, transparent 0 30px, rgba(239,68,68,0.03) 30px 32px); animation: alertPulse 2s ease-in-out infinite; }
        .theme-imposter .bg-scene::after { top: 10%; left: 50%; transform: translateX(-50%); font-size: 100px; content: '‚ö†'; opacity: 0.1; color: #ef4444; animation: blink 1.5s ease-in-out infinite; }

        /* FAKE ARTIST */
        .theme-fake-artist { --accent: #ec4899; --accent-glow: rgba(236,72,153,0.4); --accent-soft: rgba(236,72,153,0.12); }
        .theme-fake-artist .bg-base { background: linear-gradient(135deg, #150a12, #0a0a0f 50%, #0a1015); }
        .theme-fake-artist .bg-scene::before { inset: 0; background: radial-gradient(circle at 15% 20%, rgba(236,72,153,0.15), transparent 25%), radial-gradient(circle at 85% 30%, rgba(168,85,247,0.12), transparent 25%), radial-gradient(circle at 70% 80%, rgba(59,130,246,0.1), transparent 20%); }

        /* CODENAMES */
        .theme-codenames { --accent: #22c55e; --accent-glow: rgba(34,197,94,0.4); --accent-soft: rgba(34,197,94,0.12); }
        .theme-codenames .bg-base { background: linear-gradient(180deg, #08120a, #0a0a0f); }
        .theme-codenames .bg-scene::before { inset: 0; background: repeating-linear-gradient(90deg, transparent 0 60px, rgba(34,197,94,0.04) 60px 61px), repeating-linear-gradient(0deg, transparent 0 60px, rgba(34,197,94,0.04) 60px 61px); }
        .theme-codenames .bg-scene::after { top: 10%; left: 50%; transform: translateX(-50%); width: 200px; height: 200px; border: 2px solid rgba(34,197,94,0.2); border-radius: 50%; animation: radarScan 3s linear infinite; }

        /* WORD BOMB */
        .theme-word-bomb { --accent: #f43f5e; --accent-glow: rgba(244,63,94,0.4); --accent-soft: rgba(244,63,94,0.12); }
        .theme-word-bomb .bg-base { background: radial-gradient(circle at 50% 40%, #1a0a0f, #0a0a0f); }
        .theme-word-bomb .bg-scene::before { top: 12%; left: 50%; transform: translateX(-50%); font-size: 90px; content: 'üí£'; opacity: 0.2; animation: shake 0.3s ease-in-out infinite; }
        .theme-word-bomb .bg-scene::after { top: 8%; left: 50%; transform: translateX(-50%); width: 250px; height: 250px; background: radial-gradient(circle, rgba(244,63,94,0.3), transparent 60%); animation: bombPulse 0.8s ease-in-out infinite; }

        /* WAVELENGTH */
        .theme-wavelength { --accent: #f97316; --accent-glow: rgba(249,115,22,0.4); --accent-soft: rgba(249,115,22,0.12); }
        .theme-wavelength .bg-base { background: linear-gradient(180deg, #15100a, #0a0a0f); }
        .theme-wavelength .bg-scene::before { top: 0; left: 0; right: 0; height: 50%; background: linear-gradient(90deg, rgba(239,68,68,0.1), rgba(249,115,22,0.12), rgba(234,179,8,0.1), rgba(34,197,94,0.1), rgba(59,130,246,0.1), rgba(168,85,247,0.1)); mask: linear-gradient(180deg, rgba(0,0,0,0.6), transparent); -webkit-mask: linear-gradient(180deg, rgba(0,0,0,0.6), transparent); }

        /* LUDO */
        .theme-ludo { --accent: #22c55e; --accent-glow: rgba(34,197,94,0.4); --accent-soft: rgba(34,197,94,0.12); }
        .theme-ludo .bg-base { background: #0a0a0f; }
        .theme-ludo .bg-scene::before { top: 5%; left: 50%; transform: translateX(-50%); width: 220px; height: 220px; background: conic-gradient(rgba(239,68,68,0.15) 0deg 90deg, rgba(59,130,246,0.15) 90deg 180deg, rgba(34,197,94,0.15) 180deg 270deg, rgba(234,179,8,0.15) 270deg 360deg); border-radius: 12px; }
        .theme-ludo .bg-scene::after { top: 10%; left: 50%; transform: translateX(-50%); font-size: 60px; content: 'üé≤'; opacity: 0.2; animation: float 3s ease-in-out infinite; }

        /* HERD MENTALITY */
        .theme-herd-mentality { --accent: #3b82f6; --accent-glow: rgba(59,130,246,0.4); --accent-soft: rgba(59,130,246,0.12); }
        .theme-herd-mentality .bg-base { background: linear-gradient(180deg, #080a15, #0a0a0f); }
        .theme-herd-mentality .bg-scene::before { inset: 0; background: radial-gradient(circle at 30% 60%, rgba(59,130,246,0.12), transparent 20%), radial-gradient(circle at 50% 55%, rgba(59,130,246,0.15), transparent 22%), radial-gradient(circle at 70% 62%, rgba(59,130,246,0.12), transparent 18%); }

        /* PUNCHLINE */
        .theme-punchline { --accent: #fbbf24; --accent-glow: rgba(251,191,36,0.4); --accent-soft: rgba(251,191,36,0.12); }
        .theme-punchline .bg-base { background: radial-gradient(ellipse 80% 60% at 50% 0%, #1a1508, #0a0a0f); }
        .theme-punchline .bg-scene::before { top: 0; left: 50%; transform: translateX(-50%); width: 50%; height: 100%; background: linear-gradient(180deg, rgba(251,191,36,0.1), transparent 50%); clip-path: polygon(30% 0, 70% 0, 100% 100%, 0 100%); }
        .theme-punchline .bg-scene::after { top: 12%; left: 50%; transform: translateX(-50%); font-size: 70px; content: 'üé§'; opacity: 0.15; }

        /* HOT TAKES */
        .theme-hot-takes-party { --accent: #ef4444; --accent-glow: rgba(239,68,68,0.4); --accent-soft: rgba(239,68,68,0.12); }
        .theme-hot-takes-party .bg-base { background: linear-gradient(180deg, #150808, #0a0a0f); }
        .theme-hot-takes-party .bg-scene::before { top: 10%; left: 50%; transform: translateX(-50%); font-size: 80px; content: 'üî•'; opacity: 0.2; animation: fireFlicker 0.4s ease-in-out infinite alternate; }

        /* TRIVIA ROYALE */
        .theme-trivia-royale { --accent: #8b5cf6; --accent-glow: rgba(139,92,246,0.4); --accent-soft: rgba(139,92,246,0.12); }
        .theme-trivia-royale .bg-base { background: radial-gradient(ellipse 100% 80% at 50% 0%, #12081a, #0a0a0f); }
        .theme-trivia-royale .bg-scene::before { top: 8%; left: 50%; transform: translateX(-50%); font-size: 70px; content: 'üèÜ'; opacity: 0.2; animation: float 3s ease-in-out infinite; }

        /* OTHER THEMES - simpler versions */
        .theme-insider { --accent: #6366f1; --accent-glow: rgba(99,102,241,0.4); --accent-soft: rgba(99,102,241,0.12); }
        .theme-insider .bg-base { background: radial-gradient(circle at 50% 30%, #0a0a18, #0a0a0f); }
        .theme-power-struggle { --accent: #eab308; --accent-glow: rgba(234,179,8,0.4); --accent-soft: rgba(234,179,8,0.12); }
        .theme-power-struggle .bg-base { background: linear-gradient(135deg, #151208, #0a0a0f); }
        .theme-categories { --accent: #06b6d4; --accent-glow: rgba(6,182,212,0.4); --accent-soft: rgba(6,182,212,0.12); }
        .theme-categories .bg-base { background: linear-gradient(180deg, #081215, #0a0a0f); }
        .theme-npat { --accent: #f59e0b; --accent-glow: rgba(245,158,11,0.4); --accent-soft: rgba(245,158,11,0.12); }
        .theme-npat .bg-base { background: linear-gradient(180deg, #15120a, #0a0a0f); }
        .theme-word-association { --accent: #a855f7; --accent-glow: rgba(168,85,247,0.4); --accent-soft: rgba(168,85,247,0.12); }
        .theme-word-association .bg-base { background: linear-gradient(180deg, #100815, #0a0a0f); }
        .theme-charades { --accent: #10b981; --accent-glow: rgba(16,185,129,0.4); --accent-soft: rgba(16,185,129,0.12); }
        .theme-charades .bg-base { background: linear-gradient(180deg, #0a1210, #0a0a0f); }
        .theme-celebrity { --accent: #f472b6; --accent-glow: rgba(244,114,182,0.4); --accent-soft: rgba(244,114,182,0.12); }
        .theme-celebrity .bg-base { background: radial-gradient(ellipse at 50% 0%, #150a12, #0a0a0f); }
        .theme-fishbowl { --accent: #06b6d4; --accent-glow: rgba(6,182,212,0.4); --accent-soft: rgba(6,182,212,0.12); }
        .theme-fishbowl .bg-base { background: radial-gradient(ellipse at 50% 100%, #081518, #0a0a0f); }
        .theme-most-likely-to { --accent: #f43f5e; --accent-glow: rgba(244,63,94,0.4); --accent-soft: rgba(244,63,94,0.12); }
        .theme-most-likely-to .bg-base { background: radial-gradient(circle at 50% 50%, #150a0f, #0a0a0f); }
        .theme-sketch-guess { --accent: #f97316; --accent-glow: rgba(249,115,22,0.4); --accent-soft: rgba(249,115,22,0.12); }
        .theme-sketch-guess .bg-base { background: linear-gradient(180deg, #15100a, #0a0a0f); }
        .theme-fools-gold { --accent: #fbbf24; --accent-glow: rgba(251,191,36,0.4); --accent-soft: rgba(251,191,36,0.12); }
        .theme-fools-gold .bg-base { background: linear-gradient(180deg, #151008, #0a0a0f); }
        .theme-broken-pictionary { --accent: #ec4899; --accent-glow: rgba(236,72,153,0.4); --accent-soft: rgba(236,72,153,0.12); }
        .theme-broken-pictionary .bg-base { background: linear-gradient(135deg, #150a12, #0a0a0f); }
        .theme-doodle-duel { --accent: #f97316; --accent-glow: rgba(249,115,22,0.4); --accent-soft: rgba(249,115,22,0.12); }
        .theme-doodle-duel .bg-base { background: linear-gradient(180deg, #15100a, #0a0a0f); }
        .theme-two-truths { --accent: #3b82f6; --accent-glow: rgba(59,130,246,0.4); --accent-soft: rgba(59,130,246,0.12); }
        .theme-two-truths .bg-base { background: linear-gradient(180deg, #080a15, #0a0a0f); }
        .theme-this-or-that-party { --accent: #f97316; --accent-glow: rgba(249,115,22,0.4); --accent-soft: rgba(249,115,22,0.12); }
        .theme-this-or-that-party .bg-base { background: linear-gradient(90deg, rgba(59,130,246,0.08), transparent 40%, transparent 60%, rgba(249,115,22,0.08)), #0a0a0f; }
        .theme-never-ever-party { --accent: #ec4899; --accent-glow: rgba(236,72,153,0.4); --accent-soft: rgba(236,72,153,0.12); }
        .theme-never-ever-party .bg-base { background: radial-gradient(ellipse at 50% 100%, #150a12, #0a0a0f); }
        .theme-bet-or-bluff { --accent: #10b981; --accent-glow: rgba(16,185,129,0.4); --accent-soft: rgba(16,185,129,0.12); }
        .theme-bet-or-bluff .bg-base { background: linear-gradient(180deg, #081510, #0a0a0f); }

        /* ANIMATIONS */
        @keyframes pulse { 0%, 100% { opacity: 0.3; transform: translateX(-50%) scale(1); } 50% { opacity: 0.5; transform: translateX(-50%) scale(1.1); } }
        @keyframes float { 0%, 100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(-15px); } }
        @keyframes blink { 0%, 100% { opacity: 0.05; } 50% { opacity: 0.15; } }
        @keyframes alertPulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }
        @keyframes shake { 0%, 100% { transform: translateX(-50%) rotate(-2deg); } 50% { transform: translateX(-50%) rotate(2deg); } }
        @keyframes bombPulse { 0%, 100% { transform: translateX(-50%) scale(1); opacity: 0.2; } 50% { transform: translateX(-50%) scale(1.15); opacity: 0.4; } }
        @keyframes radarScan { 0% { transform: translateX(-50%) scale(0.5); opacity: 0.6; } 100% { transform: translateX(-50%) scale(2); opacity: 0; } }
        @keyframes fireFlicker { 0% { transform: translateX(-50%) scale(1); } 100% { transform: translateX(-50%) scale(1.08); } }
        @keyframes iconPulse { 0%, 100% { opacity: 0.4; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.1); } }

        /* ICON */
        .game-icon { width: 90px; height: 90px; margin: 0 auto 1.5rem; color: var(--accent); position: relative; display: flex; align-items: center; justify-content: center; }
        .game-icon svg { width: 100%; height: 100%; filter: drop-shadow(0 0 25px var(--accent-glow)); }
        .game-icon::before { content: ''; position: absolute; inset: -20px; background: radial-gradient(circle, var(--accent-soft), transparent 70%); border-radius: 50%; z-index: -1; animation: iconPulse 3s ease-in-out infinite; }

        /* LAYOUT */
        main { flex: 1; display: flex; align-items: center; justify-content: center; padding: 80px 20px 40px; position: relative; z-index: 1; }
        .lobby-container { width: 100%; max-width: 420px; }
        .game-header { text-align: center; margin-bottom: 2rem; }
        .game-title { font-family: 'Bebas Neue', sans-serif; font-size: 3.5rem; letter-spacing: 6px; line-height: 1; margin-bottom: 0.5rem; text-shadow: 0 0 60px var(--accent-glow); }
        .game-tagline { color: var(--accent); font-size: 1rem; font-weight: 600; letter-spacing: 3px; text-transform: uppercase; }
        .game-players { color: var(--muted); font-size: 0.85rem; margin-top: 0.5rem; }

        /* HTP CARD */
        .htp-card { background: rgba(255,255,255,0.02); border: 1px solid var(--border); border-left: 3px solid var(--accent); border-radius: 12px; padding: 1rem 1.25rem; margin-bottom: 1.5rem; }
        .htp-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem; }
        .htp-title { font-size: 0.75rem; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 1.5px; }
        .htp-expand { background: none; border: none; color: var(--muted); font-size: 0.75rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 4px; }
        .htp-expand:hover { color: var(--accent); }
        .htp-summary { color: var(--muted); font-size: 0.9rem; line-height: 1.6; }

        /* MAIN CARD */
        .lobby-card { background: rgba(18,18,26,0.85); border: 1px solid var(--border); border-radius: 20px; padding: 2rem; position: relative; backdrop-filter: blur(20px); }
        .lobby-card::before { content: ''; position: absolute; top: 0; left: 30px; right: 30px; height: 1px; background: linear-gradient(90deg, transparent, var(--accent), transparent); }

        /* INPUTS */
        .input-group { margin-bottom: 1.5rem; }
        .input-label { display: block; font-size: 0.75rem; font-weight: 700; color: var(--muted); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 1px; }
        .input-field { width: 100%; padding: 0.9rem 1rem; background: rgba(10,10,15,0.8); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-size: 1rem; font-family: inherit; }
        .input-field:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-soft); }
        .input-field:disabled { opacity: 0.5; }
        .input-hint { font-size: 0.8rem; color: var(--muted); margin-top: 0.5rem; }
        .input-hint a { color: var(--accent); text-decoration: none; }
        .room-code-input { text-transform: uppercase; font-family: 'Bebas Neue', sans-serif; font-size: 1.75rem; letter-spacing: 10px; text-align: center; }

        /* BUTTONS */
        .btn { width: 100%; padding: 1rem; border-radius: 10px; font-family: 'Bebas Neue', sans-serif; font-size: 1.25rem; letter-spacing: 2px; cursor: pointer; border: none; }
        .btn-primary { background: var(--accent); color: white; box-shadow: 0 4px 20px var(--accent-glow); }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-secondary { background: transparent; color: var(--text); border: 1px solid var(--border); }
        .btn-secondary:hover:not(:disabled) { border-color: var(--accent); background: var(--accent-soft); }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .btn-loading::after { content: ''; width: 16px; height: 16px; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 0.7s linear infinite; margin-left: 8px; display: inline-block; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* DIVIDER */
        .divider { display: flex; align-items: center; gap: 1rem; margin: 1.5rem 0; }
        .divider-line { flex: 1; height: 1px; background: var(--border); }
        .divider-text { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 2px; color: var(--muted); }

        /* MESSAGES */
        .message { padding: 0.9rem; border-radius: 8px; margin-top: 1rem; font-size: 0.85rem; font-weight: 600; display: none; text-align: center; }
        .message.error { background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3); color: #fca5a5; }
        .message.success { background: rgba(34,197,94,0.15); border: 1px solid rgba(34,197,94,0.3); color: #86efac; }
        .message.visible { display: block; }

        /* MODAL */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 1rem; }
        .modal-overlay.visible { display: flex; }
        .modal { background: #12121a; border: 1px solid var(--border); border-radius: 20px; width: 100%; max-width: 480px; max-height: 90vh; display: flex; flex-direction: column; }
        .modal-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 2px; color: var(--accent); }
        .modal-close { background: none; border: none; color: var(--muted); font-size: 1.5rem; cursor: pointer; }
        .modal-body { padding: 1.5rem; color: var(--muted); line-height: 1.7; overflow-y: auto; }
        .modal-body h3 { font-family: 'Bebas Neue', sans-serif; color: var(--accent); margin: 1rem 0 0.4rem; }
        .modal-body h3:first-child { margin-top: 0; }
        .modal-body ul { margin-left: 1.25rem; }
        .modal-body li { color: var(--text); margin-bottom: 0.35rem; }
        .modal-body strong { color: var(--accent); }
        .modal-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--border); }
        .modal-btn { width: 100%; padding: 0.8rem; background: var(--accent); color: white; border: none; border-radius: 10px; font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 2px; cursor: pointer; }

        /* FOOTER */
        footer { background: #000; position: relative; z-index: 10; }
        .footer-border { height: 3px; background: linear-gradient(90deg, #ff6b9d, #4facfe, #a855f7, #ff6b9d); background-size: 300% 100%; animation: gradientSlide 6s linear infinite; }
        @keyframes gradientSlide { 0% { background-position: 0% 50%; } 100% { background-position: 300% 50%; } }
        .footer-main { max-width: 1100px; margin: 0 auto; padding: 40px 20px 25px; }
        .footer-links { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; margin-bottom: 30px; max-width: 500px; margin-left: auto; margin-right: auto; }
        .footer-column { text-align: center; }
        .footer-column h5 { font-family: 'Bebas Neue', sans-serif; font-size: 0.9rem; letter-spacing: 2px; margin-bottom: 12px; color: rgba(255,255,255,0.8); }
        .footer-column ul { list-style: none; display: flex; flex-direction: column; gap: 8px; }
        .footer-column a { color: rgba(255,255,255,0.4); font-size: 0.85rem; text-decoration: none; }
        .footer-bottom { padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.06); text-align: center; }
        .footer-copyright { font-size: 0.8rem; color: rgba(255,255,255,0.35); margin-bottom: 10px; }
        .footer-legal { display: flex; justify-content: center; gap: 20px; }
        .footer-legal a { color: rgba(255,255,255,0.35); font-size: 0.75rem; text-decoration: none; }

        @media (max-width: 600px) {
            main { padding: 70px 16px 30px; }
            .game-icon { width: 70px; height: 70px; }
            .game-title { font-size: 2.8rem; }
            .lobby-card { padding: 1.5rem; }
            .footer-links { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="theme-spyfall">
<div class="bg-container"><div class="bg-base"></div><div class="bg-scene"></div></div>
<div id="site-header"></div>
<main>
    <div class="lobby-container">
        <div class="game-header">
            <div class="game-icon" id="game-icon"></div>
            <h1 class="game-title" id="game-title">LOADING</h1>
            <p class="game-tagline" id="game-tagline">...</p>
            <p class="game-players" id="game-players">...</p>
        </div>
        <div class="htp-card">
            <div class="htp-header">
                <span class="htp-title">How to Play</span>
                <button class="htp-expand" onclick="showFullRules()">Full Rules ‚Üí</button>
            </div>
            <p class="htp-summary" id="htp-summary"></p>
        </div>
        <div class="lobby-card">
            <div class="input-group">
                <label class="input-label" for="player-name">Your Name</label>
                <input type="text" id="player-name" class="input-field" placeholder="Loading..." maxlength="20" autocomplete="off">
                <p class="input-hint" id="name-hint">Loading...</p>
            </div>
            <button class="btn btn-primary" id="btn-create" onclick="createRoom()">Create Room</button>
            <div class="divider"><div class="divider-line"></div><span class="divider-text">Or Join</span><div class="divider-line"></div></div>
            <div class="input-group">
                <label class="input-label" for="room-code">Room Code</label>
                <input type="text" id="room-code" class="input-field room-code-input" placeholder="ABC123" maxlength="6" autocomplete="off">
            </div>
            <button class="btn btn-secondary" id="btn-join" onclick="joinRoom()">Join Room</button>
            <div class="message error" id="error-message"></div>
            <div class="message success" id="success-message"></div>
        </div>
    </div>
</main>
<div class="modal-overlay" id="rules-modal">
    <div class="modal">
        <div class="modal-header">
            <h2 class="modal-title" id="modal-title">How to Play</h2>
            <button class="modal-close" onclick="closeModal()">√ó</button>
        </div>
        <div class="modal-body" id="modal-body"></div>
        <div class="modal-footer"><button class="modal-btn" onclick="closeModal()">Got It</button></div>
    </div>
</div>
<footer>
    <div class="footer-border"></div>
    <div class="footer-main">
        <div class="footer-links">
            <div class="footer-column"><h5>GAMES</h5><ul><li><a href="/solo">Solo</a></li><li><a href="/squad-games.html">Squad</a></li><li><a href="/party">Party</a></li></ul></div>
            <div class="footer-column"><h5>COMMUNITY</h5><ul><li><a href="/leaderboards">Leaderboards</a></li><li><a href="/supporters">Supporters</a></li></ul></div>
            <div class="footer-column"><h5>COMPANY</h5><ul><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></div>
        </div>
        <div class="footer-bottom">
            <p class="footer-copyright">¬© 2025 TheGaming.co</p>
            <div class="footer-legal"><a href="/privacy">Privacy</a><a href="/terms">Terms</a></div>
        </div>
    </div>
</footer>
<script>
const BACKEND_URL = 'https://web-production-519c7.up.railway.app';
const SUPABASE_URL = 'https://tvvivtmzofsyehatzlvl.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR2dml2dG16b2ZzeWVoYXR6bHZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4OTExODYsImV4cCI6MjA4MDQ2NzE4Nn0.Qy8kHMO0Nb4yJ0ZHjby7RuQtzwWB8rUcZvkdnbL1b3M';
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const ICONS = {
    spy: '<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="28" r="16" stroke="currentColor" stroke-width="2.5"/><path d="M24 28h32" stroke="currentColor" stroke-width="2.5"/><ellipse cx="40" cy="28" rx="7" ry="4" fill="currentColor" opacity="0.3"/><circle cx="40" cy="28" r="3" fill="currentColor"/><path d="M40 44v6M34 68c0-8 2.5-12 6-12s6 4 6 12" stroke="currentColor" stroke-width="2.5"/></svg>',
    crown: '<svg viewBox="0 0 80 80" fill="none"><path d="M12 52l12-28 16 16 16-16 12 28H12z" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.15"/><circle cx="12" cy="24" r="5" fill="currentColor"/><circle cx="40" cy="12" r="5" fill="currentColor"/><circle cx="68" cy="24" r="5" fill="currentColor"/></svg>',
    moon: '<svg viewBox="0 0 80 80" fill="none"><path d="M52 12c-18 0-32 14-32 32s14 32 32 32c4 0 7-.5 10-1.5-8-6-13-16-13-26.5s5-20.5 13-26.5c-3-1-6-1.5-10-1.5z" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.15"/></svg>',
    alert: '<svg viewBox="0 0 80 80" fill="none"><path d="M40 10L70 65H10L40 10z" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.15"/><line x1="40" y1="28" x2="40" y2="45" stroke="currentColor" stroke-width="4" stroke-linecap="round"/><circle cx="40" cy="54" r="3" fill="currentColor"/></svg>',
    palette: '<svg viewBox="0 0 80 80" fill="none"><ellipse cx="40" cy="44" rx="30" ry="26" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><circle cx="28" cy="36" r="6" fill="currentColor" opacity="0.7"/><circle cx="44" cy="30" r="5" fill="currentColor" opacity="0.5"/><circle cx="56" cy="40" r="5" fill="currentColor" opacity="0.6"/></svg>',
    grid: '<svg viewBox="0 0 80 80" fill="none"><rect x="10" y="10" width="26" height="26" rx="4" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.2"/><rect x="44" y="10" width="26" height="26" rx="4" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><rect x="10" y="44" width="26" height="26" rx="4" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><rect x="44" y="44" width="26" height="26" rx="4" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.15"/></svg>',
    spectrum: '<svg viewBox="0 0 80 80" fill="none"><rect x="8" y="32" width="64" height="16" rx="8" stroke="currentColor" stroke-width="2.5"/><rect x="12" y="36" width="56" height="8" rx="4" fill="currentColor" fill-opacity="0.3"/><circle cx="48" cy="40" r="10" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.4"/></svg>',
    users: '<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="26" r="14" stroke="currentColor" stroke-width="2.5"/><path d="M16 68c0-14 10-22 24-22s24 8 24 22" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/></svg>',
    bomb: '<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="48" r="24" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.15"/><path d="M40 24v-10M34 18l6-6 6 6" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/></svg>',
    lightning: '<svg viewBox="0 0 80 80" fill="none"><path d="M46 8L22 42h18L34 72 58 38H40L46 8z" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.2"/></svg>',
    theater: '<svg viewBox="0 0 80 80" fill="none"><circle cx="26" cy="36" r="20" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><circle cx="54" cy="36" r="20" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><path d="M16 42c0 6 4 10 10 10s10-4 10-10" stroke="currentColor" stroke-width="2.5"/><path d="M44 32c0-4 4-6 10-6s10 2 10 6" stroke="currentColor" stroke-width="2.5"/></svg>',
    star: '<svg viewBox="0 0 80 80" fill="none"><path d="M40 8l10 22 24 2-18 16 5 24-21-12-21 12 5-24-18-16 24-2z" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.2"/></svg>',
    fish: '<svg viewBox="0 0 80 80" fill="none"><ellipse cx="36" cy="40" rx="28" ry="20" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><path d="M64 40c10-12 10 24 0 12" stroke="currentColor" stroke-width="2.5"/><circle cx="22" cy="38" r="4" fill="currentColor"/></svg>',
    pencil: '<svg viewBox="0 0 80 80" fill="none"><path d="M56 12L68 24 28 64H16V52L56 12z" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><path d="M50 18l12 12" stroke="currentColor" stroke-width="2.5"/></svg>',
    gold: '<svg viewBox="0 0 80 80" fill="none"><path d="M22 52h36l6-18H16l6 18z" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.2"/><circle cx="40" cy="26" r="10" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.3"/></svg>',
    cards: '<svg viewBox="0 0 80 80" fill="none"><rect x="16" y="12" width="32" height="46" rx="4" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1" transform="rotate(-12 32 35)"/><rect x="32" y="18" width="32" height="46" rx="4" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.2" transform="rotate(8 48 41)"/></svg>',
    laugh: '<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="40" r="28" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><circle cx="28" cy="34" r="4" fill="currentColor"/><circle cx="52" cy="34" r="4" fill="currentColor"/><path d="M24 50c8 10 24 10 32 0" stroke="currentColor" stroke-width="2.5"/></svg>',
    dice: '<svg viewBox="0 0 80 80" fill="none"><rect x="14" y="14" width="52" height="52" rx="8" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><circle cx="28" cy="28" r="5" fill="currentColor"/><circle cx="52" cy="28" r="5" fill="currentColor"/><circle cx="40" cy="40" r="5" fill="currentColor"/><circle cx="28" cy="52" r="5" fill="currentColor"/><circle cx="52" cy="52" r="5" fill="currentColor"/></svg>',
    question: '<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="40" r="28" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><path d="M30 30c0-8 5-12 12-12s12 4 12 12c0 6-5 8-8 10-2 2-4 4-4 6v3" stroke="currentColor" stroke-width="3" stroke-linecap="round"/><circle cx="40" cy="58" r="3.5" fill="currentColor"/></svg>',
    chain: '<svg viewBox="0 0 80 80" fill="none"><ellipse cx="26" cy="40" rx="16" ry="12" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><ellipse cx="54" cy="40" rx="16" ry="12" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><path d="M36 40h8" stroke="currentColor" stroke-width="5"/></svg>',
    fire: '<svg viewBox="0 0 80 80" fill="none"><path d="M40 12c-4 14 4 20 0 32-3 10-14 14-14 24 0 7 9 11 14 9-3-5-2-9 3-14 5 7 11 9 11 16 5-3 9-9 9-18 0-14-9-18-9-32-5 9-14 5-14-17z" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.2"/></svg>',
    brain: '<svg viewBox="0 0 80 80" fill="none"><circle cx="24" cy="28" r="14" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><circle cx="56" cy="28" r="14" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><circle cx="40" cy="22" r="12" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.15"/></svg>',
    pointing: '<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="40" r="28" stroke="currentColor" stroke-width="2.5" fill="currentColor" fill-opacity="0.1"/><path d="M40 22v24M28 34l12-12 12 12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/><circle cx="40" cy="56" r="4" fill="currentColor"/></svg>'
};

const GAMES = {
    'spyfall': { displayName: 'SPY HUNT', backendType: 'spyfall', theme: 'theme-spyfall', tagline: 'Trust No One', players: '4-20 Players', icon: 'spy', summary: 'One player is the Spy who does not know the location. Ask questions to find them!', howToPlay: '<h3>Setup</h3><p>One player is the <strong>Spy</strong>. Everyone else knows the location.</p><h3>Win</h3><ul><li>Players: Vote out the Spy</li><li>Spy: Guess the location</li></ul>' },
    'avalon': { displayName: 'SECRET ROLES', backendType: 'avalon', theme: 'theme-avalon', tagline: 'Loyalty & Betrayal', players: '5-15 Players', icon: 'crown', summary: 'Knights vs traitors. Vote on quests and uncover the hidden evil.', howToPlay: '<h3>Teams</h3><p>Good vs Evil.</p><h3>Win</h3><ul><li>Good: 3 successful quests</li><li>Evil: 3 failed quests</li></ul>' },
    'werewolf': { displayName: 'MAFIA', backendType: 'werewolf', theme: 'theme-werewolf', tagline: 'Survive The Night', players: '6-20 Players', icon: 'moon', summary: 'Villagers hunt killers by day. Mafia strikes by night.', howToPlay: '<h3>Roles</h3><ul><li><strong>Mafia</strong>: Eliminate villagers</li><li><strong>Seer</strong>: Check identities</li></ul>' },
    'imposter': { displayName: 'IMPOSTER', backendType: 'imposter', theme: 'theme-imposter', tagline: 'Blend In Or Be Found', players: '4-10 Players', icon: 'alert', summary: 'Everyone knows the word except one. Find the imposter!', howToPlay: '<h3>Game</h3><p>Give clues without revealing the word to the Imposter!</p>' },
    'fake-artist': { displayName: 'FAKE ARTIST', backendType: 'fake-artist', theme: 'theme-fake-artist', tagline: 'Draw Together', players: '4-10 Players', icon: 'palette', summary: 'Everyone draws the same thing except the Fake Artist!', howToPlay: '<h3>Rules</h3><p>Add ONE stroke per turn.</p>' },
    'insider': { displayName: 'INSIDER', backendType: 'insider', theme: 'theme-insider', tagline: 'The Secret Guide', players: '4-8 Players', icon: 'question', summary: '20 Questions with a twist.', howToPlay: '<h3>Roles</h3><p>One player secretly knows the answer.</p>' },
    'power-struggle': { displayName: 'POWER STRUGGLE', backendType: 'power-struggle', theme: 'theme-power-struggle', tagline: 'Bluff Your Way Up', players: '3-10 Players', icon: 'cards', summary: 'Bluff and backstab to win!', howToPlay: '<h3>Actions</h3><p>Income, Coup, Bluff roles!</p>' },
    'codenames': { displayName: 'CODEWORDS', backendType: 'codenames', theme: 'theme-codenames', tagline: 'Give Clues', players: '4-16 Players', icon: 'grid', summary: 'Spymasters give one-word clues.', howToPlay: '<h3>Teams</h3><p>Spymasters give clues, others guess.</p>' },
    'wavelength': { displayName: 'SPECTRUM', backendType: 'wavelength', theme: 'theme-wavelength', tagline: 'Find The Target', players: '4-12 Players', icon: 'spectrum', summary: 'Find the hidden target on a spectrum.', howToPlay: '<h3>Game</h3><p>Give clues for the target position!</p>' },
    'herd-mentality': { displayName: 'THINK ALIKE', backendType: 'herd-mentality', theme: 'theme-herd-mentality', tagline: 'Match The Crowd', players: '4-20 Players', icon: 'users', summary: 'Match the majority to score!', howToPlay: '<h3>Scoring</h3><p>Match majority = points!</p>' },
    'word-bomb': { displayName: 'WORD BOMB', backendType: 'word-bomb', theme: 'theme-word-bomb', tagline: 'Think Fast', players: '2-16 Players', icon: 'bomb', summary: 'Type a word before the bomb explodes!', howToPlay: '<h3>Speed</h3><p>Type fast or lose!</p>' },
    'categories': { displayName: 'CATEGORIES', backendType: 'categories', theme: 'theme-categories', tagline: 'Race to Answer', players: '2-20 Players', icon: 'lightning', summary: 'Race to type a valid answer first!', howToPlay: '<h3>Speed</h3><p>First answer wins!</p>' },
    'npat': { displayName: 'NAME PLACE ANIMAL THING', backendType: 'npat', theme: 'theme-npat', tagline: 'Race The Clock', players: '2-20 Players', icon: 'lightning', summary: 'Fill categories with a random letter!', howToPlay: '<h3>Categories</h3><p>Name, Place, Animal, Thing!</p>' },
    'word-association': { displayName: 'WORD ASSOCIATION', backendType: 'word-association', theme: 'theme-word-association', tagline: 'Chain Reaction', players: '3-12 Players', icon: 'chain', summary: 'Say a related word or lose!', howToPlay: '<h3>Chain</h3><p>Each word relates to the last.</p>' },
    'charades': { displayName: 'CHARADES', backendType: 'charades', theme: 'theme-charades', tagline: 'Act It Out', players: '4-20 Players', icon: 'theater', summary: 'Act without speaking!', howToPlay: '<h3>Rules</h3><p>No speaking! Gestures only.</p>' },
    'celebrity': { displayName: 'CELEBRITY', backendType: 'celebrity', theme: 'theme-celebrity', tagline: 'Three Rounds', players: '4-16 Players', icon: 'star', summary: 'Describe, one word, then act!', howToPlay: '<h3>Rounds</h3><p>1: Describe. 2: One Word. 3: Act!</p>' },
    'fishbowl': { displayName: 'FISHBOWL', backendType: 'fishbowl', theme: 'theme-fishbowl', tagline: 'Three Games In One', players: '6-20 Players', icon: 'fish', summary: 'Taboo, One Word, Charades!', howToPlay: '<h3>Rounds</h3><p>Same words, three ways!</p>' },
    'most-likely-to': { displayName: 'MOST LIKELY TO', backendType: 'most-likely-to', theme: 'theme-most-likely-to', tagline: 'Vote On Friends', players: '3-20 Players', icon: 'pointing', summary: 'Vote on who fits the scenario!', howToPlay: '<h3>Voting</h3><p>Who is most likely to...?</p>' },
    'sketch-guess': { displayName: 'SKETCH & GUESS', backendType: 'sketch-guess', theme: 'theme-sketch-guess', tagline: 'Draw & Guess', players: '3-20 Players', icon: 'pencil', summary: 'Draw it, guess it!', howToPlay: '<h3>Scoring</h3><p>Faster = more points!</p>' },
    'fools-gold': { displayName: 'FOOLS GOLD', backendType: 'fools-gold', theme: 'theme-fools-gold', tagline: 'Lie To Win', players: '3-12 Players', icon: 'gold', summary: 'Write convincing lies!', howToPlay: '<h3>Bluffing</h3><p>Trick others to score!</p>' },
    'punchline': { displayName: 'PUNCHLINE', backendType: 'punchline', theme: 'theme-punchline', tagline: 'Write The Funny', players: '3-16 Players', icon: 'laugh', summary: 'Funniest answer wins!', howToPlay: '<h3>Comedy</h3><p>Write and vote!</p>' },
    'broken-pictionary': { displayName: 'BROKEN PICTIONARY', backendType: 'broken-pictionary', theme: 'theme-broken-pictionary', tagline: 'Draw Guess Repeat', players: '4-16 Players', icon: 'pencil', summary: 'Watch phrases transform!', howToPlay: '<h3>Chain</h3><p>Draw, Guess, Repeat!</p>' },
    'doodle-duel': { displayName: 'DOODLE DUEL', backendType: 'doodle-duel', theme: 'theme-doodle-duel', tagline: 'Draw & Deceive', players: '3-12 Players', icon: 'pencil', summary: 'Fake titles, spot the real one!', howToPlay: '<h3>Bluffing</h3><p>Write fake titles!</p>' },
    'two-truths': { displayName: 'TWO TRUTHS', backendType: 'two-truths', theme: 'theme-two-truths', tagline: 'Spot The Lie', players: '3-16 Players', icon: 'question', summary: 'Two truths, one lie!', howToPlay: '<h3>Deception</h3><p>Make truths unbelievable!</p>' },
    'ludo': { displayName: 'LUDO', backendType: 'ludo', theme: 'theme-ludo', tagline: 'Race Home', players: '2-6 Players', icon: 'dice', summary: 'Classic board game!', howToPlay: '<h3>Rules</h3><p>Roll 6 to start!</p>' },
    'trivia-royale': { displayName: 'TRIVIA ROYALE', backendType: 'trivia-royale', theme: 'theme-trivia-royale', tagline: 'Battle of Brains', players: '2-100 Players', icon: 'brain', summary: 'Fast trivia!', howToPlay: '<h3>Speed</h3><p>Faster = more points!</p>' },
    'this-or-that-party': { displayName: 'THIS OR THAT', backendType: 'this-or-that-party', theme: 'theme-this-or-that-party', tagline: 'Pick Your Side', players: '2-100 Players', icon: 'question', summary: 'Match the majority!', howToPlay: '<h3>Voting</h3><p>Match majority to score!</p>' },
    'hot-takes-party': { displayName: 'HOT TAKES', backendType: 'hot-takes-party', theme: 'theme-hot-takes-party', tagline: 'Spicy Opinions', players: '2-100 Players', icon: 'fire', summary: 'Rate spicy statements!', howToPlay: '<h3>Rating</h3><p>Match average to score!</p>' },
    'never-ever-party': { displayName: 'NEVER HAVE I EVER', backendType: 'never-ever-party', theme: 'theme-never-ever-party', tagline: 'Confess or Deny', players: '2-100 Players', icon: 'question', summary: 'Rare experiences score more!', howToPlay: '<h3>Confess</h3><p>Minority = more points!</p>' },
    'bet-or-bluff': { displayName: 'BET OR BLUFF', backendType: 'bet-or-bluff', theme: 'theme-bet-or-bluff', tagline: 'Risk It All', players: '2-100 Players', icon: 'cards', summary: 'Answer trivia, bet on results!', howToPlay: '<h3>Betting</h3><p>Strategic betting wins!</p>' }
};

var urlParams = new URLSearchParams(window.location.search);
var gameId = urlParams.get('game') || 'spyfall';
var joinCode = urlParams.get('join');
var currentGame = GAMES[gameId] || GAMES['spyfall'];

document.body.className = currentGame.theme;
document.getElementById('game-title').textContent = currentGame.displayName;
document.getElementById('game-tagline').textContent = currentGame.tagline;
document.getElementById('game-players').textContent = currentGame.players;
document.getElementById('htp-summary').textContent = currentGame.summary;
document.getElementById('modal-title').textContent = 'How to Play ' + currentGame.displayName;
document.getElementById('modal-body').innerHTML = currentGame.howToPlay;
document.getElementById('game-icon').innerHTML = ICONS[currentGame.icon] || ICONS.question;
document.title = currentGame.displayName + ' - TheGaming.co';

if (joinCode) document.getElementById('room-code').value = joinCode.toUpperCase();

var socket = io(BACKEND_URL, { transports: ['websocket', 'polling'] });
var currentUser = null, userProfile = null, isPremium = false;
var nameInput = document.getElementById('player-name');
var nameHint = document.getElementById('name-hint');
var ADJECTIVES = ['Swift','Clever','Bold','Silent','Quick','Sly','Sharp','Cool','Wild','Rapid'];
var NOUNS = ['Fox','Wolf','Eagle','Tiger','Hawk','Bear','Lion','Shark','Falcon','Panther'];

function generateRandomName() {
    return ADJECTIVES[Math.floor(Math.random()*ADJECTIVES.length)] + NOUNS[Math.floor(Math.random()*NOUNS.length)] + (Math.floor(Math.random()*99)+1);
}

async function initAuth() {
    var session = await supabaseClient.auth.getSession();
    if (session.data && session.data.session && session.data.session.user) {
        currentUser = session.data.session.user;
        var profileResult = await supabaseClient.from('profiles').select('display_name, gamer_tag, account_type, cosmetics').eq('id', currentUser.id).single();
        if (profileResult.data) { userProfile = profileResult.data; isPremium = profileResult.data.account_type === 'premium'; }
        nameInput.value = (userProfile && userProfile.display_name) || (userProfile && userProfile.gamer_tag) || currentUser.email.split('@')[0];
        nameInput.disabled = false;
        nameInput.placeholder = 'Enter your name';
        nameHint.innerHTML = isPremium ? 'Premium styling active' : 'Change in <a href="/profile">Profile</a>';
    } else {
        nameInput.value = generateRandomName();
        nameInput.disabled = true;
        nameHint.innerHTML = '<a href="/login">Sign in</a> to choose your name';
    }
}

document.getElementById('room-code').addEventListener('input', function(e) { e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, ''); });

function showFullRules() { document.getElementById('rules-modal').classList.add('visible'); }
function closeModal() { document.getElementById('rules-modal').classList.remove('visible'); }
document.getElementById('rules-modal').addEventListener('click', function(e) { if (e.target.id === 'rules-modal') closeModal(); });

function createRoom() {
    var name = nameInput.value.trim();
    if (!name || name.length < 2) { showError('Name must be at least 2 characters'); return; }
    hideMessages(); setLoading('btn-create', true);
    localStorage.setItem('tempPlayerName', name);
    localStorage.setItem('tempGameType', currentGame.backendType);
    localStorage.setItem('tempGameId', gameId);
    socket.emit('create-room', { playerName: name, gameType: currentGame.backendType, isPremium: isPremium, cosmetics: (userProfile && userProfile.cosmetics) || null, userId: currentUser ? currentUser.id : null });
}

function joinRoom() {
    var name = nameInput.value.trim();
    var code = document.getElementById('room-code').value.trim();
    if (!name || name.length < 2) { showError('Name must be at least 2 characters'); return; }
    if (!code || code.length !== 6) { showError('Enter a 6-character room code'); return; }
    hideMessages(); setLoading('btn-join', true);
    localStorage.setItem('tempPlayerName', name);
    localStorage.setItem('tempGameType', currentGame.backendType);
    localStorage.setItem('tempGameId', gameId);
    socket.emit('join-room', { roomCode: code, playerName: name, isPremium: isPremium, cosmetics: (userProfile && userProfile.cosmetics) || null, userId: currentUser ? currentUser.id : null });
}

socket.on('room-created', function(data) { showSuccess('Room created!'); setTimeout(function() { window.location.href = '/play/' + gameId + '/' + data.roomCode; }, 500); });
socket.on('room-joined', function(data) { showSuccess('Joining...'); setTimeout(function() { window.location.href = '/play/' + gameId + '/' + data.roomCode; }, 500); });
socket.on('error', function(data) { showError(data.message || 'Error'); setLoading('btn-create', false); setLoading('btn-join', false); });
socket.on('join-error', function(data) { showError(data.message || 'Cannot join'); setLoading('btn-join', false); });

function showError(msg) { var el = document.getElementById('error-message'); el.textContent = msg; el.classList.add('visible'); }
function showSuccess(msg) { var el = document.getElementById('success-message'); el.textContent = msg; el.classList.add('visible'); }
function hideMessages() { document.getElementById('error-message').classList.remove('visible'); document.getElementById('success-message').classList.remove('visible'); }
function setLoading(id, loading) { var btn = document.getElementById(id); if (loading) { btn.classList.add('btn-loading'); btn.disabled = true; } else { btn.classList.remove('btn-loading'); btn.disabled = false; } }

nameInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') { document.getElementById('room-code').value.trim() ? joinRoom() : createRoom(); } });
document.getElementById('room-code').addEventListener('keypress', function(e) { if (e.key === 'Enter') joinRoom(); });

initAuth();
</script>
<script src="/header.js"></script>
</body>
</html>
