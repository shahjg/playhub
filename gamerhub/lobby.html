<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Game - TheGaming.co</title>
    
    <meta name="description" content="Create or join a game room. Play free multiplayer party games with friends.">
    <meta name="theme-color" content="#0a0a0f">
    <link rel="stylesheet" href="/header.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --accent: #14b8a6;
            --accent-glow: rgba(20, 184, 166, 0.4);
            --accent-soft: rgba(20, 184, 166, 0.12);
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: rgba(255, 255, 255, 0.02);
            --border: rgba(255, 255, 255, 0.08);
            --border-accent: rgba(20, 184, 166, 0.3);
            --text: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.5);
            --gold: #fbbf24;
            --green: #22c55e;
            --red: #ef4444;
        }

        /* Game Themes */
        .theme-spyfall { --accent: #14b8a6; --accent-glow: rgba(20, 184, 166, 0.4); --accent-soft: rgba(20, 184, 166, 0.12); --border-accent: rgba(20, 184, 166, 0.3); }
        .theme-word-bomb { --accent: #f43f5e; --accent-glow: rgba(244, 63, 94, 0.4); --accent-soft: rgba(244, 63, 94, 0.12); --border-accent: rgba(244, 63, 94, 0.3); }
        .theme-codenames { --accent: #22c55e; --accent-glow: rgba(34, 197, 94, 0.4); --accent-soft: rgba(34, 197, 94, 0.12); --border-accent: rgba(34, 197, 94, 0.3); }
        .theme-werewolf { --accent: #a855f7; --accent-glow: rgba(168, 85, 247, 0.4); --accent-soft: rgba(168, 85, 247, 0.12); --border-accent: rgba(168, 85, 247, 0.3); }
        .theme-fake-artist { --accent: #ec4899; --accent-glow: rgba(236, 72, 153, 0.4); --accent-soft: rgba(236, 72, 153, 0.12); --border-accent: rgba(236, 72, 153, 0.3); }
        .theme-herd-mentality { --accent: #3b82f6; --accent-glow: rgba(59, 130, 246, 0.4); --accent-soft: rgba(59, 130, 246, 0.12); --border-accent: rgba(59, 130, 246, 0.3); }
        .theme-avalon { --accent: #eab308; --accent-glow: rgba(234, 179, 8, 0.4); --accent-soft: rgba(234, 179, 8, 0.12); --border-accent: rgba(234, 179, 8, 0.3); }
        .theme-imposter { --accent: #ef4444; --accent-glow: rgba(239, 68, 68, 0.4); --accent-soft: rgba(239, 68, 68, 0.12); --border-accent: rgba(239, 68, 68, 0.3); }
        .theme-insider { --accent: #6366f1; --accent-glow: rgba(99, 102, 241, 0.4); --accent-soft: rgba(99, 102, 241, 0.12); --border-accent: rgba(99, 102, 241, 0.3); }
        .theme-wavelength { --accent: #f97316; --accent-glow: rgba(249, 115, 22, 0.4); --accent-soft: rgba(249, 115, 22, 0.12); --border-accent: rgba(249, 115, 22, 0.3); }
        .theme-npat { --accent: #f59e0b; --accent-glow: rgba(245, 158, 11, 0.4); --accent-soft: rgba(245, 158, 11, 0.12); --border-accent: rgba(245, 158, 11, 0.3); }
        .theme-categories { --accent: #00d9ff; --accent-glow: rgba(0, 217, 255, 0.4); --accent-soft: rgba(0, 217, 255, 0.12); --border-accent: rgba(0, 217, 255, 0.3); }
        .theme-word-association { --accent: #a855f7; --accent-glow: rgba(168, 85, 247, 0.4); --accent-soft: rgba(168, 85, 247, 0.12); --border-accent: rgba(168, 85, 247, 0.3); }
        .theme-charades { --accent: #10b981; --accent-glow: rgba(16, 185, 129, 0.4); --accent-soft: rgba(16, 185, 129, 0.12); --border-accent: rgba(16, 185, 129, 0.3); }
        .theme-celebrity { --accent: #f472b6; --accent-glow: rgba(244, 114, 182, 0.4); --accent-soft: rgba(244, 114, 182, 0.12); --border-accent: rgba(244, 114, 182, 0.3); }
        .theme-fishbowl { --accent: #06b6d4; --accent-glow: rgba(6, 182, 212, 0.4); --accent-soft: rgba(6, 182, 212, 0.12); --border-accent: rgba(6, 182, 212, 0.3); }
        .theme-most-likely-to { --accent: #f43f5e; --accent-glow: rgba(244, 63, 94, 0.4); --accent-soft: rgba(244, 63, 94, 0.12); --border-accent: rgba(244, 63, 94, 0.3); }
        .theme-trivia-royale { --accent: #8b5cf6; --accent-glow: rgba(139, 92, 246, 0.4); --accent-soft: rgba(139, 92, 246, 0.12); --border-accent: rgba(139, 92, 246, 0.3); }
        .theme-this-or-that-party { --accent: #f97316; --accent-glow: rgba(249, 115, 22, 0.4); --accent-soft: rgba(249, 115, 22, 0.12); --border-accent: rgba(249, 115, 22, 0.3); }
        .theme-hot-takes-party { --accent: #ef4444; --accent-glow: rgba(239, 68, 68, 0.4); --accent-soft: rgba(239, 68, 68, 0.12); --border-accent: rgba(239, 68, 68, 0.3); }
        .theme-never-ever-party { --accent: #ec4899; --accent-glow: rgba(236, 72, 153, 0.4); --accent-soft: rgba(236, 72, 153, 0.12); --border-accent: rgba(236, 72, 153, 0.3); }
        .theme-bet-or-bluff { --accent: #10b981; --accent-glow: rgba(16, 185, 129, 0.4); --accent-soft: rgba(16, 185, 129, 0.12); --border-accent: rgba(16, 185, 129, 0.3); }
        .theme-sketch-guess { --accent: #f97316; --accent-glow: rgba(249, 115, 22, 0.4); --accent-soft: rgba(249, 115, 22, 0.12); --border-accent: rgba(249, 115, 22, 0.3); }
        .theme-fools-gold { --accent: #fbbf24; --accent-glow: rgba(251, 191, 36, 0.4); --accent-soft: rgba(251, 191, 36, 0.12); --border-accent: rgba(251, 191, 36, 0.3); }
        .theme-power-struggle { --accent: #eab308; --accent-glow: rgba(234, 179, 8, 0.4); --accent-soft: rgba(234, 179, 8, 0.12); --border-accent: rgba(234, 179, 8, 0.3); }
        .theme-punchline { --accent: #fbbf24; --accent-glow: rgba(251, 191, 36, 0.4); --accent-soft: rgba(251, 191, 36, 0.12); --border-accent: rgba(251, 191, 36, 0.3); }
        .theme-broken-pictionary { --accent: #ec4899; --accent-glow: rgba(236, 72, 153, 0.4); --accent-soft: rgba(236, 72, 153, 0.12); --border-accent: rgba(236, 72, 153, 0.3); }
        .theme-doodle-duel { --accent: #f97316; --accent-glow: rgba(249, 115, 22, 0.4); --accent-soft: rgba(249, 115, 22, 0.12); --border-accent: rgba(249, 115, 22, 0.3); }
        .theme-two-truths { --accent: #3b82f6; --accent-glow: rgba(59, 130, 246, 0.4); --accent-soft: rgba(59, 130, 246, 0.12); --border-accent: rgba(59, 130, 246, 0.3); }
        .theme-ludo { --accent: #22c55e; --accent-glow: rgba(34, 197, 94, 0.4); --accent-soft: rgba(34, 197, 94, 0.12); --border-accent: rgba(34, 197, 94, 0.3); }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* ========== ANIMATED BACKGROUND ========== */
        .bg-container { position: fixed; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 0; overflow: hidden; }
        .bg-gradient { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(ellipse 80% 50% at 20% 0%, var(--accent-soft) 0%, transparent 50%), radial-gradient(ellipse 60% 40% at 90% 100%, var(--accent-soft) 0%, transparent 50%), var(--bg-primary); }
        .glow-orb { position: absolute; width: 400px; height: 400px; background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%); border-radius: 50%; filter: blur(80px); opacity: 0.3; animation: orbFloat 25s ease-in-out infinite; }
        .glow-orb:nth-child(2) { width: 300px; height: 300px; animation-delay: -12s; animation-duration: 30s; }
        @keyframes orbFloat { 0%, 100% { transform: translate(0, 0); } 33% { transform: translate(60vw, 20vh); } 66% { transform: translate(30vw, 60vh); } }
        .grid-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: linear-gradient(var(--border) 1px, transparent 1px), linear-gradient(90deg, var(--border) 1px, transparent 1px); background-size: 60px 60px; opacity: 0.3; }

        /* ========== GAME ICON ========== */
        .game-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            color: var(--accent);
            position: relative;
        }
        .game-icon svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 20px var(--accent-glow));
        }
        .game-icon::before {
            content: '';
            position: absolute;
            inset: -15px;
            background: radial-gradient(circle, var(--accent-soft) 0%, transparent 70%);
            border-radius: 50%;
            animation: iconPulse 3s ease-in-out infinite;
            z-index: -1;
        }
        @keyframes iconPulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.15); }
        }

        /* ========== MAIN CONTENT ========== */
        main { flex: 1; display: flex; align-items: center; justify-content: center; padding: 80px 20px 40px; position: relative; z-index: 1; }
        .lobby-container { width: 100%; max-width: 420px; }
        .game-header { text-align: center; margin-bottom: 2rem; }
        .game-title { font-family: 'Bebas Neue', sans-serif; font-size: 4.5rem; letter-spacing: 8px; line-height: 1; margin-bottom: 0.5rem; color: var(--text); text-shadow: 0 0 80px var(--accent-glow); }
        .game-tagline { color: var(--accent); font-size: 1rem; font-weight: 600; letter-spacing: 3px; text-transform: uppercase; }
        .game-players { color: var(--text-muted); font-size: 0.85rem; margin-top: 0.5rem; }

        /* How to Play Preview */
        .htp-card { background: var(--bg-card); border: 1px solid var(--border); border-left: 3px solid var(--accent); border-radius: 12px; padding: 1rem 1.25rem; margin-bottom: 1.5rem; }
        .htp-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem; }
        .htp-title { font-size: 0.75rem; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 1.5px; }
        .htp-expand { background: none; border: none; color: var(--text-muted); font-size: 0.75rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 4px; padding: 0; transition: color 0.2s; }
        .htp-expand:hover { color: var(--accent); }
        .htp-expand svg { width: 14px; height: 14px; }
        .htp-summary { color: var(--text-muted); font-size: 0.9rem; line-height: 1.6; }

        /* Main Card */
        .lobby-card { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 20px; padding: 2rem; position: relative; }
        .lobby-card::before { content: ''; position: absolute; top: 0; left: 30px; right: 30px; height: 1px; background: linear-gradient(90deg, transparent, var(--accent), transparent); }

        /* Input Group */
        .input-group { margin-bottom: 1.5rem; }
        .input-label { display: block; font-size: 0.75rem; font-weight: 700; color: var(--text-muted); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 1px; }
        .input-field { width: 100%; padding: 0.9rem 1rem; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-size: 1rem; font-family: inherit; transition: all 0.2s ease; }
        .input-field::placeholder { color: var(--text-muted); }
        .input-field:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-soft); }
        .input-field:disabled { opacity: 0.5; cursor: not-allowed; }
        .input-hint { font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem; }
        .input-hint a { color: var(--accent); font-weight: 600; text-decoration: none; }
        .input-hint a:hover { text-decoration: underline; }

        /* Premium Preview */
        .name-preview { margin-top: 0.75rem; padding: 0.6rem 0.9rem; background: rgba(251, 191, 36, 0.08); border-radius: 8px; border: 1px solid rgba(251, 191, 36, 0.25); }
        .name-preview-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-bottom: 0.25rem; }
        .name-preview-value { font-weight: 700; font-size: 1rem; }
        .name-preview-value.premium { background: linear-gradient(90deg, var(--gold), #f59e0b, var(--gold)); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: goldShimmer 3s linear infinite; }
        @keyframes goldShimmer { 0% { background-position: 0% center; } 100% { background-position: 200% center; } }

        /* Buttons */
        .btn { width: 100%; padding: 1rem; border-radius: 10px; font-family: 'Bebas Neue', sans-serif; font-size: 1.25rem; letter-spacing: 2px; cursor: pointer; transition: all 0.2s ease; border: none; position: relative; overflow: hidden; }
        .btn-primary { background: var(--accent); color: white; box-shadow: 0 4px 20px var(--accent-glow); }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 30px var(--accent-glow); filter: brightness(1.1); }
        .btn-secondary { background: transparent; color: var(--text); border: 1px solid var(--border); }
        .btn-secondary:hover:not(:disabled) { border-color: var(--accent); background: var(--accent-soft); }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; }
        .btn-loading::after { content: ''; width: 16px; height: 16px; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 0.7s linear infinite; margin-left: 8px; display: inline-block; vertical-align: middle; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Divider */
        .divider { display: flex; align-items: center; gap: 1rem; margin: 1.5rem 0; }
        .divider-line { flex: 1; height: 1px; background: var(--border); }
        .divider-text { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted); }

        /* Room Code Input */
        .room-code-input { text-transform: uppercase; font-family: 'Bebas Neue', sans-serif; font-size: 1.75rem; letter-spacing: 10px; text-align: center; }

        /* Messages */
        .message { padding: 0.9rem; border-radius: 8px; margin-top: 1rem; font-size: 0.85rem; font-weight: 600; display: none; text-align: center; }
        .message.error { background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.3); color: #fca5a5; }
        .message.success { background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.3); color: #86efac; }
        .message.visible { display: block; }

        /* ========== MODAL ========== */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 1rem; overflow-y: auto; }
        .modal-overlay.visible { display: flex; }
        .modal { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 20px; width: 100%; max-width: 480px; max-height: calc(100vh - 2rem); display: flex; flex-direction: column; animation: modalIn 0.25s ease; box-shadow: 0 0 60px var(--accent-glow); margin: auto; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .modal-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 2px; color: var(--accent); }
        .modal-close { background: transparent; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer; line-height: 1; padding: 0; transition: color 0.2s; }
        .modal-close:hover { color: var(--text); }
        .modal-body { padding: 1.5rem; color: var(--text-muted); line-height: 1.7; overflow-y: auto; flex: 1; }
        .modal-body h3 { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; color: var(--accent); margin-top: 1.25rem; margin-bottom: 0.4rem; letter-spacing: 1px; }
        .modal-body h3:first-child { margin-top: 0; }
        .modal-body p { margin-bottom: 0.75rem; }
        .modal-body ul { margin-left: 1.25rem; margin-bottom: 0.75rem; }
        .modal-body li { margin-bottom: 0.35rem; color: var(--text); }
        .modal-body strong { color: var(--accent); }
        .modal-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--border); flex-shrink: 0; }
        .modal-btn { width: 100%; padding: 0.8rem; background: var(--accent); color: white; border: none; border-radius: 10px; font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 2px; cursor: pointer; transition: all 0.2s ease; }
        .modal-btn:hover { filter: brightness(1.1); }

        /* ========== FOOTER ========== */
        footer { background: #000; position: relative; z-index: 10; margin-top: auto; }
        .footer-border { height: 3px; background: linear-gradient(90deg, #ff6b9d, #4facfe, #a855f7, #ff6b9d); background-size: 300% 100%; animation: gradientSlide 6s linear infinite; }
        @keyframes gradientSlide { 0% { background-position: 0% 50%; } 100% { background-position: 300% 50%; } }
        .footer-main { max-width: 1100px; margin: 0 auto; padding: 40px 20px 25px; }
        .footer-links { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; margin-bottom: 30px; max-width: 500px; margin-left: auto; margin-right: auto; }
        .footer-column { text-align: center; }
        .footer-column h5 { font-family: 'Bebas Neue', sans-serif; font-size: 0.9rem; letter-spacing: 2px; margin-bottom: 12px; color: rgba(255, 255, 255, 0.8); }
        .footer-column ul { list-style: none; display: flex; flex-direction: column; gap: 8px; }
        .footer-column a { color: rgba(255, 255, 255, 0.4); font-size: 0.85rem; transition: color 0.2s ease; text-decoration: none; }
        .footer-column a:hover { color: var(--accent); }
        .footer-bottom { padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.06); text-align: center; }
        .footer-copyright { font-size: 0.8rem; color: rgba(255, 255, 255, 0.35); margin-bottom: 10px; }
        .footer-legal { display: flex; justify-content: center; gap: 20px; }
        .footer-legal a { color: rgba(255, 255, 255, 0.35); font-size: 0.75rem; text-decoration: none; transition: color 0.2s; }
        .footer-legal a:hover { color: white; }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 600px) {
            main { padding: 70px 16px 30px; }
            .game-title { font-size: 3.2rem; letter-spacing: 5px; }
            .game-tagline { font-size: 0.85rem; letter-spacing: 2px; }
            .lobby-card { padding: 1.5rem; border-radius: 16px; }
            .btn { padding: 0.9rem; font-size: 1.15rem; }
            .modal { max-height: calc(100vh - 1rem); border-radius: 16px; }
            .footer-links { grid-template-columns: 1fr; gap: 20px; }
            .footer-main { padding: 30px 20px 20px; }
        }
    </style>
</head>
<body class="theme-spyfall">

<div class="bg-container">
    <div class="bg-gradient"></div>
    <div class="bg-pattern"></div>
    <div class="glow-orb"></div>
    <div class="glow-orb"></div>
</div>

<div id="site-header"></div>

<main>
    <div class="lobby-container">
        <div class="game-header">
            <div class="game-icon" id="game-icon"></div>
            <h1 class="game-title" id="game-title">SPY HUNT</h1>
            <p class="game-tagline" id="game-tagline">Trust No One</p>
            <p class="game-players" id="game-players">4-20 Players</p>
        </div>

        <div class="htp-card">
            <div class="htp-header">
                <span class="htp-title">How to Play</span>
                <button class="htp-expand" onclick="showFullRules()">
                    Full Rules
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
                </button>
            </div>
            <p class="htp-summary" id="htp-summary">
                One player is secretly the Spy. Everyone else knows the location. Ask questions to find the Spy — but don't reveal the location!
            </p>
        </div>

        <div class="lobby-card">
            <div class="input-group">
                <label class="input-label" for="player-name">Your Name</label>
                <input type="text" id="player-name" class="input-field" placeholder="Loading..." maxlength="20" autocomplete="off">
                <p class="input-hint" id="name-hint">Loading...</p>
                <div class="name-preview" id="name-preview" style="display: none;">
                    <div class="name-preview-label">Display Name</div>
                    <div class="name-preview-value" id="name-preview-value">Name</div>
                </div>
            </div>

            <button class="btn btn-primary" id="btn-create" onclick="createRoom()">Create Room</button>

            <div class="divider">
                <div class="divider-line"></div>
                <span class="divider-text">Or Join</span>
                <div class="divider-line"></div>
            </div>

            <div class="input-group">
                <label class="input-label" for="room-code">Room Code</label>
                <input type="text" id="room-code" class="input-field room-code-input" placeholder="ABC123" maxlength="6" autocomplete="off">
            </div>

            <button class="btn btn-secondary" id="btn-join" onclick="joinRoom()">Join Room</button>

            <div class="message error" id="error-message"></div>
            <div class="message success" id="success-message"></div>
        </div>
    </div>
</main>

<div class="modal-overlay" id="rules-modal">
    <div class="modal">
        <div class="modal-header">
            <h2 class="modal-title" id="modal-title">How to Play</h2>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modal-body"></div>
        <div class="modal-footer">
            <button class="modal-btn" onclick="closeModal()">Got It</button>
        </div>
    </div>
</div>

<footer>
    <div class="footer-border"></div>
    <div class="footer-main">
        <div class="footer-links">
            <div class="footer-column">
                <h5>GAMES</h5>
                <ul>
                    <li><a href="/solo.html">Solo</a></li>
                    <li><a href="/squad-games.html">Squad</a></li>
                    <li><a href="/party-games.html">Party</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h5>COMMUNITY</h5>
                <ul>
                    <li><a href="/leaderboards.html">Leaderboards</a></li>
                    <li><a href="/supporters.html">Supporters</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h5>COMPANY</h5>
                <ul>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/contact.html">Contact</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p class="footer-copyright">© 2025 TheGaming.co — Free party games, forever.</p>
            <div class="footer-legal">
                <a href="/privacy.html">Privacy</a>
                <a href="/terms.html">Terms</a>
            </div>
        </div>
    </div>
</footer>

<script>
    const BACKEND_URL = 'https://web-production-519c7.up.railway.app';
    const SUPABASE_URL = 'https://tvvivtmzofsyehatzlvl.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR2dml2dG16b2ZzeWVoYXR6bHZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4OTExODYsImV4cCI6MjA4MDQ2NzE4Nn0.Qy8kHMO0Nb4yJ0ZHjby7RuQtzwWB8rUcZvkdnbL1b3M';
    
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ========== ALL GAMES ==========
    const GAMES = {
        // ==================== DECEPTION & DEDUCTION ====================
        'spyfall': {
            displayName: 'SPY HUNT',
            backendType: 'spyfall',
            theme: 'theme-spyfall',
            tagline: 'Trust No One',
            players: '4-20 Players',
            minPlayers: 4,
            maxPlayers: 20,
            icon: 'spy',
            summary: 'One player is secretly the Spy. Everyone else knows the location. Ask questions to find the Spy — but don\'t reveal the location!',
            howToPlay: `<h3>The Setup</h3><p>One player is randomly chosen as the <strong>Spy</strong>. Everyone else sees a secret location and their role at that location.</p><h3>How to Play</h3><p>Players take turns asking each other questions to identify the Spy without revealing the location.</p><h3>Winning</h3><ul><li><strong>Players win</strong> by correctly voting out the Spy</li><li><strong>Spy wins</strong> by guessing the location OR surviving the vote</li></ul>`
        },
        'avalon': {
            displayName: 'SECRET ROLES',
            backendType: 'avalon',
            theme: 'theme-avalon',
            tagline: 'Loyalty & Betrayal',
            players: '5-15 Players',
            minPlayers: 5,
            maxPlayers: 15,
            icon: 'crown',
            summary: 'Knights vs traitors in King Arthur\'s court. Vote on quests, debate loyalties, and uncover the hidden evil.',
            howToPlay: `<h3>The Setup</h3><p>Players are secretly assigned to either the <strong>Loyal Servants of Arthur</strong> or the <strong>Minions of Mordred</strong>.</p><h3>Winning</h3><ul><li><strong>Good wins</strong> if 3 quests succeed</li><li><strong>Evil wins</strong> if 3 quests fail OR Assassin kills Merlin</li></ul>`
        },
        'werewolf': {
            displayName: 'MAFIA',
            backendType: 'werewolf',
            theme: 'theme-werewolf',
            tagline: 'Survive The Night',
            players: '6-20 Players',
            minPlayers: 6,
            maxPlayers: 20,
            summary: 'Villagers hunt the killers by day while the mafia strikes by night. Who can you trust?',
            howToPlay: `<h3>Roles</h3><ul><li><strong>Mafia</strong> — Eliminate one villager each night</li><li><strong>Seer</strong> — Check one player's identity each night</li><li><strong>Doctor</strong> — Protect one player each night</li></ul>`
        },
        'imposter': {
            displayName: 'IMPOSTER',
            backendType: 'imposter',
            theme: 'theme-imposter',
            tagline: 'Blend In Or Be Found',
            players: '4-10 Players',
            minPlayers: 4,
            maxPlayers: 10,
            summary: 'Everyone knows the secret word except one player. Give subtle clues to find the imposter!',
            howToPlay: `<h3>The Setup</h3><p>Everyone except the <strong>Imposter</strong> sees a secret word. The Imposter must figure out the word while blending in.</p>`
        },
        'fake-artist': {
            displayName: 'FAKE ARTIST',
            backendType: 'fake-artist',
            theme: 'theme-fake-artist',
            tagline: 'Draw Together. Trust No Brush.',
            players: '4-10 Players',
            minPlayers: 4,
            maxPlayers: 10,
            summary: 'Everyone draws the same thing — except the Fake Artist who doesn\'t know what it is!',
            howToPlay: `<h3>Drawing</h3><ul><li>Players take turns adding ONE stroke to the drawing</li><li>The Fake Artist must blend in without knowing the subject</li></ul>`
        },
        'insider': {
            displayName: 'INSIDER',
            backendType: 'insider',
            theme: 'theme-insider',
            tagline: 'The Secret Guide',
            players: '4-8 Players',
            minPlayers: 4,
            maxPlayers: 8,
            summary: 'Play 20 Questions with a twist — one player secretly knows the answer and subtly guides the group.',
            howToPlay: `<h3>The Setup</h3><p>One player is the <strong>Master</strong> who knows the word. Another is the secret <strong>Insider</strong> who also knows it.</p>`
        },
        'power-struggle': {
            displayName: 'POWER STRUGGLE',
            backendType: 'power-struggle',
            theme: 'theme-power-struggle',
            tagline: 'Bluff Your Way Up',
            players: '3-10 Players',
            minPlayers: 3,
            maxPlayers: 10,
            summary: 'Bluff, bribe, and backstab your way to corporate dominance. Claim powerful roles and be the last standing!',
            howToPlay: `<h3>The Setup</h3><p>Each player starts with 2 role cards and 2 coins.</p><h3>Actions</h3><ul><li><strong>Income</strong> — Take 1 coin</li><li><strong>Foreign Aid</strong> — Take 2 coins (blockable)</li><li><strong>Coup</strong> — Pay 7 coins to eliminate</li><li><strong>Use Role Power</strong> — Claim any role (bluff allowed!)</li></ul><h3>Challenging</h3><p>Anyone can call your bluff. Wrong challenger loses a card. Caught bluffer loses a card.</p>`
        },
        // ==================== WORD & TEAM GAMES ====================
        'codenames': {
            displayName: 'CODEWORDS',
            backendType: 'codenames',
            theme: 'theme-codenames',
            tagline: 'Give Clues. Find Agents.',
            players: '4-16 Players',
            minPlayers: 4,
            maxPlayers: 16,
            summary: 'Two spymasters give one-word clues to help teammates find their agents. Just don\'t hit the assassin!',
            howToPlay: `<h3>Teams</h3><p>Split into two teams. Each team has one Spymaster and the rest are Operatives.</p>`
        },
        'categories': {
            displayName: 'CATEGORIES',
            backendType: 'categories',
            theme: 'theme-categories',
            tagline: 'Think Fast',
            players: '2-20 Players',
            minPlayers: 2,
            maxPlayers: 20,
            summary: 'A category appears and everyone races to type a valid answer. First to answer scores!',
            howToPlay: `<h3>The Game</h3><p>Each round, a category appears. Race to type a valid answer first!</p>`
        },
        'word-association': {
            displayName: 'WORD ASSOCIATION',
            backendType: 'word-association',
            theme: 'theme-word-association',
            tagline: 'Chain Reaction',
            players: '3-12 Players',
            minPlayers: 3,
            maxPlayers: 12,
            summary: 'Say a word related to the previous one! Hesitate and you\'re out!',
            howToPlay: `<h3>The Game</h3><p>Players take turns saying words related to the previous word.</p>`
        },
        'wavelength': {
            displayName: 'SPECTRUM',
            backendType: 'wavelength',
            theme: 'theme-wavelength',
            tagline: 'Find The Target',
            players: '4-12 Players',
            minPlayers: 4,
            maxPlayers: 12,
            summary: 'One player knows where the target is on a spectrum. Give a clue to help your team guess!',
            howToPlay: `<h3>The Setup</h3><p>A spectrum appears with two opposites. A hidden target is placed somewhere on the spectrum.</p>`
        },
        'herd-mentality': {
            displayName: 'THINK ALIKE',
            backendType: 'herd-mentality',
            theme: 'theme-herd-mentality',
            tagline: 'Think Like Everyone Else',
            players: '4-20 Players',
            minPlayers: 4,
            maxPlayers: 20,
            summary: 'Answer questions to match the majority. Be unique and you\'re stuck with the Pink Cow!',
            howToPlay: `<h3>The Game</h3><p>Each round, everyone answers the same question secretly. Match the majority to score!</p>`
        },
        'word-bomb': {
            displayName: 'WORD BOMB',
            backendType: 'word-bomb',
            theme: 'theme-word-bomb',
            tagline: 'Think Fast',
            players: '2-16 Players',
            minPlayers: 2,
            maxPlayers: 16,
            summary: 'Type a word containing the given letters before the bomb explodes!',
            howToPlay: `<h3>The Game</h3><p>Type a valid word containing the given letter combination before time runs out.</p>`
        },
        'npat': {
            displayName: 'NAME PLACE ANIMAL THING',
            backendType: 'npat',
            theme: 'theme-npat',
            tagline: 'Race The Clock',
            players: '2-20 Players',
            minPlayers: 2,
            maxPlayers: 20,
            summary: 'A random letter appears — race to fill Name, Place, Animal, Thing before time runs out!',
            howToPlay: `<h3>The Game</h3><p>Fill in words starting with the random letter for each category!</p>`
        },
        // ==================== DRAWING & WRITING ====================
        'punchline': {
            displayName: 'PUNCHLINE',
            backendType: 'punchline',
            theme: 'theme-punchline',
            tagline: 'Write The Funny',
            players: '3-16 Players',
            minPlayers: 3,
            maxPlayers: 16,
            summary: 'Write the funniest answer to absurd prompts. Everyone votes, best punchline wins!',
            howToPlay: `<h3>The Game</h3><p>Each round shows a prompt. Everyone writes their funniest answer.</p><h3>Voting</h3><p>All answers shown anonymously. Vote for your favorite!</p>`
        },
        'fools-gold': {
            displayName: 'FOOLS GOLD',
            backendType: 'fools-gold',
            theme: 'theme-fools-gold',
            tagline: 'Lie Your Way to Victory',
            players: '3-12 Players',
            minPlayers: 3,
            maxPlayers: 12,
            summary: 'Fill in the blank with a convincing lie! Fool others to score, or spot the truth to win big.',
            howToPlay: `<h3>The Game</h3><p>Each round shows a trivia fact with a blank. Everyone writes a fake answer — except the truth is also hidden among the options!</p><h3>Scoring</h3><ul><li><strong>Fool Someone</strong> — 100 points per player fooled</li><li><strong>Find the Truth</strong> — 200 points</li></ul>`
        },
        'broken-pictionary': {
            displayName: 'BROKEN PICTIONARY',
            backendType: 'broken-pictionary',
            theme: 'theme-broken-pictionary',
            tagline: 'Draw. Guess. Repeat.',
            players: '4-16 Players',
            minPlayers: 4,
            maxPlayers: 16,
            summary: 'Draw, guess, repeat — watch your phrase transform through hilarious chains!',
            howToPlay: `<h3>The Chain</h3><p>Start with a phrase → Draw it → Next person guesses → They draw their guess → Repeat!</p><h3>The Reveal</h3><p>See how "Birthday Party" became "Sad Clown Funeral"</p>`
        },
        'doodle-duel': {
            displayName: 'DOODLE DUEL',
            backendType: 'doodle-duel',
            theme: 'theme-doodle-duel',
            tagline: 'Draw & Deceive',
            players: '3-12 Players',
            minPlayers: 3,
            maxPlayers: 12,
            summary: 'Draw absurd prompts, others make up fake titles. Vote for the real answer!',
            howToPlay: `<h3>Drawing</h3><p>One player draws a secret prompt.</p><h3>Faking</h3><p>Everyone else writes a fake title.</p><h3>Voting</h3><p>All titles shown — vote for the REAL one!</p>`
        },
        'two-truths': {
            displayName: 'TWO TRUTHS',
            backendType: 'two-truths',
            theme: 'theme-two-truths',
            tagline: 'Spot The Lie',
            players: '3-16 Players',
            minPlayers: 3,
            maxPlayers: 16,
            summary: 'Write two truths and one lie about yourself. Others vote on which is fake!',
            howToPlay: `<h3>Writing</h3><p>Write 2 true statements and 1 lie about yourself.</p><h3>Voting</h3><p>Others try to spot your lie!</p>`
        },
        'sketch-guess': {
            displayName: 'SKETCH & GUESS',
            backendType: 'sketch-guess',
            theme: 'theme-sketch-guess',
            tagline: 'Draw & Guess',
            players: '3-20 Players',
            minPlayers: 3,
            maxPlayers: 20,
            summary: 'One player draws while others guess the word! Fast guessing = more points.',
            howToPlay: '<h3>Play</h3><p>One player draws, others guess!</p><h3>Scoring</h3><ul><li>Guesser: Faster = more points</li><li>Drawer: Points per correct guess</li></ul>'
        },
        // ==================== PARTY & PERFORMANCE ====================
        'charades': {
            displayName: 'CHARADES',
            backendType: 'charades',
            theme: 'theme-charades',
            tagline: 'Act It Out',
            players: '4-20 Players',
            minPlayers: 4,
            maxPlayers: 20,
            summary: 'Act out words or phrases without speaking. Your team races to guess!',
            howToPlay: `<h3>Acting Rules</h3><ul><li>No speaking, sounds, or lip movements</li><li>Use gestures and body language</li></ul>`
        },
        'celebrity': {
            displayName: 'CELEBRITY',
            backendType: 'celebrity',
            theme: 'theme-celebrity',
            tagline: 'Three Rounds of Mayhem',
            players: '4-16 Players',
            minPlayers: 4,
            maxPlayers: 16,
            summary: 'Guess names through three rounds: describe freely, use one word, then act it out!',
            howToPlay: `<h3>Rounds</h3><p>Round 1: Describe. Round 2: One Word. Round 3: Charades!</p>`
        },
        'fishbowl': {
            displayName: 'FISHBOWL',
            backendType: 'fishbowl',
            theme: 'theme-fishbowl',
            tagline: 'Three Games In One',
            players: '6-20 Players',
            minPlayers: 6,
            maxPlayers: 20,
            summary: 'Teams race through three rounds: Taboo-style, one-word clues, and charades.',
            howToPlay: `<h3>Rounds</h3><p>Taboo → Password → Charades</p>`
        },
        'most-likely-to': {
            displayName: 'MOST LIKELY TO',
            backendType: 'most-likely-to',
            theme: 'theme-most-likely-to',
            tagline: 'Vote On Your Friends',
            players: '3-20 Players',
            minPlayers: 3,
            maxPlayers: 20,
            summary: 'Vote on who is most likely to do hilarious scenarios. No winners, just laughs!',
            howToPlay: `<h3>The Game</h3><p>A scenario appears. Vote for who best fits!</p>`
        },
        // ==================== CLASSIC BOARD GAMES ====================
        'ludo': {
            displayName: 'LUDO',
            backendType: 'ludo',
            theme: 'theme-ludo',
            tagline: 'Race Home',
            players: '2-6 Players',
            minPlayers: 2,
            maxPlayers: 6,
            summary: 'Classic race-to-home board game! Roll dice, move pawns, get all four home first.',
            howToPlay: `<h3>Setup</h3><p>Each player has 4 pawns in their base.</p><h3>Playing</h3><ul><li>Roll 6 to enter the board</li><li>Move clockwise around the track</li><li>Land on opponents to send them home</li><li>Get all 4 pawns to your home column to win</li></ul>`
        },
        // ==================== PARTY GAMES (Large Scale) ====================
        'trivia-royale': {
            displayName: 'TRIVIA ROYALE',
            backendType: 'trivia-royale',
            theme: 'theme-trivia-royale',
            tagline: 'Battle of Brains',
            players: '2-100 Players',
            minPlayers: 2,
            maxPlayers: 100,
            isPartyGame: true,
            summary: 'Fast-paced trivia where speed matters! Answer quickly for bonus points and build streaks.',
            howToPlay: `<h3>The Game</h3><p>10 rounds of trivia. Faster answers = more points! Build streaks for multipliers.</p>`
        },
        'this-or-that-party': {
            displayName: 'THIS OR THAT',
            backendType: 'this-or-that-party',
            theme: 'theme-this-or-that-party',
            tagline: 'Pick Your Side',
            players: '2-100 Players',
            minPlayers: 2,
            maxPlayers: 100,
            isPartyGame: true,
            summary: 'Choose between two options and see how the crowd splits! Match the majority to score.',
            howToPlay: `<h3>The Game</h3><p>Pick one of two options. Match the majority to score!</p>`
        },
        'hot-takes-party': {
            displayName: 'HOT TAKES',
            backendType: 'hot-takes-party',
            theme: 'theme-hot-takes-party',
            tagline: 'Controversial Opinions',
            players: '2-100 Players',
            minPlayers: 2,
            maxPlayers: 100,
            isPartyGame: true,
            summary: 'Rate spicy statements from 1-5 and see if the crowd agrees with your hot takes!',
            howToPlay: `<h3>The Game</h3><p>Rate statements 1-5. Match the average to score!</p>`
        },
        'never-ever-party': {
            displayName: 'NEVER HAVE I EVER',
            backendType: 'never-ever-party',
            theme: 'theme-never-ever-party',
            tagline: 'Confess or Deny',
            players: '2-100 Players',
            minPlayers: 2,
            maxPlayers: 100,
            isPartyGame: true,
            summary: 'Have you done it? Vote honestly and see what percentage of the crowd shares your experience!',
            howToPlay: `<h3>The Game</h3><p>Vote HAVE or HAVE NOT. Minority experiences score more!</p>`
        },
        'bet-or-bluff': {
            displayName: 'BET OR BLUFF',
            backendType: 'bet-or-bluff',
            theme: 'theme-bet-or-bluff',
            tagline: 'Risk It All',
            players: '2-100 Players',
            minPlayers: 2,
            maxPlayers: 100,
            isPartyGame: true,
            summary: 'Answer trivia then bet on whether others got it right! High risk, high reward.',
            howToPlay: `<h3>The Game</h3><p>Answer trivia, then bet on the results. Strategic betting wins!</p>`
        }
    };

    // Random names
    const ADJECTIVES = ['Swift', 'Clever', 'Bold', 'Silent', 'Quick', 'Sly', 'Sharp', 'Cool', 'Wild', 'Rapid', 'Sneaky', 'Mighty', 'Lucky', 'Epic', 'Shadow'];
    const NOUNS = ['Fox', 'Wolf', 'Eagle', 'Tiger', 'Hawk', 'Bear', 'Lion', 'Shark', 'Falcon', 'Panther', 'Dragon', 'Phoenix', 'Viper', 'Raven', 'Ghost'];
    
    function generateRandomName() {
        const adj = ADJECTIVES[Math.floor(Math.random() * ADJECTIVES.length)];
        const noun = NOUNS[Math.floor(Math.random() * NOUNS.length)];
        const num = Math.floor(Math.random() * 99) + 1;
        return `${adj}${noun}${num}`;
    }

    // Get game from URL
    const urlParams = new URLSearchParams(window.location.search);
    const gameId = urlParams.get('game') || 'spyfall';
    const joinCode = urlParams.get('join');
    const currentGame = GAMES[gameId] || GAMES['spyfall'];
    
    // Apply theme
    document.body.className = currentGame.theme;

    // Update page
    document.getElementById('game-title').textContent = currentGame.displayName;
    document.getElementById('game-tagline').textContent = currentGame.tagline;
    document.getElementById('game-players').textContent = currentGame.players;
    document.getElementById('htp-summary').textContent = currentGame.summary;
    document.getElementById('modal-title').textContent = `How to Play ${currentGame.displayName}`;
    document.getElementById('modal-body').innerHTML = currentGame.howToPlay;
    document.title = `${currentGame.displayName} - TheGaming.co`;

    if (joinCode) document.getElementById('room-code').value = joinCode.toUpperCase();

    // Socket
    const socket = io(BACKEND_URL, { transports: ['websocket', 'polling'] });

    // State
    let currentUser = null;
    let userProfile = null;
    let isPremium = false;

    const nameInput = document.getElementById('player-name');
    const nameHint = document.getElementById('name-hint');

    async function initAuth() {
        const { data } = await supabaseClient.auth.getSession();
        if (data?.session?.user) {
            currentUser = data.session.user;
            await loadProfile();
            showLoggedInName();
        } else {
            showGuestName();
        }
    }

    async function loadProfile() {
        if (!currentUser) return;
        const { data: profile } = await supabaseClient
            .from('profiles')
            .select('display_name, gamer_tag, account_type, cosmetics')
            .eq('id', currentUser.id)
            .single();
        
        if (profile) {
            userProfile = profile;
            isPremium = profile.account_type === 'premium';
        }
    }

    function showLoggedInName() {
        const displayName = userProfile?.display_name || userProfile?.gamer_tag || currentUser.email.split('@')[0];
        nameInput.value = displayName;
        nameInput.disabled = false;
        nameInput.placeholder = 'Enter your name';
        
        if (isPremium) {
            nameHint.innerHTML = 'Premium styling active';
            showNamePreview(displayName);
        } else {
            nameHint.innerHTML = 'Change in <a href="/profile.html">Profile</a>';
        }
    }

    function showGuestName() {
        const randomName = generateRandomName();
        nameInput.value = randomName;
        nameInput.disabled = true;
        nameHint.innerHTML = '<a href="/login.html">Sign in</a> to choose your name';
    }

    function showNamePreview(name) {
        const preview = document.getElementById('name-preview');
        const value = document.getElementById('name-preview-value');
        preview.style.display = 'block';
        value.textContent = name;
        value.className = 'name-preview-value' + (isPremium ? ' premium' : '');
    }

    nameInput.addEventListener('input', () => {
        if (isPremium && nameInput.value.trim()) showNamePreview(nameInput.value.trim());
    });

    const roomCodeInput = document.getElementById('room-code');
    roomCodeInput.addEventListener('input', (e) => {
        e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
    });

    // Modals
    function showFullRules() { document.getElementById('rules-modal').classList.add('visible'); }
    function closeModal() { document.getElementById('rules-modal').classList.remove('visible'); }
    document.getElementById('rules-modal').addEventListener('click', (e) => { if (e.target.id === 'rules-modal') closeModal(); });

    // Create/Join
    function createRoom() {
        const name = nameInput.value.trim();
        if (!name || name.length < 2) { showError('Name must be at least 2 characters'); return; }
        
        hideMessages();
        setLoading('btn-create', true);
        
        const cosmetics = userProfile?.cosmetics || null;
        const userId = currentUser?.id || null;
        
        localStorage.setItem('tempPlayerName', name);
        localStorage.setItem('tempGameType', currentGame.backendType);
        localStorage.setItem('tempGameId', gameId);
        localStorage.setItem('tempIsPremium', isPremium.toString());
        localStorage.setItem('tempCosmetics', JSON.stringify(cosmetics));
        localStorage.setItem('tempUserId', userId || '');
        
        socket.emit('create-room', { 
            playerName: name, 
            gameType: currentGame.backendType,
            isPremium: isPremium,
            cosmetics: cosmetics,
            userId: userId
        });
    }

    function joinRoom() {
        const name = nameInput.value.trim();
        const code = roomCodeInput.value.trim();
        
        if (!name || name.length < 2) { showError('Name must be at least 2 characters'); return; }
        if (!code || code.length !== 6) { showError('Enter a valid 6-character room code'); return; }
        
        hideMessages();
        setLoading('btn-join', true);
        
        const cosmetics = userProfile?.cosmetics || null;
        const userId = currentUser?.id || null;
        
        localStorage.setItem('tempPlayerName', name);
        localStorage.setItem('tempRoomCode', code);
        localStorage.setItem('tempIsPremium', isPremium.toString());
        localStorage.setItem('tempCosmetics', JSON.stringify(cosmetics));
        localStorage.setItem('tempUserId', userId || '');
        
        socket.emit('join-room', { 
            roomCode: code, 
            playerName: name,
            isPremium: isPremium,
            cosmetics: cosmetics,
            userId: userId
        });
    }

    // Socket events
    socket.on('connect', () => console.log('Connected'));

    socket.on('room-created', (data) => {
        showSuccess(`Room created!`);
        localStorage.setItem('tempRoomCode', data.roomCode);
        localStorage.setItem('tempIsHost', 'true');
        setTimeout(() => { window.location.href = `waiting-room.html?room=${data.roomCode}`; }, 300);
    });

    socket.on('room-joined', (data) => {
        showSuccess('Joined!');
        if (data.room?.gameType) {
            localStorage.setItem('tempGameType', data.room.gameType);
            const gameEntry = Object.entries(GAMES).find(([k, v]) => v.backendType === data.room.gameType);
            if (gameEntry) localStorage.setItem('tempGameId', gameEntry[0]);
        }
        setTimeout(() => { window.location.href = `waiting-room.html?room=${data.roomCode}`; }, 300);
    });

    socket.on('error', (data) => { showError(data.message || 'Something went wrong'); setLoading('btn-create', false); setLoading('btn-join', false); });
    socket.on('join-error', (data) => { showError(data.message || 'Could not join room'); setLoading('btn-join', false); });

    // Helpers
    function showError(msg) { const el = document.getElementById('error-message'); el.textContent = msg; el.classList.add('visible'); }
    function showSuccess(msg) { const el = document.getElementById('success-message'); el.textContent = msg; el.classList.add('visible'); }
    function hideMessages() { document.getElementById('error-message').classList.remove('visible'); document.getElementById('success-message').classList.remove('visible'); }
    function setLoading(btnId, loading) { const btn = document.getElementById(btnId); btn.classList.toggle('btn-loading', loading); btn.disabled = loading; }

    nameInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { roomCodeInput.value.trim() ? joinRoom() : createRoom(); } });
    roomCodeInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') joinRoom(); });

    // ========== ICONS ==========
    const ICONS = {
        spy: `<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="30" r="18" stroke="currentColor" stroke-width="2"/><path d="M22 30h36" stroke="currentColor" stroke-width="2"/><ellipse cx="40" cy="30" rx="8" ry="5" fill="currentColor" opacity="0.3"/><circle cx="40" cy="30" r="3" fill="currentColor"/><path d="M40 48v8M32 70c0-8 3-14 8-14s8 6 8 14" stroke="currentColor" stroke-width="2"/></svg>`,
        crown: `<svg viewBox="0 0 80 80" fill="none"><path d="M15 55l10-25 15 15 15-15 10 25H15z" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.15"/><circle cx="15" cy="30" r="4" fill="currentColor"/><circle cx="40" cy="20" r="4" fill="currentColor"/><circle cx="65" cy="30" r="4" fill="currentColor"/><rect x="12" y="55" width="56" height="8" rx="2" stroke="currentColor" stroke-width="2"/></svg>`,
        moon: `<svg viewBox="0 0 80 80" fill="none"><path d="M50 15c-15 0-27 12-27 27s12 27 27 27c3 0 6-.5 9-1.4-6-5-10-13-10-22s4-17 10-22c-3-.9-6-1.4-9-1.4z" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.15"/><circle cx="55" cy="25" r="2" fill="currentColor"/><circle cx="62" cy="35" r="1.5" fill="currentColor"/></svg>`,
        alert: `<svg viewBox="0 0 80 80" fill="none"><path d="M40 15L65 60H15L40 15z" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.15"/><line x1="40" y1="30" x2="40" y2="45" stroke="currentColor" stroke-width="3" stroke-linecap="round"/><circle cx="40" cy="52" r="2.5" fill="currentColor"/></svg>`,
        palette: `<svg viewBox="0 0 80 80" fill="none"><ellipse cx="40" cy="42" rx="28" ry="24" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><circle cx="30" cy="35" r="5" fill="currentColor" opacity="0.6"/><circle cx="45" cy="30" r="4" fill="currentColor" opacity="0.8"/><circle cx="55" cy="40" r="4" fill="currentColor" opacity="0.5"/><circle cx="35" cy="50" r="3" fill="currentColor" opacity="0.7"/></svg>`,
        question: `<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="40" r="28" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><path d="M32 32c0-6 4-10 10-10s10 4 10 10c0 5-4 7-7 9-2 1-3 3-3 5v2" stroke="currentColor" stroke-width="3" stroke-linecap="round"/><circle cx="40" cy="55" r="3" fill="currentColor"/></svg>`,
        grid: `<svg viewBox="0 0 80 80" fill="none"><rect x="12" y="12" width="24" height="24" rx="3" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.2"/><rect x="44" y="12" width="24" height="24" rx="3" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><rect x="12" y="44" width="24" height="24" rx="3" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><rect x="44" y="44" width="24" height="24" rx="3" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.15"/></svg>`,
        spectrum: `<svg viewBox="0 0 80 80" fill="none"><rect x="10" y="35" width="60" height="10" rx="5" stroke="currentColor" stroke-width="2"/><rect x="12" y="37" width="56" height="6" rx="3" fill="currentColor" fill-opacity="0.3"/><circle cx="45" cy="40" r="8" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.5"/></svg>`,
        users: `<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="28" r="12" stroke="currentColor" stroke-width="2"/><path d="M20 65c0-12 9-20 20-20s20 8 20 20" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><circle cx="60" cy="30" r="8" stroke="currentColor" stroke-width="1.5" opacity="0.5"/><circle cx="20" cy="30" r="8" stroke="currentColor" stroke-width="1.5" opacity="0.5"/></svg>`,
        bomb: `<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="45" r="22" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.15"/><path d="M40 23v-8M35 18l5-5 5 5" stroke="currentColor" stroke-width="2"/><path d="M50 15c5 0 10 3 10 8" stroke="currentColor" stroke-width="2"/><circle cx="33" cy="38" r="4" fill="currentColor" opacity="0.3"/></svg>`,
        lightning: `<svg viewBox="0 0 80 80" fill="none"><path d="M45 10L25 42h15L35 70 55 38H40L45 10z" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.2"/></svg>`,
        letter: `<svg viewBox="0 0 80 80" fill="none"><rect x="15" y="20" width="50" height="40" rx="4" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><text x="40" y="52" text-anchor="middle" fill="currentColor" font-family="serif" font-size="28" font-weight="bold">A</text></svg>`,
        theater: `<svg viewBox="0 0 80 80" fill="none"><circle cx="28" cy="35" r="18" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><circle cx="52" cy="35" r="18" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><path d="M20 40c0 5 3 8 8 8s8-3 8-8" stroke="currentColor" stroke-width="2"/><path d="M44 32c0-3 3-5 8-5s8 2 8 5" stroke="currentColor" stroke-width="2"/></svg>`,
        star: `<svg viewBox="0 0 80 80" fill="none"><path d="M40 12l8 18 20 2-15 13 4 19-17-10-17 10 4-19-15-13 20-2z" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.2"/></svg>`,
        fish: `<svg viewBox="0 0 80 80" fill="none"><ellipse cx="38" cy="40" rx="25" ry="18" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><path d="M63 40c8-10 8 20 0 10" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><circle cx="25" cy="38" r="3" fill="currentColor"/></svg>`,
        pointing: `<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="40" r="25" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><path d="M40 25v20M30 35l10-10 10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="40" cy="52" r="3" fill="currentColor"/></svg>`,
        pencil: `<svg viewBox="0 0 80 80" fill="none"><path d="M55 15L65 25 30 60H20V50L55 15z" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><path d="M50 20l10 10" stroke="currentColor" stroke-width="2"/></svg>`,
        gold: `<svg viewBox="0 0 80 80" fill="none"><path d="M25 50h30l5-15H20l5 15z" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.2"/><path d="M30 50v12h20V50" stroke="currentColor" stroke-width="2"/><circle cx="40" cy="28" r="8" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.3"/></svg>`,
        cards: `<svg viewBox="0 0 80 80" fill="none"><rect x="20" y="15" width="30" height="42" rx="3" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1" transform="rotate(-10 35 36)"/><rect x="30" y="20" width="30" height="42" rx="3" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.2" transform="rotate(5 45 41)"/></svg>`,
        laugh: `<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="40" r="25" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><circle cx="30" cy="35" r="3" fill="currentColor"/><circle cx="50" cy="35" r="3" fill="currentColor"/><path d="M28 48c6 8 18 8 24 0" stroke="currentColor" stroke-width="2"/></svg>`,
        chain: `<svg viewBox="0 0 80 80" fill="none"><ellipse cx="28" cy="40" rx="14" ry="10" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><ellipse cx="52" cy="40" rx="14" ry="10" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><path d="M38 40h4" stroke="currentColor" stroke-width="4"/></svg>`,
        doodle: `<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="40" r="22" stroke="currentColor" stroke-width="2" stroke-dasharray="5 5" fill="currentColor" fill-opacity="0.05"/><path d="M25 50Q35 25 55 40" stroke="currentColor" stroke-width="2"/><circle cx="30" cy="35" r="4" fill="currentColor" opacity="0.5"/></svg>`,
        truth: `<svg viewBox="0 0 80 80" fill="none"><path d="M20 40l12 12 28-28" stroke="currentColor" stroke-width="3" stroke-linecap="round"/><path d="M52 55l8 8M52 63l8-8" stroke="currentColor" stroke-width="3" stroke-linecap="round" opacity="0.5"/></svg>`,
        dice: `<svg viewBox="0 0 80 80" fill="none"><rect x="18" y="18" width="44" height="44" rx="6" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><circle cx="30" cy="30" r="4" fill="currentColor"/><circle cx="50" cy="30" r="4" fill="currentColor"/><circle cx="40" cy="40" r="4" fill="currentColor"/><circle cx="30" cy="50" r="4" fill="currentColor"/><circle cx="50" cy="50" r="4" fill="currentColor"/></svg>`,
        brain: `<svg viewBox="0 0 80 80" fill="none"><circle cx="25" cy="30" r="12" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><circle cx="55" cy="30" r="12" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><circle cx="40" cy="25" r="10" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.15"/><path d="M40 55V40" stroke="currentColor" stroke-width="2"/></svg>`,
        fire: `<svg viewBox="0 0 80 80" fill="none"><path d="M40 15c-3 12 3 18 0 28-2 8-12 12-12 20 0 6 8 10 12 8-2-4-1-8 2-12 4 6 10 8 10 14 4-2 8-8 8-16 0-12-8-16-8-28-4 8-12 4-12-14z" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.2"/></svg>`,
        heart: `<svg viewBox="0 0 80 80" fill="none"><path d="M40 65L22 47c-7-7-7-18 0-25s18-7 25 0l-7 7 7-7c7-7 18-7 25 0s7 18 0 25L40 65z" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.2"/></svg>`,
        chip: `<svg viewBox="0 0 80 80" fill="none"><circle cx="40" cy="40" r="22" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><circle cx="40" cy="40" r="12" stroke="currentColor" stroke-width="2"/><text x="40" y="45" text-anchor="middle" fill="currentColor" font-size="14" font-weight="bold">$</text></svg>`,
        split: `<svg viewBox="0 0 80 80" fill="none"><rect x="12" y="20" width="24" height="40" rx="4" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.2"/><rect x="44" y="20" width="24" height="40" rx="4" stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity="0.1"/><path d="M40 15v50" stroke="currentColor" stroke-width="1" stroke-dasharray="4 4"/></svg>`
    };

    // Game icon mapping
    const GAME_ICONS = {
        'spyfall': 'spy', 'avalon': 'crown', 'werewolf': 'moon', 'imposter': 'alert',
        'fake-artist': 'palette', 'insider': 'question', 'power-struggle': 'cards',
        'codenames': 'grid', 'wavelength': 'spectrum', 'herd-mentality': 'users',
        'word-bomb': 'bomb', 'categories': 'lightning', 'npat': 'letter',
        'word-association': 'chain', 'charades': 'theater', 'celebrity': 'star',
        'fishbowl': 'fish', 'most-likely-to': 'pointing', 'sketch-guess': 'pencil',
        'fools-gold': 'gold', 'punchline': 'laugh', 'broken-pictionary': 'doodle',
        'doodle-duel': 'pencil', 'two-truths': 'truth', 'ludo': 'dice',
        'trivia-royale': 'brain', 'this-or-that-party': 'split', 'hot-takes-party': 'fire',
        'never-ever-party': 'heart', 'bet-or-bluff': 'chip'
    };

    // Set game icon
    const iconKey = GAME_ICONS[gameId] || 'question';
    document.getElementById('game-icon').innerHTML = ICONS[iconKey] || ICONS.question;

    initAuth();
</script>

<script src="/header.js"></script>
</body>
</html>
