<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Lobby - TheGaming.co</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="/header.css">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&family=Creepster&family=Bangers&family=Fredoka+One&family=Orbitron:wght@700&family=Permanent+Marker&family=Caveat:wght@700&family=Pacifico&display=swap" rel="stylesheet">
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/js/cosmetics.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--accent:#14b8a6;--accent-glow:rgba(20,184,166,0.4);--bg:#0a0a0f;--border:rgba(255,255,255,0.1);--text:#fff;--muted:rgba(255,255,255,0.6);--gold:#fbbf24;--green:#22c55e;--red:#ef4444}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;overflow-x:hidden}
        .bg-container{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
        .bg-base{position:absolute;inset:0}.bg-scene{position:absolute;inset:0}

        .theme-loading{--accent:#666;--accent-glow:rgba(102,102,102,0.4)}
        .theme-loading .bg-base{background:linear-gradient(180deg,#0a0a0f 0%,#12121a 100%)}

        /* GAME THEMES */
        .theme-spyfall{--accent:#14b8a6;--accent-glow:rgba(20,184,166,0.6)}
        .theme-spyfall .bg-base{background:linear-gradient(180deg,#0a2525 0%,#061818 50%,#0a1a1a 100%)}
        .theme-spyfall .bg-scene{background:repeating-linear-gradient(90deg,transparent 0 80px,rgba(20,184,166,0.12) 80px 81px),repeating-linear-gradient(0deg,transparent 0 80px,rgba(20,184,166,0.12) 80px 81px)}
        .theme-spyfall .bg-scene::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:500px;height:500px;background:conic-gradient(from 0deg,transparent 0deg,rgba(20,184,166,0.5) 10deg,transparent 20deg);border-radius:50%;animation:radarSweep 4s linear infinite}
        @keyframes radarSweep{from{transform:translate(-50%,-50%) rotate(0deg)}to{transform:translate(-50%,-50%) rotate(360deg)}}

        .theme-avalon{--accent:#fbbf24;--accent-glow:rgba(251,191,36,0.6)}
        .theme-avalon .bg-base{background:linear-gradient(180deg,#1f1a08 0%,#2a1f0a 40%,#15100a 100%)}
        .theme-avalon .bg-scene::before{content:'';position:absolute;bottom:0;left:0;right:0;height:320px;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1400 300'%3E%3Cpath d='M0 300V150h50V100h40v50h80V80h30V40h40V80h30v70h100V100h30V60h20V30h30V60h20v40h30v50h120V80h40V40h30V80h40v70h100V100h30V60h40v40h30v50h90V80h30V40h20V80h30v70h120v150H0z' fill='%23fbbf24' fill-opacity='0.2'/%3E%3C/svg%3E") bottom center/cover no-repeat}
        .theme-avalon .bg-scene::after{content:'üëë';position:absolute;top:10%;left:50%;transform:translateX(-50%);font-size:120px;opacity:0.2;animation:crownFloat 4s ease-in-out infinite}
        @keyframes crownFloat{0%,100%{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(-15px)}}

        .theme-werewolf{--accent:#a855f7;--accent-glow:rgba(168,85,247,0.6)}
        .theme-werewolf .bg-base{background:linear-gradient(180deg,#1a0a30 0%,#200a38 40%,#0f0520 100%)}
        .theme-werewolf .bg-scene::before{content:'';position:absolute;top:5%;right:10%;width:150px;height:150px;background:radial-gradient(circle,rgba(255,255,220,1) 0%,rgba(255,255,200,0.8) 30%,transparent 70%);border-radius:50%;box-shadow:0 0 80px 40px rgba(255,255,200,0.4)}
        .theme-werewolf .game-title{font-family:'Creepster',cursive!important;letter-spacing:8px!important}

        .theme-imposter{--accent:#ef4444;--accent-glow:rgba(239,68,68,0.6)}
        .theme-imposter .bg-base{background:linear-gradient(180deg,#250808 0%,#300a0a 40%,#180505 100%)}
        .theme-imposter .bg-scene{background:repeating-linear-gradient(45deg,transparent 0 20px,rgba(239,68,68,0.08) 20px 22px);animation:alertMove 1s linear infinite}
        @keyframes alertMove{from{background-position:0 0}to{background-position:42px 42px}}

        .theme-fake-artist{--accent:#ec4899;--accent-glow:rgba(236,72,153,0.6)}
        .theme-fake-artist .bg-base{background:linear-gradient(135deg,#250a1d 0%,#0f1825 50%,#1a0a28 100%)}
        .theme-fake-artist .bg-scene::after{content:'üé®';position:absolute;top:10%;left:50%;transform:translateX(-50%) rotate(-10deg);font-size:140px;opacity:0.25}
        .theme-fake-artist .game-title{background:linear-gradient(90deg,#ec4899,#a855f7,#3b82f6,#22c55e,#eab308,#ec4899)!important;background-size:300% auto;-webkit-background-clip:text!important;-webkit-text-fill-color:transparent!important;animation:rainbowShift 4s linear infinite!important}
        @keyframes rainbowShift{0%{background-position:0% center}100%{background-position:300% center}}

        .theme-codenames{--accent:#dc2626;--accent-glow:rgba(220,38,38,0.5)}
        .theme-codenames .bg-base{background:linear-gradient(180deg,#1a1008 0%,#0f0a05 100%)}
        .theme-codenames .game-title{color:#fbbf24!important}

        .theme-word-bomb{--accent:#f43f5e;--accent-glow:rgba(244,63,94,0.7)}
        .theme-word-bomb .bg-base{background:radial-gradient(circle at 50% 50%,#301010 0%,#250808 40%,#180505 100%)}
        .theme-word-bomb .bg-scene::before{content:'üí£';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:220px;opacity:0.25;animation:bombShake 0.1s ease-in-out infinite}
        @keyframes bombShake{0%,100%{transform:translate(-50%,-50%) rotate(-3deg)}50%{transform:translate(-50%,-50%) rotate(3deg)}}
        .theme-word-bomb .game-title{font-family:'Bangers',cursive!important}

        .theme-wavelength{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-wavelength .bg-base{background:linear-gradient(180deg,#1a1208 0%,#0f0a05 100%)}

        /* LUDO - Dark theme instead of white */
        .theme-ludo{--accent:#22c55e;--accent-glow:rgba(34,197,94,0.6)}
        .theme-ludo .bg-base{background:linear-gradient(180deg,#0f1a15 0%,#0a1510 50%,#081210 100%)}
        .theme-ludo .bg-scene::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:350px;height:350px;background:conic-gradient(from 0deg at 50% 50%,rgba(239,68,68,0.4) 0deg 90deg,rgba(34,197,94,0.4) 90deg 180deg,rgba(234,179,8,0.4) 180deg 270deg,rgba(59,130,246,0.4) 270deg 360deg);border-radius:20px;box-shadow:0 0 60px rgba(34,197,94,0.3)}
        .theme-ludo .bg-scene::after{content:'üé≤';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:80px;animation:diceRoll 2s ease-in-out infinite}
        @keyframes diceRoll{0%,100%{transform:translate(-50%,-50%) rotate(0deg)}50%{transform:translate(-50%,-50%) rotate(360deg)}}
        .theme-ludo .game-title{font-family:'Fredoka One',cursive!important}

        .theme-power-struggle{--accent:#dc2626;--accent-glow:rgba(220,38,38,0.6)}
        .theme-power-struggle .bg-base{background:linear-gradient(180deg,#1a0a0a 0%,#250f0f 50%,#0f0505 100%)}
        .theme-power-struggle .game-title{color:#fbbf24!important}

        .theme-insider{--accent:#6366f1;--accent-glow:rgba(99,102,241,0.6)}
        .theme-insider .bg-base{background:radial-gradient(circle at 50% 50%,#151530 0%,#0a0a1a 100%)}

        .theme-herd-mentality{--accent:#8b5cf6;--accent-glow:rgba(139,92,246,0.6)}
        .theme-herd-mentality .bg-base{background:linear-gradient(180deg,#1a1030 0%,#0f0820 100%)}

        .theme-categories{--accent:#06b6d4;--accent-glow:rgba(6,182,212,0.6)}
        .theme-categories .bg-base{background:linear-gradient(180deg,#0a1a20 0%,#051215 100%)}
        .theme-categories .game-title{font-family:'Orbitron',monospace!important}

        .theme-npat{--accent:#f59e0b;--accent-glow:rgba(245,158,11,0.6)}
        .theme-npat .bg-base{background:linear-gradient(180deg,#251a08 0%,#181008 100%)}
        .theme-npat .game-title{font-family:'Permanent Marker',cursive!important}

        .theme-word-association{--accent:#8b5cf6;--accent-glow:rgba(139,92,246,0.6)}
        .theme-word-association .bg-base{background:linear-gradient(180deg,#1d0a30 0%,#130820 100%)}

        .theme-charades{--accent:#ec4899;--accent-glow:rgba(236,72,153,0.6)}
        .theme-charades .bg-base{background:linear-gradient(180deg,#2a0a1a 0%,#1a0510 100%)}
        .theme-charades .game-title{font-family:'Pacifico',cursive!important}

        .theme-heads-up{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-heads-up .bg-base{background:linear-gradient(180deg,#251508 0%,#1a0f05 100%)}
        .theme-heads-up .bg-scene::before{content:'üì±';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:150px;opacity:0.2}

        .theme-celebrity{--accent:#fbbf24;--accent-glow:rgba(251,191,36,0.6)}
        .theme-celebrity .bg-base{background:linear-gradient(180deg,#1a1508 0%,#100a05 100%)}

        .theme-fishbowl{--accent:#06b6d4;--accent-glow:rgba(6,182,212,0.6)}
        .theme-fishbowl .bg-base{background:linear-gradient(180deg,#082530 0%,#051a25 50%,#031015 100%)}
        .theme-fishbowl .bg-scene::after{content:'üêü';position:absolute;top:50%;left:50%;font-size:80px;opacity:0.4;animation:fishSwim 4s ease-in-out infinite}
        @keyframes fishSwim{0%,100%{transform:translate(-80%,-50%)}50%{transform:translate(-20%,-50%) scaleX(-1)}}

        .theme-sketch-guess{--accent:#22c55e;--accent-glow:rgba(34,197,94,0.6)}
        .theme-sketch-guess .bg-base{background:linear-gradient(180deg,#0f1a15 0%,#0a1510 100%)}
        .theme-sketch-guess .bg-scene::after{content:'‚úèÔ∏è';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-45deg);font-size:150px;opacity:0.15}
        .theme-sketch-guess .game-title{font-family:'Caveat',cursive!important;font-size:4rem!important}

        .theme-fools-gold{--accent:#fbbf24;--accent-glow:rgba(251,191,36,0.6)}
        .theme-fools-gold .bg-base{background:linear-gradient(180deg,#251a08 0%,#181005 100%)}
        .theme-fools-gold .game-title{color:#fbbf24!important}

        .theme-most-likely-to{--accent:#f43f5e;--accent-glow:rgba(244,63,94,0.6)}
        .theme-most-likely-to .bg-base{background:radial-gradient(circle at 50% 50%,#250a15 0%,#150508 100%)}

        .theme-punchline{--accent:#fbbf24;--accent-glow:rgba(251,191,36,0.6)}
        .theme-punchline .bg-base{background:radial-gradient(ellipse 100% 100% at 50% 0%,#302510 0%,#201808 40%,#100a05 100%)}
        .theme-punchline .game-title{font-family:'Bangers',cursive!important}

        .theme-trivia-royale{--accent:#a855f7;--accent-glow:rgba(168,85,247,0.6)}
        .theme-trivia-royale .bg-base{background:radial-gradient(ellipse 150% 100% at 50% 0%,#281840 0%,#1a1030 40%,#0f0818 100%)}

        .theme-this-or-that-party{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-this-or-that-party .bg-base{background:linear-gradient(90deg,rgba(59,130,246,0.25) 0%,#0f0f15 30%,#0f0f15 70%,rgba(249,115,22,0.25) 100%)}

        .theme-hot-takes-party{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-hot-takes-party .bg-base{background:linear-gradient(180deg,#301508 0%,#201008 40%,#150805 100%)}

        .theme-never-ever-party{--accent:#ec4899;--accent-glow:rgba(236,72,153,0.6)}
        .theme-never-ever-party .bg-base{background:radial-gradient(ellipse at 50% 100%,#250a1a 0%,#150810 100%)}

        .theme-bet-or-bluff{--accent:#10b981;--accent-glow:rgba(16,185,129,0.6)}
        .theme-bet-or-bluff .bg-base{background:linear-gradient(180deg,#0a2518 0%,#081812 100%)}

        .theme-broken-pictionary{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-broken-pictionary .bg-base{background:linear-gradient(135deg,#251508 0%,#150810 100%)}

        .theme-doodle-duel{--accent:#ec4899;--accent-glow:rgba(236,72,153,0.6)}
        .theme-doodle-duel .bg-base{background:linear-gradient(180deg,#251015 0%,#180a10 100%)}
        .theme-doodle-duel .game-title{font-family:'Caveat',cursive!important;font-size:4rem!important}

        .theme-two-truths{--accent:#22c55e;--accent-glow:rgba(34,197,94,0.6)}
        .theme-two-truths .bg-base{background:linear-gradient(180deg,#0a1a10 0%,#051008 100%)}

        /* LAYOUT */
        main{flex:1;display:flex;align-items:flex-start;justify-content:center;padding:100px 20px 40px;position:relative;z-index:1}
        .container{width:100%;max-width:1000px;display:grid;grid-template-columns:1fr 360px;gap:20px}
        @media(max-width:900px){.container{grid-template-columns:1fr;max-width:550px}}

        /* CARDS */
        .card{background:rgba(20,20,30,0.88);border:1px solid var(--border);border-radius:20px;padding:1.5rem;backdrop-filter:blur(20px);position:relative;overflow:hidden}
        .card::before{content:'';position:absolute;top:0;left:20px;right:20px;height:2px;background:linear-gradient(90deg,transparent,var(--accent),transparent)}
        .section-title{font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:3px;color:var(--accent);margin-bottom:1rem;display:flex;align-items:center;gap:10px}

        /* GAME HEADER */
        .game-header{text-align:center;margin-bottom:1rem;grid-column:1/-1}
        .game-title{font-family:'Bebas Neue',sans-serif;font-size:3.2rem;letter-spacing:8px;line-height:1;text-shadow:0 0 80px var(--accent-glow)}
        .game-tagline{color:var(--muted);font-size:0.9rem;margin-top:0.5rem}

        /* ROOM CODE */
        .room-code-card{text-align:center;padding:1.25rem;grid-column:1/-1}
        .room-code-label{font-size:0.7rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:0.4rem}
        .room-code-value{font-family:'Bebas Neue',sans-serif;font-size:2.8rem;letter-spacing:12px;color:var(--accent);text-shadow:0 0 30px var(--accent-glow)}
        .room-code-actions{display:flex;gap:10px;justify-content:center;margin-top:0.75rem;flex-wrap:wrap}
        .copy-btn{display:flex;align-items:center;gap:6px;padding:0.5rem 0.9rem;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.8rem;font-weight:600;cursor:pointer;transition:all 0.2s}
        .copy-btn:hover{border-color:var(--accent);background:var(--accent);color:white}
        .copy-btn svg{width:14px;height:14px}

        /* PLAYERS */
        .players-card{min-height:280px}
        .players-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;flex-wrap:wrap;gap:10px}
        .player-count-wrap{display:flex;align-items:center;gap:8px}
        .player-count{font-family:'Bebas Neue',sans-serif;font-size:1.4rem;color:var(--accent)}
        .player-max{font-size:0.9rem;color:var(--muted)}
        .players-list{display:flex;flex-direction:column;gap:8px;max-height:350px;overflow-y:auto;padding-right:5px}
        .players-list::-webkit-scrollbar{width:4px}
        .players-list::-webkit-scrollbar-thumb{background:var(--accent);border-radius:4px}

        /* PLAYER ITEM - Normal size */
        .player-item{display:flex;align-items:center;gap:12px;padding:0.65rem 0.9rem;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:12px;transition:all 0.2s;position:relative}
        .player-item:hover{border-color:rgba(255,255,255,0.15);background:rgba(255,255,255,0.05)}
        .player-item.is-host{border-color:var(--gold);background:rgba(251,191,36,0.08)}
        .player-avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent),rgba(255,255,255,0.2));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.95rem;flex-shrink:0}
        .player-info{flex:1;min-width:0}
        .player-name{font-weight:600;font-size:0.95rem}
        .player-name.premium{background:linear-gradient(90deg,var(--gold),#f59e0b,#fcd34d,var(--gold));background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:goldShimmer 3s linear infinite;font-weight:700}
        @keyframes goldShimmer{0%{background-position:0% center}100%{background-position:200% center}}
        .player-badges{display:flex;gap:4px;margin-top:2px}
        .player-badge{font-size:0.65rem;padding:0.15rem 0.4rem;border-radius:4px;background:rgba(255,255,255,0.1);font-weight:600}
        .player-badge.host{background:rgba(251,191,36,0.2);color:var(--gold)}
        .kick-btn{padding:0.3rem 0.6rem;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:6px;color:#ef4444;font-size:0.7rem;font-weight:600;cursor:pointer;opacity:0;transition:all 0.2s}
        .player-item:hover .kick-btn{opacity:1}
        .kick-btn:hover{background:rgba(239,68,68,0.2)}

        /* SETTINGS */
        .settings-card{}
        .setting-group{margin-bottom:1rem}
        .setting-label{display:block;font-size:0.7rem;font-weight:700;color:var(--muted);margin-bottom:0.4rem;text-transform:uppercase;letter-spacing:1.5px}
        select{width:100%;padding:0.75rem 1rem;background:rgba(10,10,15,0.9);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;font-family:inherit;cursor:pointer;transition:all 0.2s;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}
        select:focus{outline:none;border-color:var(--accent)}
        select option{background:#1a1a2e;color:white}
        .toggle-row{display:flex;align-items:center;justify-content:space-between;padding:0.7rem 1rem;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:10px}
        .toggle-label{font-size:0.9rem;font-weight:500}
        .toggle{position:relative;width:44px;height:24px;background:rgba(255,255,255,0.15);border-radius:12px;cursor:pointer;transition:background 0.2s}
        .toggle.active{background:var(--accent)}
        .toggle::after{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;background:white;border-radius:50%;transition:transform 0.2s;box-shadow:0 2px 4px rgba(0,0,0,0.2)}
        .toggle.active::after{transform:translateX(20px)}

        /* ROLES PREVIEW */
        .roles-preview{margin-top:1rem;padding:1rem;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:12px}
        .roles-preview-title{font-size:0.75rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:0.6rem}
        .roles-grid{display:flex;flex-wrap:wrap;gap:6px}
        .role-chip{display:inline-flex;align-items:center;gap:4px;padding:0.3rem 0.6rem;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:6px;font-size:0.8rem}
        .role-chip.good{border-color:rgba(34,197,94,0.4);background:rgba(34,197,94,0.1)}
        .role-chip.evil{border-color:rgba(239,68,68,0.4);background:rgba(239,68,68,0.1)}
        .role-chip.neutral{border-color:rgba(168,85,247,0.4);background:rgba(168,85,247,0.1)}

        /* COLOR PICKER (for Ludo) */
        .color-picker{display:flex;gap:10px;margin-top:0.5rem;justify-content:center}
        .color-option{width:40px;height:40px;border-radius:50%;cursor:pointer;border:3px solid transparent;transition:all 0.2s;display:flex;align-items:center;justify-content:center;font-size:1.2rem}
        .color-option:hover{transform:scale(1.1)}
        .color-option.selected{border-color:white;box-shadow:0 0 15px currentColor}
        .color-option.red{background:#ef4444}
        .color-option.green{background:#22c55e}
        .color-option.yellow{background:#eab308}
        .color-option.blue{background:#3b82f6}
        .color-option.taken{opacity:0.3;cursor:not-allowed}

        /* START BUTTON */
        .btn-start{width:100%;padding:1rem;background:linear-gradient(135deg,var(--accent),rgba(255,255,255,0.1));border:none;border-radius:12px;color:white;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:3px;cursor:pointer;box-shadow:0 8px 30px var(--accent-glow);transition:all 0.2s;margin-top:1rem;position:relative;overflow:hidden}
        .btn-start::before{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transform:translateX(-100%);transition:transform 0.5s}
        .btn-start:hover:not(:disabled)::before{transform:translateX(100%)}
        .btn-start:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 12px 40px var(--accent-glow)}
        .btn-start:disabled{opacity:0.5;cursor:not-allowed;transform:none}

        /* HOW TO PLAY BUTTON */
        .htp-btn{display:flex;align-items:center;gap:6px;padding:0.5rem 0.8rem;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:8px;color:var(--muted);font-size:0.75rem;font-weight:600;cursor:pointer;transition:all 0.2s}
        .htp-btn:hover{border-color:var(--accent);color:var(--accent);background:rgba(255,255,255,0.08)}
        .htp-btn svg{width:14px;height:14px}

        /* MODAL */
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;align-items:center;justify-content:center;z-index:1000;padding:1rem;backdrop-filter:blur(5px)}
        .modal-overlay.visible{display:flex}
        .modal{background:linear-gradient(180deg,#1a1a2a 0%,#12121a 100%);border:1px solid var(--border);border-radius:24px;width:100%;max-width:600px;max-height:85vh;display:flex;flex-direction:column;box-shadow:0 25px 80px rgba(0,0,0,0.5)}
        .modal-header{padding:1.25rem 1.5rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .modal-title{font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:3px;color:var(--accent)}
        .modal-close{background:none;border:none;color:var(--muted);font-size:1.5rem;cursor:pointer;transition:color 0.2s}
        .modal-close:hover{color:var(--text)}
        .modal-body{padding:1.5rem;color:var(--text);line-height:1.7;overflow-y:auto;font-size:0.95rem}
        .modal-body h3{font-family:'Bebas Neue',sans-serif;color:var(--accent);margin:1.25rem 0 0.6rem;font-size:1.1rem;letter-spacing:2px}
        .modal-body h3:first-child{margin-top:0}
        .modal-body p{margin-bottom:0.6rem;color:var(--muted)}
        .modal-body ul,.modal-body ol{margin-left:1.25rem;margin-bottom:0.6rem}
        .modal-body li{margin-bottom:0.35rem;color:var(--muted)}
        .modal-body strong{color:var(--accent)}
        .modal-body .role-card{display:inline-flex;align-items:center;gap:6px;padding:0.3rem 0.7rem;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:8px;margin:3px;font-size:0.9rem}
        .modal-body .tip-box{background:rgba(20,184,166,0.1);border-left:3px solid var(--accent);padding:0.75rem 1rem;margin:1rem 0;border-radius:0 8px 8px 0;font-size:0.9rem}
        .modal-body .warning-box{background:rgba(239,68,68,0.1);border-left:3px solid #ef4444;padding:0.75rem 1rem;margin:1rem 0;border-radius:0 8px 8px 0}
        .modal-body .example-box{background:rgba(139,92,246,0.1);border:1px dashed rgba(139,92,246,0.3);padding:0.75rem 1rem;margin:1rem 0;border-radius:8px;font-style:italic}

        /* CONFIRM MODAL */
        .confirm-btns{display:flex;gap:10px;margin-top:1.25rem}
        .confirm-btns button{flex:1;padding:0.75rem;border-radius:10px;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;cursor:pointer;border:none;transition:all 0.2s}
        .btn-confirm{background:var(--red);color:white}
        .btn-cancel{background:rgba(255,255,255,0.1);color:var(--text);border:1px solid var(--border)}

        /* PARTY MODE */
        .party-mode .players-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;max-height:450px}
        .party-mode .player-item{flex-direction:column;text-align:center;padding:1rem}
        .party-mode .player-avatar{margin:0 auto 0.5rem}
        .party-mode .player-info{text-align:center}
        .party-mode .kick-btn{margin-top:0.5rem;opacity:1}

        /* TOAST */
        .toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);padding:0.75rem 1.5rem;background:var(--accent);color:white;border-radius:10px;font-weight:600;z-index:1001;animation:toastIn 0.3s ease;box-shadow:0 10px 30px var(--accent-glow)}
        @keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

        .waiting-indicator{display:flex;align-items:center;justify-content:center;gap:8px;padding:1rem;background:rgba(255,255,255,0.03);border-radius:10px;margin-top:1rem}
        .waiting-dots{display:flex;gap:4px}
        .waiting-dots span{width:8px;height:8px;background:var(--accent);border-radius:50%;animation:dotPulse 1.4s ease-in-out infinite}
        .waiting-dots span:nth-child(2){animation-delay:0.2s}
        .waiting-dots span:nth-child(3){animation-delay:0.4s}
        @keyframes dotPulse{0%,80%,100%{transform:scale(0.6);opacity:0.5}40%{transform:scale(1);opacity:1}}

        footer{background:#000;position:relative;z-index:10}
        .footer-border{height:4px;background:linear-gradient(90deg,#ff6b9d,#4facfe,#a855f7,#ff6b9d);background-size:300% 100%;animation:gradientSlide 6s linear infinite}
        @keyframes gradientSlide{0%{background-position:0% 50%}100%{background-position:300% 50%}}
        .footer-main{max-width:1100px;margin:0 auto;padding:40px 20px 25px}
        .footer-links{display:grid;grid-template-columns:repeat(3,1fr);gap:30px;margin-bottom:30px;max-width:500px;margin-left:auto;margin-right:auto}
        .footer-column{text-align:center}
        .footer-column h5{font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:2px;margin-bottom:12px;color:rgba(255,255,255,0.8)}
        .footer-column ul{list-style:none;display:flex;flex-direction:column;gap:8px}
        .footer-column a{color:rgba(255,255,255,0.4);font-size:0.85rem;text-decoration:none}
        .footer-bottom{padding-top:20px;border-top:1px solid rgba(255,255,255,0.08);text-align:center}
        .footer-copyright{font-size:0.8rem;color:rgba(255,255,255,0.4)}
        .footer-legal{display:flex;justify-content:center;gap:20px;margin-top:8px}
        .footer-legal a{color:rgba(255,255,255,0.4);font-size:0.75rem;text-decoration:none}

        @media(max-width:600px){
            main{padding:80px 12px 30px}
            .game-title{font-size:2.2rem;letter-spacing:4px}
            .room-code-value{font-size:2rem;letter-spacing:8px}
            .container{gap:12px}
            .card{padding:1rem}
            .player-item{padding:0.8rem 1rem}
            .player-avatar{width:40px;height:40px;font-size:1rem}
            .player-name{font-size:1rem}
        }
    </style>
</head>
<body class="theme-loading">
<div class="bg-container"><div class="bg-base"></div><div class="bg-scene"></div></div>
<div id="site-header"></div>

<main>
    <div class="container">
        <div class="game-header">
            <h1 class="game-title" id="game-title">Loading...</h1>
            <p class="game-tagline" id="game-tagline"></p>
        </div>

        <div class="room-code-card card">
            <div class="room-code-label">Share This Code To Invite Friends</div>
            <div class="room-code-value" id="room-code">------</div>
            <div class="room-code-actions">
                <button class="copy-btn" onclick="copyCode()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                    Copy Code
                </button>
                <button class="copy-btn" onclick="copyLink()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                    Copy Link
                </button>
            </div>
        </div>

        <div class="players-card card">
            <div class="players-header">
                <div class="section-title">
                    <span>Players</span>
                    <div class="player-count-wrap">
                        <span class="player-count" id="player-count">0</span>
                        <span class="player-max" id="player-max">/ 10</span>
                    </div>
                </div>
                <button class="htp-btn" onclick="showHowToPlay()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                    How to Play
                </button>
            </div>
            <div class="players-list" id="players-list"></div>
            <div class="waiting-indicator" id="waiting-indicator">
                <div class="waiting-dots"><span></span><span></span><span></span></div>
                <span style="color:var(--muted);font-size:0.85rem">Waiting for players...</span>
            </div>
        </div>

        <div class="settings-card card" id="settings-section" style="display:none">
            <div class="section-title">‚öôÔ∏è Host Settings</div>
            <div id="settings-container"></div>
            <div id="roles-preview"></div>
            <div id="color-picker-section" style="display:none">
                <div class="setting-label" style="margin-top:1rem">Choose Your Color</div>
                <div class="color-picker" id="color-picker"></div>
            </div>
            <button class="btn-start" id="start-btn" disabled>Waiting for Players...</button>
        </div>
    </div>
</main>

<div class="modal-overlay" id="htp-modal">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title" id="htp-title">How To Play</span>
            <button class="modal-close" onclick="closeModal('htp-modal')">&times;</button>
        </div>
        <div class="modal-body" id="htp-content"></div>
    </div>
</div>

<div class="modal-overlay" id="confirm-modal">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title" id="confirm-title">Confirm</span>
            <button class="modal-close" onclick="closeModal('confirm-modal')">&times;</button>
        </div>
        <div class="modal-body">
            <p id="confirm-message"></p>
            <div class="confirm-btns">
                <button class="btn-cancel" onclick="closeModal('confirm-modal')">Cancel</button>
                <button class="btn-confirm" id="confirm-btn">Confirm</button>
            </div>
        </div>
    </div>
</div>

<footer>
    <div class="footer-border"></div>
    <div class="footer-main">
        <div class="footer-links">
            <div class="footer-column"><h5>Games</h5><ul><li><a href="/solo-games.html">Solo</a></li><li><a href="/duos-games.html">Duos</a></li><li><a href="/squad-games.html">Squad</a></li><li><a href="/party-games.html">Party</a></li></ul></div>
            <div class="footer-column"><h5>Account</h5><ul><li><a href="/login.html">Login</a></li><li><a href="/premium.html">Premium</a></li></ul></div>
            <div class="footer-column"><h5>Company</h5><ul><li><a href="/about.html">About</a></li><li><a href="/contact.html">Contact</a></li></ul></div>
        </div>
        <div class="footer-bottom">
            <p class="footer-copyright">¬© 2025 TheGaming.co</p>
            <div class="footer-legal"><a href="/privacy.html">Privacy</a><a href="/terms.html">Terms</a></div>
        </div>
    </div>
</footer>

<script>
    const GAMES = {
        'spyfall': {
            displayName: 'SPY HUNT', tagline: 'Find the spy before they discover your location', theme: 'theme-spyfall', minPlayers: 4, maxPlayers: 12, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/spyfall.html',
            howToPlay: '<h3>üéØ Objective</h3><p>Everyone knows the secret location except one player - <strong>the Spy</strong>. The spy must figure out where they are while everyone else tries to identify the spy through clever questioning.</p><h3>‚öôÔ∏è Setup</h3><ul><li>Each player receives a role showing the location OR "SPY"</li><li>Only one player is the spy (two in 8+ player games if enabled)</li><li>A timer starts (default 8 minutes)</li></ul><h3>üéÆ How to Play</h3><ol><li><strong>Questioning:</strong> Take turns asking each other questions about the location</li><li><strong>Answer Carefully:</strong> Questions should test knowledge without revealing the location to the spy</li><li><strong>Spy Blends In:</strong> The spy listens for clues and gives plausible answers</li><li><strong>Call a Vote:</strong> Anyone can call for a vote to accuse someone at any time</li></ol><h3>üèÜ Winning</h3><ul><li><strong>Players win</strong> if they correctly vote out the Spy</li><li><strong>Spy wins</strong> if they correctly guess the location when accused, OR survive until time runs out</li></ul><div class="tip-box">üí° <strong>Pro Tips:</strong><br>‚Ä¢ Ask questions like "What would you wear there?" - specific enough to test knowledge, vague enough to not help the spy<br>‚Ä¢ Watch for hesitation and overly vague answers<br>‚Ä¢ The spy should copy the confidence level of other players</div><div class="example-box"><strong>Example:</strong> Location is Airport<br>Good Q: "How long would you typically spend here?"<br>Good A: "Depends if I\'m picking someone up or traveling myself"<br>Suspicious A: "Um... a normal amount of time?"</div>',
            settings: [
                { id: 'category', type: 'select', label: 'Location Pack', options: [{value:'random',text:'üé≤ Random'},{value:'classic',text:'üèõÔ∏è Classic'},{value:'modern',text:'üèôÔ∏è Modern'},{value:'fantasy',text:'üè∞ Fantasy'},{value:'horror',text:'üî™ Horror'},{value:'marvel',text:'ü¶∏ Marvel'},{value:'anime',text:'üéå Anime'},{value:'videogames',text:'üéÆ Video Games'}]},
                { id: 'twoSpies', type: 'toggle', label: 'Two Spies Mode (8+ players)' },
                { id: 'roundTime', type: 'select', label: 'Round Timer', options: [{value:'5',text:'5 min'},{value:'8',text:'8 min'},{value:'10',text:'10 min'}]}
            ]
        },
        'avalon': {
            displayName: 'SECRET ROLES', tagline: 'Deception, deduction, and betrayal in Camelot', theme: 'theme-avalon', minPlayers: 5, maxPlayers: 10, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/avalon.html',
            howToPlay: '<h3>‚öîÔ∏è The Battle for Camelot</h3><p>Players are secretly divided into <strong>Loyal Servants of Arthur</strong> (Good) and <strong>Minions of Mordred</strong> (Evil). Evil players know each other; good players must use deduction.</p><h3>üë• Roles</h3><p><span class="role-card">üëë Merlin</span> (Good) Knows all Evil players, but must stay hidden from the Assassin</p><p><span class="role-card">üó°Ô∏è Assassin</span> (Evil) If Good wins, gets one shot to kill Merlin and steal victory</p><p><span class="role-card">üëÅÔ∏è Percival</span> (Good) Knows who Merlin is, helps protect them</p><p><span class="role-card">üé≠ Morgana</span> (Evil) Appears as Merlin to Percival</p><p><span class="role-card">üë§ Mordred</span> (Evil) Hidden from Merlin\'s sight</p><p><span class="role-card">üåë Oberon</span> (Evil) Doesn\'t know other Evil, they don\'t know him</p><h3>üéÆ How to Play</h3><ol><li><strong>Propose Team:</strong> Leader proposes players for the quest (size varies)</li><li><strong>Vote:</strong> Everyone votes to approve/reject the team</li><li><strong>Quest:</strong> If approved, team secretly plays Success or Fail cards</li><li><strong>Result:</strong> Quest fails if ANY Fail cards played (Quest 4 needs 2 fails in 7+ games)</li><li><strong>Repeat:</strong> First to 3 successful or 3 failed quests wins</li></ol><h3>üèÜ Winning</h3><ul><li><strong>Good wins</strong> if 3 quests succeed AND Merlin survives assassination</li><li><strong>Evil wins</strong> if 3 quests fail OR Assassin kills Merlin OR 5 teams rejected in a row</li></ul><div class="warning-box">‚ö†Ô∏è <strong>Merlin\'s Dilemma:</strong> You know everything but can\'t be too obvious, or the Assassin will find you!</div><div class="tip-box">üí° <strong>Strategy:</strong><br>‚Ä¢ Good: Watch voting patterns carefully<br>‚Ä¢ Evil: Sometimes pass quests to build trust<br>‚Ä¢ Merlin: Guide subtly through questions, not accusations</div>',
            settings: [
                { id: 'percival', type: 'toggle', label: 'Include Percival' },
                { id: 'morgana', type: 'toggle', label: 'Include Morgana' },
                { id: 'mordred', type: 'toggle', label: 'Include Mordred' },
                { id: 'oberon', type: 'toggle', label: 'Include Oberon' },
                { id: 'ladyOfLake', type: 'toggle', label: 'Lady of the Lake' }
            ],
            roles: { good: ['Merlin', 'Percival', 'Loyal Servant'], evil: ['Assassin', 'Morgana', 'Mordred', 'Oberon', 'Minion'] }
        },
        'werewolf': {
            displayName: 'MAFIA', tagline: 'Survive the night. Find the killers.', theme: 'theme-werewolf', minPlayers: 6, maxPlayers: 15, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/werewolf.html',
            howToPlay: '<h3>üåô The Village is Under Attack</h3><p>A peaceful village has been infiltrated by Mafia members who eliminate one villager each night. During the day, everyone must work together to identify and eliminate the Mafia before they take over.</p><h3>üë• Roles</h3><p><span class="role-card">üî™ Mafia</span> Know each other, kill one player each night</p><p><span class="role-card">üëÅÔ∏è Seer</span> Each night, learn if one player is Mafia or not</p><p><span class="role-card">üíâ Doctor</span> Each night, protect one player from death</p><p><span class="role-card">üî´ Vigilante</span> Can kill one player during the game (use wisely!)</p><p><span class="role-card">ü§° Jester</span> (Neutral) Wins if voted out during the day</p><p><span class="role-card">üë§ Villager</span> No power, but your vote matters!</p><h3>üéÆ Day/Night Cycle</h3><ol><li><strong>Night:</strong> Everyone closes eyes. Mafia picks victim, Seer investigates, Doctor protects</li><li><strong>Morning:</strong> Victim revealed. Someone died... or Doctor saved them!</li><li><strong>Day Discussion:</strong> Debate, share suspicions, defend yourself</li><li><strong>Voting:</strong> Vote to eliminate someone. Majority wins.</li><li><strong>Execution:</strong> Player eliminated, role revealed (if enabled)</li><li><strong>Repeat</strong> until one side wins</li></ol><h3>üèÜ Winning</h3><ul><li><strong>Village wins</strong> when all Mafia are eliminated</li><li><strong>Mafia wins</strong> when they equal or outnumber villagers</li><li><strong>Jester wins</strong> if voted out during the day</li></ul><div class="tip-box">üí° <strong>Strategy:</strong><br>‚Ä¢ Watch for who defends whom suspiciously<br>‚Ä¢ Mafia often "bus" (sacrifice) teammates to gain trust<br>‚Ä¢ Seer: Don\'t reveal too early or you\'ll be killed!</div>',
            settings: [
                { id: 'roleSet', type: 'select', label: 'Role Setup', options: [{value:'basic',text:'üü¢ Basic (Mafia, Seer, Doctor)'},{value:'standard',text:'üü° Standard (+Vigilante)'},{value:'chaos',text:'üî¥ Chaos (+Jester)'}]},
                { id: 'mafiaCount', type: 'select', label: 'Mafia Count', options: [{value:'auto',text:'Auto (based on players)'},{value:'1',text:'1'},{value:'2',text:'2'},{value:'3',text:'3'}]},
                { id: 'dayLength', type: 'select', label: 'Day Phase', options: [{value:'3',text:'3 min'},{value:'5',text:'5 min'},{value:'7',text:'7 min'}]},
                { id: 'revealRoles', type: 'toggle', label: 'Reveal roles on death' }
            ],
            roles: { good: ['Seer', 'Doctor', 'Vigilante', 'Villager'], evil: ['Mafia'], neutral: ['Jester'] }
        },
        'imposter': {
            displayName: 'IMPOSTER', tagline: 'One word at a time. One imposter among you.', theme: 'theme-imposter', minPlayers: 4, maxPlayers: 10, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/imposter.html',
            howToPlay: '<h3>üéØ Blend In</h3><p>Everyone except the <strong>Imposter</strong> sees a word. Give one-word clues to prove you know it!</p><h3>üéÆ How to Play</h3><ol><li>All players except Imposter see the secret word</li><li>Take turns giving <strong>one-word clues</strong></li><li>Imposter must fake it convincingly</li><li>Vote to find the Imposter</li></ol><h3>üèÜ Win</h3><ul><li><strong>Players</strong> by voting out Imposter</li><li><strong>Imposter</strong> by guessing word or surviving</li></ul><div class="tip-box">üí° Give clues that relate but are not too obvious. "Yellow" for Banana is too easy - try "Potassium"!</div>',
            settings: [
                { id: 'category', type: 'select', label: 'Word Pack', options: [{value:'random',text:'üé≤ Random'},{value:'food',text:'üçï Food'},{value:'animals',text:'üêæ Animals'},{value:'places',text:'üó∫Ô∏è Places'},{value:'objects',text:'üì¶ Objects'},{value:'spicy',text:'üå∂Ô∏è Spicy'}]},
                { id: 'rounds', type: 'select', label: 'Clue Rounds', options: [{value:'2',text:'2'},{value:'3',text:'3'}]}
            ]
        },
        'codenames': {
            displayName: 'CODEWORDS', tagline: 'Give clues. Find your agents. Avoid the assassin.', theme: 'theme-codenames', minPlayers: 4, maxPlayers: 20, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/codenames.html',
            howToPlay: '<h3>üïµÔ∏è Two Teams, One Grid</h3><p>Two rival spymasters give one-word clues to help their team identify secret agents hidden in a 5√ó5 grid of words. Find all your agents first to win!</p><h3>üéÆ Setup</h3><ul><li>Split into <strong>Red Team</strong> and <strong>Blue Team</strong></li><li>Each team picks a <strong>Spymaster</strong> who sees the key</li><li>25 words arranged in a grid</li></ul><h3>‚ö†Ô∏è Card Types</h3><p><span class="role-card" style="border-color:#ef4444">üî¥ Red Agents</span> <span class="role-card" style="border-color:#3b82f6">üîµ Blue Agents</span> <span class="role-card">‚¨ú Innocent Bystanders</span> <span class="role-card" style="background:#1a1a1a;color:white">üíÄ THE ASSASSIN</span></p><h3>üéÆ How to Play</h3><ol><li><strong>Spymaster\'s Clue:</strong> Give ONE word + a number (e.g., "Animal 3")</li><li><strong>Team Guesses:</strong> Discuss and tap words you think match</li><li><strong>Results:</strong><br>‚Ä¢ Your agent = Keep guessing (up to number + 1)<br>‚Ä¢ Opponent\'s agent = Turn ends, point for them<br>‚Ä¢ Bystander = Turn ends<br>‚Ä¢ <strong>ASSASSIN = INSTANT LOSS!</strong></li></ol><h3>üèÜ Winning</h3><ul><li>Find all your team\'s agents first!</li><li>Or... opponent hits the Assassin (they lose instantly)</li></ul><div class="warning-box">‚ö†Ô∏è <strong>Spymaster Rules:</strong> Only ONE word, can\'t use words on the board, no gestures or hints about position!</div><div class="tip-box">üí° <strong>Tips:</strong><br>‚Ä¢ Link multiple words with creative themes<br>‚Ä¢ Consider alternate meanings of words<br>‚Ä¢ Track opponent\'s cards to deduce yours by elimination</div>',
            settings: [
                { id: 'gridSize', type: 'select', label: 'Grid Size', options: [{value:'5x5',text:'5√ó5 (25 words)'},{value:'4x4',text:'4√ó4 (16 words - Quick)'}]},
                { id: 'turnTimer', type: 'select', label: 'Turn Timer', options: [{value:'none',text:'No Timer'},{value:'90',text:'90 seconds'},{value:'120',text:'2 minutes'}]}
            ]
        },
        'word-bomb': {
            displayName: 'WORD BOMB', tagline: 'Type fast or explode!', theme: 'theme-word-bomb', minPlayers: 2, maxPlayers: 16, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/word-bomb.html',
            howToPlay: '<h3>üí£ Beat the Clock</h3><p>A ticking bomb passes between players. Type a valid word containing the given letters before it explodes in your hands!</p><h3>üéÆ How to Play</h3><ol><li><strong>Letter Prompt:</strong> You see 2-3 letters like "PL" or "TH" or "ING"</li><li><strong>Type Fast:</strong> Enter any real word containing those letters ANYWHERE in the word</li><li><strong>Pass the Bomb:</strong> Valid word = bomb passes to next player</li><li><strong>BOOM:</strong> Time runs out or invalid word = lose a life!</li></ol><h3>üìú Rules</h3><ul><li>Must be <strong>real English words</strong> (dictionary validated)</li><li>Must contain the <strong>exact letter sequence</strong></li><li><strong>No repeating</strong> words from the current round</li><li>Timer gets <strong>faster each round!</strong></li></ul><h3>‚ù§Ô∏è Lives</h3><p>Start with 2-3 lives. Lose a life when the bomb explodes on you. Last one standing wins!</p><div class="example-box"><strong>Letters: "OU"</strong><br>‚úì H<strong>OU</strong>SE, M<strong>OU</strong>NTAIN, C<strong>OU</strong>RAGE, F<strong>OU</strong>NTAIN<br>‚úó CAT, DOG, TREE (don\'t contain "OU")</div><div class="tip-box">üí° <strong>Tips:</strong><br>‚Ä¢ Build mental lists for common combos (TH, ING, ER)<br>‚Ä¢ Longer words = more time to think of the next one<br>‚Ä¢ First word that comes to mind is usually best - don\'t overthink!</div>',
            settings: [
                { id: 'difficulty', type: 'select', label: 'Difficulty', options: [{value:'easy',text:'üü¢ Easy (2-letter combos)'},{value:'medium',text:'üü° Medium (2-3 letters)'},{value:'hard',text:'üî¥ Hard (3-letter combos)'}]},
                { id: 'lives', type: 'select', label: 'Starting Lives', options: [{value:'2',text:'‚ù§Ô∏è‚ù§Ô∏è 2 Lives'},{value:'3',text:'‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è 3 Lives'},{value:'5',text:'‚ù§Ô∏è√ó5 5 Lives'}]},
                { id: 'startTime', type: 'select', label: 'Starting Timer', options: [{value:'8',text:'8 seconds'},{value:'10',text:'10 seconds'},{value:'12',text:'12 seconds'}]}
            ]
        },
        'power-struggle': {
            displayName: 'POWER STRUGGLE', tagline: 'Bluff, steal, and survive', theme: 'theme-power-struggle', minPlayers: 3, maxPlayers: 8, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/power-struggle.html',
            howToPlay: '<h3>üëë Claim Power, Eliminate Rivals</h3><p>Each player has two hidden influence cards representing power in the court. Use their abilities - or bluff that you have them! Lose both cards and you\'re out.</p><h3>üí∞ Basic Actions (Always Available)</h3><ul><li><strong>Income:</strong> Take 1 coin (cannot be blocked)</li><li><strong>Foreign Aid:</strong> Take 2 coins (can be blocked by Duke)</li><li><strong>Coup:</strong> Pay 7 coins to eliminate one influence (cannot be blocked)</li></ul><h3>üë• Role Powers</h3><p><span class="role-card">üëë Duke</span> Take 3 coins / Block Foreign Aid</p><p><span class="role-card">üó°Ô∏è Assassin</span> Pay 3 coins to assassinate (blocked by Contessa)</p><p><span class="role-card">üè¥‚Äç‚ò†Ô∏è Captain</span> Steal 2 coins from another / Block stealing</p><p><span class="role-card">üîÑ Ambassador</span> Draw 2 cards, pick 2 to keep / Block stealing</p><p><span class="role-card">üë∏ Contessa</span> Block assassination attempts</p><h3>üé≠ The Bluffing</h3><p>You can claim <strong>ANY role</strong> to use its power - even if you don\'t have it!</p><ul><li>If someone <strong>challenges</strong> you and you\'re bluffing ‚Üí You lose a card</li><li>If someone challenges you and you <strong>have it</strong> ‚Üí THEY lose a card, you get a new card</li></ul><h3>üèÜ Last player with influence wins!</h3><div class="warning-box">‚ö†Ô∏è At 10+ coins you <strong>MUST coup</strong> - no other actions allowed!</div><div class="tip-box">üí° <strong>Strategy:</strong><br>‚Ä¢ Build to 7 coins safely for guaranteed eliminations<br>‚Ä¢ Bluff early to establish believable patterns<br>‚Ä¢ Challenge when the math doesn\'t add up</div>',
            settings: [{ id: 'startCoins', type: 'select', label: 'Starting Coins', options: [{value:'2',text:'2 coins (Standard)'},{value:'3',text:'3 coins (Faster)'}]}],
            roles: { neutral: ['Duke', 'Assassin', 'Captain', 'Ambassador', 'Contessa'] }
        },
        'ludo': {
            displayName: 'LUDO', tagline: 'Classic board race', theme: 'theme-ludo', minPlayers: 2, maxPlayers: 4, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/ludo.html',
            howToPlay: '<h3>üé≤ Race Your Tokens Home</h3><p>Roll dice and race 4 tokens around the board!</p><h3>üéÆ Rules</h3><ul><li>Roll 6 to enter the board</li><li>Land on opponents to send them back</li><li>Safe zones protect tokens</li><li>Exact roll to enter home</li></ul><h3>üèÜ First to get all 4 tokens home wins!</h3>',
            settings: [{ id: 'mode', type: 'select', label: 'Mode', options: [{value:'classic',text:'üé≤ Classic'},{value:'quick',text:'‚ö° Quick Start'}]}],
            hasColorPicker: true
        },
        'heads-up': {
            displayName: 'HEADS UP!', tagline: 'Phone on forehead party game', theme: 'theme-heads-up', minPlayers: 2, maxPlayers: 20, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/heads-up.html',
            howToPlay: '<h3>üì± Guess the Word!</h3><p>Hold phone to forehead - others give clues!</p><h3>üéÆ How to Play</h3><ol><li>One player puts phone on forehead</li><li>Others shout clues</li><li>Tilt down when correct, up to skip</li><li>Get as many as possible in 60 seconds!</li></ol><div class="tip-box">üí° <strong>Couch Mode:</strong> One phone hosts for everyone - perfect for parties!</div>',
            settings: [
                { id: 'category', type: 'select', label: 'Category', options: [{value:'random',text:'üé≤ Random'},{value:'celebrities',text:'‚≠ê Celebrities'},{value:'movies',text:'üé¨ Movies'},{value:'animals',text:'üêæ Animals'},{value:'actions',text:'üèÉ Act It Out'}]},
                { id: 'mode', type: 'select', label: 'Mode', options: [{value:'forehead',text:'üì± Phone on Forehead'},{value:'couch',text:'üõãÔ∏è Couch Mode'}]},
                { id: 'timer', type: 'select', label: 'Round', options: [{value:'60',text:'60s'},{value:'90',text:'90s'}]}
            ]
        },
        'charades': {
            displayName: 'CHARADES', tagline: 'Act it out - no talking!', theme: 'theme-charades', minPlayers: 4, maxPlayers: 20, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/charades.html',
            howToPlay: '<h3>üé≠ The Classic Acting Game</h3><p>Act out words using only gestures - no sounds!</p><h3>üéÆ Rules</h3><ul><li>No speaking or sounds</li><li>No pointing at objects</li><li>No mouthing words</li></ul><h3>üìú Classic Gestures</h3><ul><li>üìñ Book: Mime opening book</li><li>üé¨ Movie: Mime camera cranking</li><li>‚úã Words: Hold up fingers for count</li></ul><div class="tip-box">üí° <strong>Couch Mode:</strong> Pass device around - actor turns away while others see word!</div>',
            settings: [
                { id: 'category', type: 'select', label: 'Category', options: [{value:'random',text:'üé≤ Random'},{value:'movies',text:'üé¨ Movies'},{value:'actions',text:'üèÉ Actions'},{value:'animals',text:'üêæ Animals'}]},
                { id: 'mode', type: 'select', label: 'Mode', options: [{value:'teams',text:'üë• Teams'},{value:'couch',text:'üõãÔ∏è Couch Mode'}]},
                { id: 'timer', type: 'select', label: 'Turn', options: [{value:'60',text:'60s'},{value:'90',text:'90s'},{value:'120',text:'2 min'}]}
            ]
        },
        'sketch-guess': {
            displayName: 'SKETCH & GUESS', tagline: 'Draw it. Guess it fast.', theme: 'theme-sketch-guess', minPlayers: 3, maxPlayers: 16, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/sketch-guess.html',
            howToPlay: '<h3>‚úèÔ∏è Classic Drawing Game</h3><p>One draws, others race to guess!</p><h3>üéÆ How to Play</h3><ol><li>Drawer sees secret word</li><li>Everyone else types guesses</li><li>First correct = max points</li><li>Everyone takes turns</li></ol><h3>üèÜ Scoring</h3><ul><li>Guesser: Up to 500 pts (speed bonus)</li><li>Drawer: Points per correct guess</li></ul>',
            settings: [
                { id: 'category', type: 'select', label: 'Category', options: [{value:'random',text:'üé≤ Random'},{value:'animals',text:'üêæ Animals'},{value:'food',text:'üçï Food'},{value:'objects',text:'üì¶ Objects'},{value:'movies',text:'üé¨ Movies'}]},
                { id: 'drawTime', type: 'select', label: 'Draw Time', options: [{value:'60',text:'60s'},{value:'80',text:'80s'},{value:'100',text:'100s'}]},
                { id: 'hints', type: 'toggle', label: 'Letter hints' }
            ]
        },
        'trivia-royale': {
            displayName: 'TRIVIA ROYALE', tagline: 'Battle of the brains', theme: 'theme-trivia-royale', minPlayers: 2, maxPlayers: 100, isPartyGame: true, backUrl: '/party-games.html', gameFile: '/games/party/trivia-royale.html',
            howToPlay: '<h3>üëë Knowledge is Power</h3><p>Answer trivia fast - speed matters!</p><h3>üéÆ How to Play</h3><ol><li>Everyone sees same question</li><li>Pick from 4 choices</li><li>Faster correct = more points</li></ol><h3>üèÜ Scoring</h3><ul><li>Correct: 1000 + speed bonus</li><li>Wrong: 0</li></ul>',
            settings: [
                { id: 'category', type: 'select', label: 'Category', options: [{value:'general',text:'üß† General'},{value:'history',text:'üìú History'},{value:'science',text:'üî¨ Science'},{value:'gaming',text:'üéÆ Gaming'},{value:'anime',text:'üéå Anime'},{value:'brainrot',text:'ü§™ Brain Rot'}]},
                { id: 'questions', type: 'select', label: 'Questions', options: [{value:'10',text:'10'},{value:'15',text:'15'},{value:'20',text:'20'}]},
                { id: 'timePerQ', type: 'select', label: 'Time/Q', options: [{value:'10',text:'10s'},{value:'15',text:'15s'},{value:'20',text:'20s'}]}
            ]
        },
        'herd-mentality': { displayName:'THINK ALIKE', tagline:'Match the majority to score', theme:'theme-herd-mentality', minPlayers:4, maxPlayers:20, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/herd-mentality.html', howToPlay:'<h3>üêë Think Like the Herd</h3><p>Answer questions to match what the majority says. Being unique is BAD here - you want to blend in!</p><h3>üéÆ How to Play</h3><ol><li><strong>Question:</strong> Everyone sees a prompt like "Name a pizza topping"</li><li><strong>Write:</strong> Everyone secretly writes ONE answer (no talking!)</li><li><strong>Reveal:</strong> All answers shown at once</li><li><strong>Score:</strong> Match the majority = earn 1 point</li></ol><h3>üêÑ The Pink Cow</h3><p>The player with the <strong>most unique answer</strong> (only one who wrote it) receives the <strong>Pink Cow</strong>. While you hold it:</p><ul><li>You <strong>cannot score any points</strong></li><li>You keep it until someone else becomes the odd one out</li><li>You <strong>cannot win</strong> even with the highest score!</li></ul><h3>üèÜ First to target score wins!</h3><div class="tip-box">üí° <strong>Strategy:</strong> Think about what the AVERAGE person would answer, not your personal favorite or the "clever" answer. Obvious = safe!</div><div class="example-box"><strong>Q: "Name a fruit"</strong><br>Apple (5 votes) ‚úì All get points<br>Banana (3 votes) ‚úì All get points<br>Dragonfruit (1 vote) üêÑ Gets the Pink Cow!</div>', settings:[{id:'rounds',type:'select',label:'Rounds',options:[{value:'8',text:'8'},{value:'10',text:'10'},{value:'12',text:'12'}]}] },
        'fake-artist': { displayName:'FAKE ARTIST', tagline:'One stroke at a time', theme:'theme-fake-artist', minPlayers:4, maxPlayers:10, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/fake-artist.html', howToPlay:'<h3>üé® Collaborative Drawing</h3><p>Everyone draws together but one doesn\'t know what!</p><h3>üéÆ Rules</h3><ul><li>One stroke per turn</li><li>Fake Artist blends in</li><li>Vote to find faker</li></ul>', settings:[{id:'category',type:'select',label:'Category',options:[{value:'random',text:'üé≤ Random'},{value:'animals',text:'üêæ Animals'},{value:'food',text:'üçï Food'}]}] },
        'wavelength': { displayName:'SPECTRUM', tagline:'Find the hidden target', theme:'theme-wavelength', minPlayers:4, maxPlayers:12, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/wavelength.html', howToPlay:'<h3>üìä Mind Reading</h3><p>Psychic sees hidden target on spectrum, gives clue. Team guesses!</p><h3>üèÜ Score</h3><p>Bullseye: 4 | Close: 3 | Near: 2</p>', settings:[{id:'mode',type:'select',label:'Mode',options:[{value:'coop',text:'Coop'},{value:'teams',text:'Teams'}]},{id:'target',type:'select',label:'Score',options:[{value:'10',text:'10'},{value:'15',text:'15'}]}] },
        'insider': { displayName:'INSIDER', tagline:'20 Questions with a twist', theme:'theme-insider', minPlayers:4, maxPlayers:8, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/insider.html', howToPlay:'<h3>üîç Hidden Ally</h3><p>Play 20 Questions - but Insider secretly knows the answer!</p><h3>üë• Roles</h3><p><span class="role-card">üéØ Master</span> Answers Yes/No</p><p><span class="role-card">üïµÔ∏è Insider</span> Knows answer secretly</p><p><span class="role-card">üë§ Commons</span> Guess honestly</p>', settings:[{id:'difficulty',type:'select',label:'Difficulty',options:[{value:'easy',text:'Easy'},{value:'hard',text:'Hard'}]}], roles:{good:['Master','Common'],evil:['Insider']} },
        'categories': { displayName:'CATEGORIES', tagline:'Race to answer first', theme:'theme-categories', minPlayers:2, maxPlayers:20, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/categories.html', howToPlay:'<h3>‚ö° Speed Is Everything</h3><p>Category appears - first valid answer wins!</p>', settings:[{id:'rounds',type:'select',label:'Rounds',options:[{value:'10',text:'10'},{value:'15',text:'15'},{value:'20',text:'20'}]}] },
        'fishbowl': { displayName:'FISHBOWL', tagline:'Three rounds, same words', theme:'theme-fishbowl', minPlayers:6, maxPlayers:20, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/fishbowl.html', howToPlay:'<h3>üêü Three Rounds</h3><ol><li><strong>Taboo:</strong> Describe without the word</li><li><strong>Password:</strong> One word only</li><li><strong>Charades:</strong> Act it out</li></ol><p>Same words get easier each round!</p>', settings:[{id:'words',type:'select',label:'Words/Player',options:[{value:'3',text:'3'},{value:'4',text:'4'}]}] },
        'celebrity': { displayName:'CELEBRITY', tagline:'Three rounds of fame', theme:'theme-celebrity', minPlayers:4, maxPlayers:16, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/celebrity.html', howToPlay:'<h3>‚≠ê Like Fishbowl with Famous Names</h3><ol><li>Describe freely</li><li>One word only</li><li>Act it out</li></ol>', settings:[{id:'names',type:'select',label:'Names/Player',options:[{value:'3',text:'3'},{value:'5',text:'5'}]}] },
        'word-association': { displayName:'WORD CHAIN', tagline:'Keep it going', theme:'theme-word-association', minPlayers:3, maxPlayers:12, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/word-association.html', howToPlay:'<h3>üîó Chain Reaction</h3><p>Say related words before time runs out!</p><div class="example-box">Ocean ‚Üí Fish ‚Üí Gold ‚Üí Ring ‚Üí Wedding</div>', settings:[{id:'lives',type:'select',label:'Lives',options:[{value:'3',text:'3'},{value:'5',text:'5'}]}] },
        'npat': { displayName:'NAME PLACE ANIMAL THING', tagline:'Classic letter game', theme:'theme-npat', minPlayers:2, maxPlayers:16, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/npat.html', howToPlay:'<h3>üìù Fill Categories</h3><p>Letter appears - fill Name, Place, Animal, Thing!</p><h3>üèÜ Score</h3><p>Unique: 10 pts | Match: 5 pts</p>', settings:[{id:'rounds',type:'select',label:'Rounds',options:[{value:'5',text:'5'},{value:'10',text:'10'}]}] },
        'fools-gold': { displayName:'FOOLS GOLD', tagline:'Spot the truth', theme:'theme-fools-gold', minPlayers:3, maxPlayers:10, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/fools-gold.html', howToPlay:'<h3>ü™ô Bluff Your Way</h3><p>Write fake answers - find the real one!</p><h3>üèÜ Score</h3><p>Fool others: 100 pts | Find truth: 200 pts</p>', settings:[{id:'category',type:'select',label:'Category',options:[{value:'mixed',text:'üé≤ Mixed'},{value:'history',text:'üìú History'}]}] },
        'broken-pictionary': { displayName:'BROKEN PICTIONARY', tagline:'Telephone + Drawing', theme:'theme-broken-pictionary', minPlayers:4, maxPlayers:12, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/broken-pictionary.html', howToPlay:'<h3>‚úèÔ∏è Lost in Translation</h3><p>Draw ‚Üí Describe ‚Üí Draw... Watch chaos unfold!</p>', settings:[] },
        'doodle-duel': { displayName:'DOODLE DUEL', tagline:'Draw and deceive', theme:'theme-doodle-duel', minPlayers:3, maxPlayers:12, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/doodle-duel.html', howToPlay:'<h3>üñåÔ∏è Fake Titles</h3><p>One draws, others write fake titles. Find the real one!</p>', settings:[] },
        'two-truths': { displayName:'TWO TRUTHS ONE LIE', tagline:'Spot the fake', theme:'theme-two-truths', minPlayers:3, maxPlayers:12, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/two-truths.html', howToPlay:'<h3>‚úì‚úì‚úó Truth or Lie?</h3><p>Share 2 truths and 1 lie - others guess which is fake!</p>', settings:[] },
        'most-likely-to': { displayName:'MOST LIKELY TO', tagline:'Who would do it?', theme:'theme-most-likely-to', minPlayers:3, maxPlayers:20, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/most-likely-to.html', howToPlay:'<h3>üëâ Point Fingers</h3><p>Vote who\'s most likely to do each scenario!</p>', settings:[{id:'pack',type:'select',label:'Pack',options:[{value:'clean',text:'üòá Clean'},{value:'spicy',text:'üå∂Ô∏è Spicy'}]}] },
        'punchline': { displayName:'PUNCHLINE', tagline:'Write the funniest ending', theme:'theme-punchline', minPlayers:3, maxPlayers:16, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/punchline.html', howToPlay:'<h3>üé§ Comedy Night</h3><p>Write punchlines to prompts. Everyone votes!</p>', settings:[{id:'mode',type:'select',label:'Mode',options:[{value:'clean',text:'üòá Clean'},{value:'spicy',text:'üå∂Ô∏è Spicy'}]}] },
        'this-or-that-party': { displayName:'THIS OR THAT', tagline:'Pick a side', theme:'theme-this-or-that-party', minPlayers:2, maxPlayers:100, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/this-or-that-party.html', howToPlay:'<h3>‚öñÔ∏è Choose</h3><p>Pick between options. Match majority to score!</p>', settings:[{id:'pack',type:'select',label:'Pack',options:[{value:'mixed',text:'Mixed'},{value:'hypothetical',text:'Would You Rather'}]}] },
        'hot-takes-party': { displayName:'HOT TAKES', tagline:'Rate the controversy', theme:'theme-hot-takes-party', minPlayers:2, maxPlayers:100, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/hot-takes-party.html', howToPlay:'<h3>üî• Spicy Opinions</h3><p>Rate 1-5. Match the average!</p>', settings:[{id:'spice',type:'select',label:'Spice',options:[{value:'mild',text:'üå∂Ô∏è'},{value:'hot',text:'üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è'}]}] },
        'never-ever-party': { displayName:'NEVER HAVE I EVER', tagline:'Confess or deny', theme:'theme-never-ever-party', minPlayers:2, maxPlayers:100, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/never-ever-party.html', howToPlay:'<h3>üôà Have You Ever...</h3><p>Vote Have or Never. Minority scores more!</p>', settings:[{id:'pack',type:'select',label:'Pack',options:[{value:'clean',text:'üòá Clean'},{value:'spicy',text:'üå∂Ô∏è Spicy'}]}] },
        'bet-or-bluff': { displayName:'BET OR BLUFF', tagline:'Answer then wager', theme:'theme-bet-or-bluff', minPlayers:2, maxPlayers:100, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/bet-or-bluff.html', howToPlay:'<h3>üé∞ Double Down</h3><p>Answer trivia, then bet on results!</p>', settings:[] }
    };

    // ========== STATE ==========
    var urlParams = new URLSearchParams(window.location.search);
    var roomCode = urlParams.get('room') || localStorage.getItem('tempRoomCode');
    var playerName = localStorage.getItem('tempPlayerName');
    var isPremium = localStorage.getItem('tempIsPremium') === 'true';
    var myCosmetics = JSON.parse(localStorage.getItem('tempCosmetics') || 'null');
    var myUserId = localStorage.getItem('tempUserId') || null;
    var gameType = urlParams.get('game') || localStorage.getItem('tempGameType') || 'spyfall';
    var gameConfig = GAMES[gameType] || GAMES['spyfall'];
    var isHost = localStorage.getItem('tempIsHost') === 'true';
    var currentRoom = null;
    var myPlayerId = null;
    var selectedColor = null;

    if (!roomCode || !playerName) { window.location.href = '/lobby.html?game=' + gameType; }
    document.getElementById('room-code').textContent = roomCode || '------';

    // ========== SOCKET ==========
    var BACKEND_URL = 'https://web-production-519c7.up.railway.app';
    var socket = io(BACKEND_URL, { transports: ['websocket', 'polling'], reconnection: true, reconnectionAttempts: 10 });

    socket.on('connect', function() { console.log('Connected'); socket.emit('rejoin-room', { roomCode: roomCode, playerName: playerName, isPremium: isPremium, cosmetics: myCosmetics, odaId: myUserId }); });
    socket.on('room-joined', function(data) { if (data.success || data.room) handleRoomUpdate(data.room); });
    socket.on('player-joined', function(data) { handleRoomUpdate(data.room); });
    socket.on('player-disconnected', function(data) { handleRoomUpdate(data.room); });
    socket.on('player-kicked', function(data) { handleRoomUpdate(data.room); });
    socket.on('room-settings-updated', function(data) { handleRoomUpdate(data.room); });
    socket.on('host-changed', function(data) { handleRoomUpdate(data.room); });
    socket.on('game-starting', function(data) { window.location.href = (GAMES[gameType] || GAMES['spyfall']).gameFile + '?room=' + roomCode; });
    socket.on('kicked', function() { alert('You have been kicked.'); window.location.href = gameConfig.backUrl; });
    socket.on('room-not-found', function() { alert('Room not found.'); window.location.href = gameConfig.backUrl; });

    function handleRoomUpdate(room) {
        if (!room) return;
        currentRoom = room;
        if (room.gameType && room.gameType !== gameType) { gameType = room.gameType; gameConfig = GAMES[gameType] || GAMES['spyfall']; localStorage.setItem('tempGameType', gameType); }
        document.body.className = gameConfig.theme || 'theme-spyfall';
        if (gameConfig.isPartyGame) document.body.classList.add('party-mode');
        document.getElementById('game-title').textContent = gameConfig.displayName;
        document.getElementById('game-tagline').textContent = gameConfig.tagline || '';
        document.getElementById('player-max').textContent = '/ ' + gameConfig.maxPlayers;
        var me = room.players.find(function(p) { return p.name === playerName; });
        if (me) { myPlayerId = me.id; isHost = me.isHost; }
        updatePlayersList(room.players);
        document.getElementById('player-count').textContent = room.players.length;
        document.getElementById('waiting-indicator').style.display = room.players.length > 1 ? 'none' : 'flex';
        var settingsSection = document.getElementById('settings-section');
        if (isHost) { settingsSection.style.display = 'block'; renderSettings(); renderRolesPreview(); renderColorPicker(room.players); updateStartButton(room.players.length); }
        else { settingsSection.style.display = 'none'; }
    }

    function updatePlayersList(players) {
        var list = document.getElementById('players-list'); list.innerHTML = '';
        players.forEach(function(player) {
            var div = document.createElement('div');
            
            // Use TGCOCosmetics if available
            if (window.TGCOCosmetics && player.cosmetics) {
                div.innerHTML = window.TGCOCosmetics.renderPlayerCard({
                    name: player.name,
                    cosmetics: player.cosmetics,
                    isPremium: player.isPremium,
                    isHost: player.isHost,
                    isMe: player.name === playerName
                });
                if (isHost && !player.isHost && player.name !== playerName) {
                    var kickBtn = document.createElement('button');
                    kickBtn.className = 'kick-btn';
                    kickBtn.textContent = 'Kick';
                    kickBtn.onclick = function() { confirmKick(player); };
                    div.querySelector('.player-card') && div.querySelector('.player-card').appendChild(kickBtn);
                }
            } else {
                // Fallback
                div.className = 'player-item' + (player.isHost ? ' is-host' : '');
                var initial = player.name.charAt(0).toUpperCase();
                var badges = [];
                if (player.isHost) badges.push('<span class="player-badge host">üëë HOST</span>');
                if (player.color) { var colorMap = {red:'#ef4444',green:'#22c55e',yellow:'#eab308',blue:'#3b82f6'}; badges.push('<span class="player-badge" style="background:' + (colorMap[player.color]||player.color) + ';color:white">' + player.color.toUpperCase() + '</span>'); }
                var avatarStyle = player.isPremium ? 'background:linear-gradient(135deg,#fbbf24,#f59e0b);' : '';
                if (player.color) { var colorMap = {red:'#ef4444',green:'#22c55e',yellow:'#eab308',blue:'#3b82f6'}; avatarStyle = 'background:' + (colorMap[player.color] || player.color) + ';'; }
                div.innerHTML = '<div class="player-avatar" style="' + avatarStyle + '">' + initial + '</div><div class="player-info"><div class="player-name ' + (player.isPremium ? 'premium' : '') + '">' + player.name + '</div>' + (badges.length ? '<div class="player-badges">' + badges.join('') + '</div>' : '') + '</div>' + (isHost && !player.isHost && player.name !== playerName ? '<button class="kick-btn">Kick</button>' : '');
                var kickBtn = div.querySelector('.kick-btn'); if (kickBtn) kickBtn.onclick = function() { confirmKick(player); };
            }
            list.appendChild(div);
        });
    }

    function renderSettings() {
        var container = document.getElementById('settings-container');
        if (!gameConfig.settings || !gameConfig.settings.length) { container.innerHTML = '<p style="color:var(--muted);font-size:0.9rem;text-align:center">Default settings.</p>'; return; }
        var html = '';
        gameConfig.settings.forEach(function(s) {
            if (s.type === 'select') { html += '<div class="setting-group"><label class="setting-label">' + s.label + '</label><select id="setting-' + s.id + '" onchange="updateSetting(\'' + s.id + '\',this.value)">'; s.options.forEach(function(o) { html += '<option value="' + o.value + '">' + o.text + '</option>'; }); html += '</select></div>'; }
            else if (s.type === 'toggle') { html += '<div class="setting-group"><div class="toggle-row"><span class="toggle-label">' + s.label + '</span><div class="toggle' + (s.default ? ' active' : '') + '" id="setting-' + s.id + '" onclick="toggleSetting(\'' + s.id + '\')"></div></div></div>'; }
        });
        container.innerHTML = html;
        if (currentRoom && currentRoom.settings) { Object.keys(currentRoom.settings).forEach(function(k) { var el = document.getElementById('setting-' + k); if (el) { if (el.classList.contains('toggle')) { if (currentRoom.settings[k]) el.classList.add('active'); else el.classList.remove('active'); } else { el.value = currentRoom.settings[k]; } } }); }
    }

    function renderRolesPreview() {
        var container = document.getElementById('roles-preview');
        if (!gameConfig.roles) { container.innerHTML = ''; return; }
        var playerCount = currentRoom ? currentRoom.players.length : 0;
        var html = '<div class="roles-preview"><div class="roles-preview-title">Roles (' + playerCount + ' players)</div><div class="roles-grid">';
        if (gameConfig.roles.good) { gameConfig.roles.good.forEach(function(r) { html += '<span class="role-chip good">‚úì ' + r + '</span>'; }); }
        if (gameConfig.roles.evil) { gameConfig.roles.evil.forEach(function(r) { html += '<span class="role-chip evil">‚úó ' + r + '</span>'; }); }
        if (gameConfig.roles.neutral) { gameConfig.roles.neutral.forEach(function(r) { html += '<span class="role-chip neutral">‚óê ' + r + '</span>'; }); }
        html += '</div></div>'; container.innerHTML = html;
    }

    function renderColorPicker(players) {
        var section = document.getElementById('color-picker-section'); var picker = document.getElementById('color-picker');
        if (!gameConfig.hasColorPicker) { section.style.display = 'none'; return; }
        section.style.display = 'block';
        var colors = ['red', 'green', 'yellow', 'blue'];
        var takenColors = players.filter(function(p) { return p.color; }).map(function(p) { return p.color; });
        picker.innerHTML = colors.map(function(c) { var taken = takenColors.indexOf(c) !== -1; var selected = selectedColor === c; return '<div class="color-option ' + c + (taken ? ' taken' : '') + (selected ? ' selected' : '') + '" onclick="selectColor(\'' + c + '\',' + taken + ')"></div>'; }).join('');
    }

    function selectColor(color, taken) { if (taken) return; selectedColor = color; socket.emit('update-player-color', { roomCode: roomCode, color: color }); renderColorPicker(currentRoom ? currentRoom.players : []); }
    function updateSetting(id, value) { socket.emit('update-settings', { roomCode: roomCode, settings: { [id]: value } }); }
    function toggleSetting(id) { var t = document.getElementById('setting-' + id); t.classList.toggle('active'); socket.emit('update-settings', { roomCode: roomCode, settings: { [id]: t.classList.contains('active') } }); }
    function updateStartButton(count) { var btn = document.getElementById('start-btn'); var min = gameConfig.minPlayers, max = gameConfig.maxPlayers; if (count < min) { btn.disabled = true; btn.textContent = 'Need ' + (min - count) + ' More Player' + (min - count > 1 ? 's' : ''); } else if (count > max) { btn.disabled = true; btn.textContent = 'Too Many (Max ' + max + ')'; } else { btn.disabled = false; btn.textContent = 'üöÄ START GAME'; } }
    document.getElementById('start-btn').onclick = function() { socket.emit('start-game', { roomCode: roomCode }); };
    function copyCode() { navigator.clipboard.writeText(roomCode); showToast('Code copied!'); }
    function copyLink() { navigator.clipboard.writeText(window.location.origin + '/lobby.html?game=' + gameType + '&join=' + roomCode); showToast('Link copied!'); }
    function showToast(msg) { var t = document.createElement('div'); t.className = 'toast'; t.textContent = msg; document.body.appendChild(t); setTimeout(function() { t.remove(); }, 2500); }
    function showHowToPlay() { document.getElementById('htp-title').textContent = gameConfig.displayName; document.getElementById('htp-content').innerHTML = gameConfig.howToPlay || '<p>Coming soon!</p>'; document.getElementById('htp-modal').classList.add('visible'); }
    function closeModal(id) { document.getElementById(id).classList.remove('visible'); }
    function confirmKick(player) { document.getElementById('confirm-title').textContent = 'Kick Player'; document.getElementById('confirm-message').textContent = 'Remove ' + player.name + '?'; document.getElementById('confirm-btn').onclick = function() { socket.emit('kick-player', { roomCode: roomCode, playerId: player.id }); closeModal('confirm-modal'); }; document.getElementById('confirm-modal').classList.add('visible'); }
    document.querySelectorAll('.modal-overlay').forEach(function(o) { o.onclick = function(e) { if (e.target === o) o.classList.remove('visible'); }; });
</script>
<script src="/header.js"></script>
</body>
</html>
