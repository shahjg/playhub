<!DOCTYPE html>
<html>
<head>
    <title>DEBUG - Waiting Room</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        body { font-family: monospace; padding: 20px; background: #000; color: #0f0; }
        .log { margin: 5px 0; }
        .error { color: #f00; }
        .success { color: #0f0; }
        .info { color: #ff0; }
    </style>
</head>
<body>
    <h1>üîç DEBUG MODE - Waiting Room</h1>
    <div id="logs"></div>
    
    <script>
        const BACKEND_URL = 'https://web-production-519c7.up.railway.app';
        
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toISOString()}] ${msg}`;
            document.getElementById('logs').appendChild(div);
            console.log(msg);
        }
        
        log('üöÄ Page loaded!', 'success');
        
        // Get parameters
        const urlParams = new URLSearchParams(window.location.search);
        const roomCode = urlParams.get('room') || urlParams.get('code');
        const playerName = urlParams.get('name') || localStorage.getItem('playerName');
        
        log(`üìã URL Params: room=${roomCode}, name=${playerName}`, 'info');
        log(`üì¶ LocalStorage: ${localStorage.getItem('tempRoomCode')}, ${localStorage.getItem('tempPlayerName')}`, 'info');
        
        if (!roomCode) {
            log('‚ùå ERROR: No room code found!', 'error');
        }
        if (!playerName) {
            log('‚ùå ERROR: No player name found!', 'error');
        }
        
        log('üîå Connecting to backend...', 'info');
        
        const socket = io(BACKEND_URL, {
            transports: ['websocket', 'polling'],
            reconnection: true,
            reconnectionAttempts: 5,
            reconnectionDelay: 1000
        });
        
        socket.on('connect', () => {
            log(`‚úÖ Connected! Socket ID: ${socket.id}`, 'success');
            
            if (roomCode && playerName) {
                log(`üîÑ Attempting to rejoin room ${roomCode}...`, 'info');
                
                socket.emit('rejoin-room', {
                    roomCode: roomCode,
                    playerName: playerName
                });
                
                log('üì§ rejoin-room event emitted', 'success');
            } else {
                log('‚ùå Cannot rejoin - missing room code or player name', 'error');
            }
        });
        
        socket.on('connect_error', (error) => {
            log(`‚ùå Connection error: ${error.message}`, 'error');
        });
        
        socket.on('disconnect', (reason) => {
            log(`‚ö†Ô∏è Disconnected: ${reason}`, 'error');
        });
        
        socket.on('room-joined', (data) => {
            log(`‚úÖ room-joined event received!`, 'success');
            log(`Room data: ${JSON.stringify(data)}`, 'info');
        });
        
        socket.on('room-state', (data) => {
            log(`‚úÖ room-state event received!`, 'success');
            log(`State: ${JSON.stringify(data)}`, 'info');
        });
        
        socket.on('error', (data) => {
            log(`‚ùå Server error: ${data.message}`, 'error');
        });
        
        socket.on('join-error', (data) => {
            log(`‚ùå Join error: ${data.message}`, 'error');
        });
        
        // Log all socket events
        socket.onAny((eventName, ...args) => {
            log(`üì° Socket event: ${eventName}`, 'info');
            console.log('Full event data:', args);
        });
        
        log('‚úÖ Script finished loading', 'success');
    </script>
</body>
</html>
