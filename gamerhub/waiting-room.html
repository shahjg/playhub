<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Lobby - TheGaming.co</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="/header.css">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&family=Creepster&family=Bangers&family=Fredoka+One&family=Orbitron:wght@700&family=Permanent+Marker&family=Caveat:wght@700&family=Pacifico&display=swap" rel="stylesheet">
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/js/cosmetics.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--accent:#14b8a6;--accent-glow:rgba(20,184,166,0.4);--bg:#0a0a0f;--border:rgba(255,255,255,0.1);--text:#fff;--muted:rgba(255,255,255,0.6);--gold:#fbbf24;--green:#22c55e;--red:#ef4444}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;overflow-x:hidden}
        .bg-container{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
        .bg-base{position:absolute;inset:0}.bg-scene{position:absolute;inset:0}
        .theme-loading{--accent:#666;--accent-glow:rgba(102,102,102,0.4)}
        .theme-loading .bg-base{background:linear-gradient(180deg,#0a0a0f 0%,#12121a 100%)}
        .theme-spyfall{--accent:#14b8a6;--accent-glow:rgba(20,184,166,0.6)}
        .theme-spyfall .bg-base{background:linear-gradient(180deg,#0a2525 0%,#061818 50%,#0a1a1a 100%)}
        .theme-spyfall .bg-scene{background:repeating-linear-gradient(90deg,transparent 0 80px,rgba(20,184,166,0.12) 80px 81px),repeating-linear-gradient(0deg,transparent 0 80px,rgba(20,184,166,0.12) 80px 81px)}
        .theme-spyfall .bg-scene::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:500px;height:500px;background:conic-gradient(from 0deg,transparent 0deg,rgba(20,184,166,0.5) 10deg,transparent 20deg);border-radius:50%;animation:radarSweep 4s linear infinite}
        @keyframes radarSweep{from{transform:translate(-50%,-50%) rotate(0deg)}to{transform:translate(-50%,-50%) rotate(360deg)}}
        .theme-avalon,.theme-secret-roles{--accent:#fbbf24;--accent-glow:rgba(251,191,36,0.6)}
        .theme-avalon .bg-base,.theme-secret-roles .bg-base{background:linear-gradient(180deg,#1f1a08 0%,#2a1f0a 40%,#15100a 100%)}
        .theme-avalon .bg-scene::before,.theme-secret-roles .bg-scene::before{content:'';position:absolute;bottom:0;left:0;right:0;height:320px;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1400 300'%3E%3Cpath d='M0 300V150h50V100h40v50h80V80h30V40h40V80h30v70h100V100h30V60h20V30h30V60h20v40h30v50h120V80h40V40h30V80h40v70h100V100h30V60h40v40h30v50h90V80h30V40h20V80h30v70h120v150H0z' fill='%23fbbf24' fill-opacity='0.2'/%3E%3C/svg%3E") bottom center/cover no-repeat}
        .theme-avalon .bg-scene::after,.theme-secret-roles .bg-scene::after{content:'üëë';position:absolute;top:10%;left:50%;transform:translateX(-50%);font-size:120px;opacity:0.2;animation:crownFloat 4s ease-in-out infinite}
        @keyframes crownFloat{0%,100%{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(-15px)}}
        .theme-werewolf{--accent:#a855f7;--accent-glow:rgba(168,85,247,0.6)}
        .theme-werewolf .bg-base{background:linear-gradient(180deg,#1a0a30 0%,#200a38 40%,#0f0520 100%)}
        .theme-werewolf .bg-scene::before{content:'';position:absolute;top:5%;right:10%;width:150px;height:150px;background:radial-gradient(circle,rgba(255,255,220,1) 0%,rgba(255,255,200,0.8) 30%,transparent 70%);border-radius:50%;box-shadow:0 0 80px 40px rgba(255,255,200,0.4)}
        .theme-werewolf .game-title{font-family:'Creepster',cursive!important;letter-spacing:8px!important}
        .theme-imposter{--accent:#ef4444;--accent-glow:rgba(239,68,68,0.6)}
        .theme-imposter .bg-base{background:linear-gradient(180deg,#250808 0%,#300a0a 40%,#180505 100%)}
        .theme-imposter .bg-scene{background:repeating-linear-gradient(45deg,transparent 0 20px,rgba(239,68,68,0.08) 20px 22px);animation:alertMove 1s linear infinite}
        @keyframes alertMove{from{background-position:0 0}to{background-position:42px 42px}}
        .theme-fake-artist{--accent:#ec4899;--accent-glow:rgba(236,72,153,0.6)}
        .theme-fake-artist .bg-base{background:linear-gradient(135deg,#250a1d 0%,#0f1825 50%,#1a0a28 100%)}
        .theme-fake-artist .bg-scene::after{content:'üé®';position:absolute;top:10%;left:50%;transform:translateX(-50%) rotate(-10deg);font-size:140px;opacity:0.25}
        .theme-fake-artist .game-title{background:linear-gradient(90deg,#ec4899,#a855f7,#3b82f6,#22c55e,#eab308,#ec4899)!important;background-size:300% auto;-webkit-background-clip:text!important;-webkit-text-fill-color:transparent!important;animation:rainbowShift 4s linear infinite!important}
        @keyframes rainbowShift{0%{background-position:0% center}100%{background-position:300% center}}
        .theme-codenames{--accent:#dc2626;--accent-glow:rgba(220,38,38,0.5)}
        .theme-codenames .bg-base{background:linear-gradient(180deg,#1a1008 0%,#0f0a05 100%)}
        .theme-codenames .game-title{color:#fbbf24!important}
        .theme-word-bomb{--accent:#f43f5e;--accent-glow:rgba(244,63,94,0.7)}
        .theme-word-bomb .bg-base{background:radial-gradient(circle at 50% 50%,#301010 0%,#250808 40%,#180505 100%)}
        .theme-word-bomb .bg-scene::before{content:'üí£';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:220px;opacity:0.25;animation:bombShake 0.1s ease-in-out infinite}
        @keyframes bombShake{0%,100%{transform:translate(-50%,-50%) rotate(-3deg)}50%{transform:translate(-50%,-50%) rotate(3deg)}}
        .theme-word-bomb .game-title{font-family:'Bangers',cursive!important}
        .theme-wavelength{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-wavelength .bg-base{background:linear-gradient(180deg,#1a1208 0%,#0f0a05 100%)}
        .theme-ludo{--accent:#22c55e;--accent-glow:rgba(34,197,94,0.6)}
        .theme-ludo .bg-base{background:linear-gradient(180deg,#0f1a15 0%,#0a1510 50%,#081210 100%)}
        .theme-ludo .bg-scene::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:350px;height:350px;background:conic-gradient(from 0deg at 50% 50%,rgba(239,68,68,0.4) 0deg 90deg,rgba(34,197,94,0.4) 90deg 180deg,rgba(234,179,8,0.4) 180deg 270deg,rgba(59,130,246,0.4) 270deg 360deg);border-radius:20px;box-shadow:0 0 60px rgba(34,197,94,0.3)}
        .theme-ludo .bg-scene::after{content:'üé≤';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:80px;animation:diceRoll 2s ease-in-out infinite}
        @keyframes diceRoll{0%,100%{transform:translate(-50%,-50%) rotate(0deg)}50%{transform:translate(-50%,-50%) rotate(360deg)}}
        .theme-ludo .game-title{font-family:'Fredoka One',cursive!important}
        .theme-power-struggle{--accent:#dc2626;--accent-glow:rgba(220,38,38,0.6)}
        .theme-power-struggle .bg-base{background:linear-gradient(180deg,#1a0a0a 0%,#250f0f 50%,#0f0505 100%)}
        .theme-power-struggle .game-title{color:#fbbf24!important}
        .theme-insider{--accent:#6366f1;--accent-glow:rgba(99,102,241,0.6)}
        .theme-insider .bg-base{background:radial-gradient(circle at 50% 50%,#151530 0%,#0a0a1a 100%)}
        .theme-herd-mentality{--accent:#8b5cf6;--accent-glow:rgba(139,92,246,0.6)}
        .theme-herd-mentality .bg-base{background:linear-gradient(180deg,#1a1030 0%,#0f0820 100%)}
        .theme-categories{--accent:#06b6d4;--accent-glow:rgba(6,182,212,0.6)}
        .theme-categories .bg-base{background:linear-gradient(180deg,#0a1a20 0%,#051215 100%)}
        .theme-categories .game-title{font-family:'Orbitron',monospace!important}
        .theme-npat{--accent:#f59e0b;--accent-glow:rgba(245,158,11,0.6)}
        .theme-npat .bg-base{background:linear-gradient(180deg,#251a08 0%,#181008 100%)}
        .theme-npat .game-title{font-family:'Permanent Marker',cursive!important}
        .theme-word-association{--accent:#8b5cf6;--accent-glow:rgba(139,92,246,0.6)}
        .theme-word-association .bg-base{background:linear-gradient(180deg,#1d0a30 0%,#130820 100%)}
        .theme-charades{--accent:#ec4899;--accent-glow:rgba(236,72,153,0.6)}
        .theme-charades .bg-base{background:linear-gradient(180deg,#2a0a1a 0%,#1a0510 100%)}
        .theme-charades .game-title{font-family:'Pacifico',cursive!important}
        .theme-heads-up{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-heads-up .bg-base{background:linear-gradient(180deg,#251508 0%,#1a0f05 100%)}
        .theme-heads-up .bg-scene::before{content:'üì±';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:150px;opacity:0.2}
        .theme-celebrity{--accent:#fbbf24;--accent-glow:rgba(251,191,36,0.6)}
        .theme-celebrity .bg-base{background:linear-gradient(180deg,#1a1508 0%,#100a05 100%)}
        .theme-fishbowl{--accent:#06b6d4;--accent-glow:rgba(6,182,212,0.6)}
        .theme-fishbowl .bg-base{background:linear-gradient(180deg,#082530 0%,#051a25 50%,#031015 100%)}
        .theme-fishbowl .bg-scene::after{content:'üêü';position:absolute;top:50%;left:50%;font-size:80px;opacity:0.4;animation:fishSwim 4s ease-in-out infinite}
        @keyframes fishSwim{0%,100%{transform:translate(-80%,-50%)}50%{transform:translate(-20%,-50%) scaleX(-1)}}
        .theme-sketch-guess{--accent:#22c55e;--accent-glow:rgba(34,197,94,0.6)}
        .theme-sketch-guess .bg-base{background:linear-gradient(180deg,#0f1a15 0%,#0a1510 100%)}
        .theme-sketch-guess .bg-scene::after{content:'‚úèÔ∏è';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-45deg);font-size:150px;opacity:0.15}
        .theme-sketch-guess .game-title{font-family:'Caveat',cursive!important;font-size:4rem!important}
        .theme-fools-gold{--accent:#fbbf24;--accent-glow:rgba(251,191,36,0.6)}
        .theme-fools-gold .bg-base{background:linear-gradient(180deg,#251a08 0%,#181005 100%)}
        .theme-fools-gold .game-title{color:#fbbf24!important}
        .theme-most-likely-to{--accent:#f43f5e;--accent-glow:rgba(244,63,94,0.6)}
        .theme-most-likely-to .bg-base{background:radial-gradient(circle at 50% 50%,#250a15 0%,#150508 100%)}
        .theme-punchline{--accent:#fbbf24;--accent-glow:rgba(251,191,36,0.6)}
        .theme-punchline .bg-base{background:radial-gradient(ellipse 100% 100% at 50% 0%,#302510 0%,#201808 40%,#100a05 100%)}
        .theme-punchline .game-title{font-family:'Bangers',cursive!important}
        .theme-trivia-royale{--accent:#a855f7;--accent-glow:rgba(168,85,247,0.6)}
        .theme-trivia-royale .bg-base{background:radial-gradient(ellipse 150% 100% at 50% 0%,#281840 0%,#1a1030 40%,#0f0818 100%)}
        .theme-this-or-that-party{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-this-or-that-party .bg-base{background:linear-gradient(90deg,rgba(59,130,246,0.25) 0%,#0f0f15 30%,#0f0f15 70%,rgba(249,115,22,0.25) 100%)}
        .theme-hot-takes-party{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-hot-takes-party .bg-base{background:linear-gradient(180deg,#301508 0%,#201008 40%,#150805 100%)}
        .theme-never-ever-party{--accent:#ec4899;--accent-glow:rgba(236,72,153,0.6)}
        .theme-never-ever-party .bg-base{background:radial-gradient(ellipse at 50% 100%,#250a1a 0%,#150810 100%)}
        .theme-bet-or-bluff{--accent:#10b981;--accent-glow:rgba(16,185,129,0.6)}
        .theme-bet-or-bluff .bg-base{background:linear-gradient(180deg,#0a2518 0%,#081812 100%)}
        .theme-broken-pictionary{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-broken-pictionary .bg-base{background:linear-gradient(135deg,#251508 0%,#150810 100%)}
        .theme-doodle-duel{--accent:#ec4899;--accent-glow:rgba(236,72,153,0.6)}
        .theme-doodle-duel .bg-base{background:linear-gradient(180deg,#251015 0%,#180a10 100%)}
        .theme-doodle-duel .game-title{font-family:'Caveat',cursive!important;font-size:4rem!important}
        .theme-two-truths{--accent:#22c55e;--accent-glow:rgba(34,197,94,0.6)}
        .theme-two-truths .bg-base{background:linear-gradient(180deg,#0a1a10 0%,#051008 100%)}
        main{flex:1;display:flex;align-items:flex-start;justify-content:center;padding:100px 20px 40px;position:relative;z-index:1}
        .container{width:100%;max-width:1000px;display:grid;grid-template-columns:1fr 360px;gap:20px}
        @media(max-width:900px){.container{grid-template-columns:1fr;max-width:550px}}
        .card{background:rgba(20,20,30,0.88);border:1px solid var(--border);border-radius:20px;padding:1.5rem;backdrop-filter:blur(20px);position:relative;overflow:hidden}
        .card::before{content:'';position:absolute;top:0;left:20px;right:20px;height:2px;background:linear-gradient(90deg,transparent,var(--accent),transparent)}
        .section-title{font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:3px;color:var(--accent);margin-bottom:1rem;display:flex;align-items:center;gap:10px}
        .game-header{text-align:center;margin-bottom:1rem;grid-column:1/-1}
        .game-title{font-family:'Bebas Neue',sans-serif;font-size:3.2rem;letter-spacing:8px;line-height:1;text-shadow:0 0 80px var(--accent-glow)}
        .game-tagline{color:var(--muted);font-size:0.9rem;margin-top:0.5rem}
        .room-code-card{text-align:center;padding:1.25rem;grid-column:1/-1}
        .room-code-label{font-size:0.7rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:0.4rem}
        .room-code-value{font-family:'Bebas Neue',sans-serif;font-size:2.8rem;letter-spacing:12px;color:var(--accent);text-shadow:0 0 30px var(--accent-glow)}
        .room-code-actions{display:flex;gap:10px;justify-content:center;margin-top:0.75rem;flex-wrap:wrap}
        .copy-btn{display:flex;align-items:center;gap:6px;padding:0.5rem 0.9rem;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.8rem;font-weight:600;cursor:pointer;transition:all 0.2s}
        .copy-btn:hover{border-color:var(--accent);background:var(--accent);color:white}
        .copy-btn svg{width:14px;height:14px}
        .players-card{min-height:280px}
        .players-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;flex-wrap:wrap;gap:10px}
        .player-count-wrap{display:flex;align-items:center;gap:8px}
        .player-count{font-family:'Bebas Neue',sans-serif;font-size:1.4rem;color:var(--accent)}
        .player-max{font-size:0.9rem;color:var(--muted)}
        .players-list{display:flex;flex-direction:column;gap:8px;max-height:350px;overflow-y:auto;padding-right:5px}
        .players-list::-webkit-scrollbar{width:4px}
        .players-list::-webkit-scrollbar-thumb{background:var(--accent);border-radius:4px}
        .player-item{display:flex;align-items:center;gap:12px;padding:0.65rem 0.9rem;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:12px;transition:all 0.2s;position:relative}
        .player-item:hover{border-color:rgba(255,255,255,0.15);background:rgba(255,255,255,0.05)}
        .player-item.is-host{border-color:var(--gold);background:rgba(251,191,36,0.08)}
        .player-avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent),rgba(255,255,255,0.2));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.95rem;flex-shrink:0}
        .player-info{flex:1;min-width:0}
        .player-name{font-weight:600;font-size:0.95rem}
        .player-name.premium{background:linear-gradient(90deg,var(--gold),#f59e0b,#fcd34d,var(--gold));background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:goldShimmer 3s linear infinite;font-weight:700}
        @keyframes goldShimmer{0%{background-position:0% center}100%{background-position:200% center}}
        .player-badges{display:flex;gap:4px;margin-top:2px}
        .player-badge{font-size:0.65rem;padding:0.15rem 0.4rem;border-radius:4px;background:rgba(255,255,255,0.1);font-weight:600}
        .player-badge.host{background:rgba(251,191,36,0.2);color:var(--gold)}
        .kick-btn{padding:0.3rem 0.6rem;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:6px;color:#ef4444;font-size:0.7rem;font-weight:600;cursor:pointer;opacity:0;transition:all 0.2s}
        .player-item:hover .kick-btn{opacity:1}
        .kick-btn:hover{background:rgba(239,68,68,0.2)}
        .settings-card{}
        .setting-group{margin-bottom:1rem}
        .setting-label{display:block;font-size:0.7rem;font-weight:700;color:var(--muted);margin-bottom:0.4rem;text-transform:uppercase;letter-spacing:1.5px}
        select{width:100%;padding:0.75rem 1rem;background:rgba(10,10,15,0.9);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;font-family:inherit;cursor:pointer;transition:all 0.2s;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}
        select:focus{outline:none;border-color:var(--accent)}
        select option{background:#1a1a2e;color:white}
        .toggle-row{display:flex;align-items:center;justify-content:space-between;padding:0.7rem 1rem;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:10px}
        .toggle-label{font-size:0.9rem;font-weight:500}
        .toggle{position:relative;width:44px;height:24px;background:rgba(255,255,255,0.15);border-radius:12px;cursor:pointer;transition:background 0.2s}
        .toggle.active{background:var(--accent)}
        .toggle::after{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;background:white;border-radius:50%;transition:transform 0.2s;box-shadow:0 2px 4px rgba(0,0,0,0.2)}
        .toggle.active::after{transform:translateX(20px)}
        .roles-preview{margin-top:1rem;padding:1rem;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:12px}
        .roles-preview-title{font-size:0.75rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:0.6rem}
        .roles-grid{display:flex;flex-wrap:wrap;gap:6px}
        .role-chip{display:inline-flex;align-items:center;gap:4px;padding:0.3rem 0.6rem;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:6px;font-size:0.8rem}
        .role-chip.good{border-color:rgba(34,197,94,0.4);background:rgba(34,197,94,0.1)}
        .role-chip.evil{border-color:rgba(239,68,68,0.4);background:rgba(239,68,68,0.1)}
        .role-chip.neutral{border-color:rgba(168,85,247,0.4);background:rgba(168,85,247,0.1)}
        .color-picker{display:flex;gap:10px;margin-top:0.5rem;justify-content:center}
        .color-option{width:40px;height:40px;border-radius:50%;cursor:pointer;border:3px solid transparent;transition:all 0.2s;display:flex;align-items:center;justify-content:center;font-size:1.2rem}
        .color-option:hover{transform:scale(1.1)}
        .color-option.selected{border-color:white;box-shadow:0 0 15px currentColor}
        .color-option.red{background:#ef4444}
        .color-option.green{background:#22c55e}
        .color-option.yellow{background:#eab308}
        .color-option.blue{background:#3b82f6}
        .color-option.taken{opacity:0.3;cursor:not-allowed}
        .btn-start{width:100%;padding:1rem;background:linear-gradient(135deg,var(--accent),rgba(255,255,255,0.1));border:none;border-radius:12px;color:white;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:3px;cursor:pointer;box-shadow:0 8px 30px var(--accent-glow);transition:all 0.2s;margin-top:1rem;position:relative;overflow:hidden}
        .btn-start::before{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transform:translateX(-100%);transition:transform 0.5s}
        .btn-start:hover:not(:disabled)::before{transform:translateX(100%)}
        .btn-start:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 12px 40px var(--accent-glow)}
        .btn-start:disabled{opacity:0.5;cursor:not-allowed;transform:none}
        .htp-btn{display:flex;align-items:center;gap:6px;padding:0.5rem 0.8rem;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:8px;color:var(--muted);font-size:0.75rem;font-weight:600;cursor:pointer;transition:all 0.2s}
        .htp-btn:hover{border-color:var(--accent);color:var(--accent);background:rgba(255,255,255,0.08)}
        .htp-btn svg{width:14px;height:14px}
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;align-items:center;justify-content:center;z-index:1000;padding:1rem;backdrop-filter:blur(5px)}
        .modal-overlay.visible{display:flex}
        .modal{background:linear-gradient(180deg,#1a1a2a 0%,#12121a 100%);border:1px solid var(--border);border-radius:24px;width:100%;max-width:600px;max-height:85vh;display:flex;flex-direction:column;box-shadow:0 25px 80px rgba(0,0,0,0.5)}
        .modal-header{padding:1.25rem 1.5rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .modal-title{font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:3px;color:var(--accent)}
        .modal-close{background:none;border:none;color:var(--muted);font-size:1.5rem;cursor:pointer;transition:color 0.2s}
        .modal-close:hover{color:var(--text)}
        .modal-body{padding:1.5rem;color:var(--text);line-height:1.7;overflow-y:auto;font-size:0.95rem}
        .modal-body h3{font-family:'Bebas Neue',sans-serif;color:var(--accent);margin:1.25rem 0 0.6rem;font-size:1.1rem;letter-spacing:2px}
        .modal-body h3:first-child{margin-top:0}
        .modal-body p{margin-bottom:0.6rem;color:var(--muted)}
        .modal-body ul,.modal-body ol{margin-left:1.25rem;margin-bottom:0.6rem}
        .modal-body li{margin-bottom:0.35rem;color:var(--muted)}
        .modal-body strong{color:var(--accent)}
        .modal-body .role-card{display:inline-flex;align-items:center;gap:6px;padding:0.3rem 0.7rem;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:8px;margin:3px;font-size:0.9rem}
        .modal-body .tip-box{background:rgba(20,184,166,0.1);border-left:3px solid var(--accent);padding:0.75rem 1rem;margin:1rem 0;border-radius:0 8px 8px 0;font-size:0.9rem}
        .modal-body .warning-box{background:rgba(239,68,68,0.1);border-left:3px solid #ef4444;padding:0.75rem 1rem;margin:1rem 0;border-radius:0 8px 8px 0}
        .modal-body .example-box{background:rgba(139,92,246,0.1);border:1px dashed rgba(139,92,246,0.3);padding:0.75rem 1rem;margin:1rem 0;border-radius:8px;font-style:italic}
        .confirm-btns{display:flex;gap:10px;margin-top:1.25rem}
        .confirm-btns button{flex:1;padding:0.75rem;border-radius:10px;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;cursor:pointer;border:none;transition:all 0.2s}
        .btn-confirm{background:var(--red);color:white}
        .btn-cancel{background:rgba(255,255,255,0.1);color:var(--text);border:1px solid var(--border)}
        .party-mode .players-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;max-height:450px}
        .party-mode .player-item{flex-direction:column;text-align:center;padding:1rem}
        .party-mode .player-avatar{margin:0 auto 0.5rem}
        .party-mode .player-info{text-align:center}
        .party-mode .kick-btn{margin-top:0.5rem;opacity:1}
        .toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);padding:0.75rem 1.5rem;background:var(--accent);color:white;border-radius:10px;font-weight:600;z-index:1001;animation:toastIn 0.3s ease;box-shadow:0 10px 30px var(--accent-glow)}
        @keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
        .waiting-indicator{display:flex;align-items:center;justify-content:center;gap:8px;padding:1rem;background:rgba(255,255,255,0.03);border-radius:10px;margin-top:1rem}
        .waiting-dots{display:flex;gap:4px}
        .waiting-dots span{width:8px;height:8px;background:var(--accent);border-radius:50%;animation:dotPulse 1.4s ease-in-out infinite}
        .waiting-dots span:nth-child(2){animation-delay:0.2s}
        .waiting-dots span:nth-child(3){animation-delay:0.4s}
        @keyframes dotPulse{0%,80%,100%{transform:scale(0.6);opacity:0.5}40%{transform:scale(1);opacity:1}}
        footer{background:#000;position:relative;z-index:10}
        .footer-border{height:4px;background:linear-gradient(90deg,#ff6b9d,#4facfe,#a855f7,#ff6b9d);background-size:300% 100%;animation:gradientSlide 6s linear infinite}
        @keyframes gradientSlide{0%{background-position:0% 50%}100%{background-position:300% 50%}}
        .footer-main{max-width:1100px;margin:0 auto;padding:40px 20px 25px}
        .footer-links{display:grid;grid-template-columns:repeat(3,1fr);gap:30px;margin-bottom:30px;max-width:500px;margin-left:auto;margin-right:auto}
        .footer-column{text-align:center}
        .footer-column h5{font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:2px;margin-bottom:12px;color:rgba(255,255,255,0.8)}
        .footer-column ul{list-style:none;display:flex;flex-direction:column;gap:8px}
        .footer-column a{color:rgba(255,255,255,0.4);font-size:0.85rem;text-decoration:none}
        .footer-bottom{padding-top:20px;border-top:1px solid rgba(255,255,255,0.08);text-align:center}
        .footer-copyright{font-size:0.8rem;color:rgba(255,255,255,0.4)}
        .footer-legal{display:flex;justify-content:center;gap:20px;margin-top:8px}
        .footer-legal a{color:rgba(255,255,255,0.4);font-size:0.75rem;text-decoration:none}
        @media(max-width:600px){main{padding:80px 12px 30px}.game-title{font-size:2.2rem;letter-spacing:4px}.room-code-value{font-size:2rem;letter-spacing:8px}.container{gap:12px}.card{padding:1rem}.player-item{padding:0.8rem 1rem}.player-avatar{width:40px;height:40px;font-size:1rem}.player-name{font-size:1rem}}
    </style>
</head>
<body class="theme-loading">
<div class="bg-container"><div class="bg-base"></div><div class="bg-scene"></div></div>
<div id="site-header"></div>
<main>
    <div class="container">
        <div class="game-header">
            <h1 class="game-title" id="game-title">Loading...</h1>
            <p class="game-tagline" id="game-tagline"></p>
        </div>
        <div class="room-code-card card">
            <div class="room-code-label">Share This Code To Invite Friends</div>
            <div class="room-code-value" id="room-code">------</div>
            <div class="room-code-actions">
                <button class="copy-btn" onclick="copyCode()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy Code</button>
                <button class="copy-btn" onclick="copyLink()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>Copy Link</button>
            </div>
        </div>
        <div class="players-card card">
            <div class="players-header">
                <div class="section-title"><span>Players</span><div class="player-count-wrap"><span class="player-count" id="player-count">0</span><span class="player-max" id="player-max">/ 10</span></div></div>
                <button class="htp-btn" onclick="showHowToPlay()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>How to Play</button>
            </div>
            <div class="players-list" id="players-list"></div>
            <div class="waiting-indicator" id="waiting-indicator"><div class="waiting-dots"><span></span><span></span><span></span></div><span style="color:var(--muted);font-size:0.85rem">Waiting for players...</span></div>
        </div>
        <div class="settings-card card" id="settings-section" style="display:none">
            <div class="section-title">‚öôÔ∏è Host Settings</div>
            <div id="settings-container"></div>
            <div id="roles-preview"></div>
            <div id="color-picker-section" style="display:none"><div class="setting-label" style="margin-top:1rem">Choose Your Color</div><div class="color-picker" id="color-picker"></div></div>
            <button class="btn-start" id="start-btn" disabled>Waiting for Players...</button>
        </div>
    </div>
</main>
<div class="modal-overlay" id="htp-modal"><div class="modal"><div class="modal-header"><span class="modal-title" id="htp-title">How To Play</span><button class="modal-close" onclick="closeModal('htp-modal')">&times;</button></div><div class="modal-body" id="htp-content"></div></div></div>
<div class="modal-overlay" id="confirm-modal"><div class="modal"><div class="modal-header"><span class="modal-title" id="confirm-title">Confirm</span><button class="modal-close" onclick="closeModal('confirm-modal')">&times;</button></div><div class="modal-body"><p id="confirm-message"></p><div class="confirm-btns"><button class="btn-cancel" onclick="closeModal('confirm-modal')">Cancel</button><button class="btn-confirm" id="confirm-btn">Confirm</button></div></div></div></div>
<footer><div class="footer-border"></div><div class="footer-main"><div class="footer-links"><div class="footer-column"><h5>Games</h5><ul><li><a href="/solo-games.html">Solo</a></li><li><a href="/duos-games.html">Duos</a></li><li><a href="/squad-games.html">Squad</a></li><li><a href="/party-games.html">Party</a></li></ul></div><div class="footer-column"><h5>Account</h5><ul><li><a href="/login.html">Login</a></li><li><a href="/premium.html">Premium</a></li></ul></div><div class="footer-column"><h5>Company</h5><ul><li><a href="/about.html">About</a></li><li><a href="/contact.html">Contact</a></li></ul></div></div><div class="footer-bottom"><p class="footer-copyright">¬© 2025 TheGaming.co</p><div class="footer-legal"><a href="/privacy.html">Privacy</a><a href="/terms.html">Terms</a></div></div></div></footer>
<script>
const GAMES = {
    'spyfall': { displayName: 'SPY HUNT', tagline: 'Find the spy before they discover your location', theme: 'theme-spyfall', minPlayers: 4, maxPlayers: 12, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/spyfall/game.html', howToPlay: '<h3>üéØ Objective</h3><p>Everyone knows the secret location except one player - the Spy.</p>', settings: [{ id: 'category', type: 'select', label: 'Location Pack', options: [{value:'random',text:'üé≤ Random'},{value:'classic',text:'üèõÔ∏è Classic'},{value:'modern',text:'üèôÔ∏è Modern'}]}, { id: 'twoSpies', type: 'toggle', label: 'Two Spies Mode' }, { id: 'roundTime', type: 'select', label: 'Round Timer', options: [{value:'5',text:'5 min'},{value:'8',text:'8 min'},{value:'10',text:'10 min'}]}] },
    'secret-roles': { displayName: 'SECRET ROLES', tagline: 'Deception, deduction, and betrayal', theme: 'theme-secret-roles', minPlayers: 5, maxPlayers: 10, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/secret-roles/game.html', howToPlay: '<h3>‚öîÔ∏è Battle for Camelot</h3><p>Good vs Evil - find the traitors!</p>', settings: [{ id: 'variant', type: 'select', label: 'Variant', options: [{value:'standard',text:'Standard'},{value:'mordred',text:'+ Mordred'},{value:'full',text:'All Roles'}]}], roles: { good: ['Merlin', 'Percival'], evil: ['Assassin', 'Morgana'] } },
    'werewolf': { displayName: 'MAFIA', tagline: 'Survive the night. Find the killers.', theme: 'theme-werewolf', minPlayers: 6, maxPlayers: 15, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/werewolf/game.html', howToPlay: '<h3>üåô Village Under Attack</h3><p>Find the Mafia before they eliminate everyone!</p>', settings: [{ id: 'roleSet', type: 'select', label: 'Role Setup', options: [{value:'basic',text:'üü¢ Basic'},{value:'standard',text:'üü° Standard'},{value:'chaos',text:'üî¥ Chaos'}]}, { id: 'dayLength', type: 'select', label: 'Day Phase', options: [{value:'3',text:'3 min'},{value:'5',text:'5 min'}]}, { id: 'revealRoles', type: 'toggle', label: 'Reveal roles on death' }], roles: { good: ['Seer', 'Doctor', 'Villager'], evil: ['Mafia'], neutral: ['Jester'] } },
    'imposter': { displayName: 'IMPOSTER', tagline: 'One word at a time. One imposter among you.', theme: 'theme-imposter', minPlayers: 4, maxPlayers: 10, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/imposter/game.html', howToPlay: '<h3>üéØ Blend In</h3><p>Everyone except the Imposter sees a word.</p>', settings: [{ id: 'category', type: 'select', label: 'Word Pack', options: [{value:'random',text:'üé≤ Random'},{value:'food',text:'üçï Food'},{value:'animals',text:'üêæ Animals'}]}, { id: 'rounds', type: 'select', label: 'Clue Rounds', options: [{value:'2',text:'2'},{value:'3',text:'3'}]}] },
    'codenames': { displayName: 'CODEWORDS', tagline: 'Give clues. Find your agents.', theme: 'theme-codenames', minPlayers: 4, maxPlayers: 20, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/codenames/game.html', howToPlay: '<h3>üïµÔ∏è Two Teams</h3><p>Give one-word clues to find your agents!</p>', settings: [{ id: 'gridSize', type: 'select', label: 'Grid Size', options: [{value:'5x5',text:'5√ó5'},{value:'4x4',text:'4√ó4'}]}, { id: 'turnTimer', type: 'select', label: 'Turn Timer', options: [{value:'none',text:'No Timer'},{value:'90',text:'90s'},{value:'120',text:'2 min'}]}] },
    'word-bomb': { displayName: 'WORD BOMB', tagline: 'Type fast or explode!', theme: 'theme-word-bomb', minPlayers: 2, maxPlayers: 16, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/word-bomb/game.html', howToPlay: '<h3>üí£ Beat the Clock</h3><p>Type a word containing the letters before time runs out!</p>', settings: [{ id: 'difficulty', type: 'select', label: 'Difficulty', options: [{value:'easy',text:'üü¢ Easy'},{value:'medium',text:'üü° Medium'},{value:'hard',text:'üî¥ Hard'}]}, { id: 'lives', type: 'select', label: 'Lives', options: [{value:'2',text:'‚ù§Ô∏è‚ù§Ô∏è'},{value:'3',text:'‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è'}]}] },
    'power-struggle': { displayName: 'POWER STRUGGLE', tagline: 'Bluff, steal, and survive', theme: 'theme-power-struggle', minPlayers: 3, maxPlayers: 8, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/power-struggle/game.html', howToPlay: '<h3>üëë Claim Power</h3><p>Use abilities or bluff - last one standing wins!</p>', settings: [{ id: 'startCoins', type: 'select', label: 'Starting Coins', options: [{value:'2',text:'2 coins'},{value:'3',text:'3 coins'}]}], roles: { neutral: ['Duke', 'Assassin', 'Captain', 'Ambassador', 'Contessa'] } },
    'ludo': { displayName: 'LUDO', tagline: 'Classic board race', theme: 'theme-ludo', minPlayers: 2, maxPlayers: 4, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/ludo/game.html', howToPlay: '<h3>üé≤ Race Home</h3><p>Roll dice and race your tokens!</p>', settings: [{ id: 'mode', type: 'select', label: 'Mode', options: [{value:'classic',text:'üé≤ Classic'},{value:'quick',text:'‚ö° Quick'}]}], hasColorPicker: true },
    'heads-up': { displayName: 'HEADS UP!', tagline: 'Phone on forehead party game', theme: 'theme-heads-up', minPlayers: 2, maxPlayers: 20, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/heads-up/game.html', howToPlay: '<h3>üì± Guess the Word!</h3><p>Others give clues while you guess!</p>', settings: [{ id: 'category', type: 'select', label: 'Category', options: [{value:'random',text:'üé≤ Random'},{value:'celebrities',text:'‚≠ê Celebrities'},{value:'movies',text:'üé¨ Movies'}]}, { id: 'timer', type: 'select', label: 'Round', options: [{value:'60',text:'60s'},{value:'90',text:'90s'}]}] },
    'charades': { displayName: 'CHARADES', tagline: 'Act it out - no talking!', theme: 'theme-charades', minPlayers: 4, maxPlayers: 20, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/charades/game.html', howToPlay: '<h3>üé≠ Classic Acting</h3><p>Act out words using only gestures!</p>', settings: [{ id: 'category', type: 'select', label: 'Category', options: [{value:'random',text:'üé≤ Random'},{value:'movies',text:'üé¨ Movies'},{value:'actions',text:'üèÉ Actions'}]}, { id: 'timer', type: 'select', label: 'Turn', options: [{value:'60',text:'60s'},{value:'90',text:'90s'}]}] },
    'sketch-guess': { displayName: 'SKETCH & GUESS', tagline: 'Draw it. Guess it fast.', theme: 'theme-sketch-guess', minPlayers: 3, maxPlayers: 16, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/sketch-guess/game.html', howToPlay: '<h3>‚úèÔ∏è Drawing Game</h3><p>One draws, others race to guess!</p>', settings: [{ id: 'category', type: 'select', label: 'Category', options: [{value:'random',text:'üé≤ Random'},{value:'animals',text:'üêæ Animals'}]}, { id: 'drawTime', type: 'select', label: 'Draw Time', options: [{value:'60',text:'60s'},{value:'80',text:'80s'}]}, { id: 'hints', type: 'toggle', label: 'Letter hints' }] },
    'herd-mentality': { displayName: 'THINK ALIKE', tagline: 'Match the majority to score', theme: 'theme-herd-mentality', minPlayers: 4, maxPlayers: 20, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/herd-mentality/game.html', howToPlay: '<h3>üêë Think Like the Herd</h3><p>Match the majority answer!</p>', settings: [{ id: 'rounds', type: 'select', label: 'Rounds', options: [{value:'8',text:'8'},{value:'10',text:'10'}]}] },
    'fake-artist': { displayName: 'FAKE ARTIST', tagline: 'One stroke at a time', theme: 'theme-fake-artist', minPlayers: 4, maxPlayers: 10, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/fake-artist/game.html', howToPlay: '<h3>üé® Collaborative Drawing</h3><p>One player does not know what to draw!</p>', settings: [{ id: 'category', type: 'select', label: 'Category', options: [{value:'mixed',text:'üé≤ Mixed'},{value:'animals',text:'üêæ Animals'}]}] },
    'wavelength': { displayName: 'SPECTRUM', tagline: 'Find the hidden target', theme: 'theme-wavelength', minPlayers: 4, maxPlayers: 12, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/wavelength/game.html', howToPlay: '<h3>üìä Mind Reading</h3><p>Give clues for hidden spectrum position!</p>', settings: [{ id: 'mode', type: 'select', label: 'Mode', options: [{value:'coop',text:'Coop'},{value:'teams',text:'Teams'}]}] },
    'insider': { displayName: 'INSIDER', tagline: '20 Questions with a twist', theme: 'theme-insider', minPlayers: 4, maxPlayers: 8, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/insider/game.html', howToPlay: '<h3>üîç Hidden Ally</h3><p>Play 20 Questions but Insider knows!</p>', settings: [{ id: 'difficulty', type: 'select', label: 'Difficulty', options: [{value:'easy',text:'Easy'},{value:'hard',text:'Hard'}]}] },
    'categories': { displayName: 'CATEGORIES', tagline: 'Race to answer first', theme: 'theme-categories', minPlayers: 2, maxPlayers: 20, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/categories/game.html', howToPlay: '<h3>‚ö° Speed</h3><p>First valid answer wins!</p>', settings: [{ id: 'rounds', type: 'select', label: 'Rounds', options: [{value:'10',text:'10'},{value:'15',text:'15'}]}] },
    'fishbowl': { displayName: 'FISHBOWL', tagline: 'Three rounds, same words', theme: 'theme-fishbowl', minPlayers: 6, maxPlayers: 20, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/fishbowl/game.html', howToPlay: '<h3>üêü Three Rounds</h3><p>Describe, One Word, Act!</p>', settings: [{ id: 'words', type: 'select', label: 'Words/Player', options: [{value:'3',text:'3'},{value:'4',text:'4'}]}] },
    'celebrity': { displayName: 'CELEBRITY', tagline: 'Three rounds of fame', theme: 'theme-celebrity', minPlayers: 4, maxPlayers: 16, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/celebrity/game.html', howToPlay: '<h3>‚≠ê Famous Names</h3><p>Like Fishbowl with celebrities!</p>', settings: [{ id: 'names', type: 'select', label: 'Names/Player', options: [{value:'3',text:'3'},{value:'5',text:'5'}]}] },
    'word-association': { displayName: 'WORD CHAIN', tagline: 'Keep it going', theme: 'theme-word-association', minPlayers: 3, maxPlayers: 12, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/word-association/game.html', howToPlay: '<h3>üîó Chain Reaction</h3><p>Say related words fast!</p>', settings: [{ id: 'lives', type: 'select', label: 'Lives', options: [{value:'3',text:'3'},{value:'5',text:'5'}]}] },
    'npat': { displayName: 'NAME PLACE ANIMAL THING', tagline: 'Classic letter game', theme: 'theme-npat', minPlayers: 2, maxPlayers: 16, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/npat/game.html', howToPlay: '<h3>üìù Fill Categories</h3><p>Letter appears - fill all categories!</p>', settings: [{ id: 'rounds', type: 'select', label: 'Rounds', options: [{value:'5',text:'5'},{value:'10',text:'10'}]}] },
    'fools-gold': { displayName: 'FOOLS GOLD', tagline: 'Spot the truth', theme: 'theme-fools-gold', minPlayers: 3, maxPlayers: 10, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/fools-gold/game.html', howToPlay: '<h3>ü™ô Bluff</h3><p>Write fakes - find the real one!</p>', settings: [{ id: 'category', type: 'select', label: 'Category', options: [{value:'mixed',text:'üé≤ Mixed'}]}] },
    'broken-pictionary': { displayName: 'BROKEN PICTIONARY', tagline: 'Telephone + Drawing', theme: 'theme-broken-pictionary', minPlayers: 4, maxPlayers: 12, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/broken-pictionary/game.html', howToPlay: '<h3>‚úèÔ∏è Lost in Translation</h3><p>Draw, describe, repeat!</p>', settings: [] },
    'doodle-duel': { displayName: 'DOODLE DUEL', tagline: 'Draw and deceive', theme: 'theme-doodle-duel', minPlayers: 3, maxPlayers: 12, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/doodle-duel/game.html', howToPlay: '<h3>üñåÔ∏è Fake Titles</h3><p>Find the real title!</p>', settings: [] },
    'two-truths': { displayName: 'TWO TRUTHS ONE LIE', tagline: 'Spot the fake', theme: 'theme-two-truths', minPlayers: 3, maxPlayers: 12, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/two-truths/game.html', howToPlay: '<h3>‚úì‚úì‚úó Truth or Lie?</h3><p>Find the lie!</p>', settings: [] },
    'most-likely-to': { displayName: 'MOST LIKELY TO', tagline: 'Who would do it?', theme: 'theme-most-likely-to', minPlayers: 3, maxPlayers: 20, isPartyGame: true, backUrl: '/party-games.html', gameFile: '/games/party/most-likely-to/game.html', howToPlay: '<h3>üëâ Point Fingers</h3><p>Vote who is most likely!</p>', settings: [{ id: 'category', type: 'select', label: 'Pack', options: [{value:'fun',text:'üòá Fun'},{value:'spicy',text:'üå∂Ô∏è Spicy'}]}] },
    'punchline': { displayName: 'PUNCHLINE', tagline: 'Write the funniest ending', theme: 'theme-punchline', minPlayers: 3, maxPlayers: 16, isPartyGame: true, backUrl: '/party-games.html', gameFile: '/games/party/punchline/game.html', howToPlay: '<h3>üé§ Comedy</h3><p>Write punchlines!</p>', settings: [{ id: 'mode', type: 'select', label: 'Mode', options: [{value:'clean',text:'üòá Clean'},{value:'spicy',text:'üå∂Ô∏è Spicy'}]}] },
    'trivia-royale': { displayName: 'TRIVIA ROYALE', tagline: 'Battle of the brains', theme: 'theme-trivia-royale', minPlayers: 2, maxPlayers: 100, isPartyGame: true, backUrl: '/party-games.html', gameFile: '/games/party/trivia-royale/game.html', howToPlay: '<h3>üëë Knowledge</h3><p>Answer fast - speed matters!</p>', settings: [{ id: 'category', type: 'select', label: 'Category', options: [{value:'general',text:'üß† General'},{value:'gaming',text:'üéÆ Gaming'}]}, { id: 'questions', type: 'select', label: 'Questions', options: [{value:'10',text:'10'},{value:'15',text:'15'}]}] },
    'this-or-that-party': { displayName: 'THIS OR THAT', tagline: 'Pick a side', theme: 'theme-this-or-that-party', minPlayers: 2, maxPlayers: 100, isPartyGame: true, backUrl: '/party-games.html', gameFile: '/games/party/this-or-that-party/game.html', howToPlay: '<h3>‚öñÔ∏è Choose</h3><p>Pick and match majority!</p>', settings: [{ id: 'pack', type: 'select', label: 'Pack', options: [{value:'mixed',text:'Mixed'}]}] },
    'hot-takes-party': { displayName: 'HOT TAKES', tagline: 'Rate the controversy', theme: 'theme-hot-takes-party', minPlayers: 2, maxPlayers: 100, isPartyGame: true, backUrl: '/party-games.html', gameFile: '/games/party/hot-takes-party/game.html', howToPlay: '<h3>üî• Opinions</h3><p>Rate and match average!</p>', settings: [{ id: 'spice', type: 'select', label: 'Spice', options: [{value:'mild',text:'üå∂Ô∏è'},{value:'hot',text:'üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è'}]}] },
    'never-ever-party': { displayName: 'NEVER HAVE I EVER', tagline: 'Confess or deny', theme: 'theme-never-ever-party', minPlayers: 2, maxPlayers: 100, isPartyGame: true, backUrl: '/party-games.html', gameFile: '/games/party/never-ever-party/game.html', howToPlay: '<h3>üôà Have You Ever...</h3><p>Confess or deny!</p>', settings: [{ id: 'pack', type: 'select', label: 'Pack', options: [{value:'clean',text:'üòá Clean'},{value:'spicy',text:'üå∂Ô∏è Spicy'}]}] },
    'bet-or-bluff': { displayName: 'BET OR BLUFF', tagline: 'Answer then wager', theme: 'theme-bet-or-bluff', minPlayers: 2, maxPlayers: 100, isPartyGame: true, backUrl: '/party-games.html', gameFile: '/games/party/bet-or-bluff/game.html', howToPlay: '<h3>üé∞ Double Down</h3><p>Answer trivia then bet!</p>', settings: [] }
};

var urlParams = new URLSearchParams(window.location.search);
var roomCode = urlParams.get('room') || localStorage.getItem('tempRoomCode');
var playerName = localStorage.getItem('tempPlayerName');
var isPremium = localStorage.getItem('tempIsPremium') === 'true';
var myCosmetics = JSON.parse(localStorage.getItem('tempCosmetics') || 'null');
var myUserId = localStorage.getItem('tempUserId') || null;
var gameType = urlParams.get('game') || localStorage.getItem('tempGameType') || 'spyfall';
var gameConfig = GAMES[gameType] || GAMES['spyfall'];
var isHost = localStorage.getItem('tempIsHost') === 'true';
var currentRoom = null;
var myPlayerId = null;
var selectedColor = null;

if (!roomCode || !playerName) { window.location.href = '/lobby.html?game=' + gameType; }
document.getElementById('room-code').textContent = roomCode || '------';

var BACKEND_URL = 'https://web-production-519c7.up.railway.app';
var socket = io(BACKEND_URL, { transports: ['websocket', 'polling'], reconnection: true, reconnectionAttempts: 10 });

socket.on('connect', function() { console.log('Connected'); socket.emit('rejoin-room', { roomCode: roomCode, playerName: playerName, isPremium: isPremium, cosmetics: myCosmetics, odaId: myUserId }); });
socket.on('room-joined', function(data) { if (data.success || data.room) handleRoomUpdate(data.room); });
socket.on('player-joined', function(data) { handleRoomUpdate(data.room); });
socket.on('player-disconnected', function(data) { handleRoomUpdate(data.room); });
socket.on('player-kicked', function(data) { handleRoomUpdate(data.room); });
socket.on('room-settings-updated', function(data) { handleRoomUpdate(data.room); });
socket.on('host-changed', function(data) { handleRoomUpdate(data.room); });

// GAME START - REDIRECT TO GAME PAGE
socket.on('game-started', function(data) {
    console.log('Game started!', data);
    var gt = data.gameType || gameType;
    var config = GAMES[gt] || GAMES[gameType];
    var targetUrl = config.gameFile + '?room=' + roomCode;
    console.log('Redirecting to:', targetUrl);
    window.location.href = targetUrl;
});

socket.on('kicked', function() { alert('You have been kicked.'); window.location.href = gameConfig.backUrl; });
socket.on('room-not-found', function() { alert('Room not found.'); window.location.href = gameConfig.backUrl; });

function handleRoomUpdate(room) {
    if (!room) return;
    currentRoom = room;
    if (room.gameType && room.gameType !== gameType) { gameType = room.gameType; gameConfig = GAMES[gameType] || GAMES['spyfall']; localStorage.setItem('tempGameType', gameType); }
    document.body.className = gameConfig.theme || 'theme-spyfall';
    if (gameConfig.isPartyGame) document.body.classList.add('party-mode');
    document.getElementById('game-title').textContent = gameConfig.displayName;
    document.getElementById('game-tagline').textContent = gameConfig.tagline || '';
    document.getElementById('player-max').textContent = '/ ' + gameConfig.maxPlayers;
    var me = room.players.find(function(p) { return p.name === playerName; });
    if (me) { myPlayerId = me.id; isHost = me.isHost; }
    updatePlayersList(room.players);
    document.getElementById('player-count').textContent = room.players.length;
    document.getElementById('waiting-indicator').style.display = room.players.length > 1 ? 'none' : 'flex';
    var settingsSection = document.getElementById('settings-section');
    if (isHost) { settingsSection.style.display = 'block'; renderSettings(); renderRolesPreview(); renderColorPicker(room.players); updateStartButton(room.players.length); }
    else { settingsSection.style.display = 'none'; }
}

function updatePlayersList(players) {
    var list = document.getElementById('players-list'); list.innerHTML = '';
    players.forEach(function(player) {
        var div = document.createElement('div');
        if (window.TGCOCosmetics && player.cosmetics) {
            div.innerHTML = window.TGCOCosmetics.renderPlayerCard({ name: player.name, cosmetics: player.cosmetics, isPremium: player.isPremium, isHost: player.isHost, isMe: player.name === playerName });
            if (isHost && !player.isHost && player.name !== playerName) { var kickBtn = document.createElement('button'); kickBtn.className = 'kick-btn'; kickBtn.textContent = 'Kick'; kickBtn.onclick = function() { confirmKick(player); }; div.querySelector('.player-card') && div.querySelector('.player-card').appendChild(kickBtn); }
        } else {
            div.className = 'player-item' + (player.isHost ? ' is-host' : '');
            var initial = player.name.charAt(0).toUpperCase();
            var badges = [];
            if (player.isHost) badges.push('<span class="player-badge host">üëë HOST</span>');
            if (player.color) { var colorMap = {red:'#ef4444',green:'#22c55e',yellow:'#eab308',blue:'#3b82f6'}; badges.push('<span class="player-badge" style="background:' + (colorMap[player.color]||player.color) + ';color:white">' + player.color.toUpperCase() + '</span>'); }
            var avatarStyle = player.isPremium ? 'background:linear-gradient(135deg,#fbbf24,#f59e0b);' : '';
            if (player.color) { var colorMap = {red:'#ef4444',green:'#22c55e',yellow:'#eab308',blue:'#3b82f6'}; avatarStyle = 'background:' + (colorMap[player.color] || player.color) + ';'; }
            div.innerHTML = '<div class="player-avatar" style="' + avatarStyle + '">' + initial + '</div><div class="player-info"><div class="player-name ' + (player.isPremium ? 'premium' : '') + '">' + player.name + '</div>' + (badges.length ? '<div class="player-badges">' + badges.join('') + '</div>' : '') + '</div>' + (isHost && !player.isHost && player.name !== playerName ? '<button class="kick-btn">Kick</button>' : '');
            var kickBtn = div.querySelector('.kick-btn'); if (kickBtn) kickBtn.onclick = function() { confirmKick(player); };
        }
        list.appendChild(div);
    });
}

function renderSettings() {
    var container = document.getElementById('settings-container');
    if (!gameConfig.settings || !gameConfig.settings.length) { container.innerHTML = '<p style="color:var(--muted);font-size:0.9rem;text-align:center">Default settings.</p>'; return; }
    var html = '';
    gameConfig.settings.forEach(function(s) {
        if (s.type === 'select') { html += '<div class="setting-group"><label class="setting-label">' + s.label + '</label><select id="setting-' + s.id + '" onchange="updateSetting(\'' + s.id + '\',this.value)">'; s.options.forEach(function(o) { html += '<option value="' + o.value + '">' + o.text + '</option>'; }); html += '</select></div>'; }
        else if (s.type === 'toggle') { html += '<div class="setting-group"><div class="toggle-row"><span class="toggle-label">' + s.label + '</span><div class="toggle' + (s.default ? ' active' : '') + '" id="setting-' + s.id + '" onclick="toggleSetting(\'' + s.id + '\')"></div></div></div>'; }
    });
    container.innerHTML = html;
    if (currentRoom && currentRoom.settings) { Object.keys(currentRoom.settings).forEach(function(k) { var el = document.getElementById('setting-' + k); if (el) { if (el.classList.contains('toggle')) { if (currentRoom.settings[k]) el.classList.add('active'); else el.classList.remove('active'); } else { el.value = currentRoom.settings[k]; } } }); }
}

function renderRolesPreview() {
    var container = document.getElementById('roles-preview');
    if (!gameConfig.roles) { container.innerHTML = ''; return; }
    var playerCount = currentRoom ? currentRoom.players.length : 0;
    var html = '<div class="roles-preview"><div class="roles-preview-title">Roles (' + playerCount + ' players)</div><div class="roles-grid">';
    if (gameConfig.roles.good) { gameConfig.roles.good.forEach(function(r) { html += '<span class="role-chip good">‚úì ' + r + '</span>'; }); }
    if (gameConfig.roles.evil) { gameConfig.roles.evil.forEach(function(r) { html += '<span class="role-chip evil">‚úó ' + r + '</span>'; }); }
    if (gameConfig.roles.neutral) { gameConfig.roles.neutral.forEach(function(r) { html += '<span class="role-chip neutral">‚óê ' + r + '</span>'; }); }
    html += '</div></div>'; container.innerHTML = html;
}

function renderColorPicker(players) {
    var section = document.getElementById('color-picker-section'); var picker = document.getElementById('color-picker');
    if (!gameConfig.hasColorPicker) { section.style.display = 'none'; return; }
    section.style.display = 'block';
    var colors = ['red', 'green', 'yellow', 'blue'];
    var takenColors = players.filter(function(p) { return p.color; }).map(function(p) { return p.color; });
    picker.innerHTML = colors.map(function(c) { var taken = takenColors.indexOf(c) !== -1; var selected = selectedColor === c; return '<div class="color-option ' + c + (taken ? ' taken' : '') + (selected ? ' selected' : '') + '" onclick="selectColor(\'' + c + '\',' + taken + ')"></div>'; }).join('');
}

function selectColor(color, taken) { if (taken) return; selectedColor = color; socket.emit('update-player-color', { roomCode: roomCode, color: color }); renderColorPicker(currentRoom ? currentRoom.players : []); }
function updateSetting(id, value) { socket.emit('update-settings', { roomCode: roomCode, settings: { [id]: value } }); }
function toggleSetting(id) { var t = document.getElementById('setting-' + id); t.classList.toggle('active'); socket.emit('update-settings', { roomCode: roomCode, settings: { [id]: t.classList.contains('active') } }); }
function updateStartButton(count) { var btn = document.getElementById('start-btn'); var min = gameConfig.minPlayers, max = gameConfig.maxPlayers; if (count < min) { btn.disabled = true; btn.textContent = 'Need ' + (min - count) + ' More Player' + (min - count > 1 ? 's' : ''); } else if (count > max) { btn.disabled = true; btn.textContent = 'Too Many (Max ' + max + ')'; } else { btn.disabled = false; btn.textContent = 'üöÄ START GAME'; } }
document.getElementById('start-btn').onclick = function() { socket.emit('start-game', { roomCode: roomCode }); };
function copyCode() { navigator.clipboard.writeText(roomCode); showToast('Code copied!'); }
function copyLink() { navigator.clipboard.writeText(window.location.origin + '/lobby.html?game=' + gameType + '&join=' + roomCode); showToast('Link copied!'); }
function showToast(msg) { var t = document.createElement('div'); t.className = 'toast'; t.textContent = msg; document.body.appendChild(t); setTimeout(function() { t.remove(); }, 2500); }
function showHowToPlay() { document.getElementById('htp-title').textContent = gameConfig.displayName; document.getElementById('htp-content').innerHTML = gameConfig.howToPlay || '<p>Coming soon!</p>'; document.getElementById('htp-modal').classList.add('visible'); }
function closeModal(id) { document.getElementById(id).classList.remove('visible'); }
function confirmKick(player) { document.getElementById('confirm-title').textContent = 'Kick Player'; document.getElementById('confirm-message').textContent = 'Remove ' + player.name + '?'; document.getElementById('confirm-btn').onclick = function() { socket.emit('kick-player', { roomCode: roomCode, playerId: player.id }); closeModal('confirm-modal'); }; document.getElementById('confirm-modal').classList.add('visible'); }
document.querySelectorAll('.modal-overlay').forEach(function(o) { o.onclick = function(e) { if (e.target === o) o.classList.remove('visible'); }; });
</script>
<script src="/header.js"></script>
</body>
</html>
