<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Lobby - TheGaming.co</title>
    
    <meta name="description" content="Waiting room - invite friends with your room code!">
    <meta name="robots" content="noindex, nofollow">
    <meta name="theme-color" content="#0a0a0f">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/js/cosmetics.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --accent: #14b8a6;
            --accent-glow: rgba(20, 184, 166, 0.4);
            --accent-soft: rgba(20, 184, 166, 0.12);
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: rgba(255, 255, 255, 0.02);
            --border: rgba(255, 255, 255, 0.08);
            --border-accent: rgba(20, 184, 166, 0.3);
            --text: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.5);
            --gold: #fbbf24;
            --green: #22c55e;
            --red: #ef4444;
        }

        .theme-spyfall { --accent: #14b8a6; --accent-glow: rgba(20, 184, 166, 0.4); --accent-soft: rgba(20, 184, 166, 0.12); --border-accent: rgba(20, 184, 166, 0.3); }
        .theme-word-bomb { --accent: #f43f5e; --accent-glow: rgba(244, 63, 94, 0.4); --accent-soft: rgba(244, 63, 94, 0.12); --border-accent: rgba(244, 63, 94, 0.3); }
        .theme-codenames { --accent: #22c55e; --accent-glow: rgba(34, 197, 94, 0.4); --accent-soft: rgba(34, 197, 94, 0.12); --border-accent: rgba(34, 197, 94, 0.3); }
        .theme-werewolf { --accent: #a855f7; --accent-glow: rgba(168, 85, 247, 0.4); --accent-soft: rgba(168, 85, 247, 0.12); --border-accent: rgba(168, 85, 247, 0.3); }
        .theme-fake-artist { --accent: #ec4899; --accent-glow: rgba(236, 72, 153, 0.4); --accent-soft: rgba(236, 72, 153, 0.12); --border-accent: rgba(236, 72, 153, 0.3); }
        .theme-herd-mentality { --accent: #3b82f6; --accent-glow: rgba(59, 130, 246, 0.4); --accent-soft: rgba(59, 130, 246, 0.12); --border-accent: rgba(59, 130, 246, 0.3); }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* ========== ANIMATED BACKGROUND ========== */
        .bg-container {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .bg-gradient {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(ellipse 80% 50% at 20% 0%, var(--accent-soft) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 90% 100%, var(--accent-soft) 0%, transparent 50%),
                var(--bg-primary);
        }

        .glow-orb {
            position: absolute;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.3;
            animation: orbFloat 25s ease-in-out infinite;
        }

        .glow-orb:nth-child(2) {
            width: 300px;
            height: 300px;
            animation-delay: -12s;
            animation-duration: 30s;
        }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0); }
            33% { transform: translate(60vw, 20vh); }
            66% { transform: translate(30vw, 60vh); }
        }

        .grid-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(var(--border) 1px, transparent 1px),
                linear-gradient(90deg, var(--border) 1px, transparent 1px);
            background-size: 60px 60px;
            opacity: 0.3;
        }

        /* ========== HEADER ========== */
        header {
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 100;
            height: 60px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            background: rgba(10, 10, 15, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }

        .nav-inner {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 8px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .back-btn:hover { 
            background: rgba(239, 68, 68, 0.1); 
            color: var(--red);
            border-color: var(--red);
        }

        .back-btn svg { width: 16px; height: 16px; }

        .header-logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 3px;
            color: white;
            text-decoration: none;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .header-logo::after {
            content: '';
            position: absolute;
            bottom: -2px; left: 0; right: 0;
            height: 2px;
            background: linear-gradient(90deg, #ff6b9d, #4facfe, #a855f7);
        }

        .header-players {
            display: flex;
            align-items: center;
        }

        .profile-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-muted);
            transition: all 0.2s ease;
        }

        .profile-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--accent-soft);
        }

        .profile-btn svg { width: 20px; height: 20px; }

        /* ========== MAIN CONTENT ========== */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 80px 20px 40px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        /* Game Title */
        .game-header {
            text-align: center;
            margin-bottom: 1.5rem;
            width: 100%;
        }

        .game-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            letter-spacing: 5px;
            color: var(--text);
            margin-bottom: 0.25rem;
        }

        .how-to-play-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .how-to-play-btn:hover {
            background: var(--accent-soft);
            color: var(--accent);
            border-color: var(--accent);
        }

        /* ========== ROOM CODE SECTION ========== */
        .room-code-section {
            width: 100%;
            margin-bottom: 1.5rem;
        }

        .room-code-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .room-code-card::before {
            content: '';
            position: absolute;
            top: 0; left: 40px; right: 40px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
        }

        .room-code-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 0.75rem;
        }

        .room-code-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 5rem;
            letter-spacing: 12px;
            color: var(--accent);
            text-shadow: 0 0 60px var(--accent-glow);
            line-height: 1;
            animation: codeGlow 4s ease-in-out infinite;
        }

        @keyframes codeGlow {
            0%, 100% { text-shadow: 0 0 40px var(--accent-glow); }
            50% { text-shadow: 0 0 80px var(--accent-glow), 0 0 120px var(--accent-glow); }
        }

        .room-code-hint {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .room-code-actions {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .copy-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 0.7rem 1.1rem;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .copy-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--accent-soft);
        }

        .copy-btn.copied {
            border-color: var(--green);
            color: var(--green);
            background: rgba(34, 197, 94, 0.1);
        }

        .copy-btn svg { width: 16px; height: 16px; }

        /* ========== PLAYERS SECTION ========== */
        .players-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.25rem;
            width: 100%;
            margin-bottom: 1.5rem;
        }

        .players-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .players-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.15rem;
            letter-spacing: 2px;
            color: var(--text);
        }

        .players-count {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .players-count span { color: var(--accent); font-weight: 800; }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 280px;
            overflow-y: auto;
        }

        .player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.7rem 0.9rem;
            background: var(--bg-card);
            border-radius: 10px;
            border: 1px solid transparent;
            transition: all 0.2s ease;
            animation: slideIn 0.3s ease forwards;
            opacity: 0;
        }

        @keyframes slideIn {
            to { opacity: 1; }
        }

        .player-item:hover { border-color: var(--border); }
        .player-item.is-host { background: var(--accent-soft); border-color: var(--border-accent); }
        .player-item.is-me { border-color: var(--accent); }

        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-avatar {
            width: 32px;
            height: 32px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            color: var(--accent);
        }

        .player-item.is-host .player-avatar {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
        }

        .player-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text);
        }

        .player-name.premium {
            background: linear-gradient(90deg, var(--gold), #f59e0b, var(--gold));
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: goldShimmer 3s linear infinite;
        }

        @keyframes goldShimmer { 0% { background-position: 0% center; } 100% { background-position: 200% center; } }

        .player-badges { display: flex; align-items: center; gap: 6px; }

        .badge {
            font-size: 0.6rem;
            font-weight: 800;
            padding: 0.2rem 0.5rem;
            border-radius: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-host { background: var(--gold); color: var(--bg-primary); }
        .badge-you { background: rgba(255, 255, 255, 0.1); color: var(--text-muted); border: 1px solid var(--border); }

        .kick-btn {
            background: transparent;
            border: 1px solid var(--red);
            color: var(--red);
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            font-size: 0.65rem;
            font-weight: 800;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
            text-transform: uppercase;
        }

        .player-item:hover .kick-btn { opacity: 1; }
        .kick-btn:hover { background: var(--red); color: white; }

        .players-empty {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .players-list::-webkit-scrollbar { width: 5px; }
        .players-list::-webkit-scrollbar-track { background: transparent; }
        .players-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        /* Floating kick button for cosmetics player cards */
        .kick-btn-floating {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: transparent;
            border: 1px solid var(--red);
            color: var(--red);
            font-size: 12px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .player-card:hover .kick-btn-floating,
        .player-item:hover .kick-btn-floating { opacity: 1; }
        .kick-btn-floating:hover { background: var(--red); color: white; }

        /* Make player cards in list relative for kick button positioning */
        .players-list .player-card {
            position: relative;
            margin-bottom: 8px;
        }

        /* ========== SETTINGS SECTION ========== */
        .settings-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.25rem;
            width: 100%;
            margin-bottom: 1.5rem;
        }

        .settings-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 1rem;
        }

        .settings-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 2px;
            color: var(--text);
        }

        .host-badge {
            font-size: 0.55rem;
            font-weight: 800;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            background: var(--gold);
            color: var(--bg-primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .setting-group { margin-bottom: 1rem; }
        .setting-group:last-child { margin-bottom: 0; }

        .setting-label {
            display: block;
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--text-muted);
            margin-bottom: 0.4rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .setting-select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.9rem;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .setting-select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .setting-select option { background: var(--bg-secondary); }

        .setting-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0.75rem;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .setting-checkbox:hover { border-color: var(--accent); }

        .setting-checkbox input {
            width: 18px;
            height: 18px;
            accent-color: var(--accent);
            cursor: pointer;
        }

        .setting-checkbox-text { flex: 1; }
        .setting-checkbox-title { font-weight: 600; font-size: 0.9rem; color: var(--text); }
        .setting-checkbox-desc { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.15rem; }

        .location-preview {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 0.5rem;
            border: 1px solid var(--border);
        }

        .location-preview-title {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .location-tags { display: flex; flex-wrap: wrap; gap: 5px; }

        .location-tag {
            background: var(--accent-soft);
            border: 1px solid var(--border-accent);
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            font-size: 0.7rem;
            color: var(--accent);
            font-weight: 600;
        }

        /* ========== START SECTION ========== */
        .start-section { width: 100%; }

        .min-players-warning {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.25);
            border-radius: 10px;
            padding: 0.9rem;
            text-align: center;
            margin-bottom: 1rem;
            color: var(--red);
            font-size: 0.85rem;
            font-weight: 600;
        }

        .waiting-message {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.25rem;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        .waiting-dots {
            display: inline-flex;
            gap: 4px;
            margin-left: 6px;
        }

        .waiting-dot {
            width: 5px;
            height: 5px;
            background: var(--accent);
            border-radius: 50%;
            animation: dotBounce 1.4s ease-in-out infinite;
        }

        .waiting-dot:nth-child(2) { animation-delay: 0.15s; }
        .waiting-dot:nth-child(3) { animation-delay: 0.3s; }

        @keyframes dotBounce {
            0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
            40% { transform: translateY(-5px); opacity: 1; }
        }

        .btn {
            width: 100%;
            padding: 1rem;
            border-radius: 10px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            letter-spacing: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 20px var(--accent-glow);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px var(--accent-glow);
            filter: brightness(1.1);
        }

        .btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; }

        /* ========== MODAL ========== */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            overflow-y: auto;
        }

        .modal-overlay.visible { display: flex; }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            width: 100%;
            max-width: 480px;
            max-height: calc(100vh - 2rem);
            display: flex;
            flex-direction: column;
            animation: modalIn 0.25s ease;
            box-shadow: 0 0 60px var(--accent-glow);
            margin: auto;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .modal-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.4rem;
            letter-spacing: 2px;
            color: var(--accent);
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s;
        }

        .modal-close:hover { color: var(--text); }

        .modal-body {
            padding: 1.5rem;
            color: var(--text-muted);
            line-height: 1.7;
            overflow-y: auto;
            flex: 1;
        }

        .modal-body h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            color: var(--accent);
            margin-top: 1.25rem;
            margin-bottom: 0.4rem;
            letter-spacing: 1px;
        }

        .modal-body h3:first-child { margin-top: 0; }
        .modal-body p { margin-bottom: 0.75rem; }
        .modal-body ul { margin-left: 1.25rem; margin-bottom: 0.75rem; }
        .modal-body li { margin-bottom: 0.35rem; color: var(--text); }
        .modal-body strong { color: var(--accent); }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
            flex-shrink: 0;
        }

        .modal-btn {
            width: 100%;
            padding: 0.8rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-btn:hover { filter: brightness(1.1); }

        /* Confirm Modal */
        .confirm-modal .modal-body { text-align: center; padding: 2rem 1.5rem; }
        .confirm-modal .modal-message { font-size: 1rem; color: var(--text); margin-bottom: 1.5rem; }
        .confirm-modal .modal-actions { display: flex; gap: 0.75rem; }
        .confirm-modal .modal-btn { flex: 1; }
        .confirm-modal .modal-btn.cancel { background: var(--bg-primary); border: 1px solid var(--border); color: var(--text-muted); }
        .confirm-modal .modal-btn.danger { background: var(--red); }

        /* ========== FOOTER ========== */
        footer { 
            background: #000; 
            position: relative; 
            z-index: 10;
            margin-top: auto; 
        }
        
        .footer-border { 
            height: 3px; 
            background: linear-gradient(90deg, #ff6b9d, #4facfe, #a855f7, #ff6b9d); 
            background-size: 300% 100%; 
            animation: gradientSlide 6s linear infinite; 
        }
        
        @keyframes gradientSlide { 0% { background-position: 0% 50%; } 100% { background-position: 300% 50%; } }
        
        .footer-main { max-width: 1100px; margin: 0 auto; padding: 40px 20px 25px; }
        
        .footer-links { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 30px; 
            margin-bottom: 30px; 
            max-width: 500px; 
            margin-left: auto; 
            margin-right: auto; 
        }
        
        .footer-column { text-align: center; }
        .footer-column h5 { 
            font-family: 'Bebas Neue', sans-serif; 
            font-size: 0.9rem; 
            letter-spacing: 2px; 
            margin-bottom: 12px; 
            color: rgba(255, 255, 255, 0.8); 
        }
        .footer-column ul { list-style: none; display: flex; flex-direction: column; gap: 8px; }
        .footer-column a { color: rgba(255, 255, 255, 0.4); font-size: 0.85rem; transition: color 0.2s ease; text-decoration: none; }
        .footer-column a:hover { color: var(--accent); }
        
        .footer-bottom { padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.06); text-align: center; }
        .footer-copyright { font-size: 0.8rem; color: rgba(255, 255, 255, 0.35); margin-bottom: 10px; }
        .footer-legal { display: flex; justify-content: center; gap: 20px; }
        .footer-legal a { color: rgba(255, 255, 255, 0.35); font-size: 0.75rem; text-decoration: none; transition: color 0.2s; }
        .footer-legal a:hover { color: white; }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 600px) {
            header { height: 56px; padding: 0 16px; }
            .header-logo { font-size: 1.3rem; letter-spacing: 2px; }
            .back-btn { padding: 6px 10px; font-size: 0.75rem; }
            .back-btn span { display: none; }
            
            main { padding: 70px 16px 30px; }

            .game-title { font-size: 2.4rem; }

            .room-code-card { padding: 1.5rem; }
            .room-code-value { font-size: 3.5rem; letter-spacing: 8px; }
            .room-code-actions { flex-direction: column; }
            .copy-btn { width: 100%; justify-content: center; }

            .players-section, .settings-section { padding: 1rem; }
            .player-item { padding: 0.6rem 0.75rem; }
            .player-avatar { width: 28px; height: 28px; font-size: 0.8rem; }
            .player-name { font-size: 0.85rem; }
            .kick-btn { opacity: 1; }

            .btn { padding: 0.9rem; font-size: 1.15rem; }

            .modal { max-height: calc(100vh - 1rem); border-radius: 16px; }
            .modal-header { padding: 1rem 1.25rem; }
            .modal-body { padding: 1.25rem; }
            .modal-footer { padding: 0.85rem 1.25rem; }
            
            .footer-links { grid-template-columns: 1fr; gap: 20px; }
            .footer-main { padding: 30px 20px 20px; }
        }

        @media (max-height: 700px) {
            .modal { max-height: calc(100vh - 1rem); }
            .modal-body { max-height: 50vh; }
        }
    </style>
</head>
<body class="theme-spyfall">

<!-- Animated Background -->
<div class="bg-container">
    <div class="bg-gradient"></div>
    <div class="glow-orb"></div>
    <div class="glow-orb"></div>
    <div class="grid-overlay"></div>
</div>

<!-- Header -->
<header>
    <nav class="nav-inner">
        <a href="/squad-games.html" class="back-btn" id="leave-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
            <span>Leave</span>
        </a>
        <a href="/" class="header-logo">THEGAMING.CO</a>
        <div class="header-players">
            <a href="/profile.html" class="profile-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            </a>
        </div>
    </nav>
</header>

<!-- Main Content -->
<main>
    <!-- Game Header -->
    <div class="game-header">
        <h1 class="game-title" id="game-title">SPY HUNT</h1>
        <button class="how-to-play-btn" onclick="showHowToPlay()">How to Play</button>
    </div>

    <!-- Room Code Section -->
    <div class="room-code-section">
        <div class="room-code-card">
            <div class="room-code-label">Share This Code</div>
            <div class="room-code-value" id="room-code">------</div>
            <div class="room-code-hint">Join at thegaming.co/lobby</div>
            <div class="room-code-actions">
                <button class="copy-btn" id="copy-code-btn" onclick="copyRoomCode()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                    Copy Code
                </button>
                <button class="copy-btn" id="copy-link-btn" onclick="copyLink()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                    Copy Link
                </button>
            </div>
        </div>
    </div>

    <!-- Players Section -->
    <div class="players-section">
        <div class="players-header">
            <h2 class="players-title">Players</h2>
            <div class="players-count"><span id="player-count">0</span>/<span id="max-players">20</span></div>
        </div>
        <div class="players-list" id="players-list">
            <div class="players-empty">Connecting...</div>
        </div>
    </div>

    <!-- Game Settings (Host Only) -->
    <div class="settings-section" id="settings-section" style="display: none;">
        <div class="settings-header">
            <h2 class="settings-title">Settings</h2>
            <span class="host-badge">Host</span>
        </div>
        
        <div class="setting-group" id="category-group">
            <label class="setting-label" id="category-label">Location Pack</label>
            <select class="setting-select" id="category-select" onchange="updateLocationPreview()"></select>
            <div class="location-preview" id="location-preview" style="display: none;">
                <div class="location-preview-title">Included Locations</div>
                <div class="location-tags" id="location-tags"></div>
            </div>
        </div>

        <div class="setting-group" id="two-spies-group" style="display: none;">
            <label class="setting-checkbox" for="two-spies">
                <input type="checkbox" id="two-spies">
                <div class="setting-checkbox-text">
                    <div class="setting-checkbox-title">Two Spies Mode</div>
                    <div class="setting-checkbox-desc">Requires 5+ players</div>
                </div>
            </label>
        </div>
    </div>

    <!-- Start Section -->
    <div class="start-section">
        <div class="min-players-warning" id="min-warning" style="display: none;">
            Need <span id="min-players">4</span> players to start
        </div>
        <div class="waiting-message" id="waiting-message" style="display: none;">
            Waiting for host to start
            <span class="waiting-dots">
                <span class="waiting-dot"></span>
                <span class="waiting-dot"></span>
                <span class="waiting-dot"></span>
            </span>
        </div>
        <button class="btn btn-primary" id="start-btn" onclick="startGame()" style="display: none;">
            Start Game
        </button>
    </div>
</main>

<!-- How to Play Modal -->
<div class="modal-overlay" id="how-to-play-modal">
    <div class="modal">
        <div class="modal-header">
            <h2 class="modal-title" id="modal-title">How to Play</h2>
            <button class="modal-close" onclick="closeModal('how-to-play-modal')">&times;</button>
        </div>
        <div class="modal-body" id="modal-body"></div>
        <div class="modal-footer">
            <button class="modal-btn" onclick="closeModal('how-to-play-modal')">Got It</button>
        </div>
    </div>
</div>

<!-- Confirm Modal -->
<div class="modal-overlay confirm-modal" id="confirm-modal">
    <div class="modal">
        <div class="modal-header">
            <h2 class="modal-title" id="confirm-title">Confirm</h2>
            <button class="modal-close" onclick="closeModal('confirm-modal')">&times;</button>
        </div>
        <div class="modal-body">
            <p class="modal-message" id="confirm-message">Are you sure?</p>
            <div class="modal-actions">
                <button class="modal-btn cancel" onclick="closeModal('confirm-modal')">Cancel</button>
                <button class="modal-btn danger" id="confirm-btn" onclick="confirmAction()">Confirm</button>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer>
    <div class="footer-border"></div>
    <div class="footer-main">
        <div class="footer-links">
            <div class="footer-column">
                <h5>GAMES</h5>
                <ul>
                    <li><a href="/solo.html">Solo</a></li>
                    <li><a href="/squad-games.html">Squad</a></li>
                    <li><a href="/party-games.html">Party</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h5>COMMUNITY</h5>
                <ul>
                    <li><a href="/leaderboards.html">Leaderboards</a></li>
                    <li><a href="/supporters.html">Supporters</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h5>COMPANY</h5>
                <ul>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/contact.html">Contact</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p class="footer-copyright">¬© 2025 TheGaming.co ‚Äî Free party games, forever.</p>
            <div class="footer-legal">
                <a href="/privacy.html">Privacy</a>
                <a href="/terms.html">Terms</a>
            </div>
        </div>
    </div>
</footer>

<script>
    const BACKEND_URL = 'https://web-production-519c7.up.railway.app';
    const socket = io(BACKEND_URL, { transports: ['websocket', 'polling'] });

    const GAMES = {
        'spyfall': {
            displayName: 'SPY HUNT', backendType: 'spyfall', theme: 'theme-spyfall',
            minPlayers: 4, maxPlayers: 20, categoryLabel: 'Location Pack',
            categories: [
                { value: 'random', text: 'üé≤ Random (All)' },
                { value: 'classic', text: 'üèõÔ∏è Classic' },
                { value: 'modern', text: 'üèôÔ∏è Modern Life' },
                { value: 'adult', text: 'üîû Adult (18+)' },
                { value: 'marvel', text: 'ü¶∏ Marvel' },
                { value: 'dc', text: 'ü¶á DC' },
                { value: 'movies', text: 'üé¨ Movies & Shows' },
                { value: 'medieval', text: '‚öîÔ∏è Medieval' },
                { value: 'websites', text: 'üåê Websites' },
                { value: 'popculture', text: 'üì∫ Pop Culture' },
                { value: 'anime', text: 'üéå Anime' },
                { value: 'horror', text: 'üî™ Horror' },
                { value: 'realitytv', text: 'üì∫ Reality TV' },
                { value: 'videogames', text: 'üéÆ Video Games' },
                { value: 'bollywood', text: 'üáÆüá≥ Bollywood' }
            ],
            showTwoSpies: true, showLocationPreview: true,
            howToPlay: `<h3>The Setup</h3><p>One player is randomly chosen as the <strong>Spy</strong>. Everyone else sees a secret location and their role. The Spy sees nothing.</p><h3>How to Play</h3><p>Players take turns asking each other questions. The goal is to identify the Spy without revealing the location.</p><ul><li>Ask questions someone at the location would know</li><li>Answer vaguely to not give away the location</li><li>Watch for suspicious answers</li></ul><h3>Winning</h3><ul><li><strong>Players win</strong> by voting out the Spy</li><li><strong>Spy wins</strong> by guessing the location OR surviving the vote</li></ul>`,
            gameFile: 'games/squad/spyfall.html'
        },
        'word-bomb': {
            displayName: 'WORD BOMB', backendType: 'word-bomb', theme: 'theme-word-bomb',
            minPlayers: 2, maxPlayers: 16, categoryLabel: 'Difficulty',
            categories: [
                { value: 'easy', text: 'Easy' },
                { value: 'medium', text: 'Medium' },
                { value: 'hard', text: 'Hard' }
            ],
            showTwoSpies: false, showLocationPreview: false,
            howToPlay: `<h3>The Game</h3><p>Type a valid word containing the given letter combination before time runs out.</p><h3>Rules</h3><ul><li>Each word can only be used once</li><li>Words must be real English words</li><li>If time runs out, you lose a life</li></ul><h3>Winning</h3><p>Last player standing wins!</p>`,
            gameFile: 'games/squad/word-bomb.html'
        },
        'codenames': {
            displayName: 'CODE WORDS', backendType: 'codenames', theme: 'theme-codenames',
            minPlayers: 4, maxPlayers: 20, categoryLabel: 'Word Pack',
            categories: [{ value: 'standard', text: 'Standard' }, { value: 'duet', text: 'Duet (Co-op)' }],
            showTwoSpies: false, showLocationPreview: false,
            howToPlay: `<h3>Teams</h3><p>Split into Red and Blue teams. Each has one Spymaster and Operatives.</p><h3>Giving Clues</h3><p>Spymasters give a one-word clue and number (e.g., "ANIMALS 3").</p><h3>Winning</h3><ul><li>Find all your words first to win</li><li>Hit the Assassin = instant loss</li></ul>`,
            gameFile: 'games/squad/codenames.html'
        },
        'werewolf': {
            displayName: 'NIGHT WOLF', backendType: 'werewolf', theme: 'theme-werewolf',
            minPlayers: 5, maxPlayers: 20, categoryLabel: 'Mode',
            categories: [{ value: 'standard', text: 'Standard' }],
            showTwoSpies: false, showLocationPreview: false,
            howToPlay: `<h3>Roles</h3><ul><li><strong>Werewolf</strong> ‚Äî Eliminate villagers at night</li><li><strong>Seer</strong> ‚Äî Check one player per night</li><li><strong>Doctor</strong> ‚Äî Protect one player per night</li><li><strong>Villager</strong> ‚Äî Find the wolves</li></ul><h3>Winning</h3><ul><li>Villagers win when all wolves are gone</li><li>Wolves win when they outnumber villagers</li></ul>`,
            gameFile: 'games/squad/werewolf.html'
        },
        'fake-artist': {
            displayName: 'SECRET SKETCH', backendType: 'fake-artist', theme: 'theme-fake-artist',
            minPlayers: 4, maxPlayers: 10, categoryLabel: 'Difficulty',
            categories: [{ value: 'easy', text: 'Easy' }, { value: 'medium', text: 'Medium' }, { value: 'hard', text: 'Hard' }],
            showTwoSpies: false, showLocationPreview: false,
            howToPlay: `<h3>The Setup</h3><p>Everyone except the Fake Artist sees the drawing topic.</p><h3>Drawing</h3><ul><li>Take turns adding ONE stroke</li><li>Fake Artist must blend in</li></ul><h3>Winning</h3><ul><li>Players win by identifying the Fake Artist</li><li>Fake Artist wins by avoiding detection OR guessing the topic</li></ul>`,
            gameFile: 'games/squad/fake-artist.html'
        },
        'herd-mentality': {
            displayName: 'HERD MIND', backendType: 'herd-mentality', theme: 'theme-herd-mentality',
            minPlayers: 3, maxPlayers: 20, categoryLabel: 'Points to Win',
            categories: [{ value: 'quick', text: 'Quick (5)' }, { value: 'standard', text: 'Standard (8)' }, { value: 'marathon', text: 'Marathon (12)' }],
            showTwoSpies: false, showLocationPreview: false,
            howToPlay: `<h3>The Game</h3><p>Answer questions to match the majority.</p><h3>Scoring</h3><ul><li>Match majority = 1 point</li><li>Unique answer = Pink Cow</li></ul><h3>Pink Cow</h3><p>You CAN'T win while holding it!</p>`,
            gameFile: 'games/squad/herd-mentality.html'
        }
    };

    const LOCATION_PACKS = {
        classic: ['Airport', 'Bank', 'Beach', 'Casino', 'Cathedral', 'Circus', 'Hospital', 'Hotel', 'Military Base', 'Movie Studio'],
        modern: ['Coffee Shop', 'Gym', 'Shopping Mall', 'Tech Startup', 'Spa', 'Escape Room', 'Coworking Space'],
        adult: ['Strip Club', 'Vegas Casino', 'Hookah Lounge', 'Wine Tasting', 'Nightclub', 'Speakeasy'],
        marvel: ['Avengers Tower', 'Asgard', 'Wakanda', 'X-Mansion', 'Stark Industries', 'SHIELD'],
        dc: ['Batcave', 'Fortress of Solitude', 'Arkham Asylum', 'Metropolis', 'Gotham City'],
        movies: ['Hogwarts', 'The Shire', 'Death Star', 'Jurassic Park', 'The Matrix'],
        medieval: ['Castle', 'Tavern', 'Blacksmith', 'Market', 'Monastery', 'Tournament'],
        websites: ['Reddit', 'YouTube', 'Discord', 'TikTok', 'Twitter', 'Twitch'],
        popculture: ['Squid Game', 'The Office', 'Friends', 'Stranger Things', 'Among Us'],
        anime: ['U.A. High School', 'Survey Corps HQ', 'Hidden Leaf Village', 'Thousand Sunny', 'Death Note HQ', 'Spirit Bathhouse', 'Demon Slayer Corps', 'Capsule Corp', 'Tokyo Jujutsu High', 'Hunter Exam Site', 'Sword Art Online', 'Ouran Host Club', 'Nerv HQ', 'Fairy Tail Guild', 'Anteiku Coffee Shop'],
        horror: ['Haunted Mansion', 'Camp Crystal Lake', 'Overlook Hotel', 'Elm Street', 'Cabin in the Woods', 'Raccoon City', 'The Conjuring House', 'Haddonfield', 'Saw Trap Room', 'Amityville House', 'The Upside Down', 'Purge Night', 'Silent Hill', 'Texas Chainsaw Farm', 'Shining Hedge Maze'],
        realitytv: ['Love Island Villa', 'Survivor Tribal Council', 'Big Brother House', 'Bachelor Mansion', 'Drag Race Werkroom', 'MasterChef Kitchen', 'The Circle', 'Jersey Shore', 'Amazing Race Pit Stop', 'Hell\'s Kitchen', 'Kardashian Mansion', 'Shark Tank', 'Real World House', 'Too Hot to Handle', 'Queer Eye House'],
        videogames: ['Los Santos (GTA)', 'Hyrule Castle', 'Pokemon Gym', 'Verdansk Warzone', 'Lands Between', 'Rapture (Bioshock)', 'USG Ishimura', 'Aperture Science', 'Hogwarts Legacy', 'Night City', 'Silent Cartographer', 'Firelink Shrine', 'Sanctuary', 'Fortnite Island', 'City 17'],
        bollywood: ['DDLJ Train Platform', 'Bollywood Film Set', 'Big Fat Indian Wedding', '3 Idiots College', 'Mumbai Local Train', 'KJo House Party', 'IPL Stadium', 'Gangs of Wasseypur', 'Goa Beach Party', 'Bigg Boss House', 'Europe Trip (DDLJ)', 'Filmfare Awards', 'Sacred Games Mumbai', 'HAHK Wedding House', 'ZNMD Road Trip']
    };

    const urlParams = new URLSearchParams(window.location.search);
    const roomCode = urlParams.get('room') || localStorage.getItem('tempRoomCode');
    const playerName = localStorage.getItem('tempPlayerName');
    const isPremium = localStorage.getItem('tempIsPremium') === 'true';
    const myCosmetics = JSON.parse(localStorage.getItem('tempCosmetics') || 'null');
    const myUserId = localStorage.getItem('tempUserId') || null;

    let gameType = localStorage.getItem('tempGameType') || 'spyfall';
    let gameConfig = GAMES[gameType] || GAMES['spyfall'];
    let isHost = localStorage.getItem('tempIsHost') === 'true';
    let currentRoom = null;
    let myPlayerId = null;
    let confirmCallback = null;

    document.body.className = gameConfig.theme;
    document.getElementById('room-code').textContent = roomCode || '------';
    document.getElementById('max-players').textContent = gameConfig.maxPlayers;
    updateGameUI();

    socket.on('connect', () => {
        if (roomCode && playerName) {
            socket.emit('rejoin-room', { 
                roomCode, 
                playerName,
                isPremium,
                cosmetics: myCosmetics,
                userId: myUserId
            });
        }
    });

    socket.on('room-joined', (data) => handleRoomUpdate(data.room));
    socket.on('room-state', (data) => { if (data.success) handleRoomUpdate(data.room); });
    socket.on('player-joined', (data) => handleRoomUpdate(data.room));
    socket.on('player-disconnected', (data) => handleRoomUpdate(data.room));
    socket.on('player-kicked', (data) => handleRoomUpdate(data.room));

    socket.on('kicked', (data) => showConfirm('Kicked', data.message, () => window.location.href = '/squad-games.html', false));
    socket.on('host-left', (data) => showConfirm('Host Left', data.message, () => window.location.href = '/squad-games.html', false));
    socket.on('game-started', () => { window.location.href = `${gameConfig.gameFile}?room=${roomCode}`; });
    socket.on('error', (data) => showConfirm('Error', data.message, () => window.location.href = `/lobby.html?game=${gameType}`, false));
    socket.on('join-error', (data) => showConfirm('Cannot Join', data.message, () => window.location.href = `/lobby.html?game=${gameType}`, false));

    function handleRoomUpdate(room) {
        currentRoom = room;
        if (room.gameType && room.gameType !== gameType) {
            gameType = room.gameType;
            gameConfig = GAMES[gameType] || GAMES['spyfall'];
            document.body.className = gameConfig.theme;
            updateGameUI();
        }

        const me = room.players.find(p => p.name === playerName);
        if (me) { myPlayerId = me.id; isHost = me.isHost; }

        updatePlayersList(room.players);
        document.getElementById('player-count').textContent = room.players.length;

        if (isHost) {
            document.getElementById('settings-section').style.display = 'block';
            document.getElementById('start-btn').style.display = 'block';
            document.getElementById('waiting-message').style.display = 'none';

            if (room.players.length < gameConfig.minPlayers) {
                document.getElementById('min-warning').style.display = 'block';
                document.getElementById('min-players').textContent = gameConfig.minPlayers;
                document.getElementById('start-btn').disabled = true;
            } else {
                document.getElementById('min-warning').style.display = 'none';
                document.getElementById('start-btn').disabled = false;
            }

            const twoSpies = document.getElementById('two-spies');
            if (twoSpies) { twoSpies.disabled = room.players.length < 5; if (room.players.length < 5) twoSpies.checked = false; }
        } else {
            document.getElementById('settings-section').style.display = 'none';
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('waiting-message').style.display = 'block';
            document.getElementById('min-warning').style.display = 'none';
        }
    }

    function updatePlayersList(players) {
        const list = document.getElementById('players-list');
        if (!players.length) { list.innerHTML = '<div class="players-empty">No players yet</div>'; return; }

        list.innerHTML = players.map((player, idx) => {
            const isMe = player.name === playerName;
            const playerIsPremium = player.isPremium || false;
            const playerCosmetics = player.cosmetics || {};
            
            // Use cosmetics.js to render the player card
            if (window.TGCOCosmetics) {
                return window.TGCOCosmetics.renderPlayerCard({
                    name: player.name,
                    cosmetics: playerCosmetics,
                    isPremium: playerIsPremium,
                    isHost: player.isHost,
                    isMe: isMe,
                    showEntrance: player.justJoined || false
                }) + (isHost && !player.isHost ? `<button class="kick-btn-floating" onclick="kickPlayer('${player.id}', '${escapeHtml(player.name)}')">‚úï</button>` : '');
            }
            
            // Fallback if cosmetics.js not loaded
            const initial = player.name.replace(/[^a-zA-Z]/g, '')[0]?.toUpperCase() || '?';
            return `
                <div class="player-item ${player.isHost ? 'is-host' : ''} ${isMe ? 'is-me' : ''}" style="animation-delay: ${idx * 0.05}s">
                    <div class="player-info">
                        <div class="player-avatar">${player.isHost ? '‚òÖ' : initial}</div>
                        <span class="player-name">${escapeHtml(player.name)}</span>
                    </div>
                    <div class="player-badges">
                        ${player.isHost ? '<span class="badge badge-host">Host</span>' : ''}
                        ${isMe ? '<span class="badge badge-you">You</span>' : ''}
                        ${isHost && !player.isHost ? `<button class="kick-btn" onclick="kickPlayer('${player.id}', '${escapeHtml(player.name)}')">Kick</button>` : ''}
                    </div>
                </div>
            `;
        }).join('');
    }

    function updateGameUI() {
        document.getElementById('game-title').textContent = gameConfig.displayName;
        document.getElementById('modal-title').textContent = `How to Play ${gameConfig.displayName}`;
        document.getElementById('modal-body').innerHTML = gameConfig.howToPlay;
        document.getElementById('max-players').textContent = gameConfig.maxPlayers;
        document.title = `${gameConfig.displayName} Lobby - TheGaming.co`;

        document.getElementById('category-label').textContent = gameConfig.categoryLabel;
        const select = document.getElementById('category-select');
        select.innerHTML = gameConfig.categories.map(c => `<option value="${c.value}">${c.text}</option>`).join('');

        document.getElementById('two-spies-group').style.display = gameConfig.showTwoSpies ? 'block' : 'none';
        if (gameConfig.showLocationPreview) updateLocationPreview();
        else document.getElementById('location-preview').style.display = 'none';
    }

    function updateLocationPreview() {
        if (!gameConfig.showLocationPreview) return;
        const category = document.getElementById('category-select').value;
        const preview = document.getElementById('location-preview');
        const tags = document.getElementById('location-tags');

        if (category === 'random') {
            preview.style.display = 'block';
            tags.innerHTML = '<span class="location-tag">All packs combined</span>';
        } else if (LOCATION_PACKS[category]) {
            preview.style.display = 'block';
            const locs = LOCATION_PACKS[category];
            tags.innerHTML = locs.slice(0, 8).map(l => `<span class="location-tag">${l}</span>`).join('') + 
                (locs.length > 8 ? `<span class="location-tag">+${locs.length - 8} more</span>` : '');
        } else {
            preview.style.display = 'none';
        }
    }

    function copyRoomCode() {
        navigator.clipboard.writeText(roomCode);
        const btn = document.getElementById('copy-code-btn');
        btn.classList.add('copied');
        btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg> Copied`;
        setTimeout(() => {
            btn.classList.remove('copied');
            btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg> Copy Code`;
        }, 2000);
    }

    function copyLink() {
        const link = `${window.location.origin}/lobby.html?game=${gameType}&join=${roomCode}`;
        navigator.clipboard.writeText(link);
        const btn = document.getElementById('copy-link-btn');
        btn.classList.add('copied');
        btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg> Copied`;
        setTimeout(() => {
            btn.classList.remove('copied');
            btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Copy Link`;
        }, 2000);
    }

    function kickPlayer(playerId, name) {
        showConfirm('Kick Player', `Remove ${name}?`, () => socket.emit('kick-player', { roomCode, playerId }));
    }

    function startGame() {
        const category = document.getElementById('category-select').value;
        const twoSpies = document.getElementById('two-spies')?.checked || false;
        showConfirm('Start Game', 'Everyone ready?', () => socket.emit('start-game', { roomCode, category, twoSpies }));
    }

    function showHowToPlay() { document.getElementById('how-to-play-modal').classList.add('visible'); }

    function closeModal(id) { document.getElementById(id).classList.remove('visible'); }

    function showConfirm(title, message, callback, showCancel = true) {
        document.getElementById('confirm-title').textContent = title;
        document.getElementById('confirm-message').textContent = message;
        document.getElementById('confirm-modal').classList.add('visible');
        document.querySelector('#confirm-modal .cancel').style.display = showCancel ? 'block' : 'none';
        confirmCallback = callback;
    }

    function confirmAction() { closeModal('confirm-modal'); if (confirmCallback) confirmCallback(); }

    document.querySelectorAll('.modal-overlay').forEach(overlay => {
        overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.classList.remove('visible'); });
    });

    function escapeHtml(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }

    window.addEventListener('beforeunload', () => socket.disconnect());
</script>

</body>
</html>
