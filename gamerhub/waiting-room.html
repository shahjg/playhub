<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waiting Room - PlayHub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        body.spyfall {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        /* Animated Background Blobs */
        .blob {
            position: fixed;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.5;
            z-index: 0;
            animation: float 20s infinite ease-in-out;
        }

        .blob-1 {
            width: 300px;
            height: 300px;
            background: rgba(255, 107, 107, 0.4);
            top: -100px;
            left: -100px;
            animation-delay: 0s;
        }

        .blob-2 {
            width: 400px;
            height: 400px;
            background: rgba(78, 205, 196, 0.4);
            bottom: -150px;
            right: -150px;
            animation-delay: 5s;
        }

        .blob-3 {
            width: 250px;
            height: 250px;
            background: rgba(255, 195, 113, 0.4);
            top: 50%;
            left: 50%;
            animation-delay: 10s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(50px, -50px) scale(1.1); }
            66% { transform: translate(-50px, 50px) scale(0.9); }
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 4px solid #000;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
            padding: 1rem 2rem;
            position: relative;
            z-index: 10;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: #000;
            text-decoration: none;
            letter-spacing: 2px;
        }

        /* Main Container */
        .container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem 1rem;
            position: relative;
            z-index: 1;
        }

        .waiting-room-card {
            background: rgba(255, 255, 255, 0.98);
            border: 4px solid #000;
            border-radius: 20px;
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.3);
            padding: 2.5rem;
            max-width: 650px;
            width: 100%;
        }

        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 0.5rem;
            letter-spacing: 2px;
        }

        .game-title {
            text-align: center;
            color: #667eea;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .game-title.spyfall {
            color: #f5576c;
        }

        .how-to-play-btn {
            display: block;
            margin: 0 auto 1.5rem;
            background: #ffd700;
            color: #000;
            border: 3px solid #000;
            border-radius: 20px;
            padding: 0.5rem 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .how-to-play-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.3);
        }

        .room-code-display {
            text-align: center;
            margin-bottom: 2rem;
        }

        .room-code-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .room-code {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            color: #667eea;
            letter-spacing: 4px;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
        }

        .room-code.spyfall {
            color: #f5576c;
        }

        .player-count {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            color: #666;
            margin-bottom: 1.5rem;
        }

        /* Players List */
        .players-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            letter-spacing: 1px;
        }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .player-item {
            background: #f8f9fa;
            border: 3px solid #000;
            border-radius: 10px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }

        .player-item:hover {
            transform: translateX(5px);
        }

        .player-item.host {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        body.spyfall .player-item.host {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .player-number {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            width: 35px;
            height: 35px;
            background: #000;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .player-item.host .player-number {
            background: rgba(255, 255, 255, 0.3);
        }

        .player-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .player-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .player-badge {
            background: #ffd700;
            color: #000;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            border: 2px solid #000;
        }

        .kick-btn {
            background: #ff4757;
            color: white;
            border: 2px solid #000;
            border-radius: 5px;
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .kick-btn:hover {
            background: #ff3838;
            transform: scale(1.05);
        }

        /* Start Section */
        .start-section {
            text-align: center;
        }

        .category-section {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .category-label {
            display: block;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.75rem;
            color: #333;
        }

        .category-select {
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            border: 3px solid #000;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .category-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        body.spyfall .category-select:focus {
            border-color: #f5576c;
            box-shadow: 0 0 0 3px rgba(245, 87, 108, 0.3);
        }

        .category-select option {
            padding: 0.5rem;
        }

        /* Location Preview */
        .location-preview {
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .location-preview h4 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            margin-bottom: 0.75rem;
            color: #667eea;
        }

        body.spyfall .location-preview h4 {
            color: #f5576c;
        }

        .location-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .location-tag {
            background: white;
            border: 2px solid #000;
            border-radius: 5px;
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Two Spies Checkbox */
        .two-spies-section {
            margin-bottom: 1.5rem;
            text-align: left;
            background: #fff3cd;
            border: 3px solid #ffc107;
            border-radius: 10px;
            padding: 1rem;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
        }

        .checkbox-container input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .checkbox-label {
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
        }

        .checkbox-description {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }

        .min-players-warning {
            background: #fff3cd;
            border: 3px solid #ffc107;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            color: #856404;
            font-weight: 600;
        }

        .start-btn {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 2px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 4px solid #000;
            border-radius: 10px;
            padding: 1rem 3rem;
            cursor: pointer;
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
            width: 100%;
        }

        body.spyfall .start-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .start-btn:hover:not(:disabled) {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.3);
        }

        .start-btn:active:not(:disabled) {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
        }

        .start-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* How to Play Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 2rem;
            border: 4px solid #000;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            margin-bottom: 1rem;
            letter-spacing: 2px;
            color: #667eea;
        }

        body.spyfall .modal-header {
            color: #f5576c;
        }

        .modal-body {
            line-height: 1.8;
            color: #333;
        }

        .modal-body h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }

        .modal-body ul {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .modal-body li {
            margin-bottom: 0.5rem;
        }

        .close-modal-btn {
            margin-top: 1.5rem;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 2px;
            background: #667eea;
            color: white;
            border: 3px solid #000;
            border-radius: 10px;
            padding: 0.75rem 2rem;
            cursor: pointer;
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
            width: 100%;
        }

        body.spyfall .close-modal-btn {
            background: #f5576c;
        }

        .close-modal-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.3);
        }

        /* Custom Confirmation Modal */
        .custom-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s;
        }

        .custom-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
        }

        .custom-modal-content {
            position: relative;
            background: white;
            border: 4px solid #000;
            border-radius: 15px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s;
        }

        .custom-modal-header {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            letter-spacing: 2px;
            color: #667eea;
        }

        body.spyfall .custom-modal-header {
            color: #f5576c;
        }

        .custom-modal-body {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            color: #333;
        }

        .custom-modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .custom-modal-btn {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 1px;
            padding: 0.75rem 2rem;
            border: 3px solid #000;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .custom-modal-btn.cancel {
            background: #f0f0f0;
            color: #333;
        }

        .custom-modal-btn.confirm {
            background: #667eea;
            color: white;
        }

        body.spyfall .custom-modal-btn.confirm {
            background: #f5576c;
        }

        .custom-modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.3);
        }

        .custom-modal-btn.danger {
            background: #ff4757;
            color: white;
        }

        /* Footer */
        footer {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            text-align: center;
            padding: 1.5rem;
            position: relative;
            z-index: 10;
        }

        /* Scrollbar Styling */
        .players-list::-webkit-scrollbar {
            width: 8px;
        }

        .players-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .players-list::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        body.spyfall .players-list::-webkit-scrollbar-thumb {
            background: #f5576c;
        }

        .players-list::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        /* Loading State */
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                padding: 1rem;
            }

            .logo {
                font-size: 1.5rem;
            }

            .waiting-room-card {
                padding: 1.5rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            .room-code {
                font-size: 2.2rem;
            }

            .player-name {
                font-size: 0.95rem;
            }

            .player-number {
                font-size: 1.2rem;
                width: 30px;
                height: 30px;
            }

            .modal-content {
                margin: 10% auto;
                padding: 1.5rem;
            }

            .start-btn {
                font-size: 1.3rem;
                padding: 0.9rem 2rem;
            }

            .custom-modal-actions {
                flex-direction: column;
            }

            .custom-modal-btn {
                width: 100%;
            }

            .location-tag {
                font-size: 0.75rem;
                padding: 0.3rem 0.6rem;
            }
        }

        @media (max-width: 480px) {
            .room-code {
                font-size: 1.8rem;
                letter-spacing: 2px;
            }

            .player-item {
                padding: 0.75rem;
            }

            .kick-btn {
                padding: 0.3rem 0.6rem;
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>

    <!-- Header -->
    <header>
        <div class="header-content">
            <a href="index.html" class="logo">PLAYHUB</a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <div class="waiting-room-card">
            <h1>WAITING ROOM</h1>
            <div class="game-title" id="gameTitle">LOADING...</div>
            <button class="how-to-play-btn" onclick="showHowToPlay()">‚ùì How to Play</button>
            
            <div class="room-code-display">
                <div class="room-code-label">Room Code:</div>
                <div class="room-code" id="roomCode">------</div>
            </div>

            <div class="player-count" id="playerCountDisplay">0/15 Players</div>

            <div class="players-section">
                <div class="section-title">Players in Lobby</div>
                <div class="players-list" id="playersList">
                    <div class="loading">Connecting...</div>
                </div>
            </div>

            <div class="start-section" id="startSection" style="display: none;">
                <!-- Category Selection -->
                <div class="category-section" id="categorySection">
                    <label for="gameCategory" class="category-label" id="categoryLabel">Choose Category:</label>
                    <select id="gameCategory" class="category-select" onchange="updateLocationPreview()">
                        <!-- Options will be populated by JavaScript based on game type -->
                    </select>
                    
                    <!-- Location Preview -->
                    <div id="locationPreview" class="location-preview" style="display: none;">
                        <h4>Locations in this pack:</h4>
                        <div id="locationList" class="location-list"></div>
                    </div>
                </div>
                
                <!-- Two Spies Option (Spyfall only) -->
                <div class="two-spies-section" id="twoSpiesSection" style="display: none;">
                    <label class="checkbox-container" for="twoSpiesCheckbox">
                        <input type="checkbox" id="twoSpiesCheckbox">
                        <span class="checkbox-label">üïµÔ∏è Two Spies Mode</span>
                    </label>
                    <div class="checkbox-description">
                        Make the game harder with 2 spies! (Requires 5+ players)
                    </div>
                </div>
                
                <div class="min-players-warning" id="minPlayersWarning">
                    ‚ö†Ô∏è Need at least 3 players to start
                </div>
                <button class="start-btn" id="startBtn" onclick="startGame()" disabled>
                    START GAME
                </button>
            </div>
        </div>
    </div>

    <!-- How to Play Modal -->
    <div id="howToPlayModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="modalHeader">HOW TO PLAY</div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be populated by JavaScript -->
            </div>
            <button class="close-modal-btn" onclick="closeHowToPlay()">GOT IT!</button>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="customModal" class="custom-modal">
        <div class="custom-modal-overlay" onclick="closeCustomModal()"></div>
        <div class="custom-modal-content">
            <div class="custom-modal-header" id="customModalTitle">Confirm</div>
            <div class="custom-modal-body" id="customModalMessage">
                Are you sure?
            </div>
            <div class="custom-modal-actions">
                <button class="custom-modal-btn cancel" id="customModalCancel" onclick="closeCustomModal()">Cancel</button>
                <button class="custom-modal-btn confirm" id="customModalConfirm" onclick="confirmCustomModal()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div>¬© 2024 PlayHub. All games free forever.</div>
    </footer>

    <!-- Socket.io Client -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        const BACKEND_URL = 'https://web-production-519c7.up.railway.app';
        const socket = io(BACKEND_URL);

        // Get room code from URL
        const urlParams = new URLSearchParams(window.location.search);
        const roomCode = urlParams.get('room') || urlParams.get('code');
        const playerName = urlParams.get('name') || localStorage.getItem('playerName');
        
        // Game state
        let isHost = false;
        let gameType = localStorage.getItem('tempGameType') || null;
        let currentRoom = null;
        let modalCallback = null;
        
        // Location packs data for previews
        const locationPacks = {
            classic: ['Airport', 'Bank', 'Beach', 'Casino', 'Cathedral', 'Circus', 'Hospital', 'Hotel', 'Military Base', 'Movie Studio', 'Ocean Liner', 'Passenger Train', 'Pirate Ship', 'Polar Station', 'Police Station', 'Restaurant', 'School', 'Space Station', 'Submarine', 'Supermarket'],
            modern: ['Coffee Shop', 'Gym', 'Shopping Mall', 'Tech Startup', 'Spa', 'Escape Room', 'Coworking Space', 'Food Truck Festival', 'Podcast Studio', 'Airbnb', 'Rock Climbing Gym', 'eSports Arena', 'Pet Store', 'Comic Con', 'Brewery', 'Dog Park'],
            adult: ['Strip Club', 'Las Vegas Casino', 'Hookah Lounge', 'Gentleman\'s Club', 'Wine Tasting', 'Nightclub', 'Bachelor Party', 'Bachelorette Party', 'Poker Tournament', 'Speakeasy Bar', 'Tattoo Parlor', 'Music Festival', 'Boxing Gym', 'Dive Bar', 'Swingers Club', 'Massage Parlor'],
            marvel: ['Avengers Tower', 'Asgard', 'Wakanda', 'X-Mansion', 'Stark Industries', 'S.H.I.E.L.D. Helicarrier', 'Sanctum Sanctorum', 'Knowhere', 'Hydra Base', 'Daily Bugle', 'Sokovia', 'Kamar-Taj', 'Ravager Ship', 'Titan', 'TVA'],
            dc: ['Batcave', 'Fortress of Solitude', 'Arkham Asylum', 'Metropolis', 'Gotham City', 'Justice League Watchtower', 'Themyscira', 'Atlantis', 'Central City', 'LexCorp Tower', 'Hall of Justice', 'Apokolips', 'Oa', 'Smallville', 'Wayne Manor'],
            movies: ['Hogwarts', 'The Shire', 'Mordor', 'Rivendell', 'Death Star', 'Jurassic Park', 'Titanic', 'The Matrix', 'Pandora', 'Gotham', 'Wonderland', 'Shawshank Prison', 'Fight Club Basement', 'Inception Dream', 'Wakanda'],
            medieval: ['Castle Throne Room', 'Medieval Tavern', 'Blacksmith Forge', 'Medieval Market', 'Monastery', 'Jousting Tournament', 'Castle Dungeon', 'Wizard\'s Tower', 'Knights\' Barracks', 'Royal Banquet', 'Medieval Village', 'Dragon\'s Lair', 'Plague Village', 'Siege Battlefield', 'Enchanted Forest'],
            websites: ['Reddit Office', 'YouTube Studio', 'Discord Server', 'TikTok House', 'Twitter HQ', 'Twitch Stream', 'Amazon Warehouse', 'LinkedIn Office', 'Instagram Influencer Shoot', 'Wikipedia Edit War', 'Steam Game Launch', 'Netflix Office', 'OnlyFans', 'eBay Warehouse', 'Spotify Office'],
            popculture: ['Squid Game', 'The Office', 'Friends Apartment', 'Stranger Things', 'Among Us Ship', 'Minecraft World', 'Fortnite Battle', 'Breaking Bad RV', 'Game of Thrones', 'SpongeBob\'s Bikini Bottom', 'Marvel Snap', 'Wednesday Addams School', 'Ted Lasso Locker Room', 'Last of Us', 'Yellowstone Ranch']
        };
        
        // Game configurations - COMPLETE WITH ALL 4 GAMES
        const gameConfigs = {
            'imposter': {
                title: 'IMPOSTER',
                categoryLabel: 'Choose Word Category:',
                categories: [
                    { value: 'random', text: 'üé≤ Random (All Categories)' },
                    { value: 'food', text: 'üçï Food & Drinks' },
                    { value: 'animals', text: 'ü¶Å Animals' },
                    { value: 'places', text: 'üåç Places' },
                    { value: 'objects', text: 'üì¶ Common Objects' },
                    { value: 'activities', text: '‚öΩ Activities & Sports' },
                    { value: 'nature', text: 'üå≤ Nature' },
                    { value: 'entertainment', text: 'üé¨ Entertainment' },
                    { value: 'spicy', text: 'üî• Spicy/Adult' },
                    { value: 'stereotypes', text: 'üë• Stereotypes' }
                ],
                howToPlay: `
                    <p><strong>Objective:</strong> Find the imposter before it's too late!</p>
                    <h3>Game Setup:</h3>
                    <ul>
                        <li>One player is randomly selected as the <strong>Imposter</strong></li>
                        <li>All other players receive the same secret word</li>
                        <li>The Imposter doesn't know the word</li>
                    </ul>
                    <h3>How to Play:</h3>
                    <ul>
                        <li><strong>Phase 1:</strong> Everyone gives a one-word clue about the secret word</li>
                        <li>The Imposter must blend in without knowing the word!</li>
                        <li><strong>Phase 2:</strong> Vote on who you think is the Imposter</li>
                        <li>You can skip to the next round in rounds 1 & 2 if majority votes to skip</li>
                    </ul>
                    <h3>Winning:</h3>
                    <ul>
                        <li><strong>Players win</strong> if they correctly vote out the Imposter</li>
                        <li><strong>Imposter wins</strong> if an innocent player is voted out</li>
                    </ul>
                `,
                bodyClass: '',
                gameFile: 'game-imposter.html',
                showLocationPreview: false,
                showTwoSpies: false
            },
            'spyfall': {
                title: 'SPYFALL',
                categoryLabel: 'Choose Location Pack:',
                categories: [
                    { value: 'random', text: 'üé≤ Random (All Locations)' },
                    { value: 'classic', text: 'üé≠ Classic (20 Locations)' },
                    { value: 'modern', text: '‚òï Modern Life (16 Locations)' },
                    { value: 'adult', text: 'üîû Adult Only (16 Locations)' },
                    { value: 'marvel', text: '‚ö° Marvel Universe (15 Locations)' },
                    { value: 'dc', text: 'ü¶á DC Universe (15 Locations)' },
                    { value: 'movies', text: 'üé¨ Movies & Shows (15 Locations)' },
                    { value: 'medieval', text: '‚öîÔ∏è Medieval Times (15 Locations)' },
                    { value: 'websites', text: 'üíª Popular Websites (15 Locations)' },
                    { value: 'popculture', text: 'üì∫ Pop Culture (15 Locations)' }
                ],
                howToPlay: `
                    <p><strong>Objective:</strong> Find the spy among you!</p>
                    <h3>Game Setup:</h3>
                    <ul>
                        <li>One (or two) players are randomly selected as the <strong>Spy</strong></li>
                        <li>All other players know the location and have specific roles</li>
                        <li>The Spy doesn't know the location</li>
                    </ul>
                    <h3>How to Play:</h3>
                    <ul>
                        <li><strong>8 minutes:</strong> Players take turns asking each other questions</li>
                        <li>The Spy tries to figure out the location without revealing they don't know it</li>
                        <li>Players try to find the spy without making the location obvious</li>
                        <li><strong>Voting:</strong> Everyone votes on who they think is the Spy</li>
                    </ul>
                    <h3>Two Spies Mode:</h3>
                    <ul>
                        <li>Enable for extra difficulty! Two spies work together</li>
                        <li>Requires at least 5 players</li>
                        <li>Both spies must be caught to win</li>
                    </ul>
                    <h3>Winning:</h3>
                    <ul>
                        <li><strong>Players win</strong> if they correctly vote out the Spy</li>
                        <li><strong>Spy wins</strong> if an innocent player is voted out</li>
                    </ul>
                `,
                bodyClass: 'spyfall',
                gameFile: 'game-spyfall.html',
                showLocationPreview: true,
                showTwoSpies: true
            },
            'werewolf': {
                title: 'WEREWOLF',
                categoryLabel: 'Game Settings:',
                categories: [
                    { value: 'standard', text: 'üê∫ Standard Game' }
                ],
                howToPlay: `
                    <p><strong>Objective:</strong> Villagers must find the werewolves, werewolves must eliminate villagers!</p>
                    <h3>Game Setup:</h3>
                    <ul>
                        <li>Players are assigned roles: <strong>Werewolf</strong>, <strong>Seer</strong>, <strong>Doctor</strong>, or <strong>Villager</strong></li>
                        <li>Number of werewolves depends on player count (1-3 werewolves)</li>
                        <li>Seer can check if someone is a werewolf (4+ players)</li>
                        <li>Doctor can save someone from the werewolves (6+ players)</li>
                    </ul>
                    <h3>How to Play:</h3>
                    <ul>
                        <li><strong>Night Phase:</strong> Werewolves choose a victim, Seer checks a player, Doctor saves someone</li>
                        <li><strong>Day Phase:</strong> Players discuss and vote to eliminate a suspected werewolf</li>
                        <li>Game alternates between night and day</li>
                    </ul>
                    <h3>Winning:</h3>
                    <ul>
                        <li><strong>Villagers win</strong> if all werewolves are eliminated</li>
                        <li><strong>Werewolves win</strong> if they equal or outnumber villagers</li>
                    </ul>
                `,
                bodyClass: '',
                gameFile: 'game-werewolf.html',
                showLocationPreview: false,
                showTwoSpies: false
            },
            'herd-mentality': {
                title: 'HERD MENTALITY',
                categoryLabel: 'Game Settings:',
                categories: [
                    { value: 'standard', text: 'üêÑ Standard (8 points to win)' },
                    { value: 'quick', text: '‚ö° Quick Game (5 points to win)' },
                    { value: 'marathon', text: 'üèÉ Marathon (12 points to win)' }
                ],
                howToPlay: `
                    <p><strong>Objective:</strong> Think like the herd! Be the first to 8 points, but you CAN'T win while holding the Pink Cow!</p>
                    <h3>Game Setup:</h3>
                    <ul>
                        <li>Everyone sees the same question</li>
                        <li>Submit your answer secretly (30 seconds)</li>
                        <li>No one can see what others wrote</li>
                    </ul>
                    <h3>How to Play:</h3>
                    <ul>
                        <li><strong>Question Phase:</strong> Answer questions like "Name a pizza topping"</li>
                        <li><strong>Results:</strong> Answers are revealed and grouped</li>
                        <li><strong>Scoring:</strong> Match the MAJORITY = 1 point!</li>
                        <li><strong>Pink Cow:</strong> If you're the ONLY one with your answer, you get the üêÑ Pink Cow</li>
                    </ul>
                    <h3>The Pink Cow Rule:</h3>
                    <ul>
                        <li>If you have a unique answer, you get the Pink Cow</li>
                        <li>You CAN'T win while holding it!</li>
                        <li>Someone else must get it before you can win</li>
                    </ul>
                    <h3>Winning:</h3>
                    <ul>
                        <li>First to 8 points WITHOUT the Pink Cow wins!</li>
                        <li>Strategy: Think like the majority, not uniquely</li>
                    </ul>
                `,
                bodyClass: '',
                gameFile: 'game-herd-mentality.html',
                showLocationPreview: false,
                showTwoSpies: false
            }
            ,
'codenames': {
    title: 'CODENAMES',
    categoryLabel: 'Game Settings:',
    categories: [
        { value: 'standard', text: 'üïµÔ∏è Standard Game' }
    ],
    howToPlay: `
        <p><strong>Objective:</strong> Find all your team's words!</p>
        <h3>Teams:</h3>
        <ul>
            <li>üî¥ Red Team vs üîµ Blue Team</li>
            <li>Each team has 1 Spymaster + Operatives</li>
        </ul>
        <h3>How to Play:</h3>
        <ul>
            <li>Spymaster gives a clue: "ANIMALS 3"</li>
            <li>Operatives click 3 words they think are animals</li>
            <li>Correct = keep going! Wrong = turn ends</li>
            <li>DON'T click the assassin (black word) = instant loss!</li>
        </ul>
    `,
    bodyClass: '',
    gameFile: 'game-codenames.html',
    showLocationPreview: false,
    showTwoSpies: false
}
        };
        
        // Apply initial game type styling if we have it
        if (gameType) {
            const config = gameConfigs[gameType];
            if (config) {
                applyGameStyling(config);
            }
        }

        console.log('Waiting room initialized:', { roomCode, playerName, gameType });
        
        // Save to localStorage
        if (roomCode) localStorage.setItem('roomCode', roomCode);
        if (playerName) localStorage.setItem('playerName', playerName);

        // Check for valid room code
        if (!roomCode) {
            showCustomAlert('No Room Code', 'No room code provided! Redirecting to lobby...', () => {
                window.location.href = 'lobby.html';
            });
        }
        
        document.getElementById('roomCode').textContent = roomCode;

        function applyGameStyling(config) {
            document.getElementById('gameTitle').textContent = config.title;
            document.getElementById('gameTitle').className = `game-title ${config.bodyClass}`;
            document.getElementById('roomCode').className = `room-code ${config.bodyClass}`;
            document.body.className = config.bodyClass;
        }

        // Custom Modal System
        function showCustomModal(title, message, onConfirm, showCancel = true) {
            document.getElementById('customModalTitle').textContent = title;
            document.getElementById('customModalMessage').textContent = message;
            document.getElementById('customModal').style.display = 'flex';
            
            const cancelBtn = document.getElementById('customModalCancel');
            if (showCancel) {
                cancelBtn.style.display = 'inline-block';
            } else {
                cancelBtn.style.display = 'none';
            }
            
            modalCallback = onConfirm;
        }

        function showCustomAlert(title, message, onClose) {
            showCustomModal(title, message, onClose, false);
        }

        function closeCustomModal() {
            document.getElementById('customModal').style.display = 'none';
            modalCallback = null;
        }

        function confirmCustomModal() {
            if (modalCallback) {
                modalCallback();
            }
            closeCustomModal();
        }

        // Socket connection with better error handling
        socket.on('connect', () => {
            console.log('‚úÖ Connected to server, socket ID:', socket.id);
            
            console.log('üîÑ Rejoining room...');
            socket.emit('rejoin-room', {
                roomCode: roomCode,
                playerName: playerName
            });
        });

        // Connection error
        socket.on('connect_error', (error) => {
            console.error('Connection error:', error);
            document.getElementById('playersList').innerHTML = '<div class="loading">Connection error. Retrying...</div>';
        });

        // Player joined
        socket.on('player-joined', (data) => {
            console.log('Player joined event:', data);
            updateRoomState(data.room);
        });

        // Room joined successfully
        socket.on('room-joined', (data) => {
            console.log('‚úÖ Room joined event:', data);
            updateRoomState(data.room);
        });

        // Room state received
        socket.on('room-state', (data) => {
            console.log('Room state received:', data);
            if (data.success) {
                updateRoomState(data.room);
            }
        });

        // Player disconnected
        socket.on('player-disconnected', (data) => {
            console.log('Player disconnected:', data);
            updateRoomState(data.room);
        });

        // Player kicked
        socket.on('player-kicked', (data) => {
            console.log('Player kicked:', data);
            updateRoomState(data.room);
        });

        // You were kicked
        socket.on('kicked', (data) => {
            showCustomAlert('Kicked', data.message, () => {
                window.location.href = 'party-games.html';
            });
        });

        // Host left
        socket.on('host-left', (data) => {
            showCustomAlert('Host Left', data.message, () => {
                window.location.href = 'party-games.html';
            });
        });

        // Game started
        socket.on('game-started', (data) => {
            console.log('Game started, redirecting...');
            const config = gameConfigs[data.gameType];
            if (config) {
                window.location.href = `${config.gameFile}?room=${roomCode}`;
            } else {
                window.location.href = `game-${data.gameType}.html?room=${roomCode}`;
            }
        });

        // Error handling with custom alerts
        socket.on('error', (data) => {
            console.error('Socket error:', data);
            showCustomAlert('Error', data.message + '\n\nRedirecting to lobby...', () => {
                const gameType = localStorage.getItem('tempGameType') || 'imposter';
                window.location.href = `lobby.html?game=${gameType}`;
            });
        });

        socket.on('join-error', (data) => {
            console.error('Join error:', data);
            showCustomAlert('Cannot Join', data.message + '\n\nRedirecting to lobby...', () => {
                const gameType = localStorage.getItem('tempGameType') || 'imposter';
                window.location.href = `lobby.html?game=${gameType}`;
            });
        });

        // Update room state and UI
        function updateRoomState(room) {
            console.log('Updating room state:', room);
            
            currentRoom = room;
            gameType = room.gameType;
            
            // Store game type in localStorage for reconnections
            localStorage.setItem('tempGameType', gameType);
            
            // Update game type display
            const config = gameConfigs[gameType] || gameConfigs['imposter'];
            applyGameStyling(config);
            
            // Populate category dropdown
            populateCategoryDropdown(config);
            
            // Show/hide two spies option
            if (config.showTwoSpies) {
                document.getElementById('twoSpiesSection').style.display = 'block';
            } else {
                document.getElementById('twoSpiesSection').style.display = 'none';
            }
            
            // Check if I'm the host
            const myPlayer = room.players.find(p => p.name === playerName);
            if (myPlayer) {
                isHost = myPlayer.isHost;
                console.log('My host status:', isHost);
                
                if (isHost) {
                    document.getElementById('startSection').style.display = 'block';
                }
            }
            
            updatePlayersList(room.players);
        }

        // Populate category dropdown based on game type
        function populateCategoryDropdown(config) {
            const select = document.getElementById('gameCategory');
            const label = document.getElementById('categoryLabel');
            
            label.textContent = config.categoryLabel;
            select.innerHTML = '';
            
            config.categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.value;
                option.textContent = cat.text;
                select.appendChild(option);
            });
            
            // Update location preview if needed
            if (config.showLocationPreview) {
                updateLocationPreview();
            }
        }

        // Update location preview (for Spyfall)
        function updateLocationPreview() {
            const config = gameConfigs[gameType];
            if (!config || !config.showLocationPreview) return;
            
            const category = document.getElementById('gameCategory').value;
            const preview = document.getElementById('locationPreview');
            const locationList = document.getElementById('locationList');
            
            if (category === 'random') {
                // Show all locations
                preview.style.display = 'block';
                locationList.innerHTML = '<div style="color: #666; font-style: italic;">All locations from all packs will be used</div>';
            } else if (locationPacks[category]) {
                // Show locations for this pack
                preview.style.display = 'block';
                locationList.innerHTML = '';
                
                locationPacks[category].forEach(location => {
                    const tag = document.createElement('span');
                    tag.className = 'location-tag';
                    tag.textContent = location;
                    locationList.appendChild(tag);
                });
            } else {
                preview.style.display = 'none';
            }
        }

        // Update players list UI
        function updatePlayersList(players) {
            console.log('Updating players list:', players);
            
            const playersList = document.getElementById('playersList');
            const playerCountDisplay = document.getElementById('playerCountDisplay');
            const startBtn = document.getElementById('startBtn');
            const minPlayersWarning = document.getElementById('minPlayersWarning');
            const twoSpiesCheckbox = document.getElementById('twoSpiesCheckbox');
            
            if (!players || players.length === 0) {
                console.warn('No players to display');
                playersList.innerHTML = '<div class="loading">Waiting for players...</div>';
                return;
            }

            playersList.innerHTML = '';
            
            players.forEach((player, index) => {
                const playerItem = document.createElement('div');
                playerItem.className = `player-item ${player.isHost ? 'host' : ''}`;
                
                const playerInfo = document.createElement('div');
                playerInfo.className = 'player-info';
                
                const playerNumber = document.createElement('div');
                playerNumber.className = 'player-number';
                playerNumber.textContent = index + 1;
                
                const playerNameSpan = document.createElement('span');
                playerNameSpan.className = 'player-name';
                playerNameSpan.textContent = player.name;
                
                playerInfo.appendChild(playerNumber);
                playerInfo.appendChild(playerNameSpan);
                playerItem.appendChild(playerInfo);
                
                const playerActions = document.createElement('div');
                playerActions.className = 'player-actions';
                
                if (player.isHost) {
                    const badge = document.createElement('span');
                    badge.className = 'player-badge';
                    badge.textContent = 'HOST';
                    playerActions.appendChild(badge);
                }
                
                if (isHost && !player.isHost) {
                    const kickBtn = document.createElement('button');
                    kickBtn.className = 'kick-btn';
                    kickBtn.textContent = 'KICK';
                    kickBtn.onclick = () => kickPlayer(player.id, player.name);
                    playerActions.appendChild(kickBtn);
                }
                
                playerItem.appendChild(playerActions);
                playersList.appendChild(playerItem);
            });

            playerCountDisplay.textContent = `${players.length}/15 Players`;

            if (isHost) {
                if (players.length >= 3) {
                    startBtn.disabled = false;
                    minPlayersWarning.style.display = 'none';
                } else {
                    startBtn.disabled = true;
                    minPlayersWarning.style.display = 'block';
                }
                
                // Disable two spies checkbox if less than 5 players
                if (twoSpiesCheckbox) {
                    if (players.length < 5) {
                        twoSpiesCheckbox.checked = false;
                        twoSpiesCheckbox.disabled = true;
                    } else {
                        twoSpiesCheckbox.disabled = false;
                    }
                }
            }
        }

        // Kick player with custom modal
        function kickPlayer(playerId, playerName) {
            showCustomModal(
                'Kick Player',
                `Are you sure you want to kick ${playerName} from the room?`,
                () => {
                    console.log('Kicking player:', playerId);
                    socket.emit('kick-player', {
                        roomCode: roomCode,
                        playerId: playerId
                    });
                }
            );
        }

        // Start game with custom modal
        function startGame() {
            const category = document.getElementById('gameCategory').value;
            const twoSpies = document.getElementById('twoSpiesCheckbox').checked;
            
            showCustomModal(
                'Start Game',
                'Start the game now? All players will be taken to the game screen.',
                () => {
                    console.log('Starting game with category:', category, 'twoSpies:', twoSpies);
                    
                    socket.emit('start-game', {
                        roomCode: roomCode,
                        category: category,
                        twoSpies: twoSpies
                    });
                }
            );
        }

        // Show how to play modal
        function showHowToPlay() {
            const config = gameConfigs[gameType] || gameConfigs['imposter'];
            document.getElementById('modalHeader').textContent = `HOW TO PLAY ${config.title}`;
            document.getElementById('modalBody').innerHTML = config.howToPlay;
            document.getElementById('howToPlayModal').style.display = 'block';
        }

        // Close modal
        function closeHowToPlay() {
            document.getElementById('howToPlayModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('howToPlayModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Handle browser close/refresh
        window.addEventListener('beforeunload', () => {
            socket.disconnect();
        });

        // Debug: Log all socket events
        socket.onAny((eventName, ...args) => {
            console.log('Socket event:', eventName, args);
        });
    </script>
</body>
</html>
