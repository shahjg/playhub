<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Lobby - TheGaming.co</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="/header.css">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&family=Creepster&family=Bangers&family=Fredoka+One&family=Orbitron:wght@700&family=Permanent+Marker&family=Caveat:wght@700&family=Pacifico&display=swap" rel="stylesheet">
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/js/cosmetics.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--accent:#14b8a6;--accent-glow:rgba(20,184,166,0.4);--bg:#0a0a0f;--border:rgba(255,255,255,0.1);--text:#fff;--muted:rgba(255,255,255,0.6);--gold:#fbbf24;--green:#22c55e;--red:#ef4444}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;overflow-x:hidden}
        .bg-container{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
        .bg-base{position:absolute;inset:0}.bg-scene{position:absolute;inset:0}

        /* Loading state */
        .theme-loading{--accent:#666;--accent-glow:rgba(102,102,102,0.4)}
        .theme-loading .bg-base{background:linear-gradient(180deg,#0a0a0f 0%,#12121a 100%)}
        .theme-loading .game-title{opacity:0.3}

        /* GAME THEMES */
        .theme-spyfall{--accent:#14b8a6;--accent-glow:rgba(20,184,166,0.6)}
        .theme-spyfall .bg-base{background:linear-gradient(180deg,#0a2525 0%,#061818 50%,#0a1a1a 100%)}
        .theme-spyfall .bg-scene{background:repeating-linear-gradient(90deg,transparent 0 80px,rgba(20,184,166,0.12) 80px 81px),repeating-linear-gradient(0deg,transparent 0 80px,rgba(20,184,166,0.12) 80px 81px)}
        .theme-spyfall .bg-scene::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:500px;height:500px;background:conic-gradient(from 0deg,transparent 0deg,rgba(20,184,166,0.5) 10deg,transparent 20deg);border-radius:50%;animation:radarSweep 4s linear infinite}
        @keyframes radarSweep{from{transform:translate(-50%,-50%) rotate(0deg)}to{transform:translate(-50%,-50%) rotate(360deg)}}

        .theme-avalon{--accent:#fbbf24;--accent-glow:rgba(251,191,36,0.6)}
        .theme-avalon .bg-base{background:linear-gradient(180deg,#1f1a08 0%,#2a1f0a 40%,#15100a 100%)}
        .theme-avalon .bg-scene::before{content:'';position:absolute;bottom:0;left:0;right:0;height:320px;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1400 300'%3E%3Cpath d='M0 300V150h50V100h40v50h80V80h30V40h40V80h30v70h100V100h30V60h20V30h30V60h20v40h30v50h120V80h40V40h30V80h40v70h100V100h30V60h40v40h30v50h90V80h30V40h20V80h30v70h120v150H0z' fill='%23fbbf24' fill-opacity='0.2'/%3E%3C/svg%3E") bottom center/cover no-repeat}
        .theme-avalon .bg-scene::after{content:'üëë';position:absolute;top:10%;left:50%;transform:translateX(-50%);font-size:120px;opacity:0.2;animation:crownFloat 4s ease-in-out infinite}
        @keyframes crownFloat{0%,100%{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(-15px)}}

        .theme-werewolf{--accent:#a855f7;--accent-glow:rgba(168,85,247,0.6)}
        .theme-werewolf .bg-base{background:linear-gradient(180deg,#1a0a30 0%,#200a38 40%,#0f0520 100%)}
        .theme-werewolf .bg-scene::before{content:'';position:absolute;top:5%;right:10%;width:150px;height:150px;background:radial-gradient(circle,rgba(255,255,220,1) 0%,rgba(255,255,200,0.8) 30%,transparent 70%);border-radius:50%;box-shadow:0 0 80px 40px rgba(255,255,200,0.4),0 0 150px 80px rgba(168,85,247,0.3)}
        .theme-werewolf .bg-scene::after{content:'';position:absolute;bottom:0;left:0;right:0;height:45%;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1400 400'%3E%3Cpath d='M0 400V250c40 0 50-50 80-50s30 40 60 30 50-80 80-70 60 60 90 50 30-60 70-50 40 40 70 30 50-50 80-40 60 30 90 20 30-30 70-20 40 20 60 10 50-30 80-20 60 20 90 10 30-20 70-10 40 10 60 0l100 40v400H0z' fill='%231a0525'/%3E%3C/svg%3E") bottom center/cover no-repeat}
        .theme-werewolf .game-title{font-family:'Creepster',cursive!important;letter-spacing:8px!important}

        .theme-imposter{--accent:#ef4444;--accent-glow:rgba(239,68,68,0.6)}
        .theme-imposter .bg-base{background:linear-gradient(180deg,#250808 0%,#300a0a 40%,#180505 100%)}
        .theme-imposter .bg-scene{background:repeating-linear-gradient(45deg,transparent 0 20px,rgba(239,68,68,0.08) 20px 22px);animation:alertMove 1s linear infinite}
        @keyframes alertMove{from{background-position:0 0}to{background-position:42px 42px}}
        .theme-imposter .bg-scene::before{content:'‚ö†';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:300px;opacity:0.1;animation:alertPulse 1s ease-in-out infinite}
        @keyframes alertPulse{0%,100%{opacity:0.08;transform:translate(-50%,-50%) scale(1)}50%{opacity:0.15;transform:translate(-50%,-50%) scale(1.05)}}

        .theme-fake-artist{--accent:#ec4899;--accent-glow:rgba(236,72,153,0.6)}
        .theme-fake-artist .bg-base{background:linear-gradient(135deg,#250a1d 0%,#0f1825 50%,#1a0a28 100%)}
        .theme-fake-artist .bg-scene::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 15% 25%,rgba(236,72,153,0.5) 0%,transparent 25%),radial-gradient(circle at 85% 20%,rgba(168,85,247,0.4) 0%,transparent 20%),radial-gradient(circle at 80% 75%,rgba(59,130,246,0.4) 0%,transparent 25%),radial-gradient(circle at 20% 70%,rgba(34,197,94,0.35) 0%,transparent 20%);filter:blur(50px)}
        .theme-fake-artist .bg-scene::after{content:'üé®';position:absolute;top:10%;left:50%;transform:translateX(-50%) rotate(-10deg);font-size:140px;opacity:0.25}
        .theme-fake-artist .game-title{background:linear-gradient(90deg,#ec4899,#a855f7,#3b82f6,#22c55e,#eab308,#ec4899)!important;background-size:300% auto;-webkit-background-clip:text!important;-webkit-text-fill-color:transparent!important;animation:rainbowShift 4s linear infinite!important}
        @keyframes rainbowShift{0%{background-position:0% center}100%{background-position:300% center}}

        .theme-codenames{--accent:#dc2626;--accent-glow:rgba(220,38,38,0.5)}
        .theme-codenames .bg-base{background:linear-gradient(180deg,#1a1008 0%,#0f0a05 100%)}
        .theme-codenames .bg-scene::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:500px;height:400px;background:repeating-linear-gradient(90deg,rgba(220,38,38,0.25) 0px,rgba(220,38,38,0.25) 95px,rgba(30,20,10,0.9) 95px,rgba(30,20,10,0.9) 100px),repeating-linear-gradient(0deg,rgba(59,130,246,0.25) 0px,rgba(59,130,246,0.25) 75px,rgba(30,20,10,0.9) 75px,rgba(30,20,10,0.9) 80px);border-radius:12px}
        .theme-codenames .game-title{color:#fbbf24!important}

        .theme-word-bomb{--accent:#f43f5e;--accent-glow:rgba(244,63,94,0.7)}
        .theme-word-bomb .bg-base{background:radial-gradient(circle at 50% 50%,#301010 0%,#250808 40%,#180505 100%)}
        .theme-word-bomb .bg-scene::before{content:'üí£';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:220px;opacity:0.25;animation:bombShake 0.1s ease-in-out infinite}
        @keyframes bombShake{0%,100%{transform:translate(-50%,-50%) rotate(-3deg)}50%{transform:translate(-50%,-50%) rotate(3deg)}}
        .theme-word-bomb .game-title{font-family:'Bangers',cursive!important}

        .theme-wavelength{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-wavelength .bg-base{background:linear-gradient(180deg,#1a1208 0%,#0f0a05 100%)}
        .theme-wavelength .bg-scene::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:400px;height:200px;background:conic-gradient(from 180deg at 50% 100%,#ef4444 0deg,#f97316 30deg,#eab308 60deg,#22c55e 90deg,#3b82f6 120deg,#8b5cf6 150deg,#ec4899 180deg);border-radius:200px 200px 0 0;opacity:0.5}

        .theme-ludo{--accent:#22c55e;--accent-glow:rgba(34,197,94,0.6)}
        .theme-ludo .bg-base{background:#f5f0e1}
        .theme-ludo .bg-scene::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:400px;height:400px;background:conic-gradient(from 0deg at 50% 50%,#ef4444 0deg 90deg,#22c55e 90deg 180deg,#eab308 180deg 270deg,#3b82f6 270deg 360deg);border-radius:20px;box-shadow:inset 0 0 0 20px #f5f0e1}
        .theme-ludo .game-title{font-family:'Fredoka One',cursive!important;color:#1a1a1a!important;text-shadow:none!important}
        .theme-ludo .card{background:rgba(255,255,255,0.95)!important;border-color:rgba(0,0,0,0.1)!important}
        .theme-ludo .section-title,.theme-ludo .room-code-label,.theme-ludo .player-name{color:#1a1a1a!important}
        .theme-ludo .room-code-value{color:#ef4444!important}
        .theme-ludo select,.theme-ludo .input-field{background:rgba(0,0,0,0.05)!important;color:#1a1a1a!important}
        .theme-ludo .btn-start{background:#ef4444!important}
        .theme-ludo .text-muted{color:rgba(0,0,0,0.6)!important}

        .theme-power-struggle{--accent:#dc2626;--accent-glow:rgba(220,38,38,0.6)}
        .theme-power-struggle .bg-base{background:linear-gradient(180deg,#1a0a0a 0%,#250f0f 50%,#0f0505 100%)}
        .theme-power-struggle .bg-scene::before{content:'üí∞';position:absolute;top:45%;left:35%;font-size:100px;opacity:0.2}
        .theme-power-struggle .bg-scene::after{content:'üó°Ô∏è';position:absolute;top:50%;left:55%;font-size:100px;opacity:0.2}
        .theme-power-struggle .game-title{color:#fbbf24!important}

        .theme-insider{--accent:#6366f1;--accent-glow:rgba(99,102,241,0.6)}
        .theme-insider .bg-base{background:radial-gradient(circle at 50% 50%,#151530 0%,#0a0a1a 100%)}
        .theme-insider .bg-scene::before{content:'üîç';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:180px;opacity:0.15}

        .theme-herd-mentality{--accent:#8b5cf6;--accent-glow:rgba(139,92,246,0.6)}
        .theme-herd-mentality .bg-base{background:linear-gradient(180deg,#1a1030 0%,#0f0820 100%)}
        .theme-herd-mentality .bg-scene::before{content:'üêëüêëüêëüêëüêë';position:absolute;bottom:25%;left:50%;font-size:50px;opacity:0.3;animation:sheepWalk 10s linear infinite}
        @keyframes sheepWalk{0%{transform:translateX(-150%)}100%{transform:translateX(150%)}}

        .theme-categories{--accent:#06b6d4;--accent-glow:rgba(6,182,212,0.6)}
        .theme-categories .bg-base{background:linear-gradient(180deg,#0a1a20 0%,#051215 100%)}
        .theme-categories .bg-scene::before{content:'‚ö°';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:250px;opacity:0.15}
        .theme-categories .game-title{font-family:'Orbitron',monospace!important}

        .theme-npat{--accent:#f59e0b;--accent-glow:rgba(245,158,11,0.6)}
        .theme-npat .bg-base{background:linear-gradient(180deg,#251a08 0%,#181008 100%)}
        .theme-npat .game-title{font-family:'Permanent Marker',cursive!important}

        .theme-word-association{--accent:#8b5cf6;--accent-glow:rgba(139,92,246,0.6)}
        .theme-word-association .bg-base{background:linear-gradient(180deg,#1d0a30 0%,#130820 100%)}

        .theme-charades{--accent:#ec4899;--accent-glow:rgba(236,72,153,0.6)}
        .theme-charades .bg-base{background:linear-gradient(180deg,#2a0a1a 0%,#1a0510 100%)}
        .theme-charades .bg-scene::after{content:'üé≠';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:200px;opacity:0.2}
        .theme-charades .game-title{font-family:'Pacifico',cursive!important}

        .theme-celebrity{--accent:#fbbf24;--accent-glow:rgba(251,191,36,0.6)}
        .theme-celebrity .bg-base{background:linear-gradient(180deg,#1a1508 0%,#100a05 100%)}
        .theme-celebrity .bg-scene::before{content:'‚≠ê‚≠ê‚≠ê';position:absolute;top:20%;left:50%;transform:translateX(-50%);font-size:50px;opacity:0.3}

        .theme-fishbowl{--accent:#06b6d4;--accent-glow:rgba(6,182,212,0.6)}
        .theme-fishbowl .bg-base{background:linear-gradient(180deg,#082530 0%,#051a25 50%,#031015 100%)}
        .theme-fishbowl .bg-scene::after{content:'üêü';position:absolute;top:50%;left:50%;font-size:80px;opacity:0.4;animation:fishSwim 4s ease-in-out infinite}
        @keyframes fishSwim{0%,100%{transform:translate(-80%,-50%)}50%{transform:translate(-20%,-50%) scaleX(-1)}}

        .theme-sketch-guess{--accent:#22c55e;--accent-glow:rgba(34,197,94,0.6)}
        .theme-sketch-guess .bg-base{background:#f5f5f0}
        .theme-sketch-guess .bg-scene::after{content:'‚úèÔ∏è';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-45deg);font-size:180px;opacity:0.15}
        .theme-sketch-guess .game-title{color:#1a1a1a!important;text-shadow:none!important;font-family:'Caveat',cursive!important;font-size:4rem!important}
        .theme-sketch-guess .card{background:rgba(255,255,255,0.95)!important}
        .theme-sketch-guess .section-title,.theme-sketch-guess .room-code-label,.theme-sketch-guess .player-name{color:#1a1a1a!important}
        .theme-sketch-guess .room-code-value{color:#22c55e!important}
        .theme-sketch-guess select{background:rgba(0,0,0,0.05)!important;color:#1a1a1a!important}
        .theme-sketch-guess .btn-start{background:#22c55e!important}

        .theme-fools-gold{--accent:#fbbf24;--accent-glow:rgba(251,191,36,0.6)}
        .theme-fools-gold .bg-base{background:linear-gradient(180deg,#251a08 0%,#181005 100%)}
        .theme-fools-gold .bg-scene::after{content:'ü™ôü™ôü™ô';position:absolute;top:50%;left:55%;font-size:60px;opacity:0.25}
        .theme-fools-gold .game-title{color:#fbbf24!important}

        .theme-most-likely-to{--accent:#f43f5e;--accent-glow:rgba(244,63,94,0.6)}
        .theme-most-likely-to .bg-base{background:radial-gradient(circle at 50% 50%,#250a15 0%,#150508 100%)}
        .theme-most-likely-to .bg-scene::before{content:'üëà';position:absolute;top:50%;left:30%;font-size:120px;opacity:0.2}
        .theme-most-likely-to .bg-scene::after{content:'üëâ';position:absolute;top:50%;right:30%;font-size:120px;opacity:0.2}

        .theme-punchline{--accent:#fbbf24;--accent-glow:rgba(251,191,36,0.6)}
        .theme-punchline .bg-base{background:radial-gradient(ellipse 100% 100% at 50% 0%,#302510 0%,#201808 40%,#100a05 100%)}
        .theme-punchline .bg-scene::after{content:'üé§';position:absolute;top:12%;left:50%;transform:translateX(-50%);font-size:100px;opacity:0.3}
        .theme-punchline .game-title{font-family:'Bangers',cursive!important}

        .theme-trivia-royale{--accent:#a855f7;--accent-glow:rgba(168,85,247,0.6)}
        .theme-trivia-royale .bg-base{background:radial-gradient(ellipse 150% 100% at 50% 0%,#281840 0%,#1a1030 40%,#0f0818 100%)}
        .theme-trivia-royale .bg-scene::before{content:'üëë';position:absolute;top:8%;left:50%;transform:translateX(-50%);font-size:130px;opacity:0.35}

        .theme-this-or-that-party{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-this-or-that-party .bg-base{background:linear-gradient(90deg,rgba(59,130,246,0.25) 0%,#0f0f15 30%,#0f0f15 70%,rgba(249,115,22,0.25) 100%)}
        .theme-this-or-that-party .bg-scene::before{content:'VS';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:'Bebas Neue',sans-serif;font-size:200px;opacity:0.1}

        .theme-hot-takes-party{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-hot-takes-party .bg-base{background:linear-gradient(180deg,#301508 0%,#201008 40%,#150805 100%)}
        .theme-hot-takes-party .bg-scene::before{content:'üî•';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:280px;opacity:0.25}

        .theme-never-ever-party{--accent:#ec4899;--accent-glow:rgba(236,72,153,0.6)}
        .theme-never-ever-party .bg-base{background:radial-gradient(ellipse at 50% 100%,#250a1a 0%,#150810 100%)}
        .theme-never-ever-party .bg-scene::before{content:'üôà';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:180px;opacity:0.2}

        .theme-bet-or-bluff{--accent:#10b981;--accent-glow:rgba(16,185,129,0.6)}
        .theme-bet-or-bluff .bg-base{background:linear-gradient(180deg,#0a2518 0%,#081812 100%)}
        .theme-bet-or-bluff .bg-scene::before{content:'üé∞';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:180px;opacity:0.2}

        .theme-broken-pictionary{--accent:#f97316;--accent-glow:rgba(249,115,22,0.6)}
        .theme-broken-pictionary .bg-base{background:linear-gradient(135deg,#251508 0%,#150810 100%)}

        .theme-doodle-duel{--accent:#ec4899;--accent-glow:rgba(236,72,153,0.6)}
        .theme-doodle-duel .bg-base{background:linear-gradient(180deg,#251015 0%,#180a10 100%)}
        .theme-doodle-duel .game-title{font-family:'Caveat',cursive!important;font-size:4rem!important}

        .theme-two-truths{--accent:#22c55e;--accent-glow:rgba(34,197,94,0.6)}
        .theme-two-truths .bg-base{background:linear-gradient(180deg,#0a1a10 0%,#051008 100%)}
        .theme-two-truths .bg-scene::before{content:'‚úì ‚úì ‚úó';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:100px;letter-spacing:40px;opacity:0.15}

        /* LAYOUT */
        main{flex:1;display:flex;align-items:flex-start;justify-content:center;padding:100px 20px 40px;position:relative;z-index:1}
        .container{width:100%;max-width:950px;display:grid;grid-template-columns:1fr 340px;gap:20px}
        @media(max-width:850px){.container{grid-template-columns:1fr;max-width:520px}}

        /* CARDS */
        .card{background:rgba(20,20,30,0.88);border:1px solid var(--border);border-radius:20px;padding:1.5rem;backdrop-filter:blur(20px);position:relative;overflow:hidden}
        .card::before{content:'';position:absolute;top:0;left:20px;right:20px;height:2px;background:linear-gradient(90deg,transparent,var(--accent),transparent)}
        .section-title{font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:3px;color:var(--accent);margin-bottom:1rem;display:flex;align-items:center;gap:10px}

        /* GAME HEADER */
        .game-header{text-align:center;margin-bottom:1rem;grid-column:1/-1}
        .game-title{font-family:'Bebas Neue',sans-serif;font-size:3.2rem;letter-spacing:8px;line-height:1;text-shadow:0 0 80px var(--accent-glow)}
        .game-tagline{color:var(--muted);font-size:0.9rem;margin-top:0.5rem}

        /* ROOM CODE */
        .room-code-card{text-align:center;padding:1.25rem;grid-column:1/-1}
        .room-code-label{font-size:0.7rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:0.4rem}
        .room-code-value{font-family:'Bebas Neue',sans-serif;font-size:2.8rem;letter-spacing:12px;color:var(--accent);text-shadow:0 0 30px var(--accent-glow)}
        .room-code-actions{display:flex;gap:10px;justify-content:center;margin-top:0.75rem;flex-wrap:wrap}
        .copy-btn{display:flex;align-items:center;gap:6px;padding:0.5rem 0.9rem;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.8rem;font-weight:600;cursor:pointer;transition:all 0.2s}
        .copy-btn:hover{border-color:var(--accent);background:var(--accent);color:white}
        .copy-btn svg{width:14px;height:14px}

        /* PLAYERS */
        .players-card{min-height:300px}
        .players-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;flex-wrap:wrap;gap:10px}
        .player-count-wrap{display:flex;align-items:center;gap:8px}
        .player-count{font-family:'Bebas Neue',sans-serif;font-size:1.4rem;color:var(--accent)}
        .player-max{font-size:0.9rem;color:var(--muted)}
        .players-list{display:flex;flex-direction:column;gap:8px;max-height:350px;overflow-y:auto;padding-right:5px}
        .players-list::-webkit-scrollbar{width:4px}
        .players-list::-webkit-scrollbar-thumb{background:var(--accent);border-radius:4px}

        /* PLAYER ITEM */
        .player-item{display:flex;align-items:center;gap:12px;padding:0.7rem 0.9rem;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:12px;transition:all 0.2s}
        .player-item:hover{border-color:rgba(255,255,255,0.2);background:rgba(255,255,255,0.05)}
        .player-item.is-host{border-color:var(--gold);background:rgba(251,191,36,0.08)}
        .player-item.is-host::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--gold);border-radius:3px 0 0 3px}
        .player-avatar{width:38px;height:38px;border-radius:50%;background:linear-gradient(135deg,var(--accent),rgba(255,255,255,0.2));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1rem;flex-shrink:0}
        .player-info{flex:1;min-width:0}
        .player-name{font-weight:600;font-size:0.95rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .player-name.premium{background:linear-gradient(90deg,var(--gold),#f59e0b,#fcd34d,var(--gold));background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:goldShimmer 3s linear infinite;font-weight:700}
        @keyframes goldShimmer{0%{background-position:0% center}100%{background-position:200% center}}
        .player-badges{display:flex;gap:4px;margin-top:2px}
        .player-badge{font-size:0.65rem;padding:0.15rem 0.4rem;border-radius:4px;background:rgba(255,255,255,0.1)}
        .player-badge.host{background:rgba(251,191,36,0.2);color:var(--gold)}
        .player-badge.premium{background:linear-gradient(135deg,rgba(251,191,36,0.3),rgba(245,158,11,0.3));color:var(--gold)}
        .kick-btn{padding:0.35rem 0.6rem;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:6px;color:#ef4444;font-size:0.7rem;font-weight:600;cursor:pointer;opacity:0;transition:all 0.2s}
        .player-item:hover .kick-btn{opacity:1}
        .kick-btn:hover{background:rgba(239,68,68,0.2)}

        /* SETTINGS */
        .settings-card{}
        .setting-group{margin-bottom:1rem}
        .setting-group:last-child{margin-bottom:0}
        .setting-label{display:block;font-size:0.7rem;font-weight:700;color:var(--muted);margin-bottom:0.4rem;text-transform:uppercase;letter-spacing:1.5px}
        select{width:100%;padding:0.7rem 0.9rem;background:rgba(10,10,15,0.9);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;font-family:inherit;cursor:pointer;transition:all 0.2s;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}
        select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(var(--accent),0.2)}
        select option{background:#1a1a2e;color:white;padding:10px}
        .toggle-row{display:flex;align-items:center;justify-content:space-between;padding:0.65rem 0.9rem;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:10px}
        .toggle-label{font-size:0.85rem;font-weight:500}
        .toggle{position:relative;width:42px;height:22px;background:rgba(255,255,255,0.15);border-radius:11px;cursor:pointer;transition:background 0.2s}
        .toggle.active{background:var(--accent)}
        .toggle::after{content:'';position:absolute;top:2px;left:2px;width:18px;height:18px;background:white;border-radius:50%;transition:transform 0.2s;box-shadow:0 2px 4px rgba(0,0,0,0.2)}
        .toggle.active::after{transform:translateX(20px)}
        .roles-preview{margin-top:0.75rem;padding:0.75rem;background:rgba(255,255,255,0.03);border-radius:8px;font-size:0.8rem;color:var(--muted)}
        .roles-preview strong{color:var(--accent)}

        /* START BUTTON */
        .btn-start{width:100%;padding:1rem;background:linear-gradient(135deg,var(--accent),rgba(255,255,255,0.1));border:none;border-radius:12px;color:white;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:3px;cursor:pointer;box-shadow:0 8px 30px var(--accent-glow);transition:all 0.2s;margin-top:1rem;position:relative;overflow:hidden}
        .btn-start::before{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transform:translateX(-100%);transition:transform 0.5s}
        .btn-start:hover:not(:disabled)::before{transform:translateX(100%)}
        .btn-start:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 12px 40px var(--accent-glow)}
        .btn-start:disabled{opacity:0.5;cursor:not-allowed;transform:none}

        /* HOW TO PLAY BUTTON */
        .htp-btn{display:flex;align-items:center;gap:6px;padding:0.45rem 0.75rem;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:8px;color:var(--muted);font-size:0.75rem;font-weight:600;cursor:pointer;transition:all 0.2s}
        .htp-btn:hover{border-color:var(--accent);color:var(--accent);background:rgba(255,255,255,0.08)}
        .htp-btn svg{width:14px;height:14px}

        /* MODAL */
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;align-items:center;justify-content:center;z-index:1000;padding:1rem;backdrop-filter:blur(5px)}
        .modal-overlay.visible{display:flex}
        .modal{background:linear-gradient(180deg,#1a1a2a 0%,#12121a 100%);border:1px solid var(--border);border-radius:24px;width:100%;max-width:550px;max-height:85vh;display:flex;flex-direction:column;box-shadow:0 25px 80px rgba(0,0,0,0.5)}
        .modal-header{padding:1.25rem 1.5rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .modal-title{font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:3px;color:var(--accent)}
        .modal-close{background:none;border:none;color:var(--muted);font-size:1.5rem;cursor:pointer;transition:color 0.2s}
        .modal-close:hover{color:var(--text)}
        .modal-body{padding:1.5rem;color:var(--text);line-height:1.7;overflow-y:auto;font-size:0.95rem}
        .modal-body h3{font-family:'Bebas Neue',sans-serif;color:var(--accent);margin:1.25rem 0 0.6rem;font-size:1.1rem;letter-spacing:2px}
        .modal-body h3:first-child{margin-top:0}
        .modal-body p{margin-bottom:0.6rem;color:var(--muted)}
        .modal-body ul,.modal-body ol{margin-left:1.25rem;margin-bottom:0.6rem}
        .modal-body li{margin-bottom:0.35rem;color:var(--muted)}
        .modal-body strong{color:var(--accent)}
        .modal-body .role-card{display:inline-flex;align-items:center;gap:6px;padding:0.3rem 0.6rem;background:rgba(255,255,255,0.05);border-radius:6px;margin:2px;font-size:0.85rem}
        .modal-body .tip-box{background:rgba(var(--accent),0.1);border-left:3px solid var(--accent);padding:0.75rem 1rem;margin:0.75rem 0;border-radius:0 8px 8px 0}

        /* CONFIRM MODAL */
        .confirm-btns{display:flex;gap:10px;margin-top:1.25rem}
        .confirm-btns button{flex:1;padding:0.75rem;border-radius:10px;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;cursor:pointer;border:none;transition:all 0.2s}
        .btn-confirm{background:var(--red);color:white}
        .btn-confirm:hover{filter:brightness(1.1)}
        .btn-cancel{background:rgba(255,255,255,0.1);color:var(--text);border:1px solid var(--border)}

        /* PARTY MODE */
        .party-mode .players-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:8px;max-height:400px}
        .party-mode .player-item{flex-direction:column;text-align:center;padding:0.6rem}
        .party-mode .player-avatar{margin:0 auto 0.4rem}
        .party-mode .player-info{text-align:center}
        .party-mode .kick-btn{margin-top:0.4rem;opacity:1}

        /* TOAST */
        .toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);padding:0.75rem 1.5rem;background:var(--accent);color:white;border-radius:10px;font-weight:600;z-index:1001;animation:toastIn 0.3s ease;box-shadow:0 10px 30px var(--accent-glow)}
        @keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

        /* WAITING INDICATOR */
        .waiting-indicator{display:flex;align-items:center;justify-content:center;gap:8px;padding:0.75rem;background:rgba(255,255,255,0.03);border-radius:10px;margin-top:0.75rem}
        .waiting-dots{display:flex;gap:4px}
        .waiting-dots span{width:6px;height:6px;background:var(--accent);border-radius:50%;animation:dotPulse 1.4s ease-in-out infinite}
        .waiting-dots span:nth-child(2){animation-delay:0.2s}
        .waiting-dots span:nth-child(3){animation-delay:0.4s}
        @keyframes dotPulse{0%,80%,100%{transform:scale(0.6);opacity:0.5}40%{transform:scale(1);opacity:1}}

        footer{background:#000;position:relative;z-index:10}
        .footer-border{height:4px;background:linear-gradient(90deg,#ff6b9d,#4facfe,#a855f7,#ff6b9d);background-size:300% 100%;animation:gradientSlide 6s linear infinite}
        @keyframes gradientSlide{0%{background-position:0% 50%}100%{background-position:300% 50%}}
        .footer-main{max-width:1100px;margin:0 auto;padding:40px 20px 25px}
        .footer-links{display:grid;grid-template-columns:repeat(3,1fr);gap:30px;margin-bottom:30px;max-width:500px;margin-left:auto;margin-right:auto}
        .footer-column{text-align:center}
        .footer-column h5{font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:2px;margin-bottom:12px;color:rgba(255,255,255,0.8)}
        .footer-column ul{list-style:none;display:flex;flex-direction:column;gap:8px}
        .footer-column a{color:rgba(255,255,255,0.4);font-size:0.85rem;text-decoration:none}
        .footer-bottom{padding-top:20px;border-top:1px solid rgba(255,255,255,0.08);text-align:center}
        .footer-copyright{font-size:0.8rem;color:rgba(255,255,255,0.4)}
        .footer-legal{display:flex;justify-content:center;gap:20px;margin-top:8px}
        .footer-legal a{color:rgba(255,255,255,0.4);font-size:0.75rem;text-decoration:none}

        @media(max-width:600px){
            main{padding:80px 12px 30px}
            .game-title{font-size:2.2rem;letter-spacing:4px}
            .room-code-value{font-size:2rem;letter-spacing:8px}
            .container{gap:12px}
            .card{padding:1rem}
            .modal{max-width:95%}
        }
    </style>
</head>
<body class="theme-loading">
<div class="bg-container"><div class="bg-base"></div><div class="bg-scene"></div></div>
<div id="site-header"></div>

<main>
    <div class="container">
        <div class="game-header">
            <h1 class="game-title" id="game-title">Loading...</h1>
            <p class="game-tagline" id="game-tagline"></p>
        </div>

        <div class="room-code-card card">
            <div class="room-code-label">Share This Code To Invite Friends</div>
            <div class="room-code-value" id="room-code">------</div>
            <div class="room-code-actions">
                <button class="copy-btn" onclick="copyCode()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                    Copy Code
                </button>
                <button class="copy-btn" onclick="copyLink()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                    Copy Link
                </button>
            </div>
        </div>

        <div class="players-card card">
            <div class="players-header">
                <div class="section-title">
                    <span>Players</span>
                    <div class="player-count-wrap">
                        <span class="player-count" id="player-count">0</span>
                        <span class="player-max" id="player-max">/ 10</span>
                    </div>
                </div>
                <button class="htp-btn" onclick="showHowToPlay()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                    How to Play
                </button>
            </div>
            <div class="players-list" id="players-list"></div>
            <div class="waiting-indicator" id="waiting-indicator">
                <div class="waiting-dots"><span></span><span></span><span></span></div>
                <span style="color:var(--muted);font-size:0.85rem">Waiting for players to join...</span>
            </div>
        </div>

        <div class="settings-card card" id="settings-section" style="display:none">
            <div class="section-title">‚öôÔ∏è Host Settings</div>
            <div id="settings-container"></div>
            <div id="roles-preview"></div>
            <button class="btn-start" id="start-btn" disabled>Waiting for Players...</button>
        </div>
    </div>
</main>

<div class="modal-overlay" id="htp-modal">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title" id="htp-title">How To Play</span>
            <button class="modal-close" onclick="closeModal('htp-modal')">&times;</button>
        </div>
        <div class="modal-body" id="htp-content"></div>
    </div>
</div>

<div class="modal-overlay" id="confirm-modal">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title" id="confirm-title">Confirm</span>
            <button class="modal-close" onclick="closeModal('confirm-modal')">&times;</button>
        </div>
        <div class="modal-body">
            <p id="confirm-message"></p>
            <div class="confirm-btns">
                <button class="btn-cancel" onclick="closeModal('confirm-modal')">Cancel</button>
                <button class="btn-confirm" id="confirm-btn">Confirm</button>
            </div>
        </div>
    </div>
</div>

<footer>
    <div class="footer-border"></div>
    <div class="footer-main">
        <div class="footer-links">
            <div class="footer-column"><h5>Games</h5><ul><li><a href="/solo-games.html">Solo</a></li><li><a href="/duos-games.html">Duos</a></li><li><a href="/squad-games.html">Squad</a></li><li><a href="/party-games.html">Party</a></li></ul></div>
            <div class="footer-column"><h5>Account</h5><ul><li><a href="/login.html">Login</a></li><li><a href="/premium.html">Premium</a></li></ul></div>
            <div class="footer-column"><h5>Company</h5><ul><li><a href="/about.html">About</a></li><li><a href="/contact.html">Contact</a></li></ul></div>
        </div>
        <div class="footer-bottom">
            <p class="footer-copyright">¬© 2025 TheGaming.co</p>
            <div class="footer-legal"><a href="/privacy.html">Privacy</a><a href="/terms.html">Terms</a></div>
        </div>
    </div>
</footer>

<script>

    const GAMES = {
        'spyfall': {
            displayName: 'SPY HUNT', tagline: 'Find the spy before they discover your location', theme: 'theme-spyfall', minPlayers: 4, maxPlayers: 12, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/spyfall.html',
            howToPlay: '<h3>üéØ Objective</h3><p>One player is secretly the <strong>Spy</strong> who doesn\'t know the location. Everyone else knows where they are and must identify the Spy through clever questioning.</p><h3>üéÆ How to Play</h3><ol><li>All players except the Spy see the <strong>secret location</strong></li><li>Take turns asking each other questions about the location</li><li>Questions should be specific enough to test knowledge, but vague enough not to reveal the location to the Spy</li><li>The Spy tries to blend in and figure out the location</li></ol><h3>üèÜ Win Conditions</h3><ul><li><strong>Players win</strong> if they correctly vote out the Spy</li><li><strong>Spy wins</strong> if they guess the location OR survive until time runs out</li></ul><div class="tip-box">üí° <strong>Pro Tip:</strong> Ask questions like "What would you wear there?" - specific enough to catch a Spy, vague enough to not give it away!</div>',
            settings: [
                { id: 'category', type: 'select', label: 'Location Pack', options: [{value:'random',text:'üé≤ Random Mix'},{value:'classic',text:'üèõÔ∏è Classic'},{value:'modern',text:'üèôÔ∏è Modern'},{value:'fantasy',text:'üè∞ Fantasy'},{value:'horror',text:'üî™ Horror'},{value:'marvel',text:'ü¶∏ Marvel'},{value:'anime',text:'üéå Anime'},{value:'videogames',text:'üéÆ Video Games'},{value:'movies',text:'üé¨ Movies'},{value:'bollywood',text:'üáÆüá≥ Bollywood'}]},
                { id: 'twoSpies', type: 'toggle', label: 'Two Spies Mode (8+ players)' },
                { id: 'showLocations', type: 'toggle', label: 'Show Location List' },
                { id: 'roundTime', type: 'select', label: 'Round Timer', options: [{value:'5',text:'5 min'},{value:'8',text:'8 min'},{value:'10',text:'10 min'}]}
            ]
        },
        'avalon': {
            displayName: 'SECRET ROLES', tagline: 'Deception and betrayal in Camelot', theme: 'theme-avalon', minPlayers: 5, maxPlayers: 10, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/avalon.html',
            howToPlay: '<h3>‚öîÔ∏è The Battle for Camelot</h3><p>Players are divided into <strong>Loyal Servants</strong> (Good) and <strong>Minions of Mordred</strong> (Evil).</p><h3>üë• Special Roles</h3><p><span class="role-card">üëë Merlin</span> Knows Evil players</p><p><span class="role-card">üó°Ô∏è Assassin</span> Can kill Merlin to win</p><p><span class="role-card">üëÅÔ∏è Percival</span> Knows Merlin</p><p><span class="role-card">üé≠ Morgana</span> Appears as Merlin</p><p><span class="role-card">üë§ Mordred</span> Hidden from Merlin</p><p><span class="role-card">üåë Oberon</span> Evil loner</p><h3>üèÜ Win Conditions</h3><ul><li><strong>Good wins</strong> if 3 quests succeed</li><li><strong>Evil wins</strong> if 3 quests fail OR Assassin kills Merlin</li></ul>',
            settings: [
                { id: 'merlin', type: 'toggle', label: 'Merlin & Assassin', default: true },
                { id: 'percival', type: 'toggle', label: 'Percival' },
                { id: 'morgana', type: 'toggle', label: 'Morgana' },
                { id: 'mordred', type: 'toggle', label: 'Mordred' },
                { id: 'oberon', type: 'toggle', label: 'Oberon' },
                { id: 'ladyOfLake', type: 'toggle', label: 'Lady of the Lake' }
            ]
        },
        'werewolf': {
            displayName: 'MAFIA', tagline: 'Survive the night. Find the killers.', theme: 'theme-werewolf', minPlayers: 6, maxPlayers: 15, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/werewolf.html',
            howToPlay: '<h3>üåô The Night is Dark</h3><p>Mafia eliminates villagers at night. Village must find them during the day.</p><h3>üë• Roles</h3><p><span class="role-card">üî™ Mafia</span> Kill at night</p><p><span class="role-card">üëÅÔ∏è Seer</span> Investigate players</p><p><span class="role-card">üíâ Doctor</span> Protect players</p><p><span class="role-card">üî´ Vigilante</span> Kill once</p><p><span class="role-card">ü§° Jester</span> Wins if voted out</p><h3>üèÜ Win Conditions</h3><ul><li><strong>Village wins</strong> when all Mafia die</li><li><strong>Mafia wins</strong> when they equal villagers</li></ul>',
            settings: [
                { id: 'roleSet', type: 'select', label: 'Role Setup', options: [{value:'basic',text:'üü¢ Basic'},{value:'standard',text:'üü° Standard'},{value:'chaos',text:'üî¥ Chaos'}]},
                { id: 'mafiaCount', type: 'select', label: 'Mafia Count', options: [{value:'auto',text:'Auto'},{value:'1',text:'1'},{value:'2',text:'2'},{value:'3',text:'3'}]},
                { id: 'dayLength', type: 'select', label: 'Day Phase', options: [{value:'3',text:'3 min'},{value:'5',text:'5 min'},{value:'7',text:'7 min'}]},
                { id: 'revealRoles', type: 'toggle', label: 'Reveal roles on death' }
            ]
        },
        'imposter': {
            displayName: 'IMPOSTER', tagline: 'One word at a time. One imposter among you.', theme: 'theme-imposter', minPlayers: 4, maxPlayers: 10, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/imposter.html',
            howToPlay: '<h3>üéØ Blend In</h3><p>Everyone except the <strong>Imposter</strong> sees a word. Give one-word clues to prove you know it!</p><h3>üéÆ Rules</h3><ol><li>Take turns giving <strong>one-word clues</strong></li><li>Imposter must fake it</li><li>Vote to find the Imposter</li></ol><h3>üèÜ Win</h3><ul><li>Players win by voting out Imposter</li><li>Imposter wins by guessing word or surviving</li></ul>',
            settings: [
                { id: 'category', type: 'select', label: 'Word Pack', options: [{value:'random',text:'üé≤ Random'},{value:'food',text:'üçï Food'},{value:'animals',text:'üêæ Animals'},{value:'places',text:'üó∫Ô∏è Places'},{value:'objects',text:'üì¶ Objects'},{value:'spicy',text:'üå∂Ô∏è Spicy'}]},
                { id: 'rounds', type: 'select', label: 'Clue Rounds', options: [{value:'2',text:'2'},{value:'3',text:'3'}]}
            ]
        },
        'codenames': {
            displayName: 'CODEWORDS', tagline: 'Give clues. Find agents. Avoid the assassin.', theme: 'theme-codenames', minPlayers: 4, maxPlayers: 20, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/codenames.html',
            howToPlay: '<h3>üïµÔ∏è Two Teams</h3><p>Spymasters give one-word clues to help their team find words on the grid.</p><h3>‚ö†Ô∏è Cards</h3><p><span class="role-card">üî¥ Red</span> <span class="role-card">üîµ Blue</span> <span class="role-card">‚¨ú Bystander</span> <span class="role-card">üíÄ Assassin</span></p><h3>üèÜ Win</h3><ul><li>Find all your words first</li><li>Avoid the Assassin!</li></ul>',
            settings: [
                { id: 'gridSize', type: 'select', label: 'Grid', options: [{value:'5x5',text:'5√ó5'},{value:'4x4',text:'4√ó4'}]},
                { id: 'turnTimer', type: 'select', label: 'Timer', options: [{value:'none',text:'None'},{value:'90',text:'90s'},{value:'120',text:'2 min'}]}
            ]
        },
        'word-bomb': {
            displayName: 'WORD BOMB', tagline: 'Type fast or explode!', theme: 'theme-word-bomb', minPlayers: 2, maxPlayers: 16, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/word-bomb.html',
            howToPlay: '<h3>üí£ Beat the Clock</h3><p>Type a word containing the letters before the bomb explodes!</p><h3>Rules</h3><ul><li>Real English words only</li><li>Must contain the letter sequence</li><li>No repeating words</li><li>Timer gets faster!</li></ul><h3>üèÜ Last one standing wins!</h3>',
            settings: [
                { id: 'difficulty', type: 'select', label: 'Difficulty', options: [{value:'easy',text:'üü¢ Easy'},{value:'medium',text:'üü° Medium'},{value:'hard',text:'üî¥ Hard'}]},
                { id: 'lives', type: 'select', label: 'Lives', options: [{value:'2',text:'‚ù§Ô∏è‚ù§Ô∏è'},{value:'3',text:'‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è'},{value:'5',text:'‚ù§Ô∏è√ó5'}]},
                { id: 'startTime', type: 'select', label: 'Start Timer', options: [{value:'8',text:'8s'},{value:'10',text:'10s'},{value:'12',text:'12s'}]}
            ]
        },
        'power-struggle': {
            displayName: 'POWER STRUGGLE', tagline: 'Bluff, steal, and survive', theme: 'theme-power-struggle', minPlayers: 3, maxPlayers: 8, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/power-struggle.html',
            howToPlay: '<h3>üëë Claim Power</h3><p>Two hidden cards. Use their powers or bluff!</p><h3>üí∞ Actions</h3><p>Income (1 coin) ‚Ä¢ Foreign Aid (2) ‚Ä¢ Coup (7 to eliminate)</p><h3>üë• Roles</h3><p><span class="role-card">üëë Duke</span> Take 3</p><p><span class="role-card">üó°Ô∏è Assassin</span> Pay 3 to kill</p><p><span class="role-card">üè¥‚Äç‚ò†Ô∏è Captain</span> Steal 2</p><p><span class="role-card">üîÑ Ambassador</span> Exchange cards</p><p><span class="role-card">üë∏ Contessa</span> Block assassin</p>',
            settings: [
                { id: 'startCoins', type: 'select', label: 'Start Coins', options: [{value:'2',text:'2'},{value:'3',text:'3'}]}
            ]
        },
        'sketch-guess': {
            displayName: 'SKETCH & GUESS', tagline: 'Draw it. Guess it fast.', theme: 'theme-sketch-guess', minPlayers: 3, maxPlayers: 16, isPartyGame: false, backUrl: '/squad-games.html', gameFile: '/games/squad/sketch-guess.html',
            howToPlay: '<h3>‚úèÔ∏è Classic Drawing</h3><p>One draws, others race to guess!</p><h3>üèÜ Scoring</h3><ul><li>Guesser: Faster = more points</li><li>Drawer: Points per correct guess</li></ul>',
            settings: [
                { id: 'category', type: 'select', label: 'Category', options: [{value:'random',text:'üé≤ Random'},{value:'animals',text:'üêæ Animals'},{value:'food',text:'üçï Food'},{value:'objects',text:'üì¶ Objects'},{value:'custom',text:'‚úèÔ∏è Custom'}]},
                { id: 'drawTime', type: 'select', label: 'Draw Time', options: [{value:'60',text:'60s'},{value:'80',text:'80s'},{value:'100',text:'100s'}]},
                { id: 'hints', type: 'toggle', label: 'Letter hints' }
            ]
        },
        'fake-artist': { displayName:'FAKE ARTIST', tagline:'One stroke at a time', theme:'theme-fake-artist', minPlayers:4, maxPlayers:10, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/fake-artist.html', howToPlay:'<h3>üé® Collaborative Drawing</h3><p>Everyone draws, but the <strong>Fake Artist</strong> doesn\'t know what!</p><ul><li>One stroke per turn</li><li>Vote to find the faker</li></ul>', settings:[{id:'category',type:'select',label:'Category',options:[{value:'random',text:'üé≤ Random'},{value:'animals',text:'üêæ Animals'},{value:'food',text:'üçï Food'}]}] },
        'wavelength': { displayName:'SPECTRUM', tagline:'Find the hidden target', theme:'theme-wavelength', minPlayers:4, maxPlayers:12, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/wavelength.html', howToPlay:'<h3>üìä The Dial</h3><p>Psychic gives clue for hidden target on spectrum. Team guesses!</p><p>Score: Bullseye 4 | Close 3 | Near 2</p>', settings:[{id:'mode',type:'select',label:'Mode',options:[{value:'coop',text:'Coop'},{value:'teams',text:'Teams'}]},{id:'target',type:'select',label:'Score',options:[{value:'10',text:'10'},{value:'15',text:'15'}]}] },
        'ludo': { displayName:'LUDO', tagline:'Classic board race', theme:'theme-ludo', minPlayers:2, maxPlayers:4, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/ludo.html', howToPlay:'<h3>üé≤ Race Home</h3><p>Roll dice, move tokens. Land on opponents to send them back!</p><ul><li>Roll 6 to enter</li><li>First to get all 4 home wins</li></ul>', settings:[{id:'mode',type:'select',label:'Mode',options:[{value:'classic',text:'Classic'},{value:'quick',text:'Quick'}]}] },
        'insider': { displayName:'INSIDER', tagline:'20 Questions with a twist', theme:'theme-insider', minPlayers:4, maxPlayers:8, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/insider.html', howToPlay:'<h3>üîç Hidden Knowledge</h3><p>Play 20 Questions, but the <strong>Insider</strong> secretly knows the answer!</p>', settings:[{id:'difficulty',type:'select',label:'Difficulty',options:[{value:'easy',text:'Easy'},{value:'hard',text:'Hard'}]}] },
        'herd-mentality': { displayName:'THINK ALIKE', tagline:'Match the majority', theme:'theme-herd-mentality', minPlayers:4, maxPlayers:20, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/herd-mentality.html', howToPlay:'<h3>üêë Think Like Everyone</h3><p>Write answers to questions. Match the majority to score!</p><p>Odd one out gets the Pink Cow (can\'t score!)</p>', settings:[{id:'rounds',type:'select',label:'Rounds',options:[{value:'8',text:'8'},{value:'10',text:'10'},{value:'12',text:'12'}]}] },
        'categories': { displayName:'CATEGORIES', tagline:'Race to answer', theme:'theme-categories', minPlayers:2, maxPlayers:20, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/categories.html', howToPlay:'<h3>‚ö° Speed Matters</h3><p>Category appears - first valid answer wins!</p>', settings:[{id:'rounds',type:'select',label:'Rounds',options:[{value:'10',text:'10'},{value:'15',text:'15'}]}] },
        'word-association': { displayName:'WORD CHAIN', tagline:'Keep it going', theme:'theme-word-association', minPlayers:3, maxPlayers:12, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/word-association.html', howToPlay:'<h3>üîó Chain Reaction</h3><p>Say related words before time runs out!</p>', settings:[{id:'lives',type:'select',label:'Lives',options:[{value:'3',text:'3'},{value:'5',text:'5'}]}] },
        'npat': { displayName:'NAME PLACE ANIMAL THING', tagline:'Classic letter game', theme:'theme-npat', minPlayers:2, maxPlayers:16, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/npat.html', howToPlay:'<h3>üìù Fill Categories</h3><p>Random letter - fill in Name, Place, Animal, Thing!</p><p>Unique: 10 pts | Match: 5 pts</p>', settings:[{id:'rounds',type:'select',label:'Rounds',options:[{value:'5',text:'5'},{value:'10',text:'10'}]}] },
        'charades': { displayName:'CHARADES', tagline:'Act it out', theme:'theme-charades', minPlayers:4, maxPlayers:20, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/charades.html', howToPlay:'<h3>üé≠ Silent Acting</h3><p>Act out words - no sounds allowed!</p>', settings:[{id:'category',type:'select',label:'Category',options:[{value:'random',text:'üé≤ Random'},{value:'movies',text:'üé¨ Movies'},{value:'actions',text:'üèÉ Actions'}]}] },
        'celebrity': { displayName:'CELEBRITY', tagline:'Three rounds of fame', theme:'theme-celebrity', minPlayers:4, maxPlayers:16, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/celebrity.html', howToPlay:'<h3>‚≠ê Three Rounds</h3><ol><li>Describe freely</li><li>One word only</li><li>Act it out</li></ol>', settings:[{id:'names',type:'select',label:'Names/Player',options:[{value:'3',text:'3'},{value:'5',text:'5'}]}] },
        'fishbowl': { displayName:'FISHBOWL', tagline:'Taboo ‚Üí Password ‚Üí Charades', theme:'theme-fishbowl', minPlayers:6, maxPlayers:20, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/fishbowl.html', howToPlay:'<h3>üêü Same Words, Three Ways</h3><ol><li><strong>Taboo:</strong> Describe it</li><li><strong>Password:</strong> One word</li><li><strong>Charades:</strong> Act it</li></ol>', settings:[{id:'words',type:'select',label:'Words/Player',options:[{value:'3',text:'3'},{value:'4',text:'4'}]}] },
        'fools-gold': { displayName:'FOOLS GOLD', tagline:'Spot the truth', theme:'theme-fools-gold', minPlayers:3, maxPlayers:10, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/fools-gold.html', howToPlay:'<h3>ü™ô Bluff</h3><p>Fill in blanks with lies. Find the truth!</p><p>Fool: 100 pts | Truth: 200 pts</p>', settings:[{id:'category',type:'select',label:'Category',options:[{value:'mixed',text:'üé≤ Mixed'},{value:'history',text:'üìú History'}]}] },
        'broken-pictionary': { displayName:'BROKEN PICTIONARY', tagline:'Telephone + Drawing', theme:'theme-broken-pictionary', minPlayers:4, maxPlayers:12, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/broken-pictionary.html', howToPlay:'<h3>‚úèÔ∏è Lost in Translation</h3><p>Draw ‚Üí Describe ‚Üí Draw... Watch it transform!</p>', settings:[] },
        'doodle-duel': { displayName:'DOODLE DUEL', tagline:'Draw and deceive', theme:'theme-doodle-duel', minPlayers:3, maxPlayers:12, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/doodle-duel.html', howToPlay:'<h3>üñåÔ∏è Fake Titles</h3><p>One draws, others write fake titles!</p>', settings:[] },
        'two-truths': { displayName:'TWO TRUTHS ONE LIE', tagline:'Spot the fake', theme:'theme-two-truths', minPlayers:3, maxPlayers:12, isPartyGame:false, backUrl:'/squad-games.html', gameFile:'/games/squad/two-truths.html', howToPlay:'<h3>‚úì‚úì‚úó Truth or Lie</h3><p>Share 2 truths and 1 lie. Others guess!</p>', settings:[] },
        'trivia-royale': { displayName:'TRIVIA ROYALE', tagline:'Battle of brains', theme:'theme-trivia-royale', minPlayers:2, maxPlayers:100, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/trivia-royale.html', howToPlay:'<h3>üëë Knowledge is Power</h3><p>Answer trivia fast! Speed = bonus points.</p><p>Correct: 1000 + speed bonus</p>', settings:[{id:'category',type:'select',label:'Category',options:[{value:'general',text:'üß† General'},{value:'history',text:'üìú History'},{value:'science',text:'üî¨ Science'},{value:'gaming',text:'üéÆ Gaming'},{value:'anime',text:'üéå Anime'},{value:'brainrot',text:'ü§™ Brain Rot'}]},{id:'questions',type:'select',label:'Questions',options:[{value:'10',text:'10'},{value:'15',text:'15'},{value:'20',text:'20'}]}] },
        'most-likely-to': { displayName:'MOST LIKELY TO', tagline:'Who would do it?', theme:'theme-most-likely-to', minPlayers:3, maxPlayers:20, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/most-likely-to.html', howToPlay:'<h3>üëâ Point Fingers</h3><p>Vote who\'s most likely to do each thing!</p>', settings:[{id:'pack',type:'select',label:'Pack',options:[{value:'clean',text:'Clean'},{value:'spicy',text:'üå∂Ô∏è Spicy'}]}] },
        'punchline': { displayName:'PUNCHLINE', tagline:'Write the funniest ending', theme:'theme-punchline', minPlayers:3, maxPlayers:16, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/punchline.html', howToPlay:'<h3>üé§ Comedy Night</h3><p>Write punchlines. Everyone votes!</p>', settings:[{id:'mode',type:'select',label:'Mode',options:[{value:'clean',text:'Clean'},{value:'spicy',text:'üå∂Ô∏è Spicy'}]}] },
        'this-or-that-party': { displayName:'THIS OR THAT', tagline:'Pick a side', theme:'theme-this-or-that-party', minPlayers:2, maxPlayers:100, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/this-or-that-party.html', howToPlay:'<h3>‚öñÔ∏è Choose</h3><p>Pick between options. Match majority to score!</p>', settings:[{id:'pack',type:'select',label:'Pack',options:[{value:'mixed',text:'Mixed'},{value:'hypothetical',text:'Would You Rather'}]}] },
        'hot-takes-party': { displayName:'HOT TAKES', tagline:'Rate the controversy', theme:'theme-hot-takes-party', minPlayers:2, maxPlayers:100, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/hot-takes-party.html', howToPlay:'<h3>üî• Spicy Opinions</h3><p>Rate 1-5. Match the average!</p>', settings:[{id:'spice',type:'select',label:'Spice',options:[{value:'mild',text:'üå∂Ô∏è'},{value:'hot',text:'üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è'}]}] },
        'never-ever-party': { displayName:'NEVER HAVE I EVER', tagline:'Confess or deny', theme:'theme-never-ever-party', minPlayers:2, maxPlayers:100, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/never-ever-party.html', howToPlay:'<h3>üôà Have You Ever...</h3><p>Vote Have or Never. Minority scores more!</p>', settings:[{id:'pack',type:'select',label:'Pack',options:[{value:'clean',text:'Clean'},{value:'spicy',text:'üå∂Ô∏è Spicy'}]}] },
        'bet-or-bluff': { displayName:'BET OR BLUFF', tagline:'Answer then wager', theme:'theme-bet-or-bluff', minPlayers:2, maxPlayers:100, isPartyGame:true, backUrl:'/party-games.html', gameFile:'/games/party/bet-or-bluff.html', howToPlay:'<h3>üé∞ Double or Nothing</h3><p>Answer trivia, then bet on results!</p>', settings:[] }
    };

    // ========== STATE ==========
    const urlParams = new URLSearchParams(window.location.search);
    const roomCode = urlParams.get('room') || localStorage.getItem('tempRoomCode');
    const playerName = localStorage.getItem('tempPlayerName');
    const isPremium = localStorage.getItem('tempIsPremium') === 'true';
    const myCosmetics = JSON.parse(localStorage.getItem('tempCosmetics') || 'null');
    const myUserId = localStorage.getItem('tempUserId') || null;

    let gameType = urlParams.get('game') || localStorage.getItem('tempGameType') || 'spyfall';
    let gameConfig = GAMES[gameType] || GAMES['spyfall'];
    let isHost = localStorage.getItem('tempIsHost') === 'true';
    let currentRoom = null;
    let myPlayerId = null;

    if (!roomCode || !playerName) {
        window.location.href = '/lobby.html?game=' + gameType;
    }

    document.getElementById('room-code').textContent = roomCode || '------';

    // ========== SOCKET ==========
    const BACKEND_URL = 'https://web-production-519c7.up.railway.app';
    const socket = io(BACKEND_URL, { transports: ['websocket', 'polling'], reconnection: true, reconnectionAttempts: 10 });

    socket.on('connect', function() {
        console.log('Connected');
        socket.emit('rejoin-room', { roomCode: roomCode, playerName: playerName, isPremium: isPremium, cosmetics: myCosmetics, odaId: myUserId });
    });

    socket.on('room-joined', function(data) { if (data.success || data.room) handleRoomUpdate(data.room); });
    socket.on('player-joined', function(data) { handleRoomUpdate(data.room); });
    socket.on('player-disconnected', function(data) { handleRoomUpdate(data.room); });
    socket.on('player-kicked', function(data) { handleRoomUpdate(data.room); });
    socket.on('room-settings-updated', function(data) { handleRoomUpdate(data.room); });
    socket.on('host-changed', function(data) { handleRoomUpdate(data.room); });

    socket.on('game-starting', function(data) {
        var config = GAMES[gameType] || GAMES['spyfall'];
        window.location.href = config.gameFile + '?room=' + roomCode;
    });

    socket.on('kicked', function() { alert('You have been kicked.'); window.location.href = gameConfig.backUrl; });
    socket.on('room-not-found', function() { alert('Room not found.'); window.location.href = gameConfig.backUrl; });

    // ========== ROOM UPDATE ==========
    function handleRoomUpdate(room) {
        if (!room) return;
        currentRoom = room;

        if (room.gameType && room.gameType !== gameType) {
            gameType = room.gameType;
            gameConfig = GAMES[gameType] || GAMES['spyfall'];
            localStorage.setItem('tempGameType', gameType);
        }

        document.body.className = gameConfig.theme || 'theme-spyfall';
        if (gameConfig.isPartyGame) document.body.classList.add('party-mode');

        document.getElementById('game-title').textContent = gameConfig.displayName;
        document.getElementById('game-tagline').textContent = gameConfig.tagline || '';
        document.getElementById('player-max').textContent = '/ ' + gameConfig.maxPlayers;

        var me = room.players.find(function(p) { return p.name === playerName; });
        if (me) { myPlayerId = me.id; isHost = me.isHost; }

        updatePlayersList(room.players);
        document.getElementById('player-count').textContent = room.players.length;
        document.getElementById('waiting-indicator').style.display = room.players.length > 1 ? 'none' : 'flex';

        var settingsSection = document.getElementById('settings-section');
        if (isHost) {
            settingsSection.style.display = 'block';
            renderSettings();
            updateStartButton(room.players.length);
        } else {
            settingsSection.style.display = 'none';
        }
    }

    // ========== PLAYERS LIST ==========
    function updatePlayersList(players) {
        var list = document.getElementById('players-list');
        list.innerHTML = '';

        players.forEach(function(player) {
            var div = document.createElement('div');
            div.className = 'player-item' + (player.isHost ? ' is-host' : '');
            div.style.position = 'relative';

            if (window.TGCOCosmetics && player.cosmetics) {
                div.innerHTML = window.TGCOCosmetics.renderPlayerCard(player, { showKick: isHost && !player.isHost && player.name !== playerName });
                var kickBtn = div.querySelector('.kick-btn');
                if (kickBtn) kickBtn.onclick = function() { confirmKick(player); };
            } else {
                var initial = player.name.charAt(0).toUpperCase();
                var badges = [];
                if (player.isHost) badges.push('<span class="player-badge host">üëë HOST</span>');
                if (player.isPremium) badges.push('<span class="player-badge premium">‚≠ê VIP</span>');

                div.innerHTML = '<div class="player-avatar" style="' + (player.isPremium ? 'background:linear-gradient(135deg,#fbbf24,#f59e0b);' : '') + '">' + initial + '</div>' +
                    '<div class="player-info">' +
                        '<div class="player-name ' + (player.isPremium ? 'premium' : '') + '">' + player.name + '</div>' +
                        (badges.length ? '<div class="player-badges">' + badges.join('') + '</div>' : '') +
                    '</div>' +
                    (isHost && !player.isHost && player.name !== playerName ? '<button class="kick-btn">Kick</button>' : '');
                var kickBtn = div.querySelector('.kick-btn');
                if (kickBtn) kickBtn.onclick = function() { confirmKick(player); };
            }
            list.appendChild(div);
        });
    }

    // ========== SETTINGS ==========
    function renderSettings() {
        var container = document.getElementById('settings-container');
        if (!gameConfig.settings || !gameConfig.settings.length) {
            container.innerHTML = '<p style="color:var(--muted);font-size:0.85rem">No additional settings.</p>';
            return;
        }

        var html = '';
        gameConfig.settings.forEach(function(s) {
            if (s.type === 'select') {
                html += '<div class="setting-group"><label class="setting-label">' + s.label + '</label><select id="setting-' + s.id + '" onchange="updateSetting(\'' + s.id + '\',this.value)">';
                s.options.forEach(function(o) { html += '<option value="' + o.value + '">' + o.text + '</option>'; });
                html += '</select></div>';
            } else if (s.type === 'toggle') {
                html += '<div class="setting-group"><div class="toggle-row"><span class="toggle-label">' + s.label + '</span><div class="toggle' + (s.default ? ' active' : '') + '" id="setting-' + s.id + '" onclick="toggleSetting(\'' + s.id + '\')"></div></div></div>';
            }
        });
        container.innerHTML = html;

        if (currentRoom && currentRoom.settings) {
            Object.keys(currentRoom.settings).forEach(function(k) {
                var el = document.getElementById('setting-' + k);
                if (el) {
                    if (el.classList.contains('toggle')) {
                        if (currentRoom.settings[k]) el.classList.add('active'); else el.classList.remove('active');
                    } else {
                        el.value = currentRoom.settings[k];
                    }
                }
            });
        }
    }

    function updateSetting(id, value) { socket.emit('update-settings', { roomCode: roomCode, settings: { [id]: value } }); }
    function toggleSetting(id) {
        var t = document.getElementById('setting-' + id);
        t.classList.toggle('active');
        socket.emit('update-settings', { roomCode: roomCode, settings: { [id]: t.classList.contains('active') } });
    }

    function updateStartButton(count) {
        var btn = document.getElementById('start-btn');
        var min = gameConfig.minPlayers, max = gameConfig.maxPlayers;
        if (count < min) { btn.disabled = true; btn.textContent = 'Need ' + (min - count) + ' More Player' + (min - count > 1 ? 's' : ''); }
        else if (count > max) { btn.disabled = true; btn.textContent = 'Too Many (Max ' + max + ')'; }
        else { btn.disabled = false; btn.textContent = 'üöÄ Start Game'; }
    }

    document.getElementById('start-btn').onclick = function() { socket.emit('start-game', { roomCode: roomCode }); };

    // ========== UTILS ==========
    function copyCode() { navigator.clipboard.writeText(roomCode); showToast('Code copied!'); }
    function copyLink() {
        var link = window.location.origin + '/lobby.html?game=' + gameType + '&join=' + roomCode;
        navigator.clipboard.writeText(link);
        showToast('Link copied!');
    }
    function showToast(msg) {
        var t = document.createElement('div');
        t.className = 'toast'; t.textContent = msg;
        document.body.appendChild(t);
        setTimeout(function() { t.remove(); }, 2500);
    }
    function showHowToPlay() {
        document.getElementById('htp-title').textContent = gameConfig.displayName + ' - How to Play';
        document.getElementById('htp-content').innerHTML = gameConfig.howToPlay || '<p>Instructions coming soon!</p>';
        document.getElementById('htp-modal').classList.add('visible');
    }
    function closeModal(id) { document.getElementById(id).classList.remove('visible'); }
    function confirmKick(player) {
        document.getElementById('confirm-title').textContent = 'Kick Player';
        document.getElementById('confirm-message').textContent = 'Remove ' + player.name + ' from the room?';
        document.getElementById('confirm-btn').onclick = function() { socket.emit('kick-player', { roomCode: roomCode, playerId: player.id }); closeModal('confirm-modal'); };
        document.getElementById('confirm-modal').classList.add('visible');
    }
    document.querySelectorAll('.modal-overlay').forEach(function(o) { o.onclick = function(e) { if (e.target === o) o.classList.remove('visible'); }; });
</script>
<script src="/header.js"></script>
</body>
</html>
