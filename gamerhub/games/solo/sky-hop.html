<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Sky Hop ‚Äì Endless Arcade Game | TheGaming.co</title>
    <meta name="description" content="Tap to fly through the sky! Dodge obstacles and set high scores. Free with global leaderboards.">
    <meta name="theme-color" content="#0a0a0f">
    <link rel="stylesheet" href="/header.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --accent:#38bdf8;--accent-dark:#0284c7;--accent-light:#e0f2fe;
            --pink:#ff6b9d;--blue:#4facfe;--purple:#a855f7;
            --gold:#ffd700;--dark:#0a0a0f;--text-dark:#1a1a2e;--text-muted:#6b7280;
        }
        body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#e0f2fe 0%,#bae6fd 50%,#f0f9ff 100%);color:var(--text-dark);min-height:100vh;display:flex;flex-direction:column}
        h1,h2,h3,h4{font-family:'Bebas Neue',sans-serif;letter-spacing:1px}
        a{color:inherit;text-decoration:none}

        main{flex:1;display:flex;flex-direction:column;padding-top:60px}
        .game-hero{background:radial-gradient(circle at 10% 0%,#0369a1 0%,#075985 50%,#0c4a6e 100%);padding:50px 20px;text-align:center;position:relative;overflow:hidden}
        .game-hero::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 30% 20%,rgba(56,189,248,0.3) 0%,transparent 55%),radial-gradient(circle at 75% 75%,rgba(14,165,233,0.2) 0%,transparent 55%)}
        .game-hero-content{position:relative;z-index:1;max-width:600px;margin:0 auto}
        .game-icon{width:70px;height:70px;margin:0 auto 20px;animation:iconFloat 3s ease-in-out infinite}
        @keyframes iconFloat{0%,100%{transform:translateY(0) rotate(-2deg)}50%{transform:translateY(-8px) rotate(2deg)}}
        .game-hero-title{font-size:clamp(3rem,8vw,4.5rem);line-height:0.95;margin-bottom:10px;background:linear-gradient(135deg,#fff,var(--accent-light),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:3px}
        .game-hero-desc{font-size:1rem;color:rgba(255,255,255,0.7);line-height:1.6}

        .game-wrapper{flex:1;display:flex;flex-direction:column;align-items:center;padding:40px 20px 60px}
        .game-container{width:100%;max-width:500px;display:flex;flex-direction:column;gap:24px}

        .stats-bar{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
        .stat-card{background:#fff;border:2px solid rgba(56,189,248,0.15);border-radius:16px;padding:14px;text-align:center;box-shadow:0 2px 12px rgba(56,189,248,0.08)}
        .stat-label{font-size:0.7rem;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);margin-bottom:4px}
        .stat-value{font-family:'Bebas Neue',sans-serif;font-size:1.6rem;letter-spacing:1px;color:var(--accent)}
        .stat-value.best{color:var(--gold)}

        .game-board{background:#fff;border-radius:24px;border:3px solid rgba(56,189,248,0.2);padding:24px;box-shadow:0 8px 30px rgba(56,189,248,0.12);display:flex;flex-direction:column;align-items:center}
        .canvas-wrapper{position:relative;background:linear-gradient(180deg,#87CEEB 0%,#E0F7FA 100%);border-radius:12px;overflow:hidden}
        #canvas{display:block;border-radius:10px}
        .game-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.85);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px;border-radius:12px}
        .game-overlay.hidden{display:none}
        .overlay-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;letter-spacing:3px;color:#fff;margin-bottom:8px}
        .overlay-title.gameover{color:#ef4444}
        .overlay-title.start{background:linear-gradient(135deg,#fff,var(--accent-light),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .overlay-score{font-family:'Bebas Neue',sans-serif;font-size:4rem;color:var(--gold);margin:16px 0}
        .overlay-text{color:rgba(255,255,255,0.6);font-size:0.9rem;margin-bottom:20px}
        .new-best{color:var(--gold);font-weight:700;margin-bottom:12px}
        .btn{padding:14px 28px;border-radius:50px;border:none;font-weight:700;font-size:0.95rem;cursor:pointer;transition:all 0.3s;text-transform:uppercase;letter-spacing:1px;font-family:'Inter',sans-serif}
        .btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent-dark));color:#fff;box-shadow:0 6px 20px rgba(56,189,248,0.3)}
        .btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(56,189,248,0.4)}

        .tap-hint{margin-top:16px;font-size:0.85rem;color:var(--text-muted);text-align:center}

        .leaderboard-section{background:#fff;border:2px solid rgba(56,189,248,0.2);border-radius:20px;padding:24px;box-shadow:0 8px 30px rgba(56,189,248,0.12)}
        .lb-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid rgba(56,189,248,0.15);flex-wrap:wrap;gap:12px}
        .lb-title{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:2px}
        .lb-tabs{display:flex;gap:8px;background:rgba(56,189,248,0.08);padding:4px;border-radius:12px}
        .lb-tab{padding:8px 16px;border-radius:8px;font-size:0.8rem;font-weight:600;text-transform:uppercase;cursor:pointer;color:var(--text-muted);background:transparent;border:none;transition:all 0.2s}
        .lb-tab:hover{color:var(--accent)}
        .lb-tab.active{background:#fff;color:var(--accent);box-shadow:0 2px 8px rgba(56,189,248,0.15)}
        .lb-list{display:flex;flex-direction:column;gap:8px}
        .lb-row{display:flex;align-items:center;gap:15px;padding:12px 16px;background:rgba(56,189,248,0.05);border-radius:12px;transition:all 0.2s}
        .lb-row:hover{background:rgba(56,189,248,0.1)}
        .lb-row.top-1{background:linear-gradient(90deg,rgba(255,215,0,0.15),rgba(255,215,0,0.05));border:2px solid rgba(255,215,0,0.4)}
        .lb-row.top-2{background:linear-gradient(90deg,rgba(192,192,192,0.12),rgba(192,192,192,0.04));border:2px solid rgba(192,192,192,0.3)}
        .lb-row.top-3{background:linear-gradient(90deg,rgba(205,127,50,0.12),rgba(205,127,50,0.04));border:2px solid rgba(205,127,50,0.3)}
        .lb-row.is-me{border:2px solid var(--accent);background:rgba(56,189,248,0.1)}
        .lb-rank{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;width:32px;color:var(--text-muted)}
        .lb-row.top-1 .lb-rank{color:#ffd700}
        .lb-row.top-2 .lb-rank{color:#c0c0c0}
        .lb-row.top-3 .lb-rank{color:#cd7f32}
        .lb-name{flex:1;font-weight:600;font-size:0.95rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .lb-score{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;color:var(--accent)}
        .lb-empty{text-align:center;padding:30px;color:var(--text-muted);font-size:0.9rem}
        .lb-loading{text-align:center;padding:30px}
        .lb-loading::after{content:'';display:inline-block;width:20px;height:20px;border:2px solid var(--accent);border-top-color:transparent;border-radius:50%;animation:spin 0.8s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}

        footer{background:var(--dark);color:#fff;padding:30px 20px;text-align:center}
        .footer-inner{max-width:1000px;margin:0 auto}
        .footer-links{display:flex;justify-content:center;gap:24px;margin-bottom:16px;flex-wrap:wrap}
        .footer-links a{color:rgba(255,255,255,0.6);font-size:0.85rem;transition:color 0.2s}
        .footer-links a:hover{color:#fff}
        .footer-copy{font-size:0.8rem;color:rgba(255,255,255,0.4)}
    </style>
</head>
<body>
    <div id="site-header"></div>
    <script src="/header.js"></script>

    <main>
        <section class="game-hero">
            <div class="game-hero-content">
                <svg class="game-icon" viewBox="0 0 100 100" fill="none">
                    <circle cx="50" cy="50" r="45" fill="#38bdf8"/>
                    <ellipse cx="50" cy="55" rx="30" ry="25" fill="#fbbf24"/>
                    <ellipse cx="40" cy="48" rx="8" ry="10" fill="#fff"/>
                    <circle cx="42" cy="48" r="4" fill="#1a1a2e"/>
                    <path d="M65 50 L85 45 L85 55 Z" fill="#fb923c"/>
                    <ellipse cx="35" cy="60" rx="12" ry="8" fill="#f97316"/>
                </svg>
                <h1 class="game-hero-title">SKY HOP</h1>
                <p class="game-hero-desc">Tap to fly! Navigate through the sky and avoid obstacles.</p>
            </div>
        </section>

        <div class="game-wrapper">
            <div class="game-container">
                <div class="stats-bar">
                    <div class="stat-card">
                        <div class="stat-label">Score</div>
                        <div class="stat-value" id="score-display">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Best</div>
                        <div class="stat-value best" id="best-display">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Games</div>
                        <div class="stat-value" id="games-display">0</div>
                    </div>
                </div>

                <div class="game-board">
                    <div class="canvas-wrapper">
                        <canvas id="canvas" width="360" height="540"></canvas>
                        <div class="game-overlay" id="overlay">
                            <div class="overlay-title start" id="overlay-title">SKY HOP</div>
                            <div class="overlay-score hidden" id="overlay-score">0</div>
                            <div class="new-best hidden" id="new-best">üèÜ NEW BEST!</div>
                            <p class="overlay-text" id="overlay-text">Tap or press Space to fly</p>
                            <button class="btn btn-primary" id="start-btn">START</button>
                        </div>
                    </div>
                    <p class="tap-hint">Tap screen or press SPACE to hop</p>
                </div>

                <div class="leaderboard-section">
                    <div class="lb-header">
                        <h2 class="lb-title">üèÜ Leaderboard</h2>
                        <div class="lb-tabs">
                            <button class="lb-tab active" data-period="daily">Today</button>
                            <button class="lb-tab" data-period="weekly">Week</button>
                            <button class="lb-tab" data-period="alltime">All Time</button>
                        </div>
                    </div>
                    <div class="lb-list" id="leaderboard">
                        <div class="lb-loading"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-inner">
            <div class="footer-links">
                <a href="/">Home</a>
                <a href="/solo.html">Solo Games</a>
                <a href="/leaderboards.html">Leaderboards</a>
            </div>
            <p class="footer-copy">¬© 2025 TheGaming.co ‚Äî Free games, forever.</p>
        </div>
    </footer>

    <script>
        const SUPABASE_URL = 'https://tvvivtmzofsyehatzlvl.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR2dml2dG16b2ZzeWVoYXR6bHZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4OTExODYsImV4cCI6MjA4MDQ2NzE4Nn0.Qy8kHMO0Nb4yJ0ZHjby7RuQtzwWB8rUcZvkdnbL1b3M';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const GAME_ID = 'sky-hop';

        // Canvas setup
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const W = canvas.width;
        const H = canvas.height;

        // Game state
        let gameRunning = false;
        let score = 0;
        let bestScore = parseInt(localStorage.getItem('skyhop_best') || '0');
        let gamesPlayed = parseInt(localStorage.getItem('skyhop_games') || '0');
        let currentUser = null;

        // Bird
        let bird = { x: 80, y: H / 2, vy: 0, radius: 18 };
        const GRAVITY = 0.4;
        const JUMP = -7;

        // Pipes
        let pipes = [];
        const PIPE_WIDTH = 60;
        const PIPE_GAP = 150;
        const PIPE_SPEED = 2.5;
        let pipeTimer = 0;
        const PIPE_INTERVAL = 100;

        // Clouds (background decoration)
        let clouds = [];
        for (let i = 0; i < 5; i++) {
            clouds.push({ x: Math.random() * W, y: Math.random() * H * 0.6, size: 30 + Math.random() * 40 });
        }

        // UI elements
        const overlay = document.getElementById('overlay');
        const overlayTitle = document.getElementById('overlay-title');
        const overlayScore = document.getElementById('overlay-score');
        const overlayText = document.getElementById('overlay-text');
        const newBestEl = document.getElementById('new-best');
        const startBtn = document.getElementById('start-btn');
        const scoreDisplay = document.getElementById('score-display');
        const bestDisplay = document.getElementById('best-display');
        const gamesDisplay = document.getElementById('games-display');

        // Update displays
        function updateDisplays() {
            scoreDisplay.textContent = score;
            bestDisplay.textContent = bestScore;
            gamesDisplay.textContent = gamesPlayed;
        }
        updateDisplays();

        // Draw functions
        function drawBackground() {
            // Sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, H);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#E0F7FA');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, W, H);

            // Clouds
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            clouds.forEach(cloud => {
                ctx.beginPath();
                ctx.arc(cloud.x, cloud.y, cloud.size, 0, Math.PI * 2);
                ctx.arc(cloud.x + cloud.size * 0.6, cloud.y - cloud.size * 0.2, cloud.size * 0.7, 0, Math.PI * 2);
                ctx.arc(cloud.x + cloud.size * 1.2, cloud.y, cloud.size * 0.6, 0, Math.PI * 2);
                ctx.fill();
            });

            // Ground
            ctx.fillStyle = '#90EE90';
            ctx.fillRect(0, H - 40, W, 40);
            ctx.fillStyle = '#228B22';
            ctx.fillRect(0, H - 40, W, 5);
        }

        function drawBird() {
            const x = bird.x;
            const y = bird.y;
            const r = bird.radius;
            
            // Body (yellow)
            ctx.fillStyle = '#fbbf24';
            ctx.beginPath();
            ctx.ellipse(x, y, r, r * 0.85, 0, 0, Math.PI * 2);
            ctx.fill();

            // Wing
            ctx.fillStyle = '#f97316';
            ctx.beginPath();
            ctx.ellipse(x - 5, y + 3, r * 0.5, r * 0.35, -0.3, 0, Math.PI * 2);
            ctx.fill();

            // Eye (white)
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.ellipse(x + 6, y - 5, 7, 8, 0, 0, Math.PI * 2);
            ctx.fill();

            // Pupil
            ctx.fillStyle = '#1a1a2e';
            ctx.beginPath();
            ctx.arc(x + 8, y - 5, 3.5, 0, Math.PI * 2);
            ctx.fill();

            // Beak
            ctx.fillStyle = '#fb923c';
            ctx.beginPath();
            ctx.moveTo(x + r - 2, y);
            ctx.lineTo(x + r + 12, y - 4);
            ctx.lineTo(x + r + 12, y + 4);
            ctx.closePath();
            ctx.fill();
        }

        function drawPipes() {
            pipes.forEach(pipe => {
                // Pipe gradient
                const gradient = ctx.createLinearGradient(pipe.x, 0, pipe.x + PIPE_WIDTH, 0);
                gradient.addColorStop(0, '#22c55e');
                gradient.addColorStop(0.5, '#4ade80');
                gradient.addColorStop(1, '#22c55e');
                ctx.fillStyle = gradient;

                // Top pipe
                ctx.fillRect(pipe.x, 0, PIPE_WIDTH, pipe.topHeight);
                // Top pipe cap
                ctx.fillRect(pipe.x - 5, pipe.topHeight - 25, PIPE_WIDTH + 10, 25);

                // Bottom pipe
                const bottomY = pipe.topHeight + PIPE_GAP;
                ctx.fillRect(pipe.x, bottomY, PIPE_WIDTH, H - bottomY - 40);
                // Bottom pipe cap
                ctx.fillRect(pipe.x - 5, bottomY, PIPE_WIDTH + 10, 25);

                // Highlights
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.fillRect(pipe.x + 5, 0, 8, pipe.topHeight - 25);
                ctx.fillRect(pipe.x + 5, bottomY + 25, 8, H - bottomY - 65);
            });
        }

        function drawScore() {
            ctx.fillStyle = '#fff';
            ctx.strokeStyle = '#1a1a2e';
            ctx.lineWidth = 4;
            ctx.font = "bold 48px 'Bebas Neue', sans-serif";
            ctx.textAlign = 'center';
            ctx.strokeText(score, W / 2, 60);
            ctx.fillText(score, W / 2, 60);
        }

        // Game logic
        function jump() {
            if (!gameRunning) return;
            bird.vy = JUMP;
        }

        function update() {
            if (!gameRunning) return;

            // Bird physics
            bird.vy += GRAVITY;
            bird.y += bird.vy;

            // Move clouds
            clouds.forEach(cloud => {
                cloud.x -= 0.3;
                if (cloud.x + cloud.size * 2 < 0) {
                    cloud.x = W + cloud.size;
                    cloud.y = Math.random() * H * 0.6;
                }
            });

            // Spawn pipes
            pipeTimer++;
            if (pipeTimer >= PIPE_INTERVAL) {
                pipeTimer = 0;
                const minTop = 60;
                const maxTop = H - PIPE_GAP - 100;
                const topHeight = minTop + Math.random() * (maxTop - minTop);
                pipes.push({ x: W, topHeight, passed: false });
            }

            // Move pipes
            pipes.forEach(pipe => {
                pipe.x -= PIPE_SPEED;

                // Score when passing
                if (!pipe.passed && pipe.x + PIPE_WIDTH < bird.x) {
                    pipe.passed = true;
                    score++;
                    scoreDisplay.textContent = score;
                }
            });

            // Remove off-screen pipes
            pipes = pipes.filter(p => p.x + PIPE_WIDTH > 0);

            // Collision detection
            // Ground/ceiling
            if (bird.y + bird.radius > H - 40 || bird.y - bird.radius < 0) {
                gameOver();
                return;
            }

            // Pipes
            for (const pipe of pipes) {
                // Check if bird is in pipe x range
                if (bird.x + bird.radius > pipe.x && bird.x - bird.radius < pipe.x + PIPE_WIDTH) {
                    // Check top pipe
                    if (bird.y - bird.radius < pipe.topHeight) {
                        gameOver();
                        return;
                    }
                    // Check bottom pipe
                    if (bird.y + bird.radius > pipe.topHeight + PIPE_GAP) {
                        gameOver();
                        return;
                    }
                }
            }
        }

        function draw() {
            drawBackground();
            drawPipes();
            drawBird();
            if (gameRunning) drawScore();
        }

        function gameLoop() {
            update();
            draw();
            if (gameRunning) requestAnimationFrame(gameLoop);
        }

        function startGame() {
            gameRunning = true;
            score = 0;
            bird = { x: 80, y: H / 2, vy: 0, radius: 18 };
            pipes = [];
            pipeTimer = 0;
            overlay.classList.add('hidden');
            scoreDisplay.textContent = '0';
            gameLoop();
        }

        async function gameOver() {
            gameRunning = false;
            gamesPlayed++;
            localStorage.setItem('skyhop_games', gamesPlayed);

            let isNewBest = false;
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem('skyhop_best', bestScore);
                isNewBest = true;
            }

            updateDisplays();

            // Show overlay
            overlayTitle.textContent = 'GAME OVER';
            overlayTitle.className = 'overlay-title gameover';
            overlayScore.textContent = score;
            overlayScore.classList.remove('hidden');
            overlayText.textContent = 'Tap or press Space to try again';
            startBtn.textContent = 'PLAY AGAIN';
            newBestEl.classList.toggle('hidden', !isNewBest);
            overlay.classList.remove('hidden');

            // Submit score
            await submitScore(score);
            loadLeaderboard();
        }

        // Input handlers
        function handleInput(e) {
            if (e.type === 'keydown' && e.code !== 'Space') return;
            e.preventDefault();

            if (!gameRunning) {
                startGame();
            } else {
                jump();
            }
        }

        document.addEventListener('keydown', handleInput);
        canvas.addEventListener('click', handleInput);
        canvas.addEventListener('touchstart', handleInput);
        startBtn.addEventListener('click', startGame);

        // Initial draw
        draw();

        // Supabase functions
        async function loadUser() {
            const { data: { session } } = await supabaseClient.auth.getSession();
            if (session?.user) {
                currentUser = session.user;
                const { data: profile } = await supabase
                    .from('profiles')
                    .select('display_name')
                    .eq('id', currentUser.id)
                    .single();
                if (profile) currentUser.display_name = profile.display_name;
            }
        }

        async function submitScore(finalScore) {
            if (!currentUser || finalScore < 1) return;
            try {
                await supabaseClient.from('solo_scores').upsert({
                    user_id: currentUser.id,
                    game_id: GAME_ID,
                    score: finalScore,
                    played_at: new Date().toISOString()
                }, { onConflict: 'user_id,game_id', ignoreDuplicates: false });
            } catch (e) {
                console.error('Score submit error:', e);
            }
        }

        async function loadLeaderboard(period = 'daily') {
            const lb = document.getElementById('leaderboard');
            lb.innerHTML = '<div class="lb-loading"></div>';

            try {
                let query = supabase
                    .from('solo_scores')
                    .select('score, user_id, played_at, profiles(display_name)')
                    .eq('game_id', GAME_ID)
                    .order('score', { ascending: false })
                    .limit(10);

                if (period === 'daily') {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    query = query.gte('played_at', today.toISOString());
                } else if (period === 'weekly') {
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    query = query.gte('played_at', weekAgo.toISOString());
                }

                const { data, error } = await query;
                if (error) throw error;

                if (!data || data.length === 0) {
                    lb.innerHTML = '<div class="lb-empty">No scores yet. Be the first!</div>';
                    return;
                }

                lb.innerHTML = data.map((entry, i) => {
                    const rank = i + 1;
                    const name = entry.profiles?.display_name || 'Anonymous';
                    const isMe = currentUser && entry.user_id === currentUser.id;
                    const rankClass = rank <= 3 ? `top-${rank}` : '';
                    const meClass = isMe ? 'is-me' : '';
                    return `
                        <div class="lb-row ${rankClass} ${meClass}">
                            <span class="lb-rank">${rank}</span>
                            <span class="lb-name">${escapeHtml(name)}</span>
                            <span class="lb-score">${entry.score.toLocaleString()}</span>
                        </div>
                    `;
                }).join('');
            } catch (e) {
                console.error('Leaderboard error:', e);
                lb.innerHTML = '<div class="lb-empty">Failed to load leaderboard</div>';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Tab handlers
        document.querySelectorAll('.lb-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.lb-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                loadLeaderboard(tab.dataset.period);
            });
        });

        // Init
        loadUser();
        loadLeaderboard();
    </script>
<script src="/engagement.js"></script>
</body>
</html>
